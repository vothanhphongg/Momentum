import{a as f,b as kt}from"./chunk-QN3RSQM6.js";import{a as bt}from"./chunk-OIBIIFJS.js";import{a as Bt}from"./chunk-PESX4JIQ.js";import{a as Nt,b as et}from"./chunk-TF3SJD3W.js";import{a as ht}from"./chunk-ASEWS4VF.js";import"./chunk-ACTCEXOV.js";import{a as Y}from"./chunk-3CTIGV4T.js";import"./chunk-52XLG23J.js";import{c as V}from"./chunk-YQHUKBMA.js";import{a as yt,b as xt,c as At,d as gt}from"./chunk-IHUUHTWY.js";import"./chunk-N4CUQAO7.js";import{S as ft}from"./chunk-KLLSVAFY.js";import{a as ot}from"./chunk-ZTAZ2272.js";import"./chunk-Q76QXAWY.js";import"./chunk-THSNJ5WU.js";import{a as G}from"./chunk-V3IFYKWM.js";import{Ua as H,Va as M}from"./chunk-YALUYHLV.js";import"./chunk-CZ2ZBAZV.js";import{o as oo}from"./chunk-5QMHGZLF.js";import{ec as wt}from"./chunk-HPWCPLRR.js";import"./chunk-O6ZBO5JF.js";import"./chunk-TSTPZ3JM.js";import{a as It}from"./chunk-ON6S2DB7.js";import{j as pt,p as to}from"./chunk-SZD6WTBQ.js";import{f as _t,i as Rt}from"./chunk-ASR4HLU7.js";import"./chunk-ANIUN6US.js";import"./chunk-3DZ7WRLL.js";import{d as K,f as lt}from"./chunk-DEOJU4Z3.js";import"./chunk-N2BCRNDB.js";import"./chunk-LNOPECCQ.js";import"./chunk-CB7FOZNP.js";import{c}from"./chunk-43VURGIT.js";import{A as st,B as it,H as Qt,ad as dt,ia as at,ja as Xt,rd as $t}from"./chunk-TM67VPZU.js";import"./chunk-VW6OQNWT.js";import{D as C,q as ut,w as ct}from"./chunk-PUSMMCUD.js";import{R as T,o as k,z as d}from"./chunk-UWJLNJLY.js";import"./chunk-VRY2ADKE.js";import"./chunk-5U7FO2PW.js";import"./chunk-PDUOSATP.js";import"./chunk-XDY6V34Y.js";import"./chunk-YJFNO57I.js";import"./chunk-DZ6CTC22.js";import{c as mt,ea as x}from"./chunk-JT3LNHPY.js";import"./chunk-47UWF72W.js";import{b as g}from"./chunk-JWYCKY2V.js";import"./chunk-G2266BV2.js";import"./chunk-L4PAIYPH.js";import"./chunk-UT7LJPKF.js";import"./chunk-AFZ6A2B3.js";import"./chunk-VVPY7ZA7.js";import"./chunk-KUW5VATV.js";import"./chunk-BNAVWOJ2.js";import"./chunk-IG2Q5ALZ.js";import"./chunk-WOMUNWBT.js";import"./chunk-QYVQBXDG.js";import"./chunk-7D4PUIEN.js";import"./chunk-7QO4TZYQ.js";import"./chunk-FF4LY6PE.js";import"./chunk-76KCDJDG.js";import"./chunk-YDUDQP2P.js";import"./chunk-PGPFV4JQ.js";import"./chunk-MIBHDVGP.js";import"./chunk-7VFUX7IX.js";import"./chunk-XLF4LAH2.js";import"./chunk-ONKZ57T6.js";import"./chunk-ZC7Q7LCH.js";import{f as p,o as t,q as o}from"./chunk-6KXF36WM.js";t();o();var R=p(g()),U=p(It());t();o();var W=p(g());t();o();var Z=p(g());t();o();var rt={root:"_root_dowdc_1",header:"_header_dowdc_30"};t();o();t();o();var Lt=p(g());t();o();var v=ot(xt,gt),j=ot(yt,At);t();o();var Et=p(It());function eo(){let e=(0,Et.useHistory)(),r=s=>(y=!0)=>{y?e.replace(s):e.push(s)},n=s=>e.location.pathname===s,i=r(M),m=r(H),u=n(H),a=n(M);return{isHomePage:u,isAddPage:a,gotoAddPage:i,gotoHomePage:m}}var z=eo;function ro(){let[e]=v(),{gotoHomePage:r,isHomePage:n}=z();(0,Lt.useLayoutEffect)(()=>{!n&&!e&&r()},[r,n,e])}var Ft=ro;function no(){return Ft(),null}var St=no;function so({children:e,hidden:r=!1}){return Z.default.createElement(c.Box,{className:rt.root},Z.default.createElement(Bt,{className:rt.header}),r?null:e,Z.default.createElement(St,null))}var q=so;t();o();var J=p(g());T();t();o();var O={root:"_root_5jwcg_1",titleBox:"_titleBox_5jwcg_17",title:"_title_5jwcg_17",subtitle:"_subtitle_5jwcg_112",add:"_add_5jwcg_131"};function io(){let e=d("wallet_extension_addaccount_title_add_account"),r=d("wallet_extension_addaccount_subtitle_select_account");return J.default.createElement(c.Box,{className:O.titleBox},J.default.createElement(c.Box,{className:O.title},e),J.default.createElement(c.Box,{className:O.subtitle},r))}var Tt=io;t();o();var _=p(g());T();t();o();var E={root:"_root_1umy7_2",confirm:"_confirm_1umy7_41",max:"_max_1umy7_55",label:"_label_1umy7_67",name:"_name_1umy7_73",nums:"_nums_1umy7_80",option:"_option_1umy7_86",icon:"_icon_1umy7_105"};t();o();var Ct=p(g());T();$t();var ao=e=>e.filter(r=>[dt.MNEMONIC].includes(r.keyringIdentityType)).filter(r=>r.walletIdentities.every(n=>n.needBackup!==1)),nt=1;function mo(){let e=C.useForm(),{gotoAddPage:r}=z(),{keyringIdentities:n,remainAccountAmount:i}=Y(),[,m]=j(),[,u]=v(),a=h=>{if(Object.keys(e.getErrors()).length>0)return;let{keyringId:S,amount:B}=h;if(B==="0")return;let tt=Number(B||nt);!S||tt>i||(m(tt),u(S),r())},s=(0,Ct.useMemo)(()=>ao(n).map(h=>({value:h.keyringId,label:h.keyringName,len:h.walletIdentities.length})),[n]),y={keyringId:s[0]?.value,amount:""},N=(h,F=nt)=>{if(Number(F||nt)<=i&&i>0)return Promise.resolve();let B=d("wallet_extension_addaccount_remainder_added_upper_limits",{num:k.thousandFormat(i)});return Promise.reject(B)},A=()=>{e.setFieldsValue({amount:i})},b=i<=0||s.length<=0;return{initialValues:y,onSubmit:a,form:e,options:s,amountValidator:N,onSetMaxAmount:A,disableAdd:b}}var Dt=mo;function uo(){let{initialValues:e,onSubmit:r,form:n,options:i,amountValidator:m,onSetMaxAmount:u,disableAdd:a}=Dt(),{isSm:s}=V(),y=s?G.FooterActions:_.default.Fragment,N=A=>_.default.createElement(_.default.Fragment,null,_.default.createElement("div",{className:E.name},A.label),_.default.createElement("div",{className:E.nums},d("wallet_extension_batch_modify_account_desc",{num:k.thousandFormat(A.len)})));return _.default.createElement(c.Box,{className:E.root},_.default.createElement(C,{requiredMark:!0,initialValues:e,onSubmit:r,form:n},_.default.createElement(C.Item,{label:d("wallet_extension_addaccount_title_select_wallet"),name:"keyringId"},_.default.createElement(ct,{title:d("wallet_extension_addaccount_title_select_wallet"),options:i,searchable:!1,showSelectedIcon:!0,label:A=>_.default.createElement("div",{className:E.label},N(A)),renderOption:({option:A,activeIcon:b})=>_.default.createElement("div",{className:E.option},_.default.createElement("div",null,N(A)),_.default.createElement("div",{className:E.icon},b))})),_.default.createElement(C.Item,{label:d("wallet_extension_addaccount_text_added_amount"),name:"amount",rules:[{validator:m}]},_.default.createElement(ut.Number,{placeholder:"1",precision:0,min:1,suffix:_.default.createElement(c.Box,{className:E.max,onClick:u},d("wallet_extension_addaccount_textbtn_max"))})),_.default.createElement(y,null,_.default.createElement(C.Item,{noStyle:!0,className:!s&&E.confirm},_.default.createElement(x,{category:x.CATEGORY.fill,type:x.TYPE.highlight,size:x.SIZE.xl,disabled:a,htmlType:"submit",block:!0},d("wallet_extension_addaccount_btn_add"))))))}var vt=uo;function co(){return W.default.createElement(q,null,W.default.createElement(c.Box,{className:O.root},W.default.createElement(Tt,null),W.default.createElement(vt,null)))}var Ot=co;t();o();var D=p(g());t();o();var Pt={root:"_root_1uqqr_1"};t();o();var w=p(g()),Wt=p(wt()),Ut=p(oo());t();o();lt();var Ht=p(wt());to();Rt();var lo=()=>{let e=(0,Ht.useDispatch)();return async(n,i=1)=>{try{return await K().addNewWallets(n,i)}catch(m){throw e(_t(m?.message)),m}finally{await pt(e)}}},Mt=lo;lt();var fo=e=>{let{newAccountsSuccessCount:r,newAccountsFailedCount:n}=e.metamask;return{newAccountsSuccessCount:r,newAccountsFailedCount:n}},_o=e=>{let[r,n]=(0,w.useState)(f.NONE),{newAccountsSuccessCount:i,newAccountsFailedCount:m}=(0,Wt.useSelector)(fo),u=et(),a=(0,w.useRef)(),[s]=j(),[y,N]=(0,w.useState)(0),[A,b]=(0,w.useState)(0),h=Mt(),F=s-y,S=P=>P>0;(0,w.useEffect)(()=>{s<=0||(y===s&&n(f.FINISHED),A===s&&n(f.FAILED))},[A,y,s]);let B=async()=>{if(!(y>0)&&!!S(s)){n(f.ADDING);try{let P=await h(e,s);N(P),b(s-P)}catch{b(s)}finally{n(f.FINISHED)}}};return{start:B,cancel:()=>{n(f.FINISHED),a.current?.cancel()},retry:()=>{F>0&&(b(0),B())},failed:u?A+m:A,success:u?y+i:y,total:s,remain:F,status:r}},po=e=>{let{keyringIdentities:r,remainAccountAmount:n}=Y(),i=r.find(u=>u.keyringId===e),m=i?.walletIdentities?.[0]?.walletId;return{keyring:i,walletId:m,remainAccountAmount:n}};function yo(){let[e]=v(),r=et(),n=(0,Ut.useLatest)(r),{walletId:i,keyring:m,remainAccountAmount:u}=po(e),a=(0,w.useRef)(!1),{start:s,cancel:y,retry:N,success:A,failed:b,total:h,status:F}=_o(i),S=bt();return(0,w.useEffect)(()=>{!a.current&&i&&u>0&&(s(),a.current=!0)},[i,u,s]),(0,w.useEffect)(()=>{let B=async()=>{n.current===!0&&K().stopBatchAddNewWallets()};return window.addEventListener("beforeunload",B),()=>{window.removeEventListener("beforeunload",B)}},[]),{start:s,cancel:y,retry:N,success:A,failed:b,total:h,keyring:m,status:F,onFinish:S}}var Kt=yo;t();o();var Vt=p(g()),Yt=p(mt());T();t();o();var Gt={root:"_root_x2b1d_1"};var xo=({status:e,className:r,walletName:n})=>{let m={[f.NONE]:null,[f.ADDING]:{key:"wallet_extension_addaccount_remainder_account_creating",params:{acctName:n}},[f.FINISHED]:{key:"wallet_extension_addaccount_remainder_account_created"},[f.FAILED]:{key:"wallet_extension_addaccount_adding_maintitle_create_failed"}}[e],u=m?d(m.key,m.params):"";return Vt.default.createElement(c.Box,{className:(0,Yt.default)(Gt.root,r)},u)},jt=xo;t();o();var X=p(g());T();t();o();var Q={root:"_root_1n2pz_1",item:"_item_1n2pz_75",retry:"_retry_1n2pz_98"};t();o();T();var Ao=({status:e,success:r=0,total:n=0,failed:i=0})=>{let u=f.FINISHED===e?n-r:i,a={success:{key:"wallet_extension_addaccount_adding_text_create_success",params:{num:k.thousandFormat(r)}},failed:{key:"wallet_extension_addaccount_adding_text_create_failed",params:{num:k.thousandFormat(u)},withRetry:u>0},adding:{key:"wallet_extension_addaccount_remainder_created_account",params:{successnum:k.thousandFormat(r),totalnum:k.thousandFormat(n)}}};return{items:{[f.NONE]:[],[f.ADDING]:[a.adding],[f.FINISHED]:[a.success,u>0?a.failed:void 0].filter(Boolean),[f.FAILED]:[a.failed]}[e]}},zt=Ao;function go(e){let{items:r=[]}=zt(e),{retry:n}=e;return X.default.createElement(c.Box,{className:Q.root},r.map((i,m)=>{let{key:u,params:a,withRetry:s}=i;return X.default.createElement(c.Box,{key:m,className:Q.item},d(u,a),s&&X.default.createElement(c.Box,{onClick:n,className:Q.retry},d("wallet_extension_addaccount_adding_textbtn_retry")))}))}var Zt=go;t();o();var I=p(g()),$=p(mt());T();Xt();Qt();t();o();var L={root:"_root_1gfwy_1",actions:"_actions_1gfwy_21",adding:"_adding_1gfwy_38",finish:"_finish_1gfwy_52",tip:"_tip_1gfwy_88",hiddenTip:"_hiddenTip_1gfwy_154",mobileFinishActions:"_mobileFinishActions_1gfwy_162"};function wo(e){let{isSm:r}=V(),{status:n,cancel:i,download:m,finish:u}=e,a=n===f.ADDING,s=at(),y=r?G:c.Box,N=r&&!a?{offsetBottom:0,className:(0,$.default)(L.actions,L.mobileFinishActions)}:{};return I.default.createElement(c.Box,{className:L.root},I.default.createElement(y,{className:(0,$.default)(L.actions,a?L.adding:L.finish),...N},a?I.default.createElement(I.default.Fragment,null,I.default.createElement(x,{category:x.CATEGORY.outline,type:x.TYPE.primary,onClick:i,size:x.SIZE.xl,block:!0},d("wallet_extension_addaccount_adding_btn_cancel"))):I.default.createElement(I.default.Fragment,null,s!==st&&s!==it&&I.default.createElement(x,{category:x.CATEGORY.outline,type:x.TYPE.primary,size:x.SIZE.xl,onClick:Nt(ft)(m),block:r},d("wallet_extension_addaccount_adding_btn_download_address")),I.default.createElement(x,{category:x.CATEGORY.fill,type:x.TYPE.highlight,size:x.SIZE.xl,onClick:u,block:r},d("wallet_extension_addaccount_adding_btn_confirm")))),I.default.createElement(c.Box,{className:(0,$.default)(L.tip,!a&&L.hiddenTip)},a?d("wallet_extension_addaccount_adding_text_not_close"):""))}var qt=wo;function Io(){let{cancel:e,retry:r,success:n,failed:i,total:m,keyring:u,status:a,onFinish:s}=Kt(),{downloadAddress:y}=ht();return D.default.createElement(q,{hidden:a===f.NONE},D.default.createElement(c.Box,{className:Pt.root},D.default.createElement(kt,{status:a}),D.default.createElement(jt,{status:a,walletName:u?.keyringName}),D.default.createElement(Zt,{status:a,retry:r,total:m,failed:i,success:n}),D.default.createElement(qt,{status:a,cancel:e,download:y,finish:s})))}var Jt=Io;var En=()=>R.default.createElement(U.Switch,null,R.default.createElement(U.Route,{path:H,component:Ot,exact:!0}),R.default.createElement(U.Route,{path:M,component:Jt,exact:!0}));export{En as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=BatchAddAccount-MVGNUW2N.js.map
