import{a as he}from"./chunk-V7MKKAGW.js";import{c as Pe,d as U}from"./chunk-SKMCCAGC.js";import{a as ge}from"./chunk-MKSCYWSV.js";import{e as Fe}from"./chunk-XIYLMV6I.js";import{b as B}from"./chunk-YJQGXXOQ.js";import{a as V}from"./chunk-6SEP5B7P.js";import{e as pe}from"./chunk-I3CPAVOC.js";import{o as X}from"./chunk-5QMHGZLF.js";import{G as fe}from"./chunk-HPWCPLRR.js";import{c as de}from"./chunk-YOPEZ2F5.js";import{a as Ge}from"./chunk-2HSCH6R3.js";import{aa as C}from"./chunk-N2BCRNDB.js";import{$ as W,Ea as le,K as w,L as b,M as ne,N as k,Na as We,P as H,U as oe,W as ce,X as me,ha as $,ya as ue,za as He}from"./chunk-TM67VPZU.js";import{R as Ae,o as R,z as ae}from"./chunk-UWJLNJLY.js";import{H as se,f as ie,ra as re}from"./chunk-XDY6V34Y.js";import{b as A}from"./chunk-JWYCKY2V.js";import{f as T,o as g,q as d}from"./chunk-6KXF36WM.js";g();d();var G=T(A()),M=T(X());re();Ae();He();We();$();g();d();var S=T(A()),Re=T(X());g();d();var Ce=T(A()),N=T(X());$();g();d();$();var Le=async(e={})=>e?.baseFeePerGas!==void 0,K=e=>parseInt(e,16);function Ue({baseFeePerGas:e,number:t}){return{number:t,baseFeePerGas:e,gasUsedRatio:null,priorityFeesByPercentile:null}}function Ve({baseFeePerGas:e,number:t,blockIndex:a,gasUsedRatios:s,priorityFeePercentileGroups:i,percentiles:r}){let n=s[a],c=i[a],u=r.reduce((o,m,l)=>{let f=c[l];return{...o,[m]:K(f)}},{});return{number:t,baseFeePerGas:e,gasUsedRatio:n,priorityFeesByPercentile:u}}async function ye({web3:e,numberOfBlocks:t,endBlockNumber:a,percentiles:s,includeNextBlock:i}){let r=await e.eth.getFeeHistory(t,a,s),n=K(r.oldestBlock);if(r.baseFeePerGas!==void 0&&r.baseFeePerGas.length>0&&r.gasUsedRatio.length>0&&(r.reward===void 0||r.reward.length>0)){let c=i?r.baseFeePerGas:r.baseFeePerGas.slice(0,t),u=r.gasUsedRatio,o=r.reward??[],m=u.length;return c.map((l,f)=>{let h=K(l),P=w(n,f);return f>=m?Ue({baseFeePerGas:h,number:P}):Ve({baseFeePerGas:h,number:P,blockIndex:f,gasUsedRatios:u,priorityFeePercentileGroups:o,percentiles:s})})}return[]}var J=1024;function Ye(e,t){k(e,t)&&(t=e);let a=[];for(let s=b(e,t);k(s,e);s=w(s,J)){let i=b(e,s),r=i<J?i:J,n=w(s,r);a.push({numberOfBlocks:r,endBlockNumber:n})}return a}var xe=async({web3:e,numberOfBlocks:t,endBlock:a="latest",percentiles:s=[],includeNextBlock:i=!1})=>{let r=s.length>0?Array.from(new Set(s)).sort((o,m)=>o-m):[],c=Ye(a,t);return(await Promise.all(c.map(({numberOfBlocks:o,endBlockNumber:m},l)=>l===c.length-1?ye({web3:e,numberOfBlocks:o,endBlockNumber:m,percentiles:r,includeNextBlock:i}):ye({web3:e,numberOfBlocks:o,endBlockNumber:m,percentiles:r,includeNextBlock:!1})))).reduce((o,m)=>[...o,...m],[])};var qe=e=>e?B(e):{},ze=["0x144","0x2105"],$e=e=>(0,Ce.useCallback)(async()=>e?(await qe(e)).eth.getBlock("latest"):{},[e]),we=e=>(0,N.useMemoizedFn)(async({to:t,from:a,value:s,data:i=""},r)=>{let n=!r,c="";i?U(i)?c=fe(i):c=Pe(i):n||(c=ge(t,s||0));let u=await B(e),o={from:a,to:n?t:r};return n?o.value=s:o.value="0x0",c?o.data=c:o.data="0x",await u.eth.estimateGas(o)},[e]),Q=["low","medium","high"],Ee={low:{percentile:10,base:1.1,priority:.94,minSuggestedMaxPriorityFeePerGas:1e9,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:3e4}},medium:{percentile:20,base:1.2,priority:.97,minSuggestedMaxPriorityFeePerGas:15e8,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:45e3}},high:{percentile:30,base:1.25,priority:.98,minSuggestedMaxPriorityFeePerGas:2e9,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:6e4}}};function Xe(e){let t=e.slice().sort((i,r)=>k(b(i,r),0)?-1:1),a=t.length,s=Math.floor((a-1)/2);return t[s]}var Je=(e,t,a)=>{let s=a[e],i=t[t.length-1].baseFeePerGas,r=t.map(u=>"priorityFeesByPercentile"in u?u?.priorityFeesByPercentile?.[s.percentile]:null).filter(Boolean),n=Xe(r),c=w(i,n);return{baseFeePerGas:W(i,0),maxFeePerGas:W(c,0),maxPriorityFeePerGas:W(n,0)}},Ke=(e,t)=>Q.reduce((a,s)=>{let i=Je(s,e,t),{maxFeePerGas:r}=i;return[...a,{level:s,isSupportEip1559:!0,gasPrice:r,...i}]},[]),Qe=(e,t)=>(0,N.useMemoizedFn)(async a=>{let s=await B(e),i=await xe({web3:s,endBlock:a.number,numberOfBlocks:21,percentiles:[10,20,30]});return Ke(i,t)},[e]),Ze={low:{coefficient:1.1,level:"low"},medium:{coefficient:1.35,level:"medium"},high:{coefficient:1.7,level:"high"}},Ie=(e,t)=>(0,N.useMemoizedFn)(async()=>{let s=await(await B(e)).eth.getGasPrice();return Q.reduce((i,r)=>{let{level:n}=t[r];return[...i,{level:n,gasPrice:s}]},[])},[e]);function je(e){let{rpcNetworks:t}=Fe(),a=t.find(s=>s?.rpcUrl===e);return Q.reduce((s,i)=>{let r=a?.gasNormal?.[i]||Ze[i]?.coefficient,n=a?.gas1559?.[i]||Ee?.[i];return{evmNormalGasPrice:{...s.evmNormalGasPrice,[i]:{level:i,coefficient:r}},evm1559GasPrice:{...s.evm1559GasPrice,[i]:{...Ee[i],...n}}}},{})}var Te=(e,t={})=>{let a=je(e),s=$e(e),i=Ie(e,a?.evmNormalGasPrice),r=Qe(e,a?.evm1559GasPrice),n=t?.method;return(0,N.useMemoizedFn)(async c=>{if(e){let u=await s(),o=!de({chainId:c,method:n})&&!ze.includes(c)&&await Le(u),m,l=o?r:i;try{m=await l(u)}catch{m=await i(u)}return m}return[]},[e])};var tt=({txParams:e={}},t)=>{let{to:a,from:s,value:i,data:r,tokenAddress:n}=e,[c,u]=(0,S.useState)(""),[o,m]=(0,S.useState)(""),[l,f]=(0,S.useState)(!0),[h,P]=(0,S.useState)(!1),{extensionConfig:y}=V("rpc_info"),L=we((t||y)?.rpcUrl),{run:x}=(0,Re.useDebounceFn)(async()=>{try{f(!0);let E=await L({to:a,from:s,value:i,data:r},n);u(E),P(!1)}catch(E){m(E?.message||""),P(!0)}finally{f(!1)}},{wait:500});return(0,S.useEffect)(()=>{x()},[a,s,i,r,n,x]),{chainGasLimit:c,chainGasLimitError:o,chainGasLimitLoading:l,chainGasLimitLoadFailed:h}},be=tt;g();d();var F=T(A());re();var it=({txParams:e={}},t)=>{let[a,s]=(0,F.useState)([]),[i,r]=(0,F.useState)(""),[n,c]=(0,F.useState)(!0),[u,o]=(0,F.useState)(!1),{rpcUrl:m,chainId:l}=t,f=Te(m,e),h=7e3,P=(0,F.useRef)(),y=(0,F.useRef)(!0),D=()=>{y.current=null,clearTimeout(P.current)},L=async(x=!1)=>{try{x&&c(!0);let E=await f(l);(x||y.current)&&(s(E),o(!1))}catch(E){x&&(r(E?.message||""),o(!0))}finally{c(!1),y.current&&(P.current=setTimeout(()=>{L()},h))}};return(0,F.useEffect)(()=>t?.rpcUrl?(L(!0),()=>{D()}):ie,[t?.rpcUrl]),{isSupportEip1559:a[0]?.isSupportEip1559,chainGasPrices:a,chainGasPriceError:i,chainGasPriceLoading:n,chainGasPriceLoadFailed:u}},Se=it;var ve=e=>U(e)?Ge(e):e,ke={gas1559:{low:{base:"1.1",priority:"1.1"},medium:{base:"1.2",priority:"1.2"},high:{base:"1.3",priority:"1.3"},minPriority:"0"},gasNormal:{low:"1.1",medium:"1.2",high:"1.3"},gasLimit:"1.5"},st={low:C.SLOW,medium:C.STANDARD,high:C.FAST},rt={},at=({chainGasLevels:e})=>e.find(({typeKey:t})=>t===C.STANDARD)||rt,nt=()=>(0,M.useMemoizedFn)(async e=>{try{let{data:t}=await le(ue.getTestNetGasRate,{chainId:ve(e)});return t}catch{return ke}}),ot=e=>{let t=nt(),[a,s]=(0,G.useState)(!0),[i,r]=(0,G.useState)(ke);return(0,M.useAsyncEffect)(async()=>{if(e){let n=await t(e);r(n),s(!1)}},[e]),{loading:a,chainGasRate:i}},_e=(e,t)=>{let{maxFeePerGas:a,gasPrice:s,gasLimit:i}=e,r=a||s;return{...e,unitPrice:`${R.ceilShort(ce(r),2)} ${ae("extension_wallet_transaction_input_gwei")}`,totalPrice:pe(me(R.ceilMul(r,i,0)),{symbol:t?.symbol})}},ct=({chainGasLevels:e=[],chainGasRate:t={}})=>e.map(s=>{let i=t?.gas1559?.[s.level]||{},{baseFeePerGas:r,maxFeePerGas:n,maxPriorityFeePerGas:c,gasPrice:u,...o}=s,m=R.ceilMul(r,i?.base,0),l=ne([R.ceilMul(c,i?.priority,0),t?.gas1559?.minPriority?oe(t?.gas1559?.minPriority):0]),f=w(m,l),h=t?.gasNormal?.[s.level]||1;return{gasPrice:R.ceilMul(u,h,0),baseFeePerGas:m,maxPriorityFeePerGas:l,maxFeePerGas:f,...o}}),Z=({key:e,validDappGas:t,standardLevel:a,dappInjectedGasInfo:s})=>t&&s[e]||a[e],mt=({dappInjectedGasInfo:e,isSupportEip1559:t})=>{let[a,s]=(0,G.useState)(!1),{gasPrice:i,maxFeePerGas:r,maxPriorityFeePerGas:n}=e;return(0,G.useEffect)(()=>{s(t?H(i,0):H(n,0)&&H(r,n))},[t]),a},ut=(e={},t={},a=void 0)=>{let{extensionConfig:s}=V("rpc_info"),i=a||s,r=he(i.chanId),{chainGasPrices:n,isSupportEip1559:c,chainGasPriceError:u,chainGasPriceLoading:o,chainGasPriceLoadFailed:m}=Se({dappInjectedGasInfo:t,txParams:e},i),{chainGasLimit:l,chainGasLimitLoading:f,chainGasLimitError:h,chainGasLimitLoadFailed:P}=be({txParams:e,dappInjectedGasInfo:t},i),{chainGasRate:y,loading:D}=ot(i.chainId),[L,x]=(0,G.useState)(null),[E,q]=(0,G.useState)(C.STANDARD),_=mt({dappInjectedGasInfo:t,isSupportEip1559:c});(0,G.useEffect)(()=>{_&&q(C.CUSTOM)},[_]),(0,M.useAsyncEffect)(async()=>{if(i?.rpcUrl){let p=await r(i.chainId);se(p)||(q(C.CUSTOM),x(p))}},[i?.rpcUrl]);let Be=o||f||D,Ne=m||P,Me=u||h,De=y.gasLimit,O=R.ceilMul(l,De,0),z=(0,G.useMemo)(()=>ct({chainGasRate:y,chainGasLevels:n}).map(te=>_e({...te,gasLimit:O,typeKey:st[te.level]},i)),[c,y,n,O,i]),v=at({chainGasLevels:z}),I=(0,G.useMemo)(()=>{let p={...v,gasPrice:Z({key:"gasPrice",standardLevel:v,validDappGas:_,dappInjectedGasInfo:t}),maxFeePerGas:Z({key:"maxFeePerGas",standardLevel:v,validDappGas:_,dappInjectedGasInfo:t}),maxPriorityFeePerGas:Z({key:"maxPriorityFeePerGas",standardLevel:v,validDappGas:_,dappInjectedGasInfo:t})};return p.baseFeePerGas=b(p.maxFeePerGas,p.maxPriorityFeePerGas),p},[v,t,_]),j=(0,G.useMemo)(()=>{let p=O;return L?.gasLimit?p=L.gasLimit:t.gasLimit&&(p=ve(t.gasLimit)),{...L||I,gasLimit:p,typeKey:C.CUSTOM}},[O,L,I,t.gasLimit]),ee=(0,G.useMemo)(()=>[...z,_e(j,i)],[z,j,i]),Oe=ee.find(({typeKey:p})=>p===E)||{};return{setGasType:q,chainGasLevels:ee,currentGasInfo:Oe,setCustomGasOption:x,chainGasLoading:Be,chainGasError:Me,chainGasLoadFailed:Ne,chainGasPriceLoading:o,chainGasLimitLoading:f,chainGasPriceLoadFailed:m,chainGasLimitLoadFailed:P}},Zt=ut;export{we as a,Te as b,ke as c,nt as d,ct as e,Zt as f};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-M5H47IO2.js.map
