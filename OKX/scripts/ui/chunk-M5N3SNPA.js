import{a as x,b as f,d as ee,f as oe,k as ne}from"./chunk-SJXVXTEI.js";import{a as te}from"./chunk-XHICU65C.js";import{a as Xt}from"./chunk-RWQI7GDI.js";import{a as Jt,c as z,d as Qt}from"./chunk-M2Q6VTQI.js";import{a as $t}from"./chunk-2LCPVMSO.js";import{a as jt}from"./chunk-7CC6X6YX.js";import{b as qt,d as Wt}from"./chunk-DTLEDHZZ.js";import{a as zt}from"./chunk-ISZ2JUQK.js";import{f as Lt}from"./chunk-M5H47IO2.js";import{b as Ht}from"./chunk-HRKDKI66.js";import{b as Ft}from"./chunk-SKMCCAGC.js";import{a as Mt,b as it}from"./chunk-LR7KSTP2.js";import{a as Gt,d as Kt}from"./chunk-W23ABSXX.js";import{c as Yt}from"./chunk-R6X7EOIE.js";import{e as bt}from"./chunk-XIYLMV6I.js";import{a as ct,j as Zt}from"./chunk-A57OTXBP.js";import{l as B,n as Vt,p as Bt}from"./chunk-YJQGXXOQ.js";import{a as Y}from"./chunk-6SEP5B7P.js";import{b as Z}from"./chunk-KKG4PJ6O.js";import{b as st}from"./chunk-PDC447BO.js";import{W as Ut}from"./chunk-YALUYHLV.js";import{o as Dt}from"./chunk-5QMHGZLF.js";import{Bb as Ct,Fb as ht,Jb as wt,Kb as St,Sa as g,eb as M,ec as q,pb as Ot,rb as vt}from"./chunk-HPWCPLRR.js";import{a as ve}from"./chunk-ON6S2DB7.js";import{j as U,p as It}from"./chunk-SZD6WTBQ.js";import{d as v,f as at}from"./chunk-DEOJU4Z3.js";import{a as kt,b as S}from"./chunk-2HSCH6R3.js";import{H as L,q as b,sa as Oe}from"./chunk-N2BCRNDB.js";import{a as V}from"./chunk-UVFOW4HH.js";import{X as Pt,a as _t,b as Ne,ha as xe,kb as yt,lb as xt,ma as Nt,qa as Re,rc as Rt}from"./chunk-TM67VPZU.js";import{G as D}from"./chunk-PUSMMCUD.js";import{R as Et,z as h}from"./chunk-UWJLNJLY.js";import{L as gt,V as At,f as nt,ra as ye}from"./chunk-XDY6V34Y.js";import{b as rt}from"./chunk-JWYCKY2V.js";import{f as O,o as T,q as _}from"./chunk-6KXF36WM.js";T();_();var H=O(q());function We(){let t=(0,H.useSelector)(Kt),e=t&&t.metadata?t.metadata.id:null,n=e?1:0,o=(0,H.useSelector)(vt),r=o.length,a=(0,H.useSelector)(Ot),i=(0,H.useSelector)(St),m=i.length,s=(0,H.useSelector)(wt),c=s.length;return{unapprovedTxList:o,unapprovedTxCount:r,unapprovedSmCount:a,unapprovedStList:i,unapprovedStCount:m,unapprovedPermissionCount:n,unapprovedPermissionsRequestId:e,unapprovedSnList:s,unapprovedSnCount:c,unapprovedRequestCount:r+a+m+c+n}}T();_();T();_();var E=O(rt()),dt=O(q()),Te=O(ve());Et();T();_();var $=O(q()),G=O(Dt()),k=O(Oe());ye();Ne();at();Re();Rt();T();_();at();var re=async t=>await v().rpcEvmAddTransaction(t),mt=async t=>await v().rpcEvmUpdateTransaction(t),ae=async t=>await v().rpcEvmConfirmTransaction(t),se=async t=>await v().rpcEvmFindTransaction(t),ie=async(t,e)=>await v().rpcEvmPublishTransaction(t,e);T();_();var ce=O(rt());Et();var Ce=()=>{let t=ne();return e=>{if(e){let{type:n,status:o,txHash:r,extraParams:a}=e,i={[f.TRANS_OUT]:{key:"wallet_transfer_notif_send_success",params:{first:a?.value,second:a?.coinSymbol}},[f.CONTRACT_CALL]:{key:"wallet_transfer_notif_contract_interaction_success"},[f.AUTHORIZATION]:{key:"wallet_transfer_notif_approval_success",params:{first:a?.coinSymbol}},[f.CANCEL_AUTHORIZATION]:{key:"wallet_transfer_notif_cancel_approval_success",params:{first:a?.coinSymbol}},[f.CONTRACT_DEPLOY]:{key:"developer_mode_dapp_toast_deployed_successfully"}},m={[f.TRANS_OUT]:{key:"wallet_transfer_notif_send_fail",params:{first:a?.value,second:a?.coinSymbol}},[f.CONTRACT_CALL]:{key:"wallet_transfer_notif_contract_interaction_fail"},[f.AUTHORIZATION]:{key:"wallet_transfer_notif_approval_fail",params:{first:a?.coinSymbol}},[f.CANCEL_AUTHORIZATION]:{key:"wallet_transfer_notif_cancel_approval_fail",params:{first:a?.coinSymbol}},[f.CONTRACT_DEPLOY]:{key:"developer_mode_dapp_toast_deployfailed"}},s,c,l,p,d;o===x.PENDING?(s=D.TYPE.success,n===f.CANCEL_AUTHORIZATION?(c="wallet_transfer_notif_cancel_approval_submit",l={first:a?.coinSymbol}):c="wallet_transfer_notif_transaction_submit"):(o===x.SUCCEED?(s=D.TYPE.success,c=i[n]?.key,l=i[n]?.params):(s=D.TYPE.error,c=m[n]?.key,l=m[n]?.params),o!==x.DROPPED&&(p=t(r),d="wallet_transfer_notif_view_on_explorer")),D[s]({title:h(c,l)||c,desc:p?ce.default.createElement(zt,{url:p,urlText:h(d)}):null,duration:3})}}},me=Ce;function we(t){let e={to:t.to,value:(0,k.addHexPrefix)(S(t.value)),gasLimit:(0,k.addHexPrefix)(S(t.gasLimit)),nonce:(0,k.addHexPrefix)(S(t.nonce)),kaiaTxType:t.kaiaTxType,signFn:t.signFn};return t.type===b.FEE_MARKET?(e.maxFeePerGas=(0,k.addHexPrefix)(S(t.maxFeePerGas)),e.maxPriorityFeePerGas=(0,k.addHexPrefix)(S(t.maxPriorityFeePerGas)),e.type=t.type):(e.gasPrice=(0,k.addHexPrefix)(S(t.gasPrice)),t.type=b.LEGACY),t.data&&(e.data=t.data),e}function pt(t){let{extensionConfig:e}=Y("rpc_info"),n=t||e,o=Z();return(0,G.useMemoizedFn)(r=>{let{type:a,txParams:i,extraParams:m}=r,s=a;return s||(i.to?s=f.CONTRACT_CALL:s=f.CONTRACT_DEPLOY),{id:Nt(),type:s,txParams:{...we(i),from:i.from||o,chainId:n.chainId},status:x.UNAPPROVED,createTime:+new Date,txPool:[],isCanceling:!1,isSpeeding:!1,extraParams:m||{}}})}function ut(t){let e=me(),n=(0,$.useSelector)(ht),o=ct();return(0,G.useMemoizedFn)(async(r,{walletId:a=o,signedCallback:i=nt}={})=>{if(!r)throw new Error("tx meta error");let m;if(r.txParams?.result)m=r.txParams.result;else{let{from:c}=r.txParams||{};m=await v().signRpcEvmTransaction(r.txParams,c,n,a)}if(r?.txParams?.signFn===L.KAIA_SIGN_TRANSACTION)return{rawTx:m};let s=await $t(yt,m);return await i({rawTx:m,txHash:s,status:x.PENDING}),new Promise((c,l)=>{ie({txId:r.id,rawTx:m},t).then(({error:p,data:d,tx:u})=>{if(p){(u?.status===x.PENDING||u?.status===x.DROPPED)&&e(u),l(p);let{type:P,txParams:A,extraParams:y}=r,{from:w,to:R,value:F,gasLimit:I,gasPrice:N,maxFeePerGas:j,maxPriorityFeePerGas:J,data:Q,nonce:X,chainId:tt}=A||{},{approvedAmount:et,coinSymbol:ft,tokenAddress:Tt,approvedAddress:ot,value:Ee,toAddress:Pe}=y||{};_t.captureEvent({tags:{address:w},message:"API_ERROR_evm_rpc_send_tx",contexts:{report:{info:JSON.stringify({type:P,txParams:{from:w,to:R,value:F,gasLimit:I,gasPrice:N,maxFeePerGas:j,maxPriorityFeePerGas:J,data:Q,nonce:X,chainId:tt},extraParams:At({approvedAmount:et,coinSymbol:ft,tokenAddress:Tt,approvedAddress:ot,value:Ee,toAddress:Pe},gt)})}},exception:{values:[{type:"API_ERROR_evm_rpc_send_tx",value:p?.message}]},level:"info"})}else e(u),c({id:r.id,txHash:d.result})}).catch(async p=>{await ae({txId:r.id,tx:{status:x.DROPPED,finishTime:+new Date,errorMessage:p?.message},checkPoolEmpty:!0}),l(p)})})})}var lt=()=>{let t=(0,$.useDispatch)(),e=ct();return async(n,o=e)=>{await t(Yt({walletId:o,txParams:n.txParams,isRpcMode:!0}));let{id:r}=n,a=await se(r);if(a&&(a.status===x.SUCCEED||a.status===x.DROPPED||a.status===x.DROPPED))throw Error(V)}};function pe(t){let e=pt(t),n=ut(t),o=lt();return(0,G.useMemoizedFn)(async(r,a,i)=>{if(!await jt({walletId:a}))return nt;let s=e(r);return await o(s,a),n(s,{walletId:a,signedCallback:c=>{let l={...s,...c};try{i&&i(l)}catch{}return re(l)}})})}function vo(){let t=pt(),e=ut(),n=lt();return(0,G.useMemoizedFn)(async(o,r)=>{let{type:a,txParams:i,extraParams:m}=o,s=t({type:a,txParams:{...i,...r},extraParams:m}),{id:c,txPool:l}=o;return o.id=s.id,s.id=c,o.txPool=[],await n(s),e(s,{signedCallback:p=>mt({txId:c,tx:{...s,status:x.PENDING,isSpeeding:!0,txPool:[o,...l],...p}})})})}function Co(){let t=Vt(!0),e=pt(),n=ut(),o=lt();return(0,G.useMemoizedFn)(async(r,a)=>{let{txParams:i,extraParams:m}=r,{from:s,nonce:c,type:l,chainId:p}=i,d=t.find(({address:y})=>!y),u=e({type:f.TRANS_OUT,txParams:{to:s,value:"0x0",nonce:c,chainId:p,type:l,...a},extraParams:m}),{id:P,txPool:A}=r;return r.id=u.id,u.id=P,r.txPool=[],await o(u),n(u,{signedCallback:y=>mt({txId:P,tx:{...u,status:x.PENDING,isCanceling:!0,txPool:[r,...A],extraParams:{toAddress:s,tokenAddress:"",coinSymbol:d?.symbol,value:"0"},...y}})})})}T();_();var K=O(rt()),ue=O(q()),W=O(Dt());function Se(t){let e=t.map(o=>{let{nonce:r}=o.txParams;return parseInt(r,16)}),n=Math.max.apply(null,e);return Number.isInteger(n)?n+1:0}function le(t,e){let n=B(void 0,e),o=Z(),r=t||o,a=(0,ue.useSelector)(Ht),i=(0,W.useLatest)(ee(e)),m=(0,W.useLatest)(oe(void 0,e)),[s,c]=(0,K.useState)(!1),[l,p]=(0,K.useState)(null),[d,u]=(0,K.useState)(null),P=(0,W.useMemoizedFn)(async()=>{let A;c(!0);try{A=await(await n()).eth.getTransactionCount(r,"latest"),A=Math.floor(A)}catch{A=0}let y;try{let w=Se(i.current),R=Math.max(A,w),F=m.current.map(I=>{let{nonce:N}=I.txParams;return Ft(N)});for(y=R;F.includes(y);)y+=1;p(A),u(y)}finally{c(!1)}return{nonce:A,suggestedNonce:y}});return(0,K.useEffect)(()=>{(async()=>(await n())?.eth&&P())()},[n,r,a]),{loadingNonce:s,nonce:l,suggestedNonce:d,request:P}}xe();T();_();var de=async(t,e)=>{let n;try{n=await e.eth.getCode(t)}catch{n=null}return{isContractAddress:n&&n!=="0x"&&n!=="0x0"}};T();_();function fe(t,{customPermissionAmount:e}){let n=M(t);if(n){if(n.name!==g.TOKEN_METHOD_APPROVE)throw new Error(`Invalid data; should be 'approve' method, but instead is '${n.name}'`)}else throw new Error("Invalid data");let o=z(n);o.startsWith("0x")&&(o=o.substring(2));let[r,a]=t.split(o);if(!r||!a)throw new Error("Invalid data");if(a.length!==64)throw new Error("Invalid token value; should be exactly 64 hex digits long (u256)");let i=S(e);if(i.length>64)throw new Error("Custom value is larger than u256");return i=i.padStart(a.length,"0"),`${r}${o}${i}`}function Ie({data:t,to:e}){let n=B(),[o,r]=(0,E.useState)(""),[a,i]=(0,E.useState)(!1);return(0,E.useEffect)(()=>{(async()=>{if(t&&!e){r(g.DEPLOY_CONTRACT);return}try{let p=M(t)?.name,d=[g.TOKEN_METHOD_APPROVE,g.TOKEN_METHOD_TRANSFER,g.TOKEN_METHOD_TRANSFER_FROM].find(u=>u.toLowerCase()===p.toLowerCase());if(d){r(d);return}}catch{}i(!0);let s=await n(),{isContractAddress:c}=await de(e,s);r(c?g.CONTRACT_INTERACTION:g.SENT_ETHER),i(!1)})()},[t,e,n]),[o,a]}function De({data:t,type:e}){let n,o,r,a;try{let i=M(t),m=Qt(i);n=z(i),a=m,o=e===g.TOKEN_METHOD_APPROVE,r=o&&Number(a)===0}catch{}return{address:n,isApprove:o,isRevoke:r,amount:a}}function ke(t,e){let n=Bt(void 0,e),[o,r]=(0,E.useState)({}),[a,i]=(0,E.useState)(!1),m=async()=>{try{i(!0);let{symbol:s,decimals:c}=await n(t);r({symbol:s,decimals:c}),i(!1)}catch{i(!1)}};return(0,E.useEffect)(()=>{t&&m()},[t]),[o,a]}function Fe(t){let[e,n]=(0,E.useState)(-1),{isApprove:o,amount:r}=t;return(0,E.useEffect)(()=>{o&&n(r)},[o,r]),[{...t,customApproveAmount:e},n]}function be({origin:t,isApprove:e,isRevoke:n,symbol:o,walletId:r}){let a=Zt(r),i=(0,dt.useSelector)(Ct),m=r?a:i,c=(0,dt.useSelector)(Gt)[t]||{},[l,p]=(0,E.useState)({});return(0,E.useEffect)(()=>{let d=null,u=null,P=null;e?(d=null,u=o,P=n?h("wallet_approval_subtitle_revoke_approval_desc",{tokenSymbol:o}):h("wallet_dapp_conncetion_alert_approve_tip",{name:c.name,tokenSymbol:o})):(d=c.icon,P=c.host,u=c.name),p({icon:d,host:P,name:u})},[n,o]),{...l,originInfo:c,wallet:`${m.keyringName} - ${m.walletName}`}}function Le(t,e){let{nonce:n,suggestedNonce:o}=le(t,e),[r,a]=(0,E.useState)(0),[i,m]=(0,E.useState)(!0);return(0,E.useEffect)(()=>{a(o),m(!1)},[o]),[{suggested:n,custom:r,pending:i},a]}var Ue=({tx:t,nonce:e,txData:n,tokenInfo:o,chain:r,customGasInfo:a,approvedAmount:i,formattedAmount:m,txType:s})=>{let{from:c,to:l,value:p,data:d}=t,{isSupportEip1559:u,maxFeePerGas:P,maxPriorityFeePerGas:A,gasPrice:y,gasLimit:w}=a,R={from:c,to:l,value:p,gasLimit:w,nonce:e,data:d};u?(R.maxFeePerGas=P,R.maxPriorityFeePerGas=A,R.type=b.FEE_MARKET):(R.gasPrice=y,R.type=b.LEGACY),t?.method===L.KAIA_SIGN_TRANSACTION&&(R.signFn=L.KAIA_SIGN_TRANSACTION,R.kaiaTxType=t?.typeInt);let I={[g.DEPLOY_CONTRACT]:f.CONTRACT_DEPLOY,[g.CONTRACT_INTERACTION]:f.CONTRACT_CALL,[g.TOKEN_METHOD_APPROVE]:f.AUTHORIZATION,[g.SENT_ETHER]:f.TRANS_OUT,[g.TOKEN_METHOD_TRANSFER]:f.TRANS_OUT,[g.TOKEN_METHOD_TRANSFER_FROM]:f.TRANS_OUT}[s]||f.CONTRACT_CALL;n.isRevoke&&(I=f.CANCEL_AUTHORIZATION);let N={};return s===g.TOKEN_METHOD_APPROVE&&(N.approvedAmount=i,N.coinSymbol=o.symbol,N.tokenAddress=l,N.approvedAddress=n.address),s===g.SENT_ETHER&&(N.value=Pt(kt(p)),N.toAddress=l,N.coinSymbol=r.symbol),(s===g.TOKEN_METHOD_TRANSFER||s===g.TOKEN_METHOD_TRANSFER_FROM)&&(N.value=m,N.tokenAddress=l,N.toAddress=n.address,N.coinSymbol=o.symbol),{type:I,txParams:R,extraParams:N}};function He(t,e,n){let o=(0,Te.useHistory)(),r=Xt(),a=te(),i=pe(n),[m,s]=(0,E.useState)(!1);return[{sign:async(p,d)=>{s(!0),i(t,p,d).then(async({txHash:u,rawTx:P})=>{let A=t.signFn===L.KAIA_SIGN_TRANSACTION?{raw:P}:u;r({id:e,result:A}),o.push(Ut)}).catch(u=>{u.message!==V&&D.error({title:u?.message}),r({id:e,error:u?.message||"Transaction failed"}),s(!1)}).finally(()=>{o.go(0)})},cancel:async()=>{await a({id:e}),o.go(0)}},m]}function En(t,e){let[n]=Ie(t),o=De({data:t.data,type:n}),[r,a]=ke(t?.to,e),i=be({walletId:t?.walletId,origin:t.origin,...o,...r}),m=(0,E.useMemo)(()=>Jt(o?.amount||0,r?.decimals),[o?.amount,r?.decimals]),[s,c]=Fe({...o,...r,formattedAmount:m}),[l,p]=(0,E.useState)(t.data);(0,E.useEffect)(()=>{if(n===g.TOKEN_METHOD_APPROVE)try{let ot=fe(t.data,{customPermissionAmount:s.customApproveAmount});p(ot)}catch{}},[s.customApproveAmount,t.data,r?.decimals,o,n]);let d={...e,name:e?.name||e?.chainName},[u,P]=Le(t.from,e),{setGasType:A,currentGasInfo:y,chainGasLevels:w,chainGasLoading:R,setCustomGasOption:F,chainGasError:I,chainGasLoadFailed:N,chainGasLimitLoadFailed:j}=Lt({to:t.to,from:t.from,value:t.value||"0x0",data:l,method:t.method},{gasLimit:t.gas||t.gasLimit,gasPrice:t.gasPrice,maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas},e),J=Ue({tx:{...t,data:l},nonce:u.custom||u.suggested,txData:o,tokenInfo:r,chain:d,customGasInfo:y,approvedAmount:s.customApproveAmount,formattedAmount:m,txType:n}),[{sign:Q,cancel:X},tt]=He(J,t.id,e),et=(0,E.useMemo)(()=>{switch(n){case g.DEPLOY_CONTRACT:return h("developer_mode_history_title_contract_eployment");case g.TOKEN_METHOD_APPROVE:return o?.isRevoke?h("wallet_extension_popup_btn_revoke_approval"):h("wallet_extension_popup_btn_approve");default:return h("wallet_extension_popup_title_contract_interaction")}},[n,o?.isRevoke]);return[{type:n,title:et,auth:{...s,...r,formattedAmount:m},meta:i,chain:d,nonce:u,gas:{setGasType:A,chainGasLevels:w,currentGasInfo:y,setCustomGasOption:F,chainGasLoading:R,chainGasError:I,chainGasLoadFailed:N,chainGasLimitLoadFailed:j},loading:{sign:tt,token:a},data:l},{sign:Q,cancel:X,setNonce:P,setAuthAmount:c}]}T();_();var Ae=O(q());T();_();It();at();function _e(t,e,n){return async o=>{await v().resolvePendingApproval(t,e);let{pendingApprovals:r}=await U(o);Object.values(r).length===0&&!n&&o(it())}}function ge(t){return async e=>{await v().rejectPendingApproval(t);let{pendingApprovals:n}=await U(e);Object.values(n).length===0&&e(it())}}It();Rt();function Un(t){let e=(0,Ae.useDispatch)(),o=(s=>{let{id:c,origin:l,requestData:p,type:d,requestData:{chainId:u}}=s;return{id:c,origin:l,...p,requestData:p,chainIdToDisplay:parseInt(u,16),switchType:d,explorers:p.blockExplorerUrl}})(t),{addRpcNetwork:r}=bt(),{setExtensionConfig:a}=Y("rpc_info");return[o,{cancel:async()=>{await e(ge(o.id)),await U(e)},approve:async()=>{let{rpcUrl:s,ticker:c,blockExplorerUrl:l,chainId:p,faucetUrl:d,chainName:u}=o,P=await r({chainId:p,explorerUrl:l,faucetUrl:d,name:u,rpcUrl:s,symbol:c}),{uniqueId:A}=P;await a(P),await e(st("isRpcMode",!0)),await e(st("currentNetworkUniqueId",A)),await e(Mt(xt,s,c,u,p,{},!0,A)),await e(_e(o.id,o.requestData)),await U(e)}}]}T();_();function qn(t){return qt(t?.image)?t.image=t.image[0]:Wt(t?.image)&&(t.image=null),t}export{ae as a,se as b,me as c,pe as d,vo as e,Co as f,le as g,Ie as h,De as i,Ue as j,En as k,Un as l,We as m,qn as n};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-M5N3SNPA.js.map
