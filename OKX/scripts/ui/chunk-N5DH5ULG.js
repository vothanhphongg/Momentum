import{a as W,b as $,c as J,d as Q,e as V,f as X,h as Y,i as Z,j as G,k as K,l as tt,n as et,o as O}from"./chunk-5QMHGZLF.js";import{e as g,f as _}from"./chunk-TM67VPZU.js";import{b as z}from"./chunk-JWYCKY2V.js";import{f as l,o as d,q as p}from"./chunk-6KXF36WM.js";d();p();d();p();_();var v=!1,b=new Map;async function x(r,t,e){let{uiData:n}=await g.get("uiData"),c=n?.[r];c?.timer&&clearTimeout(c.timer);let i;t&&t>-1&&(i=+setTimeout(async()=>{let{uiData:f}=await g.get("uiData");f?.[r]&&(delete n?.[r],b.delete(r),await g.set({uiData:n}))},t));let s={...e,timer:i};return b.set(r,s),g.set({uiData:{...n??{},[r]:s}})}async function A(r){let t=b.get(r);if(t)return t;let{uiData:e}=await g.get("uiData"),n=e?.[r];return!v&&e&&(Object.entries(e).forEach(([c,i])=>{b.set(c,i)}),v=!0),n}d();p();var M=l(J()),B=l(Y()),E=l(Z()),k=l(G()),L=l(K()),N=l(tt()),U=l(et());d();p();var R=l(z()),C=l(O()),S=l(Q()),w=l(V()),T=l(X()),at=(r,{cacheKey:t,cacheTime:e=5*60*1e3,staleTime:n=0,setCache:c,getCache:i})=>{let s=(0,R.useRef)(),f=(0,R.useRef)(),a=async(o,u)=>{c?await c(u):(0,S.setCache)(o,e,u),(0,T.trigger)(o,u.data)},h=(o,u=[])=>i?i(u):(0,S.getCache)(o);return(0,C.useCreation)(async()=>{if(!t)return;let o=await h(t);o&&Object.hasOwnProperty.call(o,"data")&&(r.state.data=o.data,r.state.params=o.params,(n===-1||new Date().getTime()-o.time<=n)&&(r.state.loading=!1)),s.current=(0,T.subscribe)(t,u=>{r.setState({data:u})})},[]),(0,C.useUnmount)(()=>{s.current?.()}),t?{onBefore:async o=>{let u=await h(t,o);return!u||!Object.hasOwnProperty.call(u,"data")?{}:n===-1||new Date().getTime()-u.time<=n?{loading:!1,data:u?.data,error:void 0,returnNow:!0}:{data:u?.data,error:void 0}},onRequest:(o,u)=>{let P=(0,w.getCachePromise)(t);return P&&P!==f.current?{servicePromise:P}:(P=o(...u),f.current=P,(0,w.setCachePromise)(t,P),{servicePromise:P})},onSuccess:async(o,u)=>{t&&(s.current?.(),await a(t,{data:o,params:u,time:new Date().getTime()}),s.current=(0,T.subscribe)(t,P=>{r.setState({data:P})}))},onMutate:o=>{t&&(s.current?.(),a(t,{data:o,params:r.state.params,time:new Date().getTime()}),s.current=(0,T.subscribe)(t,u=>{r.setState({data:u})}))}}:{}},F=at;d();p();var H=l($()),m=l(O());d();p();var q=l(W()),y=class{constructor(t,e,n,c={}){this.serviceRef=t;this.options=e;this.subscribe=n;this.initState=c;this.count=0;this.state={loading:!1,params:void 0,data:void 0,error:void 0};this.state={...this.state,loading:!e.manual,...c}}setState(t={}){this.state={...this.state,...t},this.subscribe()}async runPluginHandler(t,...e){let c=(await Promise.allSettled(this.pluginImpls.map(i=>i[t]?.(...e)))).filter(i=>i.status==="fulfilled").map(i=>i.value).filter(Boolean);return Object.assign({},...c)}async runAsync(...t){this.count+=1;let e=this.count,{stopNow:n=!1,returnNow:c=!1,...i}=await this.runPluginHandler("onBefore",t);if(n)return new Promise(()=>{});if(this.setState({loading:!0,params:t,...i}),c)return Promise.resolve(i.data);this.options.onBefore?.(t);try{let{servicePromise:s}=await this.runPluginHandler("onRequest",this.serviceRef.current,t);s||(s=this.serviceRef.current(...t));let f=await s;return e!==this.count?await new Promise(()=>{}):(this.setState({data:f,error:void 0,loading:!1}),this.options.onSuccess?.(f,t),this.runPluginHandler("onSuccess",f,t),this.options.onFinally?.(t,f,void 0),e===this.count&&this.runPluginHandler("onFinally",t,f,void 0),f)}catch(s){if(e!==this.count)return new Promise(()=>{});throw this.setState({error:s,loading:!1}),this.options.onError?.(s,t),this.runPluginHandler("onError",s,t),this.options.onFinally?.(t,void 0,s),e===this.count&&this.runPluginHandler("onFinally",t,void 0,s),s}}run(...t){this.runAsync(...t).catch(e=>{this.options.onError||console.error(e)})}cancel(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")}refresh(){this.run(...this.state.params||[])}refreshAsync(){return this.runAsync(...this.state.params||[])}mutate(t){let e=(0,q.isFunction)(t)?t(this.state.data):t;this.runPluginHandler("onMutate",e),this.setState({data:e})}};function rt(r,t={},e=[]){let{manual:n=!1,...c}=t;H.default&&t.defaultParams&&!Array.isArray(t.defaultParams)&&console.warn(`expected defaultParams is array, got ${typeof t.defaultParams}`);let i={manual:n,...c},s=(0,m.useLatest)(r),f=(0,m.useUpdate)(),a=(0,m.useCreation)(()=>{let h=e.map(o=>o?.onInit?.(i)).filter(Boolean);return new y(s,i,f,Object.assign({},...h))},[]);return a.options=i,a.pluginImpls=e.map(h=>h(a,i)),(0,m.useMount)(()=>{if(!n){let h=a.state.params||t.defaultParams||[];a.run(...h)}}),(0,m.useUnmount)(()=>{a.cancel()}),{loading:a.state.loading,data:a.state.data,error:a.state.error,params:a.state.params||[],cancel:(0,m.useMemoizedFn)(a.cancel.bind(a)),refresh:(0,m.useMemoizedFn)(a.refresh.bind(a)),refreshAsync:(0,m.useMemoizedFn)(a.refreshAsync.bind(a)),run:(0,m.useMemoizedFn)(a.run.bind(a)),runAsync:(0,m.useMemoizedFn)(a.runAsync.bind(a)),mutate:(0,m.useMemoizedFn)(a.mutate.bind(a))}}var j=rt;function nt(r,t,e){return j(r,t,[...e||[],B.default,E.default,k.default,L.default,U.default,M.default,F,N.default])}var I=nt;function Ot(r,t,e){let n=t?.cacheKey;return I(r,{...t??{},setCache:async c=>n?x(n,t?.cacheTime,c):!1,getCache:async()=>{if(n)return A(n)}},e)}export{Ot as a};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-N5DH5ULG.js.map
