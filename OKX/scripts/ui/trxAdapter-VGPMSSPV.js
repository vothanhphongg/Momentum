import{c as A,d as C,g as b}from"./chunk-RTFE54S3.js";import"./chunk-GCQ4H2BA.js";import{a as D}from"./chunk-JGEHAFTO.js";import"./chunk-UVFOW4HH.js";import"./chunk-LNOPECCQ.js";import"./chunk-CB7FOZNP.js";import"./chunk-43VURGIT.js";import{Ia as M,Na as z,rc as X,sb as S,ya as R,za as G}from"./chunk-TM67VPZU.js";import"./chunk-VW6OQNWT.js";import"./chunk-PUSMMCUD.js";import"./chunk-UWJLNJLY.js";import{a as W}from"./chunk-VRY2ADKE.js";import{ra as k,y as B}from"./chunk-XDY6V34Y.js";import"./chunk-JT3LNHPY.js";import"./chunk-47UWF72W.js";import"./chunk-JWYCKY2V.js";import"./chunk-G2266BV2.js";import"./chunk-7VFUX7IX.js";import"./chunk-XLF4LAH2.js";import"./chunk-ONKZ57T6.js";import"./chunk-ZC7Q7LCH.js";import{o as d,p as c,q as v}from"./chunk-6KXF36WM.js";d();v();k();d();v();d();v();function x(i){var r=[],o=i.split("/");return o.forEach(function(t){var n=parseInt(t,10);isNaN(n)||(t.length>1&&t[t.length-1]==="'"&&(n+=2147483648),r.push(n))}),r}function H(i,r){function o(t,n,a){return t>=n.length?a:r(n[t],t).then(function(e){return a.push(e),o(t+1,n,a)})}return Promise.resolve().then(function(){return o(0,i,[])})}function I(i,r){for(var o=0,t=0,n=r;t<64;){var a=i[n];if(o|=(a&127)<<t,n+=1,!(a&128))return o&=4294967295,{value:o,pos:n};t+=7}throw new Error("Too many bytes when decoding varint.")}var K=function(i){return i&&i.statusCode,i},N=4,_=1,m=224,V=2,Z=4,j=5,O=8,$=10,q=6,y=250,F=function(){function i(r,o){o===void 0&&(o="TRX"),this.transport=r,r.decorateAppAPIMethods(this,["getAddress","getECDHPairKey","signTransaction","signTransactionHash","signPersonalMessage","getAppConfiguration"],o)}return i.prototype.getAddress=function(r,o){var t=x(r),n=c.Buffer.alloc(_+t.length*N);return n[0]=t.length,t.forEach(function(a,e){n.writeUInt32BE(a,1+4*e)}),this.transport.send(m,V,o?1:0,0,n).then(function(a){var e=a[0],s=a[1+e];return{publicKey:a.slice(1,1+e).toString("hex"),address:a.slice(1+e+1,1+e+1+s).toString("ascii")}})},i.prototype.getNextLength=function(r){var o=I(r,0),t=I(r,o.pos);return(o.value&7)===0?t.pos:t.value+t.pos},i.prototype.signTransaction=function(r,o,t){var n=this,a=x(r),e=c.Buffer.from(o,"hex"),s=[],h=c.Buffer.alloc(_+a.length*N);for(h[0]=a.length,a.forEach(function(l,E){h.writeUInt32BE(l,1+4*E)});e.length>0;){var g=this.getNextLength(e);if(g>y)throw new Error("Too many bytes to encode.");if(h.length+g>y){s.push(h),h=c.Buffer.alloc(0);continue}h=c.Buffer.concat([h,e.slice(0,g)]),e=e.slice(g,e.length)}s.push(h);var f=[],T,w=s.length;if(t!==void 0)for(var u=0;u<t.length;u+=1){var p=c.Buffer.from(t[u],"hex");s.push(p)}if(s.length===1)f.push(16);else{f.push(0);for(var u=1;u<s.length-1;u+=1)u>=w?f.push(160|u-w):f.push(128);t!==void 0&&t.length?f.push(168|t.length-1):f.push(144)}return H(s,function(l,E){return n.transport.send(m,Z,f[E],0,l).then(function(P){T=P})}).then(function(){return T.slice(0,65).toString("hex")},function(l){throw K(l)})},i.prototype.signTransactionHash=function(r,o){var t=x(r),n=c.Buffer.alloc(_+t.length*N);return n[0]=t.length,t.forEach(function(a,e){n.writeUInt32BE(a,1+4*e)}),n=c.Buffer.concat([n,c.Buffer.from(o,"hex")]),this.transport.send(m,j,0,0,n).then(function(a){return a.slice(0,65).toString("hex")})},i.prototype.getAppConfiguration=function(){return this.transport.send(m,q,0,0).then(function(r){var o=(r[0]&8)>0,t=(r[0]&1<<2)>0,n=(r[0]&1<<1)>0,a=(r[0]&1<<0)>0;r[1]===0&&r[2]===1&&r[3]<2&&(a=!0,n=!1),r[1]===0&&r[2]===1&&r[3]<5&&(t=!1);var e={version:"".concat(r[1],".").concat(r[2],".").concat(r[3]),versionN:r[1]*1e4+r[2]*100+r[3],allowData:a,allowContract:n,truncateAddress:t,signByHash:o};return e})},i.prototype.signPersonalMessage=function(r,o){for(var t=this,n=x(r),a=c.Buffer.from(o,"hex"),e=0,s=[],h=a.length.toString(16),g="00000000".substr(h.length)+h,f=c.Buffer.concat([c.Buffer.from(g,"hex"),a]),T=function(){var u=e===0?y-1-n.length*4:y,p=e+u>f.length?f.length-e:u,l=c.Buffer.alloc(e===0?1+n.length*4+p:p);e===0?(l[0]=n.length,n.forEach(function(E,P){l.writeUInt32BE(E,1+4*P)}),f.copy(l,1+4*n.length,e,e+p)):f.copy(l,0,e,e+p),s.push(l),e+=p};e<f.length;)T();var w;return H(s,function(u,p){return t.transport.send(m,O,p===0?0:128,0,u).then(function(l){w=l})}).then(function(){return w.slice(0,65).toString("hex")})},i.prototype.getECDHPairKey=function(r,o){var t=x(r),n=c.Buffer.from(o,"hex"),a=c.Buffer.alloc(1+t.length*4+n.length);return a[0]=t.length,t.forEach(function(e,s){a.writeUInt32BE(e,1+4*s)}),n.copy(a,1+4*t.length,0,n.length),this.transport.send(m,$,0,1,a).then(function(e){return e.slice(0,65).toString("hex")})},i}(),U=F;G();W();X();z();var L=class extends b{async makeApp(){await this.initLedgerTransPorter(),this.app||(this.app=new U(this.ledgerTransPorter))}async getAddressPromise(r){await this.makeApp();let o=[];for(let t=r*5;t<(r+1)*5;t++){let n=`44'/195'/0'/0/${t}`,{address:a}=await this.app.getAddress(n,!1,!0);o.push({address:a,index:t,path:n})}return o}async getAddress(r=0){return await Promise.race([this.getAddressPromise(r),this.throwTimeoutError()])}async getTokens(r,o){let t=r.map(({address:n})=>n);try{let n=await M(R.getChainToken,{addressList:t,coinId:o});if(n?.code===0){let{data:a}=n;a.forEach(({address:e,coinAmount:s})=>{let h=B(r,{address:e});h.coinAmount=s})}}catch(n){console.log(n)}return r}async signTransaction(r,o){try{C.openModal(A.confirm);let t=r.hdPathMap[S];await this.checkLedgerConnection();let{getHardWareRawTransaction:n,getHardWareSignedTransaction:a}=await D(),{raw:e}=await n(195,{data:o}),s=await this.app.signTransaction(t,e);if(s==="01000103019000")throw new Error(A.wrongApp);let h=await a(195,{raw:e,sig:s});return C.closeModal(),h}catch(t){return this.handleErrors(t,S)}}},gt=new L;export{gt as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=trxAdapter-VGPMSSPV.js.map
