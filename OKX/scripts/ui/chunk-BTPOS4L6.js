import{a as Ee,b as Fe}from"./chunk-7RP5AG3D.js";import{a as Pe}from"./chunk-F6DRZBXE.js";import{b as be}from"./chunk-ZJVF5RSO.js";import{b as ge,g as xe,i as Ae,l as Ie,m as Ce,q as he,r as Ne}from"./chunk-3CVTSTBR.js";import{a as Te}from"./chunk-TOV4UWR3.js";import{a as et,c as Le,d as F}from"./chunk-HOU3VS5H.js";import{a as we}from"./chunk-SQDIO2NL.js";import{a as It}from"./chunk-IP7VSGCS.js";import{b as tt}from"./chunk-XYDICNP3.js";import{B as ye,a as pe,l as R}from"./chunk-2LCPVMSO.js";import{d as de,g as ue}from"./chunk-MNZIO3NP.js";import{a as _e}from"./chunk-7CC6X6YX.js";import{c as fe}from"./chunk-TSTKPLAO.js";import{b as xt}from"./chunk-LR7KSTP2.js";import{h as yt,i as ae}from"./chunk-MKEYCSLA.js";import{f as At}from"./chunk-AKE54ZCC.js";import{f as _t}from"./chunk-27LUWCHG.js";import{h as le,l as ce,m as me}from"./chunk-IRMYAC6R.js";import{b as gt}from"./chunk-ETJEH7T4.js";import{a as ie}from"./chunk-V3IFYKWM.js";import{a as Tt}from"./chunk-YALUYHLV.js";import{q as w}from"./chunk-I3CPAVOC.js";import{o as se}from"./chunk-5QMHGZLF.js";import{ec as ro}from"./chunk-HPWCPLRR.js";import{a as so}from"./chunk-ON6S2DB7.js";import{j as re,p as oo}from"./chunk-SZD6WTBQ.js";import{b as ne}from"./chunk-CWNIM6RS.js";import{aa as Q,f as X,ka as oe}from"./chunk-N2BCRNDB.js";import{c as L}from"./chunk-43VURGIT.js";import{Ia as J,Na as Gt,Uc as $,_c as Kt,a as Yt,b as to,bd as Xt,hd as K,lc as qt,mb as Zt,mc as Jt,md as Qt,od as te,rc as $t,rd as ee,ya as q,za as Vt}from"./chunk-TM67VPZU.js";import{G as zt,d as jt,o as Ht}from"./chunk-PUSMMCUD.js";import{R as Z,o as B,z as f}from"./chunk-UWJLNJLY.js";import{H as Rt,ra as eo}from"./chunk-XDY6V34Y.js";import{b as D}from"./chunk-JWYCKY2V.js";import{f as N,o as c,q as m}from"./chunk-6KXF36WM.js";c();m();var t=N(D()),ze=N(ro()),Ve=N(so()),ot=N(se());eo();Z();oo();ee();$t();Kt();c();m();var C=N(D());Z();Kt();c();m();var Be={list:"_list_b7lh5_1"};var no=({coinId:e,value:n,visible:a,onToggleVisible:i,options:o,onChange:u})=>{let y=de(e),h=p=>{let{addressType:T,address:x,canTransferAmount:b}=p;return C.default.createElement(At.Card,{selected:n?.address===x,onClick:()=>{i?.(),u?.(p)}},C.default.createElement(L.Box,{style:{width:"100%"}},C.default.createElement(L.FlexBox,{justify:"space-between",align:L.ALIGN.center},C.default.createElement(w.Text,{strong:!0},f($[T])),C.default.createElement(w.DisplayAmount,{strong:!0,mode:w.CRYPTO,decimals:y?.decimals},b)),C.default.createElement(L.FlexBox,{justify:"space-between",align:L.ALIGN.center},C.default.createElement(w.Address,{address:x,desensitize:!0,copyable:!1,size:w.SIZE.sm,type:w.TYPE.secondary}),C.default.createElement(w.Text,{type:w.TYPE.secondary,size:w.SIZE.xs},f("extension_wallet_available_coin_balance",{coin:y?.symbol})))))};return C.default.createElement(Ht,{visible:a,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:f("btcnft_gas_title_pay_gas_with"),onClose:i},C.default.createElement(At,{space:16,dataSource:o,renderItem:h,className:Be.list}))},ke=no;c();m();to();var Se=N(D()),ao=()=>(0,Se.useCallback)(({value:e,message:n,reportParams:a})=>{try{Yt.captureEvent({message:n,contexts:{report:{info:JSON.stringify(a)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:e}]},level:"warn"})}catch(i){console.log(i)}},[]),Oe=ao;c();m();var j=N(D());ee();Vt();Gt();function io(e,n,a,i){let[o,u]=(0,j.useState)(a),[y,h]=(0,j.useState)([]);return(0,j.useEffect)(()=>{if(i?.chainId===void 0||i?.chainId===null)return;(async()=>{try{if(!a)return;let T=await J(q.checkDustForBtcTx,{inscriptionIds:n,targetAddress:e,scene:24,chain:i.chainId,tokenStandard:Qt(i.chainId)});h(T?.data?.dustInscriptionIds||[])}finally{u(!1)}})()},[a,e,n,i]),{isDustLoading:o,dustError:y.length>0}}var We=io;c();m();var Ue=N(D());Z();var lo=({isMpcWallet:e,isHardware:n,feeError:a,isSufficientGas:i,dustError:o,transferReminder:u,addressCheckError:y=""})=>({tipMessageProps:(0,Ue.useMemo)(()=>e?{type:F.TIP_TYPE.COMMON_ERROR,message:f("extension_wallet_contractual_interaction_wallet_unavailable")}:n?{type:F.TIP_TYPE.COMMON_ERROR,message:f("wallet_extension_top_toast_dapp_comingsoon")}:a?{type:F.TIP_TYPE.FEE_ERROR}:i?o?{type:F.TIP_TYPE.COMMON_ERROR,message:f("wallet_info_dialog_dust_limit_individually")}:y?{type:F.TIP_TYPE.COMMON_ERROR,message:y}:{type:jt.TYPE.warn,message:u}:{type:oe.FEE_BALANCE_INSUFFICIENT},[a,e,n,i,o,u,y])}),De=lo;c();m();var Me=N(se());Gt();Vt();var co=e=>{let{loading:n,data:a}=(0,Me.useRequest)(async()=>(await J(q.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(e)?e:[e]}))?.data?.details||[]);return[n,a||[]]},ve=co;c();m();var Ct=N(D());Z();$t();var mo=7*1e3,uo=({walletId:e,coinId:n,satBytes:a,needFilteredUtxo:i,localType:o=Zt})=>{let u=le(e),y=(0,Ct.useMemo)(()=>{let x=ne(o);return u?.addressType?.[x]||[]},[u?.walletId]),[h,p]=Ie({coinId:n,walletId:e,satBytes:a,addressList:y?.map(({address:x})=>x),needFilteredUtxo:i},{pollingInterval:mo,ready:!!i?.length&&!!a}),T=(0,Ct.useMemo)(()=>y.map((b,A)=>({...b,canTransferAmount:p[A]}))?.sort((b,A)=>{let rt=B.sub(A.canTransferAmount,b.canTransferAmount);return Number(rt)}),[p,y]);return[h,T]},Ye=uo;c();m();var ht={"nft-transfer__extend":"_nft-transfer__extend_1bjoo_1",nftTransferExtend:"_nft-transfer__extend_1bjoo_1","nft-transfer__icon":"_nft-transfer__icon_1bjoo_4",nftTransferIcon:"_nft-transfer__icon_1bjoo_4"};var Re={Ordinals:"Ordinals",Atomicals:"Atomicals"},je=2,He="NFT",fo=({unapproved:e})=>{let n=e?.walletId,a=e?.localType,o=fe({localType:a})?.coinId;o===void 0&&(o=Jt(a));let[u,y]=ue(o),h=me(n),p=e.params.transfer.from,T=e.params.transfer.to,{feeRate:x}=e.params.transfer.options||{},b=Oe(),[,A]=Te({coinId:o,address:p,chainId:u?.chainId}),rt=A?.transferReminder,[Nt,H]=(0,ot.useSetState)({payWallet:!1,networkFee:!1}),[E,wt]=(0,t.useState)(x&&typeof x=="number"?{satBytes:x,level:Q.CUSTOM}:{satBytes:A?.normal,level:Q.STANDARD});(0,t.useEffect)(()=>{!E?.satBytes&&A?.normal&&wt({satBytes:A?.normal,level:Q.STANDARD})},[A,E]);let z=e.params.transfer.data,k=Array.isArray(z)&&z.length>1,{isDustLoading:Lt,dustError:st}=We(T,z,k,y),[,l]=ve(z),M=(0,t.useMemo)(()=>{if(!Array.isArray(l)||!l?.length)return;let[{protocol:s}]=l||[];if(s===Re.Atomicals)return K.ARC_20},[l]),nt=(0,t.useMemo)(()=>l.map(s=>`${s.btcNftUtxoDetail?.txId}-${s.btcNftUtxoDetail?.outputIndex}`),[l]),[bt,S]=Ye({localType:a,coinId:o,walletId:n,needFilteredUtxo:nt,satBytes:E?.satBytes}),[r,at]=(0,t.useState)({}),[it,{toggle:Ge}]=(0,ot.useBoolean)(!1);(0,t.useEffect)(()=>{let s=S?.[0];if(Rt(r)&&!!s&&s?.canTransferAmount&&at(s),S&&r.address&&r?.canTransferAmount){let d=S.find(({address:_})=>_===r?.address);d||b({value:d,reportParams:{payWallet:r,payWallets:S},message:`payWallet address get ${d}`}),d&&at(d)}},[b,r,S]);let v=(0,t.useMemo)(()=>l.map(s=>{let{tokenId:d,protocol:_}=s,{txId:U,outputIndex:Y,outputValue:Qe}=s?.btcNftUtxoDetail||{},vt={txHash:U,nftId:s.tokenId,status:1,address:p,vout:Number(Y),coinAmount:Number(Qe),resourceUrl:s?.resourceUrl};return _===Re.Atomicals&&Object.assign(vt,{data:[{atomicalId:d,type:He,amount:1}]}),vt}),[p,l]),Et=(0,t.useMemo)(()=>l.map(s=>{let d=s?.tokenId,{outputValue:_}=s?.btcNftUtxoDetail||{},U=Number(_);k||(U=B.lt(_,546)?546:Number(_));let Y={amount:U,address:T};return M===K.ARC_20&&Object.assign(Y,{data:[{atomicalId:d,type:He,amount:1}]}),Y}),[k,l,M,T]),lt=(0,t.useMemo)(()=>{if(!k){let{outputValue:s=0}=l?.[0]?.btcNftUtxoDetail||{};if(s<546)return B.sub(546,s)}return 0},[k,l]),[ct,g,V]=he({coinId:o,protocolId:M,toAddr:T,coinAmount:lt,fromAddr:r?.address,satBytes:E?.satBytes,utxoParams:{satBytes:E?.satBytes,needFilteredUtxo:nt},canTransferAmount:r?.canTransferAmount,inputs:v,outputs:Et},{ready:!!v?.length}),mt=k?X.BTC_NFT_BULK_SEND:X.SEND_NFT,Ft=Ne({coinId:o,walletId:n,protocolId:M,coinAmount:0,toAddr:T,fromAddr:p,changeAddr:r?.address,localType:u?.localType,dustSize:M===K.ARC_20?void 0:A?.minOutput,networkFee:g,satBytes:E.satBytes,inputs:v,outputs:Et}),dt=l.map(({tokenId:s})=>s),Ze=JSON.stringify({nftIds:dt,from:p,to:T,serviceCharge:g,gasFrom:r?.address}),Pt=ye({coinId:o,txType:mt,walletId:n,coinAmount:0,fromAddr:p,toAddr:T,networkFee:g,localType:u?.localType,extJson:Ze,txSource:Xt.NFT}),Bt=Ae({coinId:o,walletId:n,address:r.address,utxoType:ge.TRANSFER,satBytes:E?.satBytes,needFilteredUtxo:nt}),I=(0,ze.useDispatch)(),O=(0,Ve.useHistory)(),kt=Ce({coinId:o,txType:X.SEND_NFT,protocolId:te(u?.chainId),address:r.address}),ut=l?.length,qe=(0,t.useMemo)(()=>(l?.slice(0,it?ut:je)).map(({resourceUrl:d,name:_})=>({title:_,icon:{src:d}})),[l,it,ut]),W=(0,t.useMemo)(()=>!(r?.canTransferAmount&&B.lt(r?.canTransferAmount,B.add(g,lt))),[g,lt,r?.canTransferAmount]),Je=ce(n),[$e,ft]=(0,t.useState)(!1),G=(0,t.useCallback)(async()=>{e.id?(await I(yt(e.id)),await I(xt()),await re(I)):(I(_t()),W?O.goBack():O.replace(Tt)),ft(!1)},[I,O,W,e.id]),{addressCheckLoading:St,addressCheckError:pt}=Pe({from:p,chainIndex:qt(a),handleCancel:G,method:e.method}),{tipMessageProps:Ke}=De({isHardware:h,feeError:V,isSufficientGas:W,dustError:st,transferReminder:rt,addressCheckError:pt}),Ot=(0,t.useCallback)(async()=>{if(!await _e({walletId:n,callback:async()=>{await I(yt(e.id))}}))return;let d=await Bt(0,g);await kt([...v,...d],G),ft(!0);let _=await Ft({utxoList:[],utxos:[{address:r.address,inputs:xe(d)}]}),U=await pe(u?.localType,_);try{e.id?(await I(ae(e.id,{coinId:o,txHash:U,signedTx:_,serviceCharge:g,gasFrom:r.address,txType:mt,nftIds:dt})),await I(xt())):(await Pt(_),I(_t()),zt.success({title:f("wallet_transfer_notif_transaction_submit")})),O.push(Tt)}catch{}finally{ft(!1)}},[G,kt,u?.localType,I,g,Bt,O,W,dt,r.address,Pt,Ft,v,mt,e.id]),{loading:Wt,onClick:Ut}=It(Ot),{loading:Dt,onClick:Mt}=It(G),Xe=(0,t.useMemo)(()=>{let s={actionType:R.ACTION_TYPE.CANCEL,btnText:f("wallet_dapp_connection_btn_reject"),onClick:Mt,loading:Dt},d={disabled:bt||ct||V||h||!Number(g)||!l?.length||Lt||st||pt,actionType:R.ACTION_TYPE.CONFIRM,onClick:Ut,loading:Wt||St};return W||(d={coinId:o,walletId:n,address:r?.address,actionType:R.ACTION_TYPE.FILL_UP}),[s,d]},[bt,ct,V,h,g,l?.length,Ot,W,e.id,I,O,o,n,r?.address,Lt,st,Dt,Wt,Mt,Ut,St,pt]);return t.default.createElement(L.Box,null,t.default.createElement(et,null,t.default.createElement(Le,{space:24,title:f("wallet_extension_send_colored_send"),summaryList:qe}),ut>je&&t.default.createElement(L.FlexBox,{justify:"center",className:ht["nft-transfer__extend"],onClick:Ge},t.default.createElement(gt,{size:gt.SIZE.xs,className:ht["nft-transfer__icon"],icon:it?"okds-arrow-chevron-up-md":"okx-wallet-plugin-add-arrow-chevrons"}))),t.default.createElement(et,null,t.default.createElement(tt,{walletId:n,address:p,title:f("extension_send_mid_text_from")}),t.default.createElement(tt,{address:T,title:f("extension_send_mid_text_to")})),t.default.createElement(et,null,t.default.createElement(we,{coinId:o,loading:ct,estimateFailed:V,networkFee:g,onClick:()=>{H({networkFee:!0})}}),t.default.createElement(tt,{copyable:!1,address:r?.address,addressType:r?.addressType,title:f("btcnft_gas_label_pay_gas_with"),tags:[f($[r?.addressType])],onClick:()=>{H({payWallet:!0})}},t.default.createElement(Ee,{coinBalance:r.canTransferAmount,coinId:o}))),t.default.createElement(ke,{coinId:o,value:r,options:S,visible:Nt.payWallet,onChange:at,onToggleVisible:()=>{H({payWallet:!1})}}),t.default.createElement(ie,{offsetBottom:0,placeholder:!0,borderTop:!0},t.default.createElement(F,{coinId:o,...Ke}),t.default.createElement(R,{buttonGroup:Xe})),t.default.createElement(be,{coinId:o,signInfo:A,visible:Nt?.networkFee,value:E,estimatedFee:g,onChange:wt,onToggleVisible:()=>{H({networkFee:!1})}}),t.default.createElement(Fe,{visible:Je&&$e}))},Qr=fo;export{Qr as a};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-BTPOS4L6.js.map
