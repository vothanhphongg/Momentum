import{a as oe,b as ie,c as le,d as ue,e as de}from"./chunk-JCM7SRK2.js";import{a as fe}from"./chunk-E2JYOUYE.js";import{a as re}from"./chunk-B3JSNQIV.js";import{p as te,q as ne,r as T}from"./chunk-YALUYHLV.js";import{o as Ge}from"./chunk-5QMHGZLF.js";import{b as K,c as He,ec as Ye,vb as ee}from"./chunk-HPWCPLRR.js";import{a as Je}from"./chunk-ON6S2DB7.js";import{j as A,p as Ve}from"./chunk-SZD6WTBQ.js";import{m as Z,n as v,r as qe}from"./chunk-3DZ7WRLL.js";import{c as M,d as I,f as Le}from"./chunk-DEOJU4Z3.js";import{a as Qe,b as ze,c as Xe}from"./chunk-PLIIQKFY.js";import{c as ae,d as se,g as ce}from"./chunk-RTFE54S3.js";import{c as C,e as h}from"./chunk-UVFOW4HH.js";import{Ia as H,Na as Pe,Tc as B,_c as Ke,ad as W,kb as O,mb as q,nb as V,ob as G,pb as Q,pc as X,rc as Y,rd as J,tb as z,ya as P,za as Ue}from"./chunk-TM67VPZU.js";import{H as x}from"./chunk-PUSMMCUD.js";import{R as De,z as F}from"./chunk-UWJLNJLY.js";import{ra as $e,y as U}from"./chunk-XDY6V34Y.js";import{b as Re}from"./chunk-JWYCKY2V.js";import{c as L,f as w,o as d,q as f}from"./chunk-6KXF36WM.js";var we=L((wr,ge)=>{"use strict";d();f();var ye="%[a-f0-9]{2}",pe=new RegExp(ye,"gi"),me=new RegExp("("+ye+")+","gi");function j(e,r){try{return decodeURIComponent(e.join(""))}catch{}if(e.length===1)return e;r=r||1;var t=e.slice(0,r),n=e.slice(r);return Array.prototype.concat.call([],j(t),j(n))}function Ze(e){try{return decodeURIComponent(e)}catch{for(var r=e.match(pe),t=1;t<r.length;t++)e=j(r,t).join(""),r=e.match(pe);return e}}function ve(e){for(var r={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},t=me.exec(e);t;){try{r[t[0]]=decodeURIComponent(t[0])}catch{var n=Ze(t[0]);n!==t[0]&&(r[t[0]]=n)}t=me.exec(e)}r["%C2"]="\uFFFD";for(var a=Object.keys(r),c=0;c<a.length;c++){var s=a[c];e=e.replace(new RegExp(s,"g"),r[s])}return e}ge.exports=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch{return ve(e)}}});var Te=L(u=>{"use strict";d();f();var er=Qe(),rr=we(),We=ze(),tr=Xe(),nr=e=>e==null,k=Symbol("encodeFragmentIdentifier");function ar(e){switch(e.arrayFormat){case"index":return r=>(t,n)=>{let a=t.length;return n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),"[",a,"]"].join("")]:[...t,[l(r,e),"[",l(a,e),"]=",l(n,e)].join("")]};case"bracket":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),"[]"].join("")]:[...t,[l(r,e),"[]=",l(n,e)].join("")];case"colon-list-separator":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),":list="].join("")]:[...t,[l(r,e),":list=",l(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{let r=e.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,a)=>a===void 0||e.skipNull&&a===null||e.skipEmptyString&&a===""?n:(a=a===null?"":a,n.length===0?[[l(t,e),r,l(a,e)].join("")]:[[n,l(a,e)].join(e.arrayFormatSeparator)])}default:return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,l(r,e)]:[...t,[l(r,e),"=",l(n,e)].join("")]}}function sr(e){let r;switch(e.arrayFormat){case"index":return(t,n,a)=>{if(r=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),!r){a[t]=n;return}a[t]===void 0&&(a[t]={}),a[t][r[1]]=n};case"bracket":return(t,n,a)=>{if(r=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"colon-list-separator":return(t,n,a)=>{if(r=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"comma":case"separator":return(t,n,a)=>{let c=typeof n=="string"&&n.includes(e.arrayFormatSeparator),s=typeof n=="string"&&!c&&m(n,e).includes(e.arrayFormatSeparator);n=s?m(n,e):n;let o=c||s?n.split(e.arrayFormatSeparator).map(p=>m(p,e)):n===null?n:m(n,e);a[t]=o};case"bracket-separator":return(t,n,a)=>{let c=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!c){a[t]=n&&m(n,e);return}let s=n===null?[]:n.split(e.arrayFormatSeparator).map(o=>m(o,e));if(a[t]===void 0){a[t]=s;return}a[t]=[].concat(a[t],s)};default:return(t,n,a)=>{if(a[t]===void 0){a[t]=n;return}a[t]=[].concat(a[t],n)}}}function Ae(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function l(e,r){return r.encode?r.strict?er(e):encodeURIComponent(e):e}function m(e,r){return r.decode?rr(e):e}function he(e){return Array.isArray(e)?e.sort():typeof e=="object"?he(Object.keys(e)).sort((r,t)=>Number(r)-Number(t)).map(r=>e[r]):e}function Ee(e){let r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function cr(e){let r="",t=e.indexOf("#");return t!==-1&&(r=e.slice(t)),r}function Fe(e){e=Ee(e);let r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function Ie(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function xe(e,r){r=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},r),Ae(r.arrayFormatSeparator);let t=sr(r),n=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return n;for(let a of e.split("&")){if(a==="")continue;let[c,s]=We(r.decode?a.replace(/\+/g," "):a,"=");s=s===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?s:m(s,r),t(m(c,r),s,n)}for(let a of Object.keys(n)){let c=n[a];if(typeof c=="object"&&c!==null)for(let s of Object.keys(c))c[s]=Ie(c[s],r);else n[a]=Ie(c,r)}return r.sort===!1?n:(r.sort===!0?Object.keys(n).sort():Object.keys(n).sort(r.sort)).reduce((a,c)=>{let s=n[c];return Boolean(s)&&typeof s=="object"&&!Array.isArray(s)?a[c]=he(s):a[c]=s,a},Object.create(null))}u.extract=Fe;u.parse=xe;u.stringify=(e,r)=>{if(!e)return"";r=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},r),Ae(r.arrayFormatSeparator);let t=s=>r.skipNull&&nr(e[s])||r.skipEmptyString&&e[s]==="",n=ar(r),a={};for(let s of Object.keys(e))t(s)||(a[s]=e[s]);let c=Object.keys(a);return r.sort!==!1&&c.sort(r.sort),c.map(s=>{let o=e[s];return o===void 0?"":o===null?l(s,r):Array.isArray(o)?o.length===0&&r.arrayFormat==="bracket-separator"?l(s,r)+"[]":o.reduce(n(s),[]).join("&"):l(s,r)+"="+l(o,r)}).filter(s=>s.length>0).join("&")};u.parseUrl=(e,r)=>{r=Object.assign({decode:!0},r);let[t,n]=We(e,"#");return Object.assign({url:t.split("?")[0]||"",query:xe(Fe(e),r)},r&&r.parseFragmentIdentifier&&n?{fragmentIdentifier:m(n,r)}:{})};u.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[k]:!0},r);let t=Ee(e.url).split("?")[0]||"",n=u.extract(e.url),a=u.parse(n,{sort:!1}),c=Object.assign(a,e.query),s=u.stringify(c,r);s&&(s=`?${s}`);let o=cr(e.url);return e.fragmentIdentifier&&(o=`#${r[k]?l(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${t}${s}${o}`};u.pick=(e,r,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[k]:!1},t);let{url:n,query:a,fragmentIdentifier:c}=u.parseUrl(e,t);return u.stringifyUrl({url:n,query:tr(a,r),fragmentIdentifier:c},t)};u.exclude=(e,r,t)=>{let n=Array.isArray(r)?a=>!r.includes(a):(a,c)=>!r(a,c);return u.pick(e,n,t)}});d();f();var i=w(Re()),y=w(Ye()),R=w(Je()),Be=w(Ge()),E=w(Te()),je=w(He());De();Ve();J();qe();Y();d();f();var Ce=()=>!!(window.navigator&&window.navigator.hid);Le();d();f();Ue();Pe();var be=()=>({syncMpcWallet:async r=>{let t=r?.walletIdentities?.length||0,n=r?.mpcId||"",{data:a}=await H(P.syncMpcwallet,{mpcId:n,deriveIndex:t});return a}});d();f();$e();J();Y();Ke();var Me=(e,r)=>{if(!e||!Array.isArray(e))return[];let{hasBackup:t,keyringType:n}=r||{};return e.filter(({hasBackup:a,keyringIdentityType:c})=>{let s=!0;return typeof t=="boolean"&&(s=t===a),n&&(s=(typeof n=="string"?[n]:n)?.includes(c)),s})},Oe=e=>e?.reduce((r,{walletIdentities:t,...n})=>[...r,...t.map((a={})=>({...n,...a}))],[]),Se=e=>e.map(r=>{let{walletIdentities:t}=r;return{...r,hasBackup:t?.[0]?.needBackup!==1}}),or=(e={},r)=>{let t=[B.SEGWIT_NESTED,B.SEGWIT_NESTED_49],n={};return Object.keys(e).forEach(c=>{let s=r[c],o=t.find(g=>g!==s),p=Object.entries(e[c]).map(([g,ke])=>({addressType:g,...ke}));n[c]=p.filter(({addressType:g})=>g!==o)}),n},Ne=(e=[])=>e.map(r=>{let{walletIdentities:t}=r;return{...r,walletIdentities:t.map(n=>{let{walletId:a,accountsMap:c,addressType:s,segwitAddressType:o,...p}=n;return{walletId:a,selectedAddressType:s,addressType:or(n?.accountsMap,o),segwitAddressType:o,...p}})}});var ir=[q,z,V,G,Q],Ur=(e,r=O,t)=>{if(ir.includes(r)&&t){let a=X(r),c=e?.addressType?.[a]||[];return U(c,s=>s.addressType===t)?.address}return e?.account?.[r]};var lr="syncMpcWalletErrorCode";var ur=(0,je.createSelector)(({keyring:e})=>e.keyringIdentities,e=>Ne(K(e))),D=e=>{let r=(0,y.useSelector)(ur);return(0,i.useMemo)(()=>{let n=Se(r);return e?Me(n,e):n},[e,r])},S=e=>{let r=D(e);return(0,i.useMemo)(()=>Oe(r||[]),[r])},dr=()=>(0,y.useSelector)(ee),N=(e,r=!0)=>{let t=dr(),n=e||t,a=S();return(0,i.useMemo)(()=>r===!1&&!e?null:a.find(c=>c?.walletId===n),[a,n,r,e])},dt=(e,r)=>N(e,!1)?.account?.[r],ft=(e,r)=>{let t=S(r);return(0,i.useMemo)(()=>Array.isArray(e)?t.filter(({walletId:n})=>e.includes(n)):t,[e,t])},pt=()=>{let e=S();return(0,i.useCallback)(r=>e?.find(t=>t.walletId===r),[e])},mt=e=>N(e)?.keyringIdentityType===W.MPC,yt=e=>{let r=N(e);return de(r?.initialType)},gt=e=>{let r=D(),{keyringId:t}=N()||{},n=e||t;return(0,i.useMemo)(()=>r?.find(a=>a.keyringId===n),[r,n])},_=()=>{let e=D();return(0,i.useCallback)(r=>e?.find(t=>t.keyringId===r),[e])};var _e=()=>{let e=(0,y.useDispatch)(),{successHaptic:r,impactHaptic:t}=fe();return(0,i.useCallback)(async n=>{try{t();let{walletId:a}=await I().addNewWallet(n);return re(),await A(e),r(),x.success({title:F("wallet_addacount_toast_account_created")}),a}catch(a){return a.message===Z&&x.error(F("wallet_home_toast_network_error")),a.message===v&&x.error(F("extension_wallet_addwallet_toast_wallets_added",{amount:1e3})),""}},[])},fr=()=>{let e=(0,R.useHistory)();return(0,i.useCallback)(async r=>{let t=r?.walletIdentities?.[0]?.walletId;if(!Ce()){e.push(`${T}/${C.ledger}?${E.default.stringify({baseChain:O,type:h.addAccount,walletId:t})}`);return}let n=`${ne}?${E.default.stringify({type:h.addAccount,walletId:t})}`;await ce.hasConnectedLedger()?e.push(n):se.openModal(ae.hardWareNotConnected,{walletName:r.keyringName,onButtonClick:()=>{globalThis.platform.openExtensionInBrowser(te)},onExtButtonClick:()=>{globalThis.platform.openExtensionInBrowser(`${n}&hideBack=1`)}})},[])},pr=()=>{let e=(0,R.useHistory)(),r=fr(),t=S()?.length;return(0,i.useCallback)(async n=>{if(t===1e3){x.error(F("extension_wallet_addwallet_toast_wallets_added",{amount:1e3}));return}let{initialType:a}=n,c=n?.walletIdentities?.[0]?.walletId;switch(!0){case oe(a):{r(n);break}case ie(a):{globalThis.platform.openExtensionInBrowser(`${T}/${C.trezor}?${E.default.stringify({type:h.addAccount,walletId:c,hideBack:1})}`);break}case le(a):{e.push(`${T}/${C.keystone}?${E.default.stringify({walletId:c,type:h.addAccount})}`);break}case ue(a):{let{onekeyInfo:s}=n,{firstEvmAddress:o,connectId:p}=s;e.push(`${T}/${C.onekey}?${E.default.stringify({firstEvmAddress:o,connectId:p,type:h.addAccount})}`);break}default:break}},[])},wt=()=>{let e=_(),r=_e(),t=pr(),n=_e(),{syncMpcWallet:a}=be();return(0,i.useCallback)(async c=>{if(c&&typeof c=="string"){let s=e(c),o=s?.walletIdentities?.[0]?.walletId;if(s?.keyringIdentityType===W.MNEMONIC)return await r(o);if(s?.keyringIdentityType===W.HARDWARE)return t(s);if(s?.keyringIdentityType===W.MPC){try{await a(s)}catch{return Promise.reject(new Error(lr))}return await n(o)}return Promise.reject()}return Promise.reject()},[e,r,t,n,a])},mr=()=>{let e=_();return(0,i.useCallback)(r=>new Promise((t,n)=>{let a=e(r);M().getMnemonicByWalletId(a?.walletIdentities?.[0]?.walletId,(c,s)=>{if(c){n(c);return}t(s)})}),[])},It=(e,r=!0)=>{let t=mr(),[n,a]=(0,i.useState)(null);return(0,i.useEffect)(()=>{(async()=>{if(e){let c=await t(e);a(c)}})()},[e]),r?n?.split(" "):n},yr=()=>(0,i.useCallback)((e,r={})=>new Promise((t,n)=>{M().getBackupPrivateKeys(e,(a,c)=>{if(a){n(a);return}let s=c;Array.isArray(r?.exclude)&&(s=s?.filter(({coinId:o})=>!r?.exclude?.includes(o))),t(s)})}),[]),Wt=(e,r={})=>{let[t,n]=(0,i.useState)([]),a=yr();return(0,Be.useDeepCompareEffect)(()=>{(async()=>{if(e){let c=await a(e,r);n(c)}})()},[e,r]),t},gr=()=>{let e=_();return(0,i.useCallback)(r=>new Promise((t,n)=>{let a=e(r);M().getBackupData(a?.walletIdentities?.[0]?.walletId,(c,s)=>{if(c){n(c);return}t(s)})}),[])},At=e=>{let[r,t]=(0,i.useState)([]),n=gr();return(0,i.useEffect)(()=>{(async()=>{if(e){let a=await n(e);t(a)}})()},[e]),r},ht=()=>{let e=(0,y.useDispatch)(),r=_();return(0,i.useCallback)(async t=>{let n=r(t);await I().backupMnemonic(n?.walletIdentities?.[0]?.groupId),await A(e)},[])},Et=()=>{let e=(0,y.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await I().updateKeyringIdentityName(r,t),await A(e)},[])},Ft=()=>{let e=(0,y.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await I().updateWalletIdentityName(r,t),await A(e)},[])},xt=()=>{let e=(0,y.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await I().updateKeyringIdentitiesOrder(r,t),await A(e)},[e])};export{Te as a,Ce as b,Ur as c,lr as d,D as e,S as f,dr as g,N as h,dt as i,ft as j,pt as k,mt as l,yt as m,gt as n,_ as o,wt as p,It as q,yr as r,Wt as s,At as t,ht as u,Et as v,Ft as w,xt as x};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-IRMYAC6R.js.map
