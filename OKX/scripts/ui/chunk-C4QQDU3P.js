import{a as fd,b as pd,c as md,d as Rd,e as Id,f as Ld}from"./chunk-PSP73LQF.js";import{a as dd}from"./chunk-NKH3CSPK.js";import{a as Cd,b as Od,c as Dd,d as Ad}from"./chunk-ZP2WZ34E.js";import{a as ld,b as Kr,c as ud,d as Mi}from"./chunk-WXZ3ZM4J.js";import{a as kd}from"./chunk-HQOEAQAJ.js";import{a as hd}from"./chunk-XVXZXT5F.js";import{a as wd,b as Td}from"./chunk-FU6DGYIU.js";import{a as bd}from"./chunk-N5DH5ULG.js";import{a as Nd}from"./chunk-A7OOQ3UI.js";import{a as Pd}from"./chunk-H5FQUSH6.js";import{a as Ki}from"./chunk-AQOCVER4.js";import{b as ga,c as xr,d as od,e as ma,f as id}from"./chunk-N7RVZ3T6.js";import{a as rd}from"./chunk-ZE645RND.js";import{d as nd}from"./chunk-7C3BTQYU.js";import{H as td}from"./chunk-3XTUMVWB.js";import{a as zu}from"./chunk-OWWFH26C.js";import{c as Yu}from"./chunk-MNZIO3NP.js";import{a as xi,b as ad}from"./chunk-KQSVDWZZ.js";import{a as ed}from"./chunk-IIAVVYHZ.js";import{a as Qu,c as Zu}from"./chunk-TSTKPLAO.js";import{a as Sd}from"./chunk-Z7BY4UGH.js";import{a as _d,b as yd}from"./chunk-J5SZHERT.js";import{a as Ed}from"./chunk-QF3U2HSV.js";import{a as cd,b as vd}from"./chunk-BMKBVCIX.js";import{a as gd}from"./chunk-ULWEH6UQ.js";import{a as Li}from"./chunk-YJDAHJUY.js";import{a as Dn}from"./chunk-3USSVI5T.js";import{a as ki}from"./chunk-G55YEDT5.js";import{d as Cm,e as Om,k as Em,l as wm}from"./chunk-P3UGFZYN.js";import{a as da,c as mu,f as Uu,g as Xu,h as Hu}from"./chunk-UGT3PL2G.js";import{b as vu}from"./chunk-IOMRU3OQ.js";import{q as Iu}from"./chunk-DJZDGYQA.js";import{e as Pu}from"./chunk-W23ABSXX.js";import{b as Lu}from"./chunk-4EFZXPDV.js";import{g as Pi,h as Gu}from"./chunk-G4AVWXHJ.js";import{a as Ju,b as Fu,c as $u,d as Vu}from"./chunk-76CRIMII.js";import{b as Ql}from"./chunk-F7VSWGDW.js";import{P as Oi,ea as hu,la as Ei}from"./chunk-KLLSVAFY.js";import{f as pa}from"./chunk-AKE54ZCC.js";import{a as Bu}from"./chunk-A57OTXBP.js";import{a as ju}from"./chunk-HTLOGWI7.js";import{c as sd}from"./chunk-OD6ZXH4X.js";import{m as Ri,o as Nu,v as Ru}from"./chunk-ELJJJNTC.js";import{g as ha}from"./chunk-7SRLIN7D.js";import{g as sn,h as Lr}from"./chunk-IRMYAC6R.js";import{b as Di}from"./chunk-MRB2XFLQ.js";import{d as Ni}from"./chunk-PDC447BO.js";import{a as ku}from"./chunk-JCM7SRK2.js";import{b as Ft}from"./chunk-ETJEH7T4.js";import{a as qu,b as Ai}from"./chunk-LLZAOPDB.js";import{a as on}from"./chunk-EWTTD4DL.js";import{b as Ku,c as Mu,d as Ii}from"./chunk-Y2TPPS4H.js";import{g as xu}from"./chunk-ITY22AD4.js";import{a as Wu}from"./chunk-E2JYOUYE.js";import{H as Ti,aa as xo,e as wi,f as Cu,fa as Si,gb as Tu,i as Ou,pa as Eu,ra as wu,sb as Su}from"./chunk-YALUYHLV.js";import{a as fa,h as Du,q as Jt}from"./chunk-I3CPAVOC.js";import{o as Pr}from"./chunk-5QMHGZLF.js";import{$b as fu,Ab as Ci,Bb as lu,C as ou,Eb as uu,Gb as du,I as iu,J as su,K as au,N as ua,c as mm,dc as pu,ec as it,na as cu}from"./chunk-HPWCPLRR.js";import{a as vn}from"./chunk-ON6S2DB7.js";import{f as gu,p as bm}from"./chunk-SZD6WTBQ.js";import{d as ca,f as gm}from"./chunk-DEOJU4Z3.js";import{e as _u,k as Lo,l as yu,m as bu}from"./chunk-XV444F26.js";import{g as Au}from"./chunk-LNOPECCQ.js";import{c as ee}from"./chunk-43VURGIT.js";import{B as pi,Ea as zl,Gb as eu,H as ql,Hb as tu,I as Jl,Ia as Ar,Ib as nu,Ic as la,K as hi,Na as bi,Q as gi,Sc as _m,ad as vi,e as di,f as pm,ha as ia,ia as mi,ja as Fl,kb as Po,mb as nr,ra as $l,rc as ko,rd as ru,sa as hm,ta as Vl,ub as Zl,ya as In,za as yi}from"./chunk-TM67VPZU.js";import{G as aa,H as Yl,L as tr,N as Ao,d as _i,j as sa,n as Gl,o as Ot,w as Do,y as Dr}from"./chunk-PUSMMCUD.js";import{E as fi,Q as Hl,R as ot,k as Ul,o as Dt,y as Xl,z as se}from"./chunk-UWJLNJLY.js";import{G as Wl,L as jl,la as Bl,ra as oa}from"./chunk-XDY6V34Y.js";import{W as Ir,c as Io,ea as Le}from"./chunk-JT3LNHPY.js";import{b as Ce}from"./chunk-JWYCKY2V.js";import{a as ym}from"./chunk-WOMUNWBT.js";import{a as vm}from"./chunk-324EPGNQ.js";import{a as kr}from"./chunk-IWVM7XL6.js";import{a as Ro,b as ke,c as $,d as Qe,f as q,g as Ml,o as f,q as p}from"./chunk-6KXF36WM.js";var jr=$(ye=>{"use strict";f();p();Object.defineProperty(ye,"__esModule",{value:!0});ye.ConnectorState=ye.CONNECT_PROTOCOL_VER=ye.CONNECT_JSONRPC_VER=ye.OKXCONNECTOR_SESSION_LIVE_TTL=ye.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL=ye.OKXCONNECTOR_MESSAGE_TTL=ye.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE=ye.OKXCONNECTOR_WS_URL_LIST=ye.OKXCONNECTOR_WS_URL_IDX_KEY=ye.OKXCONNECTOR_WS_URL_3=ye.OKXCONNECTOR_WS_URL_2=ye.OKXCONNECTOR_WS_URL_1=ye.EVENT_EMITTER_MAX_LISTENERS=ye.OKXCONNECTOR_PROTOCOL_VERSION=void 0;ye.OKXCONNECTOR_PROTOCOL_VERSION=2;ye.EVENT_EMITTER_MAX_LISTENERS=10;ye.OKXCONNECTOR_WS_URL_1="wss://wsdexpri.okx.com/ws/v1/wallet-connect-relay";ye.OKXCONNECTOR_WS_URL_2="wss://wsdexpri.okx.ac/ws/v1/wallet-connect-relay";ye.OKXCONNECTOR_WS_URL_3="wss://wsdexpri.coinall.ltd/ws/v1/wallet-connect-relay";ye.OKXCONNECTOR_WS_URL_IDX_KEY="wuik";ye.OKXCONNECTOR_WS_URL_LIST=[ye.OKXCONNECTOR_WS_URL_1,ye.OKXCONNECTOR_WS_URL_2,ye.OKXCONNECTOR_WS_URL_3];ye.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE={TIME_OUT:3990,CANCELED:3991,FINISHED:3992};ye.OKXCONNECTOR_MESSAGE_TTL=3e5;ye.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL=864e5;ye.OKXCONNECTOR_SESSION_LIVE_TTL=864e5;ye.CONNECT_JSONRPC_VER="2.0";ye.CONNECT_PROTOCOL_VER=2;ye.ConnectorState={InitState:0,Connecting:1,Connected:2,Disconnected:3,OnError:4}});var Br=$(ve=>{"use strict";f();p();Object.defineProperty(ve,"__esModule",{value:!0});ve.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE=ve.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE=ve.OKXCONNECTOR_STORAGE_PROTOCOL_CACHE=ve.OKXCONNECTOR_STORAGE_CIPHER_METHOD=ve.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV=ve.OKXCONNECTOR_STORAGER_CRYPTO_SALT=ve.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD=ve.OKXCONNECTOR_TON_KEY=ve.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE=ve.OKXCONNECTOR_TOKEN_CACHE=ve.OKXCONNECTOR_JWT_KEY=ve.OKXCONNECTOR_SESSION_PREFIX_KEY=ve.OKXCONNECTOR_CRYPTO_KEY=ve.OKXCONNECTOR_CACHE_KEY_DAPP=ve.OKXCONNECTOR_CACHE_KEY=void 0;ve.OKXCONNECTOR_CACHE_KEY="ck";ve.OKXCONNECTOR_CACHE_KEY_DAPP="ck_dapp";ve.OKXCONNECTOR_CRYPTO_KEY="cck_k";ve.OKXCONNECTOR_SESSION_PREFIX_KEY="cspk_";ve.OKXCONNECTOR_JWT_KEY="cjk_k";ve.OKXCONNECTOR_TOKEN_CACHE="ct";ve.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE="csp";ve.OKXCONNECTOR_TON_KEY="OKXStorage_ctc";ve.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD="scp";ve.OKXCONNECTOR_STORAGER_CRYPTO_SALT="scs";ve.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV="scpc";ve.OKXCONNECTOR_STORAGE_CIPHER_METHOD="aes-256-cbc";ve.OKXCONNECTOR_STORAGE_PROTOCOL_CACHE="okx_connect_split_cache_key";ve.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE="okx_connect_te_cache_key";ve.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE="okx_connect_twe_cache_key"});var If=$((Ln,Rf)=>{f();p();var $i=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis,Vi=function(){function n(){this.fetch=!1,this.DOMException=$i.DOMException}return n.prototype=$i,new n}();(function(n){var e=function(t){var r=typeof n<"u"&&n||typeof self<"u"&&self||typeof r<"u"&&r,o={searchParams:"URLSearchParams"in r,iterable:"Symbol"in r&&"iterator"in Symbol,blob:"FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in r,arrayBuffer:"ArrayBuffer"in r};function i(O){return O&&DataView.prototype.isPrototypeOf(O)}if(o.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(O){return O&&s.indexOf(Object.prototype.toString.call(O))>-1};function g(O){if(typeof O!="string"&&(O=String(O)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(O)||O==="")throw new TypeError('Invalid character in header field name: "'+O+'"');return O.toLowerCase()}function d(O){return typeof O!="string"&&(O=String(O)),O}function a(O){var R={next:function(){var B=O.shift();return{done:B===void 0,value:B}}};return o.iterable&&(R[Symbol.iterator]=function(){return R}),R}function c(O){this.map={},O instanceof c?O.forEach(function(R,B){this.append(B,R)},this):Array.isArray(O)?O.forEach(function(R){this.append(R[0],R[1])},this):O&&Object.getOwnPropertyNames(O).forEach(function(R){this.append(R,O[R])},this)}c.prototype.append=function(O,R){O=g(O),R=d(R);var B=this.map[O];this.map[O]=B?B+", "+R:R},c.prototype.delete=function(O){delete this.map[g(O)]},c.prototype.get=function(O){return O=g(O),this.has(O)?this.map[O]:null},c.prototype.has=function(O){return this.map.hasOwnProperty(g(O))},c.prototype.set=function(O,R){this.map[g(O)]=d(R)},c.prototype.forEach=function(O,R){for(var B in this.map)this.map.hasOwnProperty(B)&&O.call(R,this.map[B],B,this)},c.prototype.keys=function(){var O=[];return this.forEach(function(R,B){O.push(B)}),a(O)},c.prototype.values=function(){var O=[];return this.forEach(function(R){O.push(R)}),a(O)},c.prototype.entries=function(){var O=[];return this.forEach(function(R,B){O.push([B,R])}),a(O)},o.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);function u(O){if(O.bodyUsed)return Promise.reject(new TypeError("Already read"));O.bodyUsed=!0}function _(O){return new Promise(function(R,B){O.onload=function(){R(O.result)},O.onerror=function(){B(O.error)}})}function y(O){var R=new FileReader,B=_(R);return R.readAsArrayBuffer(O),B}function N(O){var R=new FileReader,B=_(R);return R.readAsText(O),B}function X(O){for(var R=new Uint8Array(O),B=new Array(R.length),Q=0;Q<R.length;Q++)B[Q]=String.fromCharCode(R[Q]);return B.join("")}function D(O){if(O.slice)return O.slice(0);var R=new Uint8Array(O.byteLength);return R.set(new Uint8Array(O)),R.buffer}function T(){return this.bodyUsed=!1,this._initBody=function(O){this.bodyUsed=this.bodyUsed,this._bodyInit=O,O?typeof O=="string"?this._bodyText=O:o.blob&&Blob.prototype.isPrototypeOf(O)?this._bodyBlob=O:o.formData&&FormData.prototype.isPrototypeOf(O)?this._bodyFormData=O:o.searchParams&&URLSearchParams.prototype.isPrototypeOf(O)?this._bodyText=O.toString():o.arrayBuffer&&o.blob&&i(O)?(this._bodyArrayBuffer=D(O.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(O)||l(O))?this._bodyArrayBuffer=D(O):this._bodyText=O=Object.prototype.toString.call(O):this._bodyText="",this.headers.get("content-type")||(typeof O=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o.searchParams&&URLSearchParams.prototype.isPrototypeOf(O)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o.blob&&(this.blob=function(){var O=u(this);if(O)return O;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var O=u(this);return O||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(y)}),this.text=function(){var O=u(this);if(O)return O;if(this._bodyBlob)return N(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(X(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}var L=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function H(O){var R=O.toUpperCase();return L.indexOf(R)>-1?R:O}function F(O,R){if(!(this instanceof F))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');R=R||{};var B=R.body;if(O instanceof F){if(O.bodyUsed)throw new TypeError("Already read");this.url=O.url,this.credentials=O.credentials,R.headers||(this.headers=new c(O.headers)),this.method=O.method,this.mode=O.mode,this.signal=O.signal,!B&&O._bodyInit!=null&&(B=O._bodyInit,O.bodyUsed=!0)}else this.url=String(O);if(this.credentials=R.credentials||this.credentials||"same-origin",(R.headers||!this.headers)&&(this.headers=new c(R.headers)),this.method=H(R.method||this.method||"GET"),this.mode=R.mode||this.mode||null,this.signal=R.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&B)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(B),(this.method==="GET"||this.method==="HEAD")&&(R.cache==="no-store"||R.cache==="no-cache")){var Q=/([?&])_=[^&]*/;if(Q.test(this.url))this.url=this.url.replace(Q,"$1_="+new Date().getTime());else{var ce=/\?/;this.url+=(ce.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}F.prototype.clone=function(){return new F(this,{body:this._bodyInit})};function S(O){var R=new FormData;return O.trim().split("&").forEach(function(B){if(B){var Q=B.split("="),ce=Q.shift().replace(/\+/g," "),ie=Q.join("=").replace(/\+/g," ");R.append(decodeURIComponent(ce),decodeURIComponent(ie))}}),R}function W(O){var R=new c,B=O.replace(/\r?\n[\t ]+/g," ");return B.split("\r").map(function(Q){return Q.indexOf(`
`)===0?Q.substr(1,Q.length):Q}).forEach(function(Q){var ce=Q.split(":"),ie=ce.shift().trim();if(ie){var Ge=ce.join(":").trim();R.append(ie,Ge)}}),R}T.call(F.prototype);function k(O,R){if(!(this instanceof k))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');R||(R={}),this.type="default",this.status=R.status===void 0?200:R.status,this.ok=this.status>=200&&this.status<300,this.statusText=R.statusText===void 0?"":""+R.statusText,this.headers=new c(R.headers),this.url=R.url||"",this._initBody(O)}T.call(k.prototype),k.prototype.clone=function(){return new k(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},k.error=function(){var O=new k(null,{status:0,statusText:""});return O.type="error",O};var J=[301,302,303,307,308];k.redirect=function(O,R){if(J.indexOf(R)===-1)throw new RangeError("Invalid status code");return new k(null,{status:R,headers:{location:O}})},t.DOMException=r.DOMException;try{new t.DOMException}catch{t.DOMException=function(R,B){this.message=R,this.name=B;var Q=Error(R);this.stack=Q.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function ne(O,R){return new Promise(function(B,Q){var ce=new F(O,R);if(ce.signal&&ce.signal.aborted)return Q(new t.DOMException("Aborted","AbortError"));var ie=new XMLHttpRequest;function Ge(){ie.abort()}ie.onload=function(){var Pe={status:ie.status,statusText:ie.statusText,headers:W(ie.getAllResponseHeaders()||"")};Pe.url="responseURL"in ie?ie.responseURL:Pe.headers.get("X-Request-URL");var pt="response"in ie?ie.response:ie.responseText;setTimeout(function(){B(new k(pt,Pe))},0)},ie.onerror=function(){setTimeout(function(){Q(new TypeError("Network request failed"))},0)},ie.ontimeout=function(){setTimeout(function(){Q(new TypeError("Network request failed"))},0)},ie.onabort=function(){setTimeout(function(){Q(new t.DOMException("Aborted","AbortError"))},0)};function Ye(Pe){try{return Pe===""&&r.location.href?r.location.href:Pe}catch{return Pe}}ie.open(ce.method,Ye(ce.url),!0),ce.credentials==="include"?ie.withCredentials=!0:ce.credentials==="omit"&&(ie.withCredentials=!1),"responseType"in ie&&(o.blob?ie.responseType="blob":o.arrayBuffer&&ce.headers.get("Content-Type")&&ce.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(ie.responseType="arraybuffer")),R&&typeof R.headers=="object"&&!(R.headers instanceof c)?Object.getOwnPropertyNames(R.headers).forEach(function(Pe){ie.setRequestHeader(Pe,d(R.headers[Pe]))}):ce.headers.forEach(function(Pe,pt){ie.setRequestHeader(pt,Pe)}),ce.signal&&(ce.signal.addEventListener("abort",Ge),ie.onreadystatechange=function(){ie.readyState===4&&ce.signal.removeEventListener("abort",Ge)}),ie.send(typeof ce._bodyInit>"u"?null:ce._bodyInit)})}return ne.polyfill=!0,r.fetch||(r.fetch=ne,r.Headers=c,r.Request=F,r.Response=k),t.Headers=c,t.Request=F,t.Response=k,t.fetch=ne,t}({})})(Vi);Vi.fetch.ponyfill=!0;delete Vi.fetch.polyfill;var Ur=$i.fetch?$i:Vi;Ln=Ur.fetch;Ln.default=Ur.fetch;Ln.fetch=Ur.fetch;Ln.Headers=Ur.Headers;Ln.Request=Ur.Request;Ln.Response=Ur.Response;Rf.exports=Ln});var Na=$(be=>{"use strict";f();p();Object.defineProperty(be,"__esModule",{value:!0});be.DEFAULT_ERROR=be.STANDARD_ERROR_MAP=be.SERVER_ERROR_CODE_RANGE=be.RESERVED_ERROR_CODES=be.SERVER_ERROR=be.INTERNAL_ERROR=be.INVALID_PARAMS=be.METHOD_NOT_FOUND=be.INVALID_REQUEST=be.PARSE_ERROR=be.OKX_CONNECT_ERROR_CODES=be.OKXConnectError=void 0;var or=class extends Error{constructor(e,t){t==null&&(t=Um(e)),super(t),this.code=e,this.message=`${or.prefix} ${t?`
`+t:""}`,Object.setPrototypeOf(this,or.prototype)}toJSON(){return{message:this.message,code:this.code}}};be.OKXConnectError=or;or.prefix="[OKX_CONNECT_SDK_ERROR]";function Um(n){return n==kt.UNKNOWN_ERROR?"unknown error":n==kt.BAD_REQUEST_ERROR?"bad request error":n==kt.ALREADY_CONNECTED_ERROR?"already connected error":n==kt.NOT_CONNECTED_ERROR?"not connected error":n==kt.UNKNOWN_APP_ERROR?"unknown app error":n==kt.USER_REJECTS_ERROR?"user rejects error":n==kt.USER_REJECTS_ERROR_CAUSE_REGISTER?"wallet address are registering":n==kt.METHOD_NOT_SUPPORTED?"method not supported":n==kt.CONNECTION_ERROR?"connect error":n==kt.CHAIN_NOT_SUPPORTED?"chain not supported":"unknown error"}var kt;(function(n){n[n.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",n[n.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",n[n.ALREADY_CONNECTED_ERROR=11]="ALREADY_CONNECTED_ERROR",n[n.NOT_CONNECTED_ERROR=12]="NOT_CONNECTED_ERROR",n[n.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",n[n.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",n[n.USER_REJECTS_ERROR_CAUSE_REGISTER=301]="USER_REJECTS_ERROR_CAUSE_REGISTER",n[n.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED",n[n.CHAIN_NOT_SUPPORTED=500]="CHAIN_NOT_SUPPORTED",n[n.WALLET_NOT_SUPPORTED=600]="WALLET_NOT_SUPPORTED",n[n.CONNECTION_ERROR=700]="CONNECTION_ERROR"})(kt||(be.OKX_CONNECT_ERROR_CODES=kt={}));be.PARSE_ERROR="PARSE_ERROR";be.INVALID_REQUEST="INVALID_REQUEST";be.METHOD_NOT_FOUND="METHOD_NOT_FOUND";be.INVALID_PARAMS="INVALID_PARAMS";be.INTERNAL_ERROR="INTERNAL_ERROR";be.SERVER_ERROR="SERVER_ERROR";be.RESERVED_ERROR_CODES=[-32700,-32600,-32601,-32602,-32603];be.SERVER_ERROR_CODE_RANGE=[-32e3,-32099];be.STANDARD_ERROR_MAP={[be.PARSE_ERROR]:{code:-32700,message:"Parse error"},[be.INVALID_REQUEST]:{code:-32600,message:"Invalid Request"},[be.METHOD_NOT_FOUND]:{code:-32601,message:"Method not found"},[be.INVALID_PARAMS]:{code:-32602,message:"Invalid params"},[be.INTERNAL_ERROR]:{code:-32603,message:"Internal error"},[be.SERVER_ERROR]:{code:-32e3,message:"Server error"}};be.DEFAULT_ERROR=be.SERVER_ERROR});var Af=$(Xr=>{"use strict";f();p();Object.defineProperty(Xr,"__esModule",{value:!0});Xr.OKX_CONNECT_ERROR_CODES=Xr.OKXConnectError=void 0;var Df=Na();Object.defineProperty(Xr,"OKXConnectError",{enumerable:!0,get:function(){return Df.OKXConnectError}});Object.defineProperty(Xr,"OKX_CONNECT_ERROR_CODES",{enumerable:!0,get:function(){return Df.OKX_CONNECT_ERROR_CODES}})});var Ra=$(xe=>{"use strict";f();p();Object.defineProperty(xe,"__esModule",{value:!0});xe.NameSpaceKeyStarknet=xe.NameSpaceKeyTron=xe.NameSpaceKeyCosmos=xe.NameSpaceKeyAptos=xe.NameSpaceKeyBtc=xe.NameSpaceKeySui=xe.NameSpaceKeyTON=xe.NameSpaceKeySOL=xe.NameSpaceKeyEip155=xe.OpenAppLinkType=void 0;var Pf;(function(n){n.UniversalLink="universallink",n.DeepLink="deeplink"})(Pf||(xe.OpenAppLinkType=Pf={}));xe.NameSpaceKeyEip155="eip155";xe.NameSpaceKeySOL="solana";xe.NameSpaceKeyTON="ton";xe.NameSpaceKeySui="sui";xe.NameSpaceKeyBtc="btc";xe.NameSpaceKeyAptos="aptos";xe.NameSpaceKeyCosmos="cosmos";xe.NameSpaceKeyTron="tron";xe.NameSpaceKeyStarknet="starknet"});var Gi=$(Re=>{"use strict";f();p();Object.defineProperty(Re,"__esModule",{value:!0});Re.OKX_MINI_WALLET_NAME=Re.OKX_APP_WALLET_NAME=Re.stackDeepLink=Re.tgwalletAppName=Re.tgwalletName=Re.tonConnectSdkVersion=Re.standardDeeplink=Re.downloadUrl=Re.shortUniversalLink=Re.standardUniversalLink=Re.okxDeeplink=void 0;Re.getTestTwaUrl=Xm;Re.getTestTgTwaUrl=Hm;Re.getBotNameAndAppName=qm;Re.okxDeeplink="okx://web3";Re.standardUniversalLink=typeof window<"u"&&window.location.hostname.includes("okx.com")?"https://link.okx.com/download":"https://www.okx.com/download";Re.shortUniversalLink=typeof window<"u"&&window.location.hostname.includes("okx.com")?"https://link.okx.com/ul/connect":"https://www.okx.com/ul/connect";Re.downloadUrl="https://www.okx.com/download";Re.standardDeeplink=`${Re.okxDeeplink}/wallet/connect`;Re.tonConnectSdkVersion="1";Re.tgwalletName="OKX_WALLET_BOT";Re.tgwalletAppName="start";Re.stackDeepLink="okx://web3?stack=true";function Xm(){return window.okxTesttwaUrl}function Hm(){return window.okxTestTgtwaUrl}function qm(n){let t=new URL(n).pathname.split("/").filter(Boolean);if(t.length>=2){let r=t[0],o=t[1];return{botName:r,appName:o}}}Re.OKX_APP_WALLET_NAME="OKX Wallet";Re.OKX_MINI_WALLET_NAME="OKX Mini Wallet"});var Bf=$(Xe=>{"use strict";f();p();var Jm=Xe&&Xe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Xe,"__esModule",{value:!0});Xe.isJsonRpcPayload=Da;Xe.isJsonRpcRequest=Fm;Xe.isJsonRpcResponse=$m;Xe.isJsonRpcResult=kf;Xe.isJsonRpcError=Lf;Xe.payloadId=xf;Xe.getBigIntRpcId=zm;Xe.formatJsonRpcRequest=Qm;Xe.formatJsonRpcResult=Zm;Xe.formatJsonRpcError=e_;Xe.isReservedErrorCode=Kf;Xe.getError=Ia;Xe.getErrorByCode=Mf;Xe.formatErrorMessage=Wf;Xe.isHttpUrl=n_;Xe.isWsUrl=r_;Xe.parseConnectionError=o_;function Da(n){return typeof n=="object"&&"id"in n&&"jsonrpc"in n&&n.jsonrpc==="2.0"}function Fm(n){return Da(n)&&"method"in n}function $m(n){return Da(n)&&(kf(n)||Lf(n))}function kf(n){return"result"in n}function Lf(n){return"error"in n}var cn=Na(),Vm=Jm(kr()),Yi=class{constructor(e){this.i=1;let t=e===8?new Uint8Array(1):e===16?new Uint16Array(1):new Uint32Array(1);e?this.initialValue=Vm.default.randomBytes(e/8)[0]:this.initialValue=0}getNextValue(){return this.initialValue+this.i++}},Gm=new Yi(8),Ym=new Yi(16);function xf(){let n=Date.now()*1e3,e=Gm.getNextValue();return n+e}function zm(){let n=BigInt(Date.now())*BigInt(1e6),e=BigInt(Ym.getNextValue());return n+e}function Qm(n,e,t){return{id:t||xf(),jsonrpc:"2.0",method:n,params:e}}function Zm(n,e){return{id:n,jsonrpc:"2.0",result:e}}function e_(n,e,t){return{id:n,jsonrpc:"2.0",error:Wf(e,t)}}function Kf(n){return cn.RESERVED_ERROR_CODES.includes(n)}function Ia(n){return Object.keys(cn.STANDARD_ERROR_MAP).includes(n)?cn.STANDARD_ERROR_MAP[n]:cn.STANDARD_ERROR_MAP[cn.DEFAULT_ERROR]}function Mf(n){let e=Object.values(cn.STANDARD_ERROR_MAP).find(t=>t.code===n);return e||cn.STANDARD_ERROR_MAP[cn.DEFAULT_ERROR]}function Wf(n,e){return typeof n>"u"?Ia(cn.INTERNAL_ERROR):(typeof n=="string"&&(n=Object.assign(Object.assign({},Ia(cn.SERVER_ERROR)),{message:n})),typeof e<"u"&&(n.data=e),Kf(n.code)&&(n=Mf(n.code)),n)}function t_(n){let e=n.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function jf(n,e){let t=t_(n);return typeof t>"u"?!1:new RegExp(e).test(t)}function n_(n){return jf(n,"^https?:")}function r_(n){return jf(n,"^wss?:")}function o_(n,e,t){return n.message.includes("getaddrinfo ENOTFOUND")||n.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):n}});var Xf=$(Lt=>{"use strict";f();p();var i_=Lt&&Lt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.IEngine=Lt.ISignClient=Lt.ISignClientEvents=Lt.IEngineEvents=void 0;var Uf=i_(ki()),Aa=class extends Uf.default{constructor(){super()}};Lt.IEngineEvents=Aa;var Pa=class extends Uf.default{constructor(){super()}};Lt.ISignClientEvents=Pa;var ka=class{constructor(e){this.data=e}};Lt.ISignClient=ka;var La=class{constructor(e){this.client=e}};Lt.IEngine=La});var qf=$(zi=>{"use strict";f();p();Object.defineProperty(zi,"__esModule",{value:!0});zi.TONCHAIN=void 0;var Hf;(function(n){n.MAINNET="-239"})(Hf||(zi.TONCHAIN=Hf={}))});var Ff=$(Qi=>{"use strict";f();p();Object.defineProperty(Qi,"__esModule",{value:!0});Qi.CONNECT_ITEM_ERROR_CODES=void 0;var Jf;(function(n){n[n.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",n[n.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(Jf||(Qi.CONNECT_ITEM_ERROR_CODES=Jf={}))});var $f=$(Hr=>{"use strict";f();p();Object.defineProperty(Hr,"__esModule",{value:!0});Hr.CONNECT_ITEM_ERROR_CODES=Hr.TONCHAIN=void 0;var s_=qf();Object.defineProperty(Hr,"TONCHAIN",{enumerable:!0,get:function(){return s_.TONCHAIN}});var a_=Ff();Object.defineProperty(Hr,"CONNECT_ITEM_ERROR_CODES",{enumerable:!0,get:function(){return a_.CONNECT_ITEM_ERROR_CODES}})});var jo=$(mt=>{"use strict";f();p();Object.defineProperty(mt,"__esModule",{value:!0});mt.OKXInjectWalletName=mt.OKXMiniWalletName=mt.OKXWalletName=void 0;mt.creatOKXWalletInfo=c_;mt.creatOKXMiniAppWalletInfo=l_;mt.creatOKXInjectWalletInfo=u_;mt.OKXWalletName="OKX Wallet";mt.OKXMiniWalletName="OKX Mini Wallet";mt.OKXInjectWalletName="OKX Inject Wallet";function c_(){return{appName:"okxAppWallet",name:mt.OKXWalletName,imageUrl:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png"}}function l_(){return{appName:"okxMiniApp",name:mt.OKXMiniWalletName,imageUrl:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png"}}function u_(){return{appName:"okxInjectWallet",name:mt.OKXInjectWalletName,imageUrl:""}}});var Vf=$(fe=>{"use strict";f();p();var d_=fe&&fe.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),f_=fe&&fe.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&d_(e,n,t)};Object.defineProperty(fe,"__esModule",{value:!0});fe.OKXWalletName=fe.creatOKXInjectWalletInfo=fe.creatOKXMiniAppWalletInfo=fe.creatOKXWalletInfo=fe.ISignClientEvents=fe.IEngine=fe.IEngineEvents=fe.ISignClient=fe.getBigIntRpcId=fe.formatJsonRpcRequest=fe.isJsonRpcError=fe.isJsonRpcResponse=fe.parseConnectionError=fe.isHttpUrl=fe.formatJsonRpcError=void 0;var ir=Bf();Object.defineProperty(fe,"formatJsonRpcError",{enumerable:!0,get:function(){return ir.formatJsonRpcError}});Object.defineProperty(fe,"isHttpUrl",{enumerable:!0,get:function(){return ir.isHttpUrl}});Object.defineProperty(fe,"parseConnectionError",{enumerable:!0,get:function(){return ir.parseConnectionError}});Object.defineProperty(fe,"isJsonRpcResponse",{enumerable:!0,get:function(){return ir.isJsonRpcResponse}});Object.defineProperty(fe,"isJsonRpcError",{enumerable:!0,get:function(){return ir.isJsonRpcError}});Object.defineProperty(fe,"formatJsonRpcRequest",{enumerable:!0,get:function(){return ir.formatJsonRpcRequest}});Object.defineProperty(fe,"getBigIntRpcId",{enumerable:!0,get:function(){return ir.getBigIntRpcId}});var Zi=Xf();Object.defineProperty(fe,"ISignClient",{enumerable:!0,get:function(){return Zi.ISignClient}});Object.defineProperty(fe,"IEngineEvents",{enumerable:!0,get:function(){return Zi.IEngineEvents}});Object.defineProperty(fe,"IEngine",{enumerable:!0,get:function(){return Zi.IEngine}});Object.defineProperty(fe,"ISignClientEvents",{enumerable:!0,get:function(){return Zi.ISignClientEvents}});f_($f(),fe);var es=jo();Object.defineProperty(fe,"creatOKXWalletInfo",{enumerable:!0,get:function(){return es.creatOKXWalletInfo}});Object.defineProperty(fe,"creatOKXMiniAppWalletInfo",{enumerable:!0,get:function(){return es.creatOKXMiniAppWalletInfo}});Object.defineProperty(fe,"creatOKXInjectWalletInfo",{enumerable:!0,get:function(){return es.creatOKXInjectWalletInfo}});Object.defineProperty(fe,"OKXWalletName",{enumerable:!0,get:function(){return es.OKXWalletName}})});var Gf=$(Ke=>{"use strict";f();p();Object.defineProperty(Ke,"__esModule",{value:!0});Ke.NAMES_CHAINS=Ke.TON_CHAINS=Ke.COSMOS_CHAINS=Ke.APTOS_CHAINS=Ke.SUI_CHAINS=Ke.SOLANA_CHAINS=Ke.BTC_CHAINS=void 0;var qr=Ra();Ke.BTC_CHAINS={MAINNET:"btc:mainnet",FRACTAL:"fractal:mainnet"};Ke.SOLANA_CHAINS={MAINNET:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",TESTNET:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",SONIC_TESTNET:"sonic:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"};Ke.SUI_CHAINS={MAINNET:"sui:mainnet"};Ke.APTOS_CHAINS={MAINNET:"aptos:mainnet",MOVEMENT_MAINNET:"movement:mainnet",MOVEMENT_TESTNET:"movement:testnet"};Ke.COSMOS_CHAINS={COSMOS_MAINNET:"cosmos:cosmoshub-4"};Ke.TON_CHAINS={MAINNET:"ton:-239"};Ke.NAMES_CHAINS={[qr.NameSpaceKeyBtc]:Object.values(Ke.BTC_CHAINS),[qr.NameSpaceKeySOL]:Object.values(Ke.SOLANA_CHAINS),[qr.NameSpaceKeyTON]:Object.values(Ke.TON_CHAINS),[qr.NameSpaceKeySui]:Object.values(Ke.SUI_CHAINS),[qr.NameSpaceKeyAptos]:Object.values(Ke.APTOS_CHAINS),[qr.NameSpaceKeyCosmos]:Object.values(Ke.COSMOS_CHAINS)}});var et=$(Y=>{"use strict";f();p();var p_=Y&&Y.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Yf=Y&&Y.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&p_(e,n,t)};Object.defineProperty(Y,"__esModule",{value:!0});Y.NAMES_CHAINS=Y.TON_CHAINS=Y.COSMOS_CHAINS=Y.APTOS_CHAINS=Y.SUI_CHAINS=Y.SOLANA_CHAINS=Y.BTC_CHAINS=Y.shortUniversalLink=Y.downloadUrl=Y.okxDeeplink=Y.tonConnectSdkVersion=Y.standardDeeplink=Y.standardUniversalLink=Y.OpenAppLinkType=Y.NameSpaceKeyStarknet=Y.NameSpaceKeyTron=Y.NameSpaceKeyCosmos=Y.NameSpaceKeyAptos=Y.NameSpaceKeyBtc=Y.NameSpaceKeySui=Y.NameSpaceKeyTON=Y.NameSpaceKeySOL=Y.NameSpaceKeyEip155=void 0;Yf(Af(),Y);var ln=Ra();Object.defineProperty(Y,"NameSpaceKeyEip155",{enumerable:!0,get:function(){return ln.NameSpaceKeyEip155}});Object.defineProperty(Y,"NameSpaceKeySOL",{enumerable:!0,get:function(){return ln.NameSpaceKeySOL}});Object.defineProperty(Y,"NameSpaceKeyTON",{enumerable:!0,get:function(){return ln.NameSpaceKeyTON}});Object.defineProperty(Y,"NameSpaceKeySui",{enumerable:!0,get:function(){return ln.NameSpaceKeySui}});Object.defineProperty(Y,"NameSpaceKeyBtc",{enumerable:!0,get:function(){return ln.NameSpaceKeyBtc}});Object.defineProperty(Y,"NameSpaceKeyAptos",{enumerable:!0,get:function(){return ln.NameSpaceKeyAptos}});Object.defineProperty(Y,"NameSpaceKeyCosmos",{enumerable:!0,get:function(){return ln.NameSpaceKeyCosmos}});Object.defineProperty(Y,"NameSpaceKeyTron",{enumerable:!0,get:function(){return ln.NameSpaceKeyTron}});Object.defineProperty(Y,"NameSpaceKeyStarknet",{enumerable:!0,get:function(){return ln.NameSpaceKeyStarknet}});Object.defineProperty(Y,"OpenAppLinkType",{enumerable:!0,get:function(){return ln.OpenAppLinkType}});var Jr=Gi();Object.defineProperty(Y,"standardUniversalLink",{enumerable:!0,get:function(){return Jr.standardUniversalLink}});Object.defineProperty(Y,"standardDeeplink",{enumerable:!0,get:function(){return Jr.standardDeeplink}});Object.defineProperty(Y,"tonConnectSdkVersion",{enumerable:!0,get:function(){return Jr.tonConnectSdkVersion}});Object.defineProperty(Y,"okxDeeplink",{enumerable:!0,get:function(){return Jr.okxDeeplink}});Object.defineProperty(Y,"downloadUrl",{enumerable:!0,get:function(){return Jr.downloadUrl}});Object.defineProperty(Y,"shortUniversalLink",{enumerable:!0,get:function(){return Jr.shortUniversalLink}});Yf(Vf(),Y);var sr=Gf();Object.defineProperty(Y,"BTC_CHAINS",{enumerable:!0,get:function(){return sr.BTC_CHAINS}});Object.defineProperty(Y,"SOLANA_CHAINS",{enumerable:!0,get:function(){return sr.SOLANA_CHAINS}});Object.defineProperty(Y,"SUI_CHAINS",{enumerable:!0,get:function(){return sr.SUI_CHAINS}});Object.defineProperty(Y,"APTOS_CHAINS",{enumerable:!0,get:function(){return sr.APTOS_CHAINS}});Object.defineProperty(Y,"COSMOS_CHAINS",{enumerable:!0,get:function(){return sr.COSMOS_CHAINS}});Object.defineProperty(Y,"TON_CHAINS",{enumerable:!0,get:function(){return sr.TON_CHAINS}});Object.defineProperty(Y,"NAMES_CHAINS",{enumerable:!0,get:function(){return sr.NAMES_CHAINS}})});var zf=$((Bo,ts)=>{f();p();(function(n,e){"use strict";var t="1.0.39",r="",o="?",i="function",s="undefined",l="object",g="string",d="major",a="model",c="name",u="type",_="vendor",y="version",N="architecture",X="console",D="mobile",T="tablet",L="smarttv",H="wearable",F="embedded",S=500,W="Amazon",k="Apple",J="ASUS",ne="BlackBerry",O="Browser",R="Chrome",B="Edge",Q="Firefox",ce="Google",ie="Huawei",Ge="LG",Ye="Microsoft",Pe="Motorola",pt="Opera",yn="Samsung",ht="Sharp",bn="Sony",zn="Xiaomi",Qn="Zebra",bt="Facebook",Er="Chromium OS",si="Mac OS",ai=" Browser",Ys=function(le,he){var te={};for(var Se in le)he[Se]&&he[Se].length%2===0?te[Se]=he[Se].concat(le[Se]):te[Se]=le[Se];return te},wr=function(le){for(var he={},te=0;te<le.length;te++)he[le[te].toUpperCase()]=le[te];return he},ci=function(le,he){return typeof le===g?Nn(he).indexOf(Nn(le))!==-1:!1},Nn=function(le){return le.toLowerCase()},zs=function(le){return typeof le===g?le.replace(/[^\d\.]/g,r).split(".")[0]:e},wo=function(le,he){if(typeof le===g)return le=le.replace(/^\s\s*/,r),typeof he===s?le:le.substring(0,S)},gt=function(le,he){for(var te=0,Se,Rt,vt,_e,Z,Ct;te<he.length&&!Z;){var Nr=he[te],To=he[te+1];for(Se=Rt=0;Se<Nr.length&&!Z&&Nr[Se];)if(Z=Nr[Se++].exec(le),Z)for(vt=0;vt<To.length;vt++)Ct=Z[++Rt],_e=To[vt],typeof _e===l&&_e.length>0?_e.length===2?typeof _e[1]==i?this[_e[0]]=_e[1].call(this,Ct):this[_e[0]]=_e[1]:_e.length===3?typeof _e[1]===i&&!(_e[1].exec&&_e[1].test)?this[_e[0]]=Ct?_e[1].call(this,Ct,_e[2]):e:this[_e[0]]=Ct?Ct.replace(_e[1],_e[2]):e:_e.length===4&&(this[_e[0]]=Ct?_e[3].call(this,Ct.replace(_e[1],_e[2])):e):this[_e]=Ct||e;te+=2}},Tr=function(le,he){for(var te in he)if(typeof he[te]===l&&he[te].length>0){for(var Se=0;Se<he[te].length;Se++)if(ci(he[te][Se],le))return te===o?e:te}else if(ci(he[te],le))return te===o?e:te;return he.hasOwnProperty("*")?he["*"]:le},li={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Zn={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Sr={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,y],[/opios[\/ ]+([\w\.]+)/i],[y,[c,pt+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[c,pt+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[c,pt]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[c,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[c,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[c,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[c,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[c,"UC"+O]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[c,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[c,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[c,"Smart Lenovo "+O]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+O],y],[/\bfocus\/([\w\.]+)/i],[y,[c,Q+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[c,pt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[c,pt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[c,"MIUI "+O]],[/fxios\/([-\w\.]+)/i],[y,[c,Q]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360"+ai]],[/\b(qq)\/([\w\.]+)/i],[[c,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1"+ai],y],[/samsungbrowser\/([\w\.]+)/i],[y,[c,yn+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],y],[/metasr[\/ ]?([\d\.]+)/i],[y,[c,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[c,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[c,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,bt],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[c,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[c,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[c,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[c,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,R+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[c,"Android "+O]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[y,Tr,li]],[/(webkit|khtml)\/([\w\.]+)/i],[c,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],y],[/(wolvic)\/([\w\.]+)/i],[c,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[c,Q+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[c,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[c,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[N,"amd64"]],[/(ia32(?=;))/i],[[N,Nn]],[/((?:i[346]|x)86)[;\)]/i],[[N,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[N,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[N,"armhf"]],[/windows (ce|mobile); ppc;/i],[[N,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[N,/ower/,r,Nn]],[/(sun4\w)[;\)]/i],[[N,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[N,Nn]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a,[_,yn],[u,T]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[a,[_,yn],[u,D]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[a,[_,k],[u,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a,[_,k],[u,T]],[/(macintosh);/i],[a,[_,k]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a,[_,ht],[u,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a,[_,ie],[u,T]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a,[_,ie],[u,D]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[a,/_/g," "],[_,zn],[u,D]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a,/_/g," "],[_,zn],[u,T]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a,[_,"OPPO"],[u,D]],[/\b(opd2\d{3}a?) bui/i],[a,[_,"OPPO"],[u,T]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a,[_,"Vivo"],[u,D]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[a,[_,"Realme"],[u,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a,[_,Pe],[u,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a,[_,Pe],[u,T]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a,[_,Ge],[u,T]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a,[_,Ge],[u,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a,[_,"Lenovo"],[u,T]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a,/_/g," "],[_,"Nokia"],[u,D]],[/(pixel c)\b/i],[a,[_,ce],[u,T]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a,[_,ce],[u,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a,[_,bn],[u,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a,"Xperia Tablet"],[_,bn],[u,T]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a,[_,"OnePlus"],[u,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a,[_,W],[u,T]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a,/(.+)/g,"Fire Phone $1"],[_,W],[u,D]],[/(playbook);[-\w\),; ]+(rim)/i],[a,_,[u,T]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a,[_,ne],[u,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a,[_,J],[u,T]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a,[_,J],[u,D]],[/(nexus 9)/i],[a,[_,"HTC"],[u,T]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[a,/_/g," "],[u,D]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[a,[_,"TCL"],[u,T]],[/(itel) ((\w+))/i],[[_,Nn],a,[u,Tr,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a,[_,"Acer"],[u,T]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a,[_,"Meizu"],[u,D]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[a,[_,"Ulefone"],[u,D]],[/droid.+; (a(?:015|06[35]|142p?))/i],[a,[_,"Nothing"],[u,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,a,[u,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,a,[u,T]],[/(surface duo)/i],[a,[_,Ye],[u,T]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a,[_,"Fairphone"],[u,D]],[/(u304aa)/i],[a,[_,"AT&T"],[u,D]],[/\bsie-(\w*)/i],[a,[_,"Siemens"],[u,D]],[/\b(rct\w+) b/i],[a,[_,"RCA"],[u,T]],[/\b(venue[\d ]{2,7}) b/i],[a,[_,"Dell"],[u,T]],[/\b(q(?:mv|ta)\w+) b/i],[a,[_,"Verizon"],[u,T]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a,[_,"Barnes & Noble"],[u,T]],[/\b(tm\d{3}\w+) b/i],[a,[_,"NuVision"],[u,T]],[/\b(k88) b/i],[a,[_,"ZTE"],[u,T]],[/\b(nx\d{3}j) b/i],[a,[_,"ZTE"],[u,D]],[/\b(gen\d{3}) b.+49h/i],[a,[_,"Swiss"],[u,D]],[/\b(zur\d{3}) b/i],[a,[_,"Swiss"],[u,T]],[/\b((zeki)?tb.*\b) b/i],[a,[_,"Zeki"],[u,T]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],a,[u,T]],[/\b(ns-?\w{0,9}) b/i],[a,[_,"Insignia"],[u,T]],[/\b((nxa|next)-?\w{0,9}) b/i],[a,[_,"NextBook"],[u,T]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],a,[u,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],a,[u,D]],[/\b(ph-1) /i],[a,[_,"Essential"],[u,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a,[_,"Envizen"],[u,T]],[/\b(trio[-\w\. ]+) b/i],[a,[_,"MachSpeed"],[u,T]],[/\btu_(1491) b/i],[a,[_,"Rotor"],[u,T]],[/(shield[\w ]+) b/i],[a,[_,"Nvidia"],[u,T]],[/(sprint) (\w+)/i],[_,a,[u,D]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[_,Ye],[u,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a,[_,Qn],[u,T]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a,[_,Qn],[u,D]],[/smart-tv.+(samsung)/i],[_,[u,L]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[_,yn],[u,L]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,Ge],[u,L]],[/(apple) ?tv/i],[_,[a,k+" TV"],[u,L]],[/crkey/i],[[a,R+"cast"],[_,ce],[u,L]],[/droid.+aft(\w+)( bui|\))/i],[a,[_,W],[u,L]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a,[_,ht],[u,L]],[/(bravia[\w ]+)( bui|\))/i],[a,[_,bn],[u,L]],[/(mitv-\w{5}) bui/i],[a,[_,zn],[u,L]],[/Hbbtv.*(technisat) (.*);/i],[_,a,[u,L]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,wo],[a,wo],[u,L]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,L]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,a,[u,X]],[/droid.+; (shield) bui/i],[a,[_,"Nvidia"],[u,X]],[/(playstation [345portablevi]+)/i],[a,[_,bn],[u,X]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a,[_,Ye],[u,X]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[a,[_,yn],[u,H]],[/((pebble))app/i],[_,a,[u,H]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a,[_,k],[u,H]],[/droid.+; (glass) \d/i],[a,[_,ce],[u,H]],[/droid.+; (wt63?0{2,3})\)/i],[a,[_,Qn],[u,H]],[/(quest( \d| pro)?)/i],[a,[_,bt],[u,H]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[u,F]],[/(aeobc)\b/i],[a,[_,W],[u,F]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[a,[u,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a,[u,T]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,T]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,D]],[/(android[-\w\. ]{0,9});.+buil/i],[a,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[c,B+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[c,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[c,[y,Tr,Zn]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,Tr,Zn],[c,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,si],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,y],[/\(bb(10);/i],[y,[c,ne]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[c,Q+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[c,R+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,Er],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,y],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[c,y]]},rt=function(le,he){if(typeof le===l&&(he=le,le=e),!(this instanceof rt))return new rt(le,he).getResult();var te=typeof n!==s&&n.navigator?n.navigator:e,Se=le||(te&&te.userAgent?te.userAgent:r),Rt=te&&te.userAgentData?te.userAgentData:e,vt=he?Ys(Sr,he):Sr,_e=te&&te.userAgent==Se;return this.getBrowser=function(){var Z={};return Z[c]=e,Z[y]=e,gt.call(Z,Se,vt.browser),Z[d]=zs(Z[y]),_e&&te&&te.brave&&typeof te.brave.isBrave==i&&(Z[c]="Brave"),Z},this.getCPU=function(){var Z={};return Z[N]=e,gt.call(Z,Se,vt.cpu),Z},this.getDevice=function(){var Z={};return Z[_]=e,Z[a]=e,Z[u]=e,gt.call(Z,Se,vt.device),_e&&!Z[u]&&Rt&&Rt.mobile&&(Z[u]=D),_e&&Z[a]=="Macintosh"&&te&&typeof te.standalone!==s&&te.maxTouchPoints&&te.maxTouchPoints>2&&(Z[a]="iPad",Z[u]=T),Z},this.getEngine=function(){var Z={};return Z[c]=e,Z[y]=e,gt.call(Z,Se,vt.engine),Z},this.getOS=function(){var Z={};return Z[c]=e,Z[y]=e,gt.call(Z,Se,vt.os),_e&&!Z[c]&&Rt&&Rt.platform&&Rt.platform!="Unknown"&&(Z[c]=Rt.platform.replace(/chrome os/i,Er).replace(/macos/i,si)),Z},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Se},this.setUA=function(Z){return Se=typeof Z===g&&Z.length>S?wo(Z,S):Z,this},this.setUA(Se),this};rt.VERSION=t,rt.BROWSER=wr([c,y,d]),rt.CPU=wr([N]),rt.DEVICE=wr([a,_,u,X,D,L,T,H,F]),rt.ENGINE=rt.OS=wr([c,y]),typeof Bo!==s?(typeof ts!==s&&ts.exports&&(Bo=ts.exports=rt),Bo.UAParser=rt):typeof define===i&&define.amd?define(function(){return rt}):typeof n!==s&&(n.UAParser=rt);var rn=typeof n!==s&&(n.jQuery||n.Zepto);if(rn&&!rn.ua){var er=new rt;rn.ua=er.getResult(),rn.ua.get=function(){return er.getUA()},rn.ua.set=function(le){er.setUA(le);var he=er.getResult();for(var te in he)rn.ua[te]=he[te]}}})(typeof window=="object"?window:Bo)});var rs=$(Vt=>{"use strict";f();p();var h_=Vt&&Vt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Vt,"__esModule",{value:!0});Vt.openLink=ns;Vt.openLinkBlank=y_;Vt.openDeeplinkWithFallback=b_;Vt.isMobileUserAgent=v_;Vt.getUserAgent=Ma;Vt.isOS=xa;Vt.isBrowser=Ka;var g_=h_(zf()),m_=He(),__=Uo();function ns(n,e="_self"){(0,m_.logDebug)("openLink",n,e),window.open(n,e,"noopener noreferrer")}function y_(n){ns(n,"_blank")}function b_(n,e){let t=()=>{Ka("safari")||xa("android")&&Ka("firefox")||e()},r=setTimeout(()=>t(),500);window.addEventListener("blur",()=>clearTimeout(r),{once:!0}),xa("android")&&(0,__.inTg)()?ns(n,"_blank"):ns(n,"_self")}function v_(){let n=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.slice(0,4)))&&(n=!0)}(navigator.userAgent||navigator.vendor||window.opera),n}function Ma(){var n,e,t;let r=new g_.default().getResult(),o=(n=r.os.name)===null||n===void 0?void 0:n.toLowerCase(),i=(e=r.device.model)===null||e===void 0?void 0:e.toLowerCase(),s;switch(!0){case i==="ipad":s="ipad";break;case o==="ios":s="ios";break;case o==="android":s="android";break;case o==="mac os":s="macos";break;case o==="linux":s="linux";break;case o?.includes("windows"):s="windows";break}let l=(t=r.browser.name)===null||t===void 0?void 0:t.toLowerCase(),g;switch(!0){case l==="chrome":g="chrome";break;case l==="firefox":g="firefox";break;case l?.includes("safari"):g="safari";break;case l?.includes("opera"):g="opera";break}return{os:s,browser:g}}function xa(...n){return n.includes(Ma().os)}function Ka(...n){return n.includes(Ma().browser)}});var Uo=$(On=>{"use strict";f();p();var Wa,ja,Ba,Ua,Xa,Ha,qa;Object.defineProperty(On,"__esModule",{value:!0});On.isTmaPlatform=O_;On.isInTMA=Ja;On.inTg=E_;On.isInTelegramBrowser=Qf;On.sendExpand=w_;On.sendOpenTelegramLink=T_;On.versionCompare=tp;var $r=Vr(),os=He(),xn=et(),C_=rs(),Cn={};try{let n=location.hash.toString();Cn=S_(n)}catch{}var Fr="unknown";Cn?.tgWebAppPlatform&&(Fr=(Wa=Cn.tgWebAppPlatform)!==null&&Wa!==void 0?Wa:"unknown");if(Fr==="unknown"){let n=(0,$r.getWindow)();Fr=(Ua=(Ba=(ja=n?.Telegram)===null||ja===void 0?void 0:ja.WebApp)===null||Ba===void 0?void 0:Ba.platform)!==null&&Ua!==void 0?Ua:"unknown"}var is="6.0";Cn?.tgWebAppVersion&&(is=Cn.tgWebAppVersion);if(!is){let n=(0,$r.getWindow)();is=(qa=(Ha=(Xa=n?.Telegram)===null||Xa===void 0?void 0:Xa.WebApp)===null||Ha===void 0?void 0:Ha.version)!==null&&qa!==void 0?qa:"6.0"}function O_(...n){return n.includes(Fr)}function Ja(){var n;return Fr!=="unknown"||!!(!((n=(0,$r.getWindow)())===null||n===void 0)&&n.TelegramWebviewProxy)}function E_(){return Qf()||Ja()}function Qf(){var n;let e=!!(!((n=(0,$r.getWindow)())===null||n===void 0)&&n.TelegramWebview);return(Ja()||e)&&Fr==="unknown"}function w_(){ep("web_app_expand",{})}function T_(n,e){let t=new URL(n);if(t.protocol!=="http:"&&t.protocol!=="https:"){if(e)return e();throw new xn.OKXConnectError(xn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Url protocol is not supported: ${t}`)}if(t.hostname!=="t.me"){if(e)return e();throw new xn.OKXConnectError(xn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Url host is not supported: ${t}`)}let r=t.pathname+t.search;Zf()||R_("6.1")?ep("web_app_open_tg_link",{path_full:r}):(0,C_.openLinkBlank)("https://t.me"+r)}function Zf(){try{let n=(0,$r.getWindow)();return n?n.parent!=null&&n!==n.parent:!1}catch{return!1}}function ep(n,e){try{let t=(0,$r.getWindow)();if(!t)throw new xn.OKXConnectError(xn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Can't post event to parent window: window is not defined");if(t.TelegramWebviewProxy!==void 0)(0,os.logDebug)("postEvent",n,e),t.TelegramWebviewProxy.postEvent(n,JSON.stringify(e));else if(t.external&&"notify"in t.external)(0,os.logDebug)("postEvent",n,e),t.external.notify(JSON.stringify({eventType:n,eventData:e}));else if(Zf()){let r="*",o=JSON.stringify({eventType:n,eventData:e});(0,os.logDebug)("postEvent",n,e),t.parent.postMessage(o,r)}else throw new xn.OKXConnectError(xn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Can't post event to TMA")}catch(t){(0,os.logError)(`Can't post event to parent window: ${t}`)}}function S_(n){n=n.replace(/^#/,"");let e={};if(!n.length)return e;if(n.indexOf("=")<0&&n.indexOf("?")<0)return e._path=ss(n),e;let t=n.indexOf("?");if(t>=0){let o=n.substr(0,t);e._path=ss(o),n=n.substr(t+1)}let r=N_(n);for(let o in r)e[o]=r[o];return e}function ss(n){try{return n=n.replace(/\+/g,"%20"),decodeURIComponent(n)}catch{return n}}function N_(n){let e={};if(!n.length)return e;let t=n.split("&"),r,o,i,s;for(r=0;r<t.length;r++)o=t[r].split("="),i=ss(o[0]),s=o[1]==null?null:ss(o[1]),e[i]=s;return e}function tp(n,e){typeof n!="string"&&(n=""),typeof e!="string"&&(e="");let t=n.replace(/^\s+|\s+$/g,"").split("."),r=e.replace(/^\s+|\s+$/g,"").split("."),o,i,s,l;for(o=Math.max(t.length,r.length),i=0;i<o;i++)if(s=parseInt(t[i])||0,l=parseInt(r[i])||0,s!==l)return s>l?1:-1;return 0}function R_(n){return tp(is,n)>=0}});var Vr=$(ze=>{"use strict";f();p();var Fa,$a,Va,Ga;Object.defineProperty(ze,"__esModule",{value:!0});ze.removeUrlLastSlash=np;ze.addPathToUrl=A_;ze.getUniversalLink=rp;ze.openOKXDeeplink=P_;ze.openOKXDeeplinkWithFallback=op;ze.getWindow=lr;ze.isTelegramUrl=k_;ze.encodeTelegramUrlParameters=L_;ze.encodeConnectParams=ip;ze.encodeTWAConnectURLParams=sp;ze.getAppWalletDeepLink=x_;ze.getAppWalletShortDeepLink=ap;ze.getTelegramWalletTWAUrl=Ya;ze.openOKXTMAWalletlinkWithFallback=K_;ze.isInTMA=ar;ze.isInTelegramBrowser=j_;ze.getOKXLink=B_;var En=et(),cr=He(),Ie=Gi(),un=xt(),I_=Uo(),D_=jr();function np(n){return n.slice(-1)==="/"?n.slice(0,-1):n}function A_(n,e){return np(n)+"/"+e}function rp(n,e=!1){console.log("getUniversalLink deeplinkUrl:",n,", useStandardUniversalLink:",e);let t=encodeURIComponent(n);return console.log("getUniversalLink standardUniversalLink:",En.standardUniversalLink),console.log("getUniversalLink standardUniversalLink:",`${En.standardUniversalLink}?deeplink=${t}`),`${En.standardUniversalLink}?deeplink=${t}`}function P_(n,e,t){op(n,e,t,!1)}function op(n,e,t,r=!0){var o;let i=!!(!((o=lr())===null||o===void 0)&&o.TelegramWebviewProxy);console.log("openOKXDeeplinkWithFallback fullUrl:",e);let s=!1,l=3e3,g=En.standardUniversalLink;console.log("openOKXDeeplinkWithFallback standardUniversalLink:",En.standardUniversalLink);let d=null,a=()=>{console.log("fallbackToDownloadPage :empty")},c=!1;if(t===En.OpenAppLinkType.UniversalLink?c=(0,un.isInIOSChrome)()||(0,un.isInIOSLine)()||(0,un.isInIOSLark)()||(0,un.isInIOSWeChat)():c=i===!1&&(0,un.isIos)(),r&&((0,un.isIos)()?c&&(a=()=>{console.log("windowOpen --> fallbackToDownloadPage --",s),s||(console.log("windowOpen --> fallbackToDownloadPage universal link"),window.open(e,"_self"))}):a=()=>{s||(d?d.open(e,"_self"):window.open(e,"_blank"))}),!(0,un.isIos)()||c){if(i?d=window.open(n,"_blank"):(console.log("windowOpen --> deeplinkUrl"),window.location.href=n),r){setTimeout(a,l);let u=0,_=setInterval(()=>{u++,console.log("windowOpen --> interval:",u,document.hidden,document.visibilityState),document.hidden&&(s=!0),(u>10||document.hidden)&&(clearInterval(_),console.log("windowOpen :cleat: ${count}"))},200);window.addEventListener("blur",()=>{console.log("windowOpen :blur"),s=!0},{once:!0}),document.addEventListener("visibilitychange",()=>{console.log("windowOpen :visibilitychange:",document.visibilityState),document.visibilityState==="hidden"&&(s=!0)})}}else i?window.open(e,"_blank"):(console.log("windowOpen[before]: ",Date.now()),window?.okxLogDebug?window.open(e,"_blank"):window.open(e,"_self"),console.log("windowOpen[after]: ",Date.now()))}function lr(){if(typeof window<"u")return window}function k_(n){if(!n)return!1;let e=new URL(n);return e.protocol==="tg:"||e.hostname==="t.me"}function L_(n){let e=n;return e=e.replace(/\./g,"%2E"),e=e.replace(/-/g,"%2D"),e=e.replace(/_/g,"%5F"),e=e.replace(/&/g,"-"),e=e.replace(/=/g,"__"),e=e.replace(/%/g,"--"),e}function ip(n){let e=Object.assign(Object.assign({},n),{protocolVersion:D_.CONNECT_PROTOCOL_VER}),t=JSON.stringify(e);(0,cr.logDebug)("url encodeConnectParams connectRequestStr ",t);let r=new TextEncoder().encode(t),o=btoa(String.fromCharCode(...r));return(0,cr.logDebug)("url encodeConnectParams base64Encoded ",o),o}function sp(n){let e=JSON.stringify({topic:n.topic,clientId:n.clientId});(0,cr.logDebug)("url encodeConnectParams connectRequestStr",e);let t=new TextEncoder().encode(e);return btoa(String.fromCharCode(...t))}function x_(n){return`${En.standardDeeplink}?param=${n}`}function ap(n,e){return`${Ie.shortUniversalLink}?topic=${n}${(0,un.getLastSixMd5Hash)(e)}`}function Ya(n,e){let t={okxconnect:"",redirect:"",extraparams:"",fromtg:!1};n&&(t.okxconnect=n),e&&(t.redirect=e),ar()?t.fromtg=!0:t.fromtg=!1,(0,cr.logDebug)("getTelegramWalletTWAUrl redirect:",t.redirect);let r=JSON.stringify(t),o=new TextEncoder().encode(r),i=btoa(String.fromCharCode(...o)),s=(0,un.toSafeBase64FromBase64)(i);if((0,cr.logDebug)("[TWA] open link:",t,i),n||e){if(ar())return(0,Ie.getTestTgTwaUrl)()?`${(0,Ie.getTestTgTwaUrl)()}?startapp=${s}`:`https://t.me/${Ie.tgwalletName}/start?startapp=${s}`;if((0,Ie.getTestTwaUrl)())return`${(0,Ie.getTestTwaUrl)()}?tgWebAppStartParam=${s}`;if((0,Ie.getTestTgTwaUrl)()){let l=(0,Ie.getBotNameAndAppName)((0,Ie.getTestTgTwaUrl)());if(l){let{botName:g,appName:d}=l;return`tg://resolve?domain=${g}&appname=${d}&startapp=${s}`}return`tg://resolve?domain=${Ie.tgwalletName}&appname=${Ie.tgwalletAppName}&startapp=${s}`}else return`tg://resolve?domain=${Ie.tgwalletName}&appname=${Ie.tgwalletAppName}&startapp=${s}`}if(ar())return(0,Ie.getTestTgTwaUrl)()?`${(0,Ie.getTestTgTwaUrl)()}`:`https://t.me/${Ie.tgwalletName}/start`;if((0,Ie.getTestTwaUrl)())return`${(0,Ie.getTestTwaUrl)()}`;if((0,Ie.getTestTgTwaUrl)()){let l=(0,Ie.getBotNameAndAppName)((0,Ie.getTestTgTwaUrl)());if(l){let{botName:g,appName:d}=l;return`tg://resolve?domain=${g}&appname=${d}`}return`tg://resolve?domain=${Ie.tgwalletName}&appname=${Ie.tgwalletAppName}`}else return`tg://resolve?domain=${Ie.tgwalletName}&appname=${Ie.tgwalletAppName}`}function K_(n){var e,t,r,o,i;(0,cr.logDebug)("[TWA] open link:",n,"isInTMA ==> ",ar()),ar()?!((t=(e=lr())===null||e===void 0?void 0:e.Telegram)===null||t===void 0)&&t.WebApp?(i=(o=(r=lr())===null||r===void 0?void 0:r.Telegram)===null||o===void 0?void 0:o.WebApp)===null||i===void 0||i.openTelegramLink(n):(0,I_.sendOpenTelegramLink)(n):(0,Ie.getTestTwaUrl)()?window.open(n,"_blank"):window.open(n,"_self")}function as(n){try{return n=n.replace(/\+/g,"%20"),decodeURIComponent(n)}catch{return n}}function M_(n){let e={};if(!n.length)return e;let t=n.split("&"),r,o,i,s;for(r=0;r<t.length;r++)o=t[r].split("="),i=as(o[0]),s=o[1]==null?null:as(o[1]),e[i]=s;return e}function W_(n){n=n.replace(/^#/,"");let e={};if(!n.length)return e;if(n.indexOf("=")<0&&n.indexOf("?")<0)return e._path=as(n),e;let t=n.indexOf("?");if(t>=0){let o=n.substr(0,t);e._path=as(o),n=n.substr(t+1)}let r=M_(n);for(let o in r)e[o]=r[o];return e}var Xo={};try{let n=location.hash.toString();Xo=W_(n)}catch{}var Ho="unknown";Xo?.tgWebAppPlatform&&(Ho=(Fa=Xo.tgWebAppPlatform)!==null&&Fa!==void 0?Fa:"unknown");if(Ho==="unknown"){let n=lr();Ho=(Ga=(Va=($a=n?.Telegram)===null||$a===void 0?void 0:$a.WebApp)===null||Va===void 0?void 0:Va.platform)!==null&&Ga!==void 0?Ga:"unknown"}function ar(){var n;return Ho!=="unknown"||!!(!((n=lr())===null||n===void 0)&&n.TelegramWebviewProxy)}function j_(){var n;let e=!!(!((n=lr())===null||n===void 0)&&n.TelegramWebview);return(ar()||e)&&Ho==="unknown"}function B_(n,e=!1,t){if((0,cr.logDebug)(`url  getOKXLink() called connectRequest==> ${JSON.stringify(n)}  useMini=> ${e}  tmaReturnUrl==> ${t}`),e)return n?{universalLink:Ya(sp(n),t??"back")}:{universalLink:Ya(void 0,t??"back")};{let r=n?`${En.standardDeeplink}?param=${ip(n)}`:En.standardDeeplink;return(0,un.useShortLink)()?{universalLink:n?ap(n.topic,n.clientId):Ie.shortUniversalLink,deepLink:r}:{universalLink:rp(r),deepLink:r}}}});var up=$(Gr=>{"use strict";f();p();var cp=Gr&&Gr.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.callForSuccess=U_;Gr.delay=lp;function U_(n,e){return cp(this,void 0,void 0,function*(){var t,r;let o=(t=e?.attempts)!==null&&t!==void 0?t:3,i=(r=e?.delayMs)!==null&&r!==void 0?r:800;if(typeof n!="function")throw new Error(`Expected a function, got ${typeof n}`);let s=0,l;for(;s<o;)try{return yield n()}catch(g){l=g,s++,s<o&&(yield lp(i))}throw l})}function lp(n,e){return cp(this,void 0,void 0,function*(){return new Promise((t,r)=>{var o,i;if(!((o=e?.signal)===null||o===void 0)&&o.aborted){r(new Error("Delay aborted"));return}let s=setTimeout(()=>t(),n);(i=e?.signal)===null||i===void 0||i.addEventListener("abort",()=>{clearTimeout(s),r(new Error("Delay aborted"))})})})}});var dp=$(pe=>{"use strict";f();p();Object.defineProperty(pe,"__esModule",{value:!0});pe.Report_WalletType_Key=pe.Report_OKXConnectSDK_RequestError_Log=pe.Report_OKXConnectSDK_RequestSuccess_Log=pe.Report_OKXConnectSDK_RequestStart_Log=pe.Report_OKXConnectSDKExtension_ConnectDapp_Button_Click=pe.Report_OKXConnectSDKExtension_Module_Retry_Click=pe.Report_ConnectDapp_ConnectAndSign_Click=pe.Report_Proceed_QRCode_Click=pe.Report_ChooseType_Download_Click=pe.Report_ChooseType_ConnectWallet_Click=pe.Report_Proceed_Retry_Click=pe.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View=pe.Report_OKXConnectSDKExtension_ConnectDapp_Page_View=pe.Report_ChooseType_ConnectWallet_View=pe.Report_Loading_ConnectWallet_View=pe.Report_Proceed_QRCode_View=pe.Report_Proceed_Proceed_View=void 0;pe.Report_Proceed_Proceed_View="OKXConnectSDK_Proceed_Proceed_View";pe.Report_Proceed_QRCode_View="OKXConnectSDK_Proceed_QRCode_View";pe.Report_Loading_ConnectWallet_View="OKXConnectSDK_Loading_ConnectWallet_View";pe.Report_ChooseType_ConnectWallet_View="OKXConnectSDK_ChooseType_ConnectWallet_View";pe.Report_OKXConnectSDKExtension_ConnectDapp_Page_View="OKXConnectSDKExtension_ConnectDapp_Page_View";pe.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View="OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View";pe.Report_Proceed_Retry_Click="OKXConnectSDK_Proceed_Retry_Click";pe.Report_ChooseType_ConnectWallet_Click="OKXConnectSDK_ChooseType_ConnectWallet_Click";pe.Report_ChooseType_Download_Click="OKXConnectSDK_ChooseType_Download_Click";pe.Report_Proceed_QRCode_Click="OKXConnectSDK_Proceed_QRCode_Click";pe.Report_ConnectDapp_ConnectAndSign_Click="OKXConnectSDK_ConnectDapp_ConnectAndSign_Click";pe.Report_OKXConnectSDKExtension_Module_Retry_Click="OKXConnectSDKExtension_Module_Retry_Click";pe.Report_OKXConnectSDKExtension_ConnectDapp_Button_Click="OKXConnectSDKExtension_ConnectDapp_Button_Click";pe.Report_OKXConnectSDK_RequestStart_Log="Report_OKXConnectSDK_RequestStart_View";pe.Report_OKXConnectSDK_RequestSuccess_Log="Report_OKXConnectSDK_RequestSuccess_View";pe.Report_OKXConnectSDK_RequestError_Log="Report_OKXConnectSDK_RequestError_View";pe.Report_WalletType_Key="wallet_type"});var fp=$(za=>{"use strict";f();p();Object.defineProperty(za,"__esModule",{value:!0});za.checkMetaData=X_;var cs=et();function X_(n){if(!n)throw new cs.OKXConnectError(cs.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"You have to specify a `dappMetaData`in the options.");if(!n.name)throw new cs.OKXConnectError(cs.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"dappName is required");return!0}});var tt=$(P=>{"use strict";f();p();var H_=P&&P.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),pp=P&&P.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&H_(e,n,t)};Object.defineProperty(P,"__esModule",{value:!0});P.getNamespaceKeyByChain=P.chainName2IdMap=P.replaceChainIdToChainName=P.replaceChainNameToChainId=P.checkMetaData=P.versionCompare=P.isBrowser=P.isOS=P.isMobileUserAgent=P.openDeeplinkWithFallback=P.openLinkBlank=P.openLink=P.getChainId=P.useShortLink=P.toSafeBase64FromBase64=P.isValidObject=P.isIos=P.base64decode=P.base64encode=P.splitToUint8Arrays=P.concatUint8Arrays=P.toHexString=P.hexToByteArray=P.getOKXLink=P.getAppWalletShortDeepLink=P.encodeTWAConnectURLParams=P.encodeConnectParams=P.openOKXTMAWalletlinkWithFallback=P.getTelegramWalletTWAUrl=P.getAppWalletDeepLink=P.encodeTelegramUrlParameters=P.isTelegramUrl=P.openOKXDeeplinkWithFallback=P.openOKXDeeplink=P.getUniversalLink=P.safeJsonStringify=P.safeJsonParse=P.getDefaultReporter=P.reportEvent=P.reportLog=P.logWarning=P.logError=P.logDebug=P.callForSuccess=void 0;var q_=up();Object.defineProperty(P,"callForSuccess",{enumerable:!0,get:function(){return q_.callForSuccess}});var Yr=He();Object.defineProperty(P,"logDebug",{enumerable:!0,get:function(){return Yr.logDebug}});Object.defineProperty(P,"logError",{enumerable:!0,get:function(){return Yr.logError}});Object.defineProperty(P,"logWarning",{enumerable:!0,get:function(){return Yr.logWarning}});Object.defineProperty(P,"reportLog",{enumerable:!0,get:function(){return Yr.reportLog}});Object.defineProperty(P,"reportEvent",{enumerable:!0,get:function(){return Yr.reportEvent}});Object.defineProperty(P,"getDefaultReporter",{enumerable:!0,get:function(){return Yr.getDefaultReporter}});pp(dp(),P);pp(qo(),P);var hp=Kn();Object.defineProperty(P,"safeJsonParse",{enumerable:!0,get:function(){return hp.safeJsonParse}});Object.defineProperty(P,"safeJsonStringify",{enumerable:!0,get:function(){return hp.safeJsonStringify}});var Kt=Vr();Object.defineProperty(P,"getUniversalLink",{enumerable:!0,get:function(){return Kt.getUniversalLink}});Object.defineProperty(P,"openOKXDeeplink",{enumerable:!0,get:function(){return Kt.openOKXDeeplink}});Object.defineProperty(P,"openOKXDeeplinkWithFallback",{enumerable:!0,get:function(){return Kt.openOKXDeeplinkWithFallback}});Object.defineProperty(P,"isTelegramUrl",{enumerable:!0,get:function(){return Kt.isTelegramUrl}});Object.defineProperty(P,"encodeTelegramUrlParameters",{enumerable:!0,get:function(){return Kt.encodeTelegramUrlParameters}});Object.defineProperty(P,"getAppWalletDeepLink",{enumerable:!0,get:function(){return Kt.getAppWalletDeepLink}});Object.defineProperty(P,"getTelegramWalletTWAUrl",{enumerable:!0,get:function(){return Kt.getTelegramWalletTWAUrl}});Object.defineProperty(P,"openOKXTMAWalletlinkWithFallback",{enumerable:!0,get:function(){return Kt.openOKXTMAWalletlinkWithFallback}});Object.defineProperty(P,"encodeConnectParams",{enumerable:!0,get:function(){return Kt.encodeConnectParams}});Object.defineProperty(P,"encodeTWAConnectURLParams",{enumerable:!0,get:function(){return Kt.encodeTWAConnectURLParams}});Object.defineProperty(P,"getAppWalletShortDeepLink",{enumerable:!0,get:function(){return Kt.getAppWalletShortDeepLink}});Object.defineProperty(P,"getOKXLink",{enumerable:!0,get:function(){return Kt.getOKXLink}});var Gt=xt();Object.defineProperty(P,"hexToByteArray",{enumerable:!0,get:function(){return Gt.hexToByteArray}});Object.defineProperty(P,"toHexString",{enumerable:!0,get:function(){return Gt.toHexString}});Object.defineProperty(P,"concatUint8Arrays",{enumerable:!0,get:function(){return Gt.concatUint8Arrays}});Object.defineProperty(P,"splitToUint8Arrays",{enumerable:!0,get:function(){return Gt.splitToUint8Arrays}});Object.defineProperty(P,"base64encode",{enumerable:!0,get:function(){return Gt.base64encode}});Object.defineProperty(P,"base64decode",{enumerable:!0,get:function(){return Gt.base64decode}});Object.defineProperty(P,"isIos",{enumerable:!0,get:function(){return Gt.isIos}});Object.defineProperty(P,"isValidObject",{enumerable:!0,get:function(){return Gt.isValidObject}});Object.defineProperty(P,"toSafeBase64FromBase64",{enumerable:!0,get:function(){return Gt.toSafeBase64FromBase64}});Object.defineProperty(P,"useShortLink",{enumerable:!0,get:function(){return Gt.useShortLink}});Object.defineProperty(P,"getChainId",{enumerable:!0,get:function(){return Gt.getChainId}});var zr=rs();Object.defineProperty(P,"openLink",{enumerable:!0,get:function(){return zr.openLink}});Object.defineProperty(P,"openLinkBlank",{enumerable:!0,get:function(){return zr.openLinkBlank}});Object.defineProperty(P,"openDeeplinkWithFallback",{enumerable:!0,get:function(){return zr.openDeeplinkWithFallback}});Object.defineProperty(P,"isMobileUserAgent",{enumerable:!0,get:function(){return zr.isMobileUserAgent}});Object.defineProperty(P,"isOS",{enumerable:!0,get:function(){return zr.isOS}});Object.defineProperty(P,"isBrowser",{enumerable:!0,get:function(){return zr.isBrowser}});var J_=Uo();Object.defineProperty(P,"versionCompare",{enumerable:!0,get:function(){return J_.versionCompare}});var F_=fp();Object.defineProperty(P,"checkMetaData",{enumerable:!0,get:function(){return F_.checkMetaData}});var ls=xt();Object.defineProperty(P,"replaceChainNameToChainId",{enumerable:!0,get:function(){return ls.replaceChainNameToChainId}});Object.defineProperty(P,"replaceChainIdToChainName",{enumerable:!0,get:function(){return ls.replaceChainIdToChainName}});Object.defineProperty(P,"chainName2IdMap",{enumerable:!0,get:function(){return ls.chainName2IdMap}});Object.defineProperty(P,"getNamespaceKeyByChain",{enumerable:!0,get:function(){return ls.getNamespaceKeyByChain}})});var us=$((gp,Qa)=>{f();p();(function(n){if(typeof gp=="object"&&typeof Qa<"u")Qa.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var e;typeof window<"u"?e=window:typeof globalThis<"u"?e=globalThis:typeof self<"u"?e=self:e=this,e.localforage=n()}})(function(){var n,e,t;return function r(o,i,s){function l(a,c){if(!i[a]){if(!o[a]){var u=typeof Ro=="function"&&Ro;if(!c&&u)return u(a,!0);if(g)return g(a,!0);var _=new Error("Cannot find module '"+a+"'");throw _.code="MODULE_NOT_FOUND",_}var y=i[a]={exports:{}};o[a][0].call(y.exports,function(N){var X=o[a][1][N];return l(X||N)},y,y.exports,r,o,i,s)}return i[a].exports}for(var g=typeof Ro=="function"&&Ro,d=0;d<s.length;d++)l(s[d]);return l}({1:[function(r,o,i){(function(s){"use strict";var l=s.MutationObserver||s.WebKitMutationObserver,g;if(l){var d=0,a=new l(N),c=s.document.createTextNode("");a.observe(c,{characterData:!0}),g=function(){c.data=d=++d%2}}else if(!s.setImmediate&&typeof s.MessageChannel<"u"){var u=new s.MessageChannel;u.port1.onmessage=N,g=function(){u.port2.postMessage(0)}}else"document"in s&&"onreadystatechange"in s.document.createElement("script")?g=function(){var D=s.document.createElement("script");D.onreadystatechange=function(){N(),D.onreadystatechange=null,D.parentNode.removeChild(D),D=null},s.document.documentElement.appendChild(D)}:g=function(){setTimeout(N,0)};var _,y=[];function N(){_=!0;for(var D,T,L=y.length;L;){for(T=y,y=[],D=-1;++D<L;)T[D]();L=y.length}_=!1}o.exports=X;function X(D){y.push(D)===1&&!_&&g()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(r,o,i){"use strict";var s=r(1);function l(){}var g={},d=["REJECTED"],a=["FULFILLED"],c=["PENDING"];o.exports=u;function u(S){if(typeof S!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,S!==l&&X(this,S)}u.prototype.catch=function(S){return this.then(null,S)},u.prototype.then=function(S,W){if(typeof S!="function"&&this.state===a||typeof W!="function"&&this.state===d)return this;var k=new this.constructor(l);if(this.state!==c){var J=this.state===a?S:W;y(k,J,this.outcome)}else this.queue.push(new _(k,S,W));return k};function _(S,W,k){this.promise=S,typeof W=="function"&&(this.onFulfilled=W,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}_.prototype.callFulfilled=function(S){g.resolve(this.promise,S)},_.prototype.otherCallFulfilled=function(S){y(this.promise,this.onFulfilled,S)},_.prototype.callRejected=function(S){g.reject(this.promise,S)},_.prototype.otherCallRejected=function(S){y(this.promise,this.onRejected,S)};function y(S,W,k){s(function(){var J;try{J=W(k)}catch(ne){return g.reject(S,ne)}J===S?g.reject(S,new TypeError("Cannot resolve promise with itself")):g.resolve(S,J)})}g.resolve=function(S,W){var k=D(N,W);if(k.status==="error")return g.reject(S,k.value);var J=k.value;if(J)X(S,J);else{S.state=a,S.outcome=W;for(var ne=-1,O=S.queue.length;++ne<O;)S.queue[ne].callFulfilled(W)}return S},g.reject=function(S,W){S.state=d,S.outcome=W;for(var k=-1,J=S.queue.length;++k<J;)S.queue[k].callRejected(W);return S};function N(S){var W=S&&S.then;if(S&&(typeof S=="object"||typeof S=="function")&&typeof W=="function")return function(){W.apply(S,arguments)}}function X(S,W){var k=!1;function J(B){k||(k=!0,g.reject(S,B))}function ne(B){k||(k=!0,g.resolve(S,B))}function O(){W(ne,J)}var R=D(O);R.status==="error"&&J(R.value)}function D(S,W){var k={};try{k.value=S(W),k.status="success"}catch(J){k.status="error",k.value=J}return k}u.resolve=T;function T(S){return S instanceof this?S:g.resolve(new this(l),S)}u.reject=L;function L(S){var W=new this(l);return g.reject(W,S)}u.all=H;function H(S){var W=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=S.length,J=!1;if(!k)return this.resolve([]);for(var ne=new Array(k),O=0,R=-1,B=new this(l);++R<k;)Q(S[R],R);return B;function Q(ce,ie){W.resolve(ce).then(Ge,function(Ye){J||(J=!0,g.reject(B,Ye))});function Ge(Ye){ne[ie]=Ye,++O===k&&!J&&(J=!0,g.resolve(B,ne))}}}u.race=F;function F(S){var W=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=S.length,J=!1;if(!k)return this.resolve([]);for(var ne=-1,O=new this(l);++ne<k;)R(S[ne]);return O;function R(B){W.resolve(B).then(function(Q){J||(J=!0,g.resolve(O,Q))},function(Q){J||(J=!0,g.reject(O,Q))})}}},{1:1}],3:[function(r,o,i){(function(s){"use strict";typeof s.Promise!="function"&&(s.Promise=r(2))}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(r,o,i){"use strict";var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h};function l(h,b){if(!(h instanceof b))throw new TypeError("Cannot call a class as a function")}function g(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var d=g();function a(){try{if(!d||!d.open)return!1;var h=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),b=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!h||b)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function c(h,b){h=h||[],b=b||{};try{return new Blob(h,b)}catch(v){if(v.name!=="TypeError")throw v;for(var m=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,C=new m,E=0;E<h.length;E+=1)C.append(h[E]);return C.getBlob(b.type)}}typeof Promise>"u"&&r(3);var u=Promise;function _(h,b){b&&h.then(function(m){b(null,m)},function(m){b(m)})}function y(h,b,m){typeof b=="function"&&h.then(b),typeof m=="function"&&h.catch(m)}function N(h){return typeof h!="string"&&(console.warn(h+" used as a key, but it is not a string."),h=String(h)),h}function X(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var D="local-forage-detect-blob-support",T=void 0,L={},H=Object.prototype.toString,F="readonly",S="readwrite";function W(h){for(var b=h.length,m=new ArrayBuffer(b),C=new Uint8Array(m),E=0;E<b;E++)C[E]=h.charCodeAt(E);return m}function k(h){return new u(function(b){var m=h.transaction(D,S),C=c([""]);m.objectStore(D).put(C,"key"),m.onabort=function(E){E.preventDefault(),E.stopPropagation(),b(!1)},m.oncomplete=function(){var E=navigator.userAgent.match(/Chrome\/(\d+)/),v=navigator.userAgent.match(/Edge\//);b(v||!E||parseInt(E[1],10)>=43)}}).catch(function(){return!1})}function J(h){return typeof T=="boolean"?u.resolve(T):k(h).then(function(b){return T=b,T})}function ne(h){var b=L[h.name],m={};m.promise=new u(function(C,E){m.resolve=C,m.reject=E}),b.deferredOperations.push(m),b.dbReady?b.dbReady=b.dbReady.then(function(){return m.promise}):b.dbReady=m.promise}function O(h){var b=L[h.name],m=b.deferredOperations.pop();if(m)return m.resolve(),m.promise}function R(h,b){var m=L[h.name],C=m.deferredOperations.pop();if(C)return C.reject(b),C.promise}function B(h,b){return new u(function(m,C){if(L[h.name]=L[h.name]||bn(),h.db)if(b)ne(h),h.db.close();else return m(h.db);var E=[h.name];b&&E.push(h.version);var v=d.open.apply(d,E);b&&(v.onupgradeneeded=function(I){var A=v.result;try{A.createObjectStore(h.storeName),I.oldVersion<=1&&A.createObjectStore(D)}catch(x){if(x.name==="ConstraintError")console.warn('The database "'+h.name+'" has been upgraded from version '+I.oldVersion+" to version "+I.newVersion+', but the storage "'+h.storeName+'" already exists.');else throw x}}),v.onerror=function(I){I.preventDefault(),C(v.error)},v.onsuccess=function(){var I=v.result;I.onversionchange=function(A){A.target.close()},m(I),O(h)}})}function Q(h){return B(h,!1)}function ce(h){return B(h,!0)}function ie(h,b){if(!h.db)return!0;var m=!h.db.objectStoreNames.contains(h.storeName),C=h.version<h.db.version,E=h.version>h.db.version;if(C&&(h.version!==b&&console.warn('The database "'+h.name+`" can't be downgraded from version `+h.db.version+" to version "+h.version+"."),h.version=h.db.version),E||m){if(m){var v=h.db.version+1;v>h.version&&(h.version=v)}return!0}return!1}function Ge(h){return new u(function(b,m){var C=new FileReader;C.onerror=m,C.onloadend=function(E){var v=btoa(E.target.result||"");b({__local_forage_encoded_blob:!0,data:v,type:h.type})},C.readAsBinaryString(h)})}function Ye(h){var b=W(atob(h.data));return c([b],{type:h.type})}function Pe(h){return h&&h.__local_forage_encoded_blob}function pt(h){var b=this,m=b._initReady().then(function(){var C=L[b._dbInfo.name];if(C&&C.dbReady)return C.dbReady});return y(m,h,h),m}function yn(h){ne(h);for(var b=L[h.name],m=b.forages,C=0;C<m.length;C++){var E=m[C];E._dbInfo.db&&(E._dbInfo.db.close(),E._dbInfo.db=null)}return h.db=null,Q(h).then(function(v){return h.db=v,ie(h)?ce(h):v}).then(function(v){h.db=b.db=v;for(var I=0;I<m.length;I++)m[I]._dbInfo.db=v}).catch(function(v){throw R(h,v),v})}function ht(h,b,m,C){C===void 0&&(C=1);try{var E=h.db.transaction(h.storeName,b);m(null,E)}catch(v){if(C>0&&(!h.db||v.name==="InvalidStateError"||v.name==="NotFoundError"))return u.resolve().then(function(){if(!h.db||v.name==="NotFoundError"&&!h.db.objectStoreNames.contains(h.storeName)&&h.version<=h.db.version)return h.db&&(h.version=h.db.version+1),ce(h)}).then(function(){return yn(h).then(function(){ht(h,b,m,C-1)})}).catch(m);m(v)}}function bn(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function zn(h){var b=this,m={db:null};if(h)for(var C in h)m[C]=h[C];var E=L[m.name];E||(E=bn(),L[m.name]=E),E.forages.push(b),b._initReady||(b._initReady=b.ready,b.ready=pt);var v=[];function I(){return u.resolve()}for(var A=0;A<E.forages.length;A++){var x=E.forages[A];x!==b&&v.push(x._initReady().catch(I))}var K=E.forages.slice(0);return u.all(v).then(function(){return m.db=E.db,Q(m)}).then(function(j){return m.db=j,ie(m,b._defaultConfig.version)?ce(m):j}).then(function(j){m.db=E.db=j,b._dbInfo=m;for(var G=0;G<K.length;G++){var ue=K[G];ue!==b&&(ue._dbInfo.db=m.db,ue._dbInfo.version=m.version)}})}function Qn(h,b){var m=this;h=N(h);var C=new u(function(E,v){m.ready().then(function(){ht(m._dbInfo,F,function(I,A){if(I)return v(I);try{var x=A.objectStore(m._dbInfo.storeName),K=x.get(h);K.onsuccess=function(){var j=K.result;j===void 0&&(j=null),Pe(j)&&(j=Ye(j)),E(j)},K.onerror=function(){v(K.error)}}catch(j){v(j)}})}).catch(v)});return _(C,b),C}function bt(h,b){var m=this,C=new u(function(E,v){m.ready().then(function(){ht(m._dbInfo,F,function(I,A){if(I)return v(I);try{var x=A.objectStore(m._dbInfo.storeName),K=x.openCursor(),j=1;K.onsuccess=function(){var G=K.result;if(G){var ue=G.value;Pe(ue)&&(ue=Ye(ue));var Ee=h(ue,G.key,j++);Ee!==void 0?E(Ee):G.continue()}else E()},K.onerror=function(){v(K.error)}}catch(G){v(G)}})}).catch(v)});return _(C,b),C}function Er(h,b,m){var C=this;h=N(h);var E=new u(function(v,I){var A;C.ready().then(function(){return A=C._dbInfo,H.call(b)==="[object Blob]"?J(A.db).then(function(x){return x?b:Ge(b)}):b}).then(function(x){ht(C._dbInfo,S,function(K,j){if(K)return I(K);try{var G=j.objectStore(C._dbInfo.storeName);x===null&&(x=void 0);var ue=G.put(x,h);j.oncomplete=function(){x===void 0&&(x=null),v(x)},j.onabort=j.onerror=function(){var Ee=ue.error?ue.error:ue.transaction.error;I(Ee)}}catch(Ee){I(Ee)}})}).catch(I)});return _(E,m),E}function si(h,b){var m=this;h=N(h);var C=new u(function(E,v){m.ready().then(function(){ht(m._dbInfo,S,function(I,A){if(I)return v(I);try{var x=A.objectStore(m._dbInfo.storeName),K=x.delete(h);A.oncomplete=function(){E()},A.onerror=function(){v(K.error)},A.onabort=function(){var j=K.error?K.error:K.transaction.error;v(j)}}catch(j){v(j)}})}).catch(v)});return _(C,b),C}function ai(h){var b=this,m=new u(function(C,E){b.ready().then(function(){ht(b._dbInfo,S,function(v,I){if(v)return E(v);try{var A=I.objectStore(b._dbInfo.storeName),x=A.clear();I.oncomplete=function(){C()},I.onabort=I.onerror=function(){var K=x.error?x.error:x.transaction.error;E(K)}}catch(K){E(K)}})}).catch(E)});return _(m,h),m}function Ys(h){var b=this,m=new u(function(C,E){b.ready().then(function(){ht(b._dbInfo,F,function(v,I){if(v)return E(v);try{var A=I.objectStore(b._dbInfo.storeName),x=A.count();x.onsuccess=function(){C(x.result)},x.onerror=function(){E(x.error)}}catch(K){E(K)}})}).catch(E)});return _(m,h),m}function wr(h,b){var m=this,C=new u(function(E,v){if(h<0){E(null);return}m.ready().then(function(){ht(m._dbInfo,F,function(I,A){if(I)return v(I);try{var x=A.objectStore(m._dbInfo.storeName),K=!1,j=x.openKeyCursor();j.onsuccess=function(){var G=j.result;if(!G){E(null);return}h===0||K?E(G.key):(K=!0,G.advance(h))},j.onerror=function(){v(j.error)}}catch(G){v(G)}})}).catch(v)});return _(C,b),C}function ci(h){var b=this,m=new u(function(C,E){b.ready().then(function(){ht(b._dbInfo,F,function(v,I){if(v)return E(v);try{var A=I.objectStore(b._dbInfo.storeName),x=A.openKeyCursor(),K=[];x.onsuccess=function(){var j=x.result;if(!j){C(K);return}K.push(j.key),j.continue()},x.onerror=function(){E(x.error)}}catch(j){E(j)}})}).catch(E)});return _(m,h),m}function Nn(h,b){b=X.apply(this,arguments);var m=this.config();h=typeof h!="function"&&h||{},h.name||(h.name=h.name||m.name,h.storeName=h.storeName||m.storeName);var C=this,E;if(!h.name)E=u.reject("Invalid arguments");else{var v=h.name===m.name&&C._dbInfo.db,I=v?u.resolve(C._dbInfo.db):Q(h).then(function(A){var x=L[h.name],K=x.forages;x.db=A;for(var j=0;j<K.length;j++)K[j]._dbInfo.db=A;return A});h.storeName?E=I.then(function(A){if(!!A.objectStoreNames.contains(h.storeName)){var x=A.version+1;ne(h);var K=L[h.name],j=K.forages;A.close();for(var G=0;G<j.length;G++){var ue=j[G];ue._dbInfo.db=null,ue._dbInfo.version=x}var Ee=new u(function(Ne,Fe){var Ue=d.open(h.name,x);Ue.onerror=function(It){var No=Ue.result;No.close(),Fe(It)},Ue.onupgradeneeded=function(){var It=Ue.result;It.deleteObjectStore(h.storeName)},Ue.onsuccess=function(){var It=Ue.result;It.close(),Ne(It)}});return Ee.then(function(Ne){K.db=Ne;for(var Fe=0;Fe<j.length;Fe++){var Ue=j[Fe];Ue._dbInfo.db=Ne,O(Ue._dbInfo)}}).catch(function(Ne){throw(R(h,Ne)||u.resolve()).catch(function(){}),Ne})}}):E=I.then(function(A){ne(h);var x=L[h.name],K=x.forages;A.close();for(var j=0;j<K.length;j++){var G=K[j];G._dbInfo.db=null}var ue=new u(function(Ee,Ne){var Fe=d.deleteDatabase(h.name);Fe.onerror=function(){var Ue=Fe.result;Ue&&Ue.close(),Ne(Fe.error)},Fe.onblocked=function(){console.warn('dropInstance blocked for database "'+h.name+'" until all open connections are closed')},Fe.onsuccess=function(){var Ue=Fe.result;Ue&&Ue.close(),Ee(Ue)}});return ue.then(function(Ee){x.db=Ee;for(var Ne=0;Ne<K.length;Ne++){var Fe=K[Ne];O(Fe._dbInfo)}}).catch(function(Ee){throw(R(h,Ee)||u.resolve()).catch(function(){}),Ee})})}return _(E,b),E}var zs={_driver:"asyncStorage",_initStorage:zn,_support:a(),iterate:bt,getItem:Qn,setItem:Er,removeItem:si,clear:ai,length:Ys,key:wr,keys:ci,dropInstance:Nn};function wo(){return typeof openDatabase=="function"}var gt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Tr="~~local_forage_type~",li=/^~~local_forage_type~([^~]+)~/,Zn="__lfsc__:",Sr=Zn.length,rt="arbf",rn="blob",er="si08",le="ui08",he="uic8",te="si16",Se="si32",Rt="ur16",vt="ui32",_e="fl32",Z="fl64",Ct=Sr+rt.length,Nr=Object.prototype.toString;function To(h){var b=h.length*.75,m=h.length,C,E=0,v,I,A,x;h[h.length-1]==="="&&(b--,h[h.length-2]==="="&&b--);var K=new ArrayBuffer(b),j=new Uint8Array(K);for(C=0;C<m;C+=4)v=gt.indexOf(h[C]),I=gt.indexOf(h[C+1]),A=gt.indexOf(h[C+2]),x=gt.indexOf(h[C+3]),j[E++]=v<<2|I>>4,j[E++]=(I&15)<<4|A>>2,j[E++]=(A&3)<<6|x&63;return K}function Qs(h){var b=new Uint8Array(h),m="",C;for(C=0;C<b.length;C+=3)m+=gt[b[C]>>2],m+=gt[(b[C]&3)<<4|b[C+1]>>4],m+=gt[(b[C+1]&15)<<2|b[C+2]>>6],m+=gt[b[C+2]&63];return b.length%3===2?m=m.substring(0,m.length-1)+"=":b.length%3===1&&(m=m.substring(0,m.length-2)+"=="),m}function Ig(h,b){var m="";if(h&&(m=Nr.call(h)),h&&(m==="[object ArrayBuffer]"||h.buffer&&Nr.call(h.buffer)==="[object ArrayBuffer]")){var C,E=Zn;h instanceof ArrayBuffer?(C=h,E+=rt):(C=h.buffer,m==="[object Int8Array]"?E+=er:m==="[object Uint8Array]"?E+=le:m==="[object Uint8ClampedArray]"?E+=he:m==="[object Int16Array]"?E+=te:m==="[object Uint16Array]"?E+=Rt:m==="[object Int32Array]"?E+=Se:m==="[object Uint32Array]"?E+=vt:m==="[object Float32Array]"?E+=_e:m==="[object Float64Array]"?E+=Z:b(new Error("Failed to get type for BinaryArray"))),b(E+Qs(C))}else if(m==="[object Blob]"){var v=new FileReader;v.onload=function(){var I=Tr+h.type+"~"+Qs(this.result);b(Zn+rn+I)},v.readAsArrayBuffer(h)}else try{b(JSON.stringify(h))}catch(I){console.error("Couldn't convert value into a JSON string: ",h),b(null,I)}}function Dg(h){if(h.substring(0,Sr)!==Zn)return JSON.parse(h);var b=h.substring(Ct),m=h.substring(Sr,Ct),C;if(m===rn&&li.test(b)){var E=b.match(li);C=E[1],b=b.substring(E[0].length)}var v=To(b);switch(m){case rt:return v;case rn:return c([v],{type:C});case er:return new Int8Array(v);case le:return new Uint8Array(v);case he:return new Uint8ClampedArray(v);case te:return new Int16Array(v);case Rt:return new Uint16Array(v);case Se:return new Int32Array(v);case vt:return new Uint32Array(v);case _e:return new Float32Array(v);case Z:return new Float64Array(v);default:throw new Error("Unkown type: "+m)}}var Zs={serialize:Ig,deserialize:Dg,stringToBuffer:To,bufferToString:Qs};function Al(h,b,m,C){h.executeSql("CREATE TABLE IF NOT EXISTS "+b.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],m,C)}function Ag(h){var b=this,m={db:null};if(h)for(var C in h)m[C]=typeof h[C]!="string"?h[C].toString():h[C];var E=new u(function(v,I){try{m.db=openDatabase(m.name,String(m.version),m.description,m.size)}catch(A){return I(A)}m.db.transaction(function(A){Al(A,m,function(){b._dbInfo=m,v()},function(x,K){I(K)})},I)});return m.serializer=Zs,E}function Rn(h,b,m,C,E,v){h.executeSql(m,C,E,function(I,A){A.code===A.SYNTAX_ERR?I.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[b.storeName],function(x,K){K.rows.length?v(x,A):Al(x,b,function(){x.executeSql(m,C,E,v)},v)},v):v(I,A)},v)}function Pg(h,b){var m=this;h=N(h);var C=new u(function(E,v){m.ready().then(function(){var I=m._dbInfo;I.db.transaction(function(A){Rn(A,I,"SELECT * FROM "+I.storeName+" WHERE key = ? LIMIT 1",[h],function(x,K){var j=K.rows.length?K.rows.item(0).value:null;j&&(j=I.serializer.deserialize(j)),E(j)},function(x,K){v(K)})})}).catch(v)});return _(C,b),C}function kg(h,b){var m=this,C=new u(function(E,v){m.ready().then(function(){var I=m._dbInfo;I.db.transaction(function(A){Rn(A,I,"SELECT * FROM "+I.storeName,[],function(x,K){for(var j=K.rows,G=j.length,ue=0;ue<G;ue++){var Ee=j.item(ue),Ne=Ee.value;if(Ne&&(Ne=I.serializer.deserialize(Ne)),Ne=h(Ne,Ee.key,ue+1),Ne!==void 0){E(Ne);return}}E()},function(x,K){v(K)})})}).catch(v)});return _(C,b),C}function Pl(h,b,m,C){var E=this;h=N(h);var v=new u(function(I,A){E.ready().then(function(){b===void 0&&(b=null);var x=b,K=E._dbInfo;K.serializer.serialize(b,function(j,G){G?A(G):K.db.transaction(function(ue){Rn(ue,K,"INSERT OR REPLACE INTO "+K.storeName+" (key, value) VALUES (?, ?)",[h,j],function(){I(x)},function(Ee,Ne){A(Ne)})},function(ue){if(ue.code===ue.QUOTA_ERR){if(C>0){I(Pl.apply(E,[h,x,m,C-1]));return}A(ue)}})})}).catch(A)});return _(v,m),v}function Lg(h,b,m){return Pl.apply(this,[h,b,m,1])}function xg(h,b){var m=this;h=N(h);var C=new u(function(E,v){m.ready().then(function(){var I=m._dbInfo;I.db.transaction(function(A){Rn(A,I,"DELETE FROM "+I.storeName+" WHERE key = ?",[h],function(){E()},function(x,K){v(K)})})}).catch(v)});return _(C,b),C}function Kg(h){var b=this,m=new u(function(C,E){b.ready().then(function(){var v=b._dbInfo;v.db.transaction(function(I){Rn(I,v,"DELETE FROM "+v.storeName,[],function(){C()},function(A,x){E(x)})})}).catch(E)});return _(m,h),m}function Mg(h){var b=this,m=new u(function(C,E){b.ready().then(function(){var v=b._dbInfo;v.db.transaction(function(I){Rn(I,v,"SELECT COUNT(key) as c FROM "+v.storeName,[],function(A,x){var K=x.rows.item(0).c;C(K)},function(A,x){E(x)})})}).catch(E)});return _(m,h),m}function Wg(h,b){var m=this,C=new u(function(E,v){m.ready().then(function(){var I=m._dbInfo;I.db.transaction(function(A){Rn(A,I,"SELECT key FROM "+I.storeName+" WHERE id = ? LIMIT 1",[h+1],function(x,K){var j=K.rows.length?K.rows.item(0).key:null;E(j)},function(x,K){v(K)})})}).catch(v)});return _(C,b),C}function jg(h){var b=this,m=new u(function(C,E){b.ready().then(function(){var v=b._dbInfo;v.db.transaction(function(I){Rn(I,v,"SELECT key FROM "+v.storeName,[],function(A,x){for(var K=[],j=0;j<x.rows.length;j++)K.push(x.rows.item(j).key);C(K)},function(A,x){E(x)})})}).catch(E)});return _(m,h),m}function Bg(h){return new u(function(b,m){h.transaction(function(C){C.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(E,v){for(var I=[],A=0;A<v.rows.length;A++)I.push(v.rows.item(A).name);b({db:h,storeNames:I})},function(E,v){m(v)})},function(C){m(C)})})}function Ug(h,b){b=X.apply(this,arguments);var m=this.config();h=typeof h!="function"&&h||{},h.name||(h.name=h.name||m.name,h.storeName=h.storeName||m.storeName);var C=this,E;return h.name?E=new u(function(v){var I;h.name===m.name?I=C._dbInfo.db:I=openDatabase(h.name,"","",0),h.storeName?v({db:I,storeNames:[h.storeName]}):v(Bg(I))}).then(function(v){return new u(function(I,A){v.db.transaction(function(x){function K(Ee){return new u(function(Ne,Fe){x.executeSql("DROP TABLE IF EXISTS "+Ee,[],function(){Ne()},function(Ue,It){Fe(It)})})}for(var j=[],G=0,ue=v.storeNames.length;G<ue;G++)j.push(K(v.storeNames[G]));u.all(j).then(function(){I()}).catch(function(Ee){A(Ee)})},function(x){A(x)})})}):E=u.reject("Invalid arguments"),_(E,b),E}var Xg={_driver:"webSQLStorage",_initStorage:Ag,_support:wo(),iterate:kg,getItem:Pg,setItem:Lg,removeItem:xg,clear:Kg,length:Mg,key:Wg,keys:jg,dropInstance:Ug};function Hg(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function kl(h,b){var m=h.name+"/";return h.storeName!==b.storeName&&(m+=h.storeName+"/"),m}function qg(){var h="_localforage_support_test";try{return localStorage.setItem(h,!0),localStorage.removeItem(h),!1}catch{return!0}}function Jg(){return!qg()||localStorage.length>0}function Fg(h){var b=this,m={};if(h)for(var C in h)m[C]=h[C];return m.keyPrefix=kl(h,b._defaultConfig),Jg()?(b._dbInfo=m,m.serializer=Zs,u.resolve()):u.reject()}function $g(h){var b=this,m=b.ready().then(function(){for(var C=b._dbInfo.keyPrefix,E=localStorage.length-1;E>=0;E--){var v=localStorage.key(E);v.indexOf(C)===0&&localStorage.removeItem(v)}});return _(m,h),m}function Vg(h,b){var m=this;h=N(h);var C=m.ready().then(function(){var E=m._dbInfo,v=localStorage.getItem(E.keyPrefix+h);return v&&(v=E.serializer.deserialize(v)),v});return _(C,b),C}function Gg(h,b){var m=this,C=m.ready().then(function(){for(var E=m._dbInfo,v=E.keyPrefix,I=v.length,A=localStorage.length,x=1,K=0;K<A;K++){var j=localStorage.key(K);if(j.indexOf(v)===0){var G=localStorage.getItem(j);if(G&&(G=E.serializer.deserialize(G)),G=h(G,j.substring(I),x++),G!==void 0)return G}}});return _(C,b),C}function Yg(h,b){var m=this,C=m.ready().then(function(){var E=m._dbInfo,v;try{v=localStorage.key(h)}catch{v=null}return v&&(v=v.substring(E.keyPrefix.length)),v});return _(C,b),C}function zg(h){var b=this,m=b.ready().then(function(){for(var C=b._dbInfo,E=localStorage.length,v=[],I=0;I<E;I++){var A=localStorage.key(I);A.indexOf(C.keyPrefix)===0&&v.push(A.substring(C.keyPrefix.length))}return v});return _(m,h),m}function Qg(h){var b=this,m=b.keys().then(function(C){return C.length});return _(m,h),m}function Zg(h,b){var m=this;h=N(h);var C=m.ready().then(function(){var E=m._dbInfo;localStorage.removeItem(E.keyPrefix+h)});return _(C,b),C}function em(h,b,m){var C=this;h=N(h);var E=C.ready().then(function(){b===void 0&&(b=null);var v=b;return new u(function(I,A){var x=C._dbInfo;x.serializer.serialize(b,function(K,j){if(j)A(j);else try{localStorage.setItem(x.keyPrefix+h,K),I(v)}catch(G){(G.name==="QuotaExceededError"||G.name==="NS_ERROR_DOM_QUOTA_REACHED")&&A(G),A(G)}})})});return _(E,m),E}function tm(h,b){if(b=X.apply(this,arguments),h=typeof h!="function"&&h||{},!h.name){var m=this.config();h.name=h.name||m.name,h.storeName=h.storeName||m.storeName}var C=this,E;return h.name?E=new u(function(v){h.storeName?v(kl(h,C._defaultConfig)):v(h.name+"/")}).then(function(v){for(var I=localStorage.length-1;I>=0;I--){var A=localStorage.key(I);A.indexOf(v)===0&&localStorage.removeItem(A)}}):E=u.reject("Invalid arguments"),_(E,b),E}var nm={_driver:"localStorageWrapper",_initStorage:Fg,_support:Hg(),iterate:Gg,getItem:Vg,setItem:em,removeItem:Zg,clear:$g,length:Qg,key:Yg,keys:zg,dropInstance:tm},rm=function(b,m){return b===m||typeof b=="number"&&typeof m=="number"&&isNaN(b)&&isNaN(m)},om=function(b,m){for(var C=b.length,E=0;E<C;){if(rm(b[E],m))return!0;E++}return!1},Ll=Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"},So={},xl={},Rr={INDEXEDDB:zs,WEBSQL:Xg,LOCALSTORAGE:nm},im=[Rr.INDEXEDDB._driver,Rr.WEBSQL._driver,Rr.LOCALSTORAGE._driver],ui=["dropInstance"],ea=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ui),sm={description:"",driver:im.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function am(h,b){h[b]=function(){var m=arguments;return h.ready().then(function(){return h[b].apply(h,m)})}}function ta(){for(var h=1;h<arguments.length;h++){var b=arguments[h];if(b)for(var m in b)b.hasOwnProperty(m)&&(Ll(b[m])?arguments[0][m]=b[m].slice():arguments[0][m]=b[m])}return arguments[0]}var cm=function(){function h(b){l(this,h);for(var m in Rr)if(Rr.hasOwnProperty(m)){var C=Rr[m],E=C._driver;this[m]=E,So[E]||this.defineDriver(C)}this._defaultConfig=ta({},sm),this._config=ta({},this._defaultConfig,b),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return h.prototype.config=function(m){if((typeof m>"u"?"undefined":s(m))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var C in m){if(C==="storeName"&&(m[C]=m[C].replace(/\W/g,"_")),C==="version"&&typeof m[C]!="number")return new Error("Database version must be a number.");this._config[C]=m[C]}return"driver"in m&&m.driver?this.setDriver(this._config.driver):!0}else return typeof m=="string"?this._config[m]:this._config},h.prototype.defineDriver=function(m,C,E){var v=new u(function(I,A){try{var x=m._driver,K=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!m._driver){A(K);return}for(var j=ea.concat("_initStorage"),G=0,ue=j.length;G<ue;G++){var Ee=j[G],Ne=!om(ui,Ee);if((Ne||m[Ee])&&typeof m[Ee]!="function"){A(K);return}}var Fe=function(){for(var No=function(dm){return function(){var fm=new Error("Method "+dm+" is not implemented by the current driver"),Kl=u.reject(fm);return _(Kl,arguments[arguments.length-1]),Kl}},na=0,um=ui.length;na<um;na++){var ra=ui[na];m[ra]||(m[ra]=No(ra))}};Fe();var Ue=function(No){So[x]&&console.info("Redefining LocalForage driver: "+x),So[x]=m,xl[x]=No,I()};"_support"in m?m._support&&typeof m._support=="function"?m._support().then(Ue,A):Ue(!!m._support):Ue(!0)}catch(It){A(It)}});return y(v,C,E),v},h.prototype.driver=function(){return this._driver||null},h.prototype.getDriver=function(m,C,E){var v=So[m]?u.resolve(So[m]):u.reject(new Error("Driver not found."));return y(v,C,E),v},h.prototype.getSerializer=function(m){var C=u.resolve(Zs);return y(C,m),C},h.prototype.ready=function(m){var C=this,E=C._driverSet.then(function(){return C._ready===null&&(C._ready=C._initDriver()),C._ready});return y(E,m,m),E},h.prototype.setDriver=function(m,C,E){var v=this;Ll(m)||(m=[m]);var I=this._getSupportedDrivers(m);function A(){v._config.driver=v.driver()}function x(G){return v._extend(G),A(),v._ready=v._initStorage(v._config),v._ready}function K(G){return function(){var ue=0;function Ee(){for(;ue<G.length;){var Ne=G[ue];return ue++,v._dbInfo=null,v._ready=null,v.getDriver(Ne).then(x).catch(Ee)}A();var Fe=new Error("No available storage method found.");return v._driverSet=u.reject(Fe),v._driverSet}return Ee()}}var j=this._driverSet!==null?this._driverSet.catch(function(){return u.resolve()}):u.resolve();return this._driverSet=j.then(function(){var G=I[0];return v._dbInfo=null,v._ready=null,v.getDriver(G).then(function(ue){v._driver=ue._driver,A(),v._wrapLibraryMethodsWithReady(),v._initDriver=K(I)})}).catch(function(){A();var G=new Error("No available storage method found.");return v._driverSet=u.reject(G),v._driverSet}),y(this._driverSet,C,E),this._driverSet},h.prototype.supports=function(m){return!!xl[m]},h.prototype._extend=function(m){ta(this,m)},h.prototype._getSupportedDrivers=function(m){for(var C=[],E=0,v=m.length;E<v;E++){var I=m[E];this.supports(I)&&C.push(I)}return C},h.prototype._wrapLibraryMethodsWithReady=function(){for(var m=0,C=ea.length;m<C;m++)am(this,ea[m])},h.prototype.createInstance=function(m){return new h(m)},h}(),lm=new cm;o.exports=lm},{3:3}]},{},[4])(4)})});var qo=$(st=>{"use strict";f();p();var Wn=st&&st.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})},tc=st&&st.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(st,"__esModule",{value:!0});st.OKXReporter=st.OKXReportSide=st.OKXReportType=st.versionStr=void 0;var $_=tc(If()),Mn=He(),Jo=Vr(),Za=tt(),V_=tc(us()),G_=tc(kr());st.versionStr="1.8.1";var Y_=["https://www.okx.com/dappstat/wallet-connect","https://www.okx.ac/dappstat/wallet-connect"],z_="OKX_RP_CK",mp="OKX_RP_UUID_CK",_p=100,Q_={Accept:"*/*","Content-Type":"text/plain"},Z_="POST",ey={headers:Q_,method:Z_};st.OKXReportType={PAGE_IN:"page_in",PAGE_OUT:"page_out",CLICK:"click",LOG:"log"};st.OKXReportSide={DAPP:"dapp",WALLET:"wallet"};var ty=(n,...e)=>Wn(void 0,[n,...e],void 0,function*(t,r={},o=5e3){for(let i of t)try{let s=new AbortController,l=s.signal,g=(0,$_.default)(i,Object.assign(Object.assign({},r),{signal:l})),d=new Promise((c,u)=>setTimeout(()=>{s.abort(),u(new Error("Request timed out"))},o)),a=yield Promise.race([g,d]);if(a.ok)return a;if(a.status==502)return console.error("Fetch error status 502",i),a}catch(s){console.error(`Fetch error for ${i}:`,s)}throw console.error("'All fetch attempts failed.'"),new Error("All fetch attempts failed.")}),ec=class{constructor(){this.currentSide=st.OKXReportSide.DAPP,this.currentVersion=st.versionStr,this.storage=V_.default.createInstance({name:"OKXReporter"}),this.recordList=new Array,this.currentUUID=(0,Za.toHexString)(G_.default.randomBytes(16))}configVersionAndSide(e,t,r){this.currentVersion=e+Mn.logVersion,this.currentSide=t,this.appName=r}get recordCacheKey(){return z_+"@"+this.appName}get reportPlatform(){return(0,Za.isMobileUserAgent)()?(0,Za.isIos)()?"iOS":"android":"pc"}beginReport(){return Wn(this,void 0,void 0,function*(){this.startErrorCatching();let e=yield this.storage.getItem(this.recordCacheKey),t=yield this.storage.getItem(mp);t?this.currentUUID=t:this.storage.setItem(mp,this.currentUUID),e&&(this.recordList=e,(0,Mn.logDebug)("resume records from cache length: ",this.recordList.length),yield this.sendCachedRecords())})}startErrorCatching(){(0,Jo.getWindow)()&&(0,Mn.logDebug)("begin capture console error")}cachedErrors(){return this.recordList}sendRecord(e){return Wn(this,void 0,void 0,function*(){return new Promise((t,r)=>Wn(this,void 0,void 0,function*(){try{let o=JSON.stringify(e);(0,Mn.logDebug)("[REPORT] record: ",o);let i=yield ty(Y_,Object.assign(Object.assign({},ey),{body:o}));(0,Mn.logDebug)("[REPORT] get rsp:",i),i&&i.status&&i.status==200?(this.recordList=this.recordList.filter(s=>s.timestamp!=e.timestamp||s.content!=e.content),yield this.storage.setItem(this.recordCacheKey,this.recordList),t(!0)):r(!1)}catch(o){(0,Mn.logDebug)("send record error:",o),t(!0)}}))})}sendRecordContent(e,t,r){return Wn(this,arguments,void 0,function*(o,i,s,l=void 0,g=void 0,d=void 0,a=void 0,c=void 0,u=void 0){var _,y,N,X;let D=(_=(0,Jo.getWindow)())===null||_===void 0?void 0:_.location.pathname,T=(y=(0,Jo.getWindow)())===null||y===void 0?void 0:y.location.origin;D&&T&&(T=T+D);let L=(N=(0,Jo.getWindow)())===null||N===void 0?void 0:N.navigator.language,H=(X=(0,Jo.getWindow)())===null||X===void 0?void 0:X.navigator.userAgent,F=this.reportPlatform,S={uuid:this.currentUUID,version:this.currentVersion,content:o,action:s,side:this.currentSide,timestamp:new Date().getTime(),url:T,lang:L,type:i,platform:F,"user-agent":H,reverved1:l,reverved2:g,reverved3:d,reverved4:a,reverved5:c,reverved6:u};yield this.markRecordItem(S),yield this.sendRecord(S)})}sendCachedRecords(){return Wn(this,void 0,void 0,function*(){return new Promise((e,t)=>Wn(this,void 0,void 0,function*(){let r=this.recordList.map(o=>this.sendRecord(o));(0,Mn.logDebug)("[REPORT] submit & clean recorded caches begin @",new Date().toUTCString()),Promise.allSettled(r).then(o=>{(0,Mn.logDebug)("[REPORT] submit & clean recorded caches ends @",new Date().toUTCString());let i=[];o.forEach((s,l)=>{s.status=="rejected"&&i.push(l)}),this.recordList=this.recordList.filter((s,l)=>!i.includes(l)),this.storage.setItem(this.recordCacheKey,this.recordList).then(function(s){e()}).catch(function(s){t(s)})})}))})}markRecordItem(e){return Wn(this,void 0,void 0,function*(){if(this.recordList.push(e),this.recordList.length>_p){let t=this.recordList.length-_p;this.recordList.splice(0,t)}return new Promise((t,r)=>{this.storage.setItem(this.recordCacheKey,this.recordList).then(function(o){t(e)}).catch(function(o){r(o)})})})}};st.OKXReporter=ec});var yp=$((FR,ny)=>{ny.exports={name:"@okxconnect/core",version:"1.8.1",description:"OKX Connect core",main:"./src/index.js",keywords:["OKXConnect","OKX Connect"],scripts:{build:"npx tsc",local:"yarn install && npx tsc",remove:"rm -rf ./src  && rm -rf ./node_modules"},author:"OKX Wallet",license:"MIT",dependencies:{"@stablelib/ed25519":"^1.0.2","@stablelib/random":"^1.0.1","@stablelib/sha256":"1.0.1",bs58:"^5.0.0","core-js":"2.6.12","cross-fetch":"^4.0.0","crypto-js":"^4.2.0",eventemitter3:"^5.0.1",isutf8:"^4.0.0",localforage:"^1.10.0",multiformats:"9.4.2",process:"^0.11.10",tweetnacl:"^1.0.3","tweetnacl-util":"^0.15.1","ua-parser-js":"^1.0.35",uint8arrays:"3.1.0"},devDependencies:{"@types/crypto-js":"^4.2.2","@types/ua-parser-js":"^0.7.36",assert:"^2.1.0",eslint:"^9.7.0",events:"^3.3.0",jest:"^29.7.0","ts-loader":"^9.5.1",typescript:"^5.5.2"},peerDependencies:{"@solana/web3.js":"^1.78.4"}}});var He=$(Mt=>{"use strict";f();p();var bp=Mt&&Mt.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.logVersion=void 0;Mt.getDefaultReporter=oy;Mt.logDebug=sy;Mt.logError=ay;Mt.logWarning=cy;Mt.reportEvent=ly;Mt.reportLog=uy;var ds=!1,ry=!1,vp=qo(),nc=new vp.OKXReporter;function oy(){return nc}var iy=yp(),fs=iy.version;function sy(...n){if(typeof console<"u")try{(ds||window?.okxLogDebug)&&console.log(`[OKX_CONNECT_SDK] ${fs} `,...n)}catch{}}function ay(...n){if(typeof console<"u")try{if((ds||window?.okxLogDebug)&&console.error(`[OKX_CONNECT_SDK] ${fs} `,...n),ry||!ds){let e="";e+=[...n].reduce((t,r)=>{typeof r=="string"?t+=","+r:typeof r=="object"&&(t+=JSON.stringify(r))}),nc.sendRecordContent(e,vp.OKXReportType.LOG,"")}}catch{}}function cy(...n){if(typeof console<"u")try{(ds||window?.okxLogDebug)&&console.warn(`[OKX_CONNECT_SDK] ${fs} `,...n)}catch{}}function ly(n,e,t){return bp(this,arguments,void 0,function*(r,o,i,s=void 0,l=void 0,g=void 0,d=void 0,a=void 0,c=void 0){try{yield nc.sendRecordContent(i,r,o,s,l,g,d,a,c)}catch{}})}function uy(n){return bp(this,arguments,void 0,function*(e,t="default"){})}Mt.logVersion=fs});var Kn=$(ps=>{"use strict";f();p();Object.defineProperty(ps,"__esModule",{value:!0});ps.safeJsonParse=hy;ps.safeJsonStringify=gy;var dy=He(),fy=n=>JSON.stringify(n,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),py=n=>{let e=/:(\b\d{17,}|\b(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))(?=[,\}\]]|$)/g,t=n.replace(e,(r,o)=>`:"${o}n"`);try{return JSON.parse(t,(r,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)}catch{return JSON.parse(n)}};function hy(n){if(typeof n!="string")throw(0,dy.logDebug)(n),new Error(`Cannot safe json parse value of type ${typeof n}`);try{return py(n)}catch(e){return console.error("safeJsonParse error:",e),n}}function gy(n){return typeof n=="string"?n:fy(n)||""}});function my(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var o=0;o<n.length;o++){var i=n.charAt(o),s=i.charCodeAt(0);if(t[s]!==255)throw new TypeError(i+" is ambiguous");t[s]=o}var l=n.length,g=n.charAt(0),d=Math.log(l)/Math.log(256),a=Math.log(256)/Math.log(l);function c(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var N=0,X=0,D=0,T=y.length;D!==T&&y[D]===0;)D++,N++;for(var L=(T-D)*a+1>>>0,H=new Uint8Array(L);D!==T;){for(var F=y[D],S=0,W=L-1;(F!==0||S<X)&&W!==-1;W--,S++)F+=256*H[W]>>>0,H[W]=F%l>>>0,F=F/l>>>0;if(F!==0)throw new Error("Non-zero carry");X=S,D++}for(var k=L-X;k!==L&&H[k]===0;)k++;for(var J=g.repeat(N);k<L;++k)J+=n.charAt(H[k]);return J}function u(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var N=0;if(y[N]!==" "){for(var X=0,D=0;y[N]===g;)X++,N++;for(var T=(y.length-N)*d+1>>>0,L=new Uint8Array(T);y[N];){var H=t[y.charCodeAt(N)];if(H===255)return;for(var F=0,S=T-1;(H!==0||F<D)&&S!==-1;S--,F++)H+=l*L[S]>>>0,L[S]=H%256>>>0,H=H/256>>>0;if(H!==0)throw new Error("Non-zero carry");D=F,N++}if(y[N]!==" "){for(var W=T-D;W!==T&&L[W]===0;)W++;for(var k=new Uint8Array(X+(T-W)),J=X;W!==T;)k[J++]=L[W++];return k}}}function _(y){var N=u(y);if(N)return N;throw new Error(`Non-${e} character`)}return{encode:c,decodeUnsafe:u,decode:_}}var _y,yy,Cp,Op=ke(()=>{f();p();_y=my,yy=_y,Cp=yy});var hs={};Qe(hs,{coerce:()=>Yt,empty:()=>Ep,equals:()=>rc,fromHex:()=>vy,fromString:()=>oc,isBinary:()=>Cy,toHex:()=>by,toString:()=>ic});var Ep,by,vy,rc,Yt,Cy,oc,ic,jn=ke(()=>{f();p();Ep=new Uint8Array(0),by=n=>n.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),vy=n=>{let e=n.match(/../g);return e?new Uint8Array(e.map(t=>parseInt(t,16))):Ep},rc=(n,e)=>{if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0},Yt=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},Cy=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),oc=n=>new TextEncoder().encode(n),ic=n=>new TextDecoder().decode(n)});var sc,ac,Fo,cc,gs,Bn,Oy,Ey,Me,dn=ke(()=>{f();p();Op();jn();sc=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ac=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseDecode=r}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){let t={[this.prefix]:this,...e.decoders||{[e.prefix]:e}};return new Fo(t)}},Fo=class{constructor(e){this.decoders=e}or(e){let t=e.decoders||{[e.prefix]:e};return new Fo({...this.decoders,...t})}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},cc=class{constructor(e,t,r,o){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=o,this.encoder=new sc(e,t,r),this.decoder=new ac(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},gs=({name:n,prefix:e,encode:t,decode:r})=>new cc(n,e,t,r),Bn=({prefix:n,name:e,alphabet:t})=>{let{encode:r,decode:o}=Cp(t,e);return gs({prefix:n,name:e,encode:r,decode:i=>Yt(o(i))})},Oy=(n,e,t,r)=>{let o={};for(let a=0;a<e.length;++a)o[e[a]]=a;let i=n.length;for(;n[i-1]==="=";)--i;let s=new Uint8Array(i*t/8|0),l=0,g=0,d=0;for(let a=0;a<i;++a){let c=o[n[a]];if(c===void 0)throw new SyntaxError(`Non-${r} character`);g=g<<t|c,l+=t,l>=8&&(l-=8,s[d++]=255&g>>l)}if(l>=t||255&g<<8-l)throw new SyntaxError("Unexpected end of data");return s},Ey=(n,e,t)=>{let r=e[e.length-1]==="=",o=(1<<t)-1,i="",s=0,l=0;for(let g=0;g<n.length;++g)for(l=l<<8|n[g],s+=8;s>t;)s-=t,i+=e[o&l>>s];if(s&&(i+=e[o&l<<t-s]),r)for(;i.length*t&7;)i+="=";return i},Me=({name:n,prefix:e,bitsPerChar:t,alphabet:r})=>gs({prefix:e,name:n,encode(o){return Ey(o,r,t)},decode(o){return Oy(o,r,t,n)}})});var lc={};Qe(lc,{identity:()=>wy});var wy,wp=ke(()=>{f();p();dn();jn();wy=gs({prefix:"\0",name:"identity",encode:n=>ic(n),decode:n=>oc(n)})});var uc={};Qe(uc,{base2:()=>Ty});var Ty,Tp=ke(()=>{f();p();dn();Ty=Me({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})});var dc={};Qe(dc,{base8:()=>Sy});var Sy,Sp=ke(()=>{f();p();dn();Sy=Me({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})});var fc={};Qe(fc,{base10:()=>Ny});var Ny,Np=ke(()=>{f();p();dn();Ny=Bn({prefix:"9",name:"base10",alphabet:"0123456789"})});var pc={};Qe(pc,{base16:()=>Ry,base16upper:()=>Iy});var Ry,Iy,Rp=ke(()=>{f();p();dn();Ry=Me({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Iy=Me({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})});var hc={};Qe(hc,{base32:()=>Qr,base32hex:()=>ky,base32hexpad:()=>xy,base32hexpadupper:()=>Ky,base32hexupper:()=>Ly,base32pad:()=>Ay,base32padupper:()=>Py,base32upper:()=>Dy,base32z:()=>My});var Qr,Dy,Ay,Py,ky,Ly,xy,Ky,My,gc=ke(()=>{f();p();dn();Qr=Me({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Dy=Me({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ay=Me({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Py=Me({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ky=Me({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ly=Me({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),xy=Me({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ky=Me({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),My=Me({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})});var mc={};Qe(mc,{base36:()=>Wy,base36upper:()=>jy});var Wy,jy,Ip=ke(()=>{f();p();dn();Wy=Bn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),jy=Bn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})});var _c={};Qe(_c,{base58btc:()=>fn,base58flickr:()=>By});var fn,By,yc=ke(()=>{f();p();dn();fn=Bn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),By=Bn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})});var bc={};Qe(bc,{base64:()=>Uy,base64pad:()=>Xy,base64url:()=>Hy,base64urlpad:()=>qy});var Uy,Xy,Hy,qy,Dp=ke(()=>{f();p();dn();Uy=Me({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Xy=Me({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Hy=Me({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),qy=Me({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});function kp(n,e,t){e=e||[],t=t||0;for(var r=t;n>=Vy;)e[t++]=n&255|Ap,n/=128;for(;n&$y;)e[t++]=n&255|Ap,n>>>=7;return e[t]=n|0,kp.bytes=t-r+1,e}function vc(n,r){var t=0,r=r||0,o=0,i=r,s,l=n.length;do{if(i>=l)throw vc.bytes=0,new RangeError("Could not decode varint");s=n[i++],t+=o<28?(s&Pp)<<o:(s&Pp)*Math.pow(2,o),o+=7}while(s>=Yy);return vc.bytes=i-r,t}var Jy,Ap,Fy,$y,Vy,Gy,Yy,Pp,zy,Qy,Zy,eb,tb,nb,rb,ob,ib,sb,ab,cb,$o,Lp=ke(()=>{f();p();Jy=kp,Ap=128,Fy=127,$y=~Fy,Vy=Math.pow(2,31);Gy=vc,Yy=128,Pp=127;zy=Math.pow(2,7),Qy=Math.pow(2,14),Zy=Math.pow(2,21),eb=Math.pow(2,28),tb=Math.pow(2,35),nb=Math.pow(2,42),rb=Math.pow(2,49),ob=Math.pow(2,56),ib=Math.pow(2,63),sb=function(n){return n<zy?1:n<Qy?2:n<Zy?3:n<eb?4:n<tb?5:n<nb?6:n<rb?7:n<ob?8:n<ib?9:10},ab={encode:Jy,decode:Gy,encodingLength:sb},cb=ab,$o=cb});var eo={};Qe(eo,{decode:()=>Zr,encodeTo:()=>ur,encodingLength:()=>dr});var Zr,ur,dr,ms=ke(()=>{f();p();Lp();Zr=n=>[$o.decode(n),$o.decode.bytes],ur=(n,e,t=0)=>($o.encode(n,e,t),e),dr=n=>$o.encodingLength(n)});var to={};Qe(to,{Digest:()=>fr,create:()=>Vo,decode:()=>Cc,equals:()=>Oc});var Vo,Cc,Oc,fr,_s=ke(()=>{f();p();jn();ms();Vo=(n,e)=>{let t=e.byteLength,r=dr(n),o=r+dr(t),i=new Uint8Array(o+t);return ur(n,i,0),ur(t,i,r),i.set(e,o),new fr(n,t,e,i)},Cc=n=>{let e=Yt(n),[t,r]=Zr(e),[o,i]=Zr(e.subarray(r)),s=e.subarray(r+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new fr(t,o,s,e)},Oc=(n,e)=>n===e?!0:n.code===e.code&&n.size===e.size&&rc(n.bytes,e.bytes),fr=class{constructor(e,t,r,o){this.code=e,this.size=t,this.digest=r,this.bytes=o}}});var bs={};Qe(bs,{Hasher:()=>ys,from:()=>no});var no,ys,vs=ke(()=>{f();p();_s();no=({name:n,code:e,encode:t})=>new ys(n,e,t),ys=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}async digest(e){if(e instanceof Uint8Array){let t=await this.encode(e);return Vo(this.code,t)}else throw Error("Unknown type, must be binary type")}}});var Ec={};Qe(Ec,{sha256:()=>lb,sha512:()=>ub});var xp,lb,ub,Kp=ke(()=>{f();p();vs();xp=n=>async e=>new Uint8Array(await crypto.subtle.digest(n,e)),lb=no({name:"sha2-256",code:18,encode:xp("SHA-256")}),ub=no({name:"sha2-512",code:19,encode:xp("SHA-512")})});var wc={};Qe(wc,{identity:()=>db});var db,Mp=ke(()=>{f();p();vs();jn();db=no({name:"identity",code:0,encode:n=>Yt(n)})});var Tc={};Qe(Tc,{code:()=>pb,decode:()=>gb,encode:()=>hb,name:()=>fb});var Wp,fb,pb,hb,gb,jp=ke(()=>{f();p();jn();Wp=n=>Yt(n),{name:fb,code:pb,encode:hb,decode:gb}={name:"raw",code:85,decode:Wp,encode:Wp}});var Sc={};Qe(Sc,{code:()=>_b,decode:()=>bb,encode:()=>yb,name:()=>mb});var mb,_b,yb,bb,Bp=ke(()=>{f();p();({name:mb,code:_b,encode:yb,decode:bb}={name:"json",code:512,encode:n=>new TextEncoder().encode(JSON.stringify(n)),decode:n=>JSON.parse(new TextDecoder().decode(n))})});var $e,vb,Cb,Ob,Go,Eb,Up,Xp,Cs,Os,wb,Tb,Sb,Hp=ke(()=>{f();p();ms();_s();yc();gc();jn();$e=class{constructor(e,t,r,o){this.code=t,this.version=e,this.multihash=r,this.bytes=o,this.byteOffset=o.byteOffset,this.byteLength=o.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:Os,byteLength:Os,code:Cs,version:Cs,multihash:Cs,bytes:Cs,_baseCache:Os,asCID:Os})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==Go)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Eb)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $e.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,r=Vo(e,t);return $e.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Oc(this.multihash,e.multihash)}toString(e){let{bytes:t,version:r,_baseCache:o}=this;switch(r){case 0:return Cb(t,o,e||fn.encoder);default:return Ob(t,o,e||Qr.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return Tb(/^0\.0/,Sb),!!(e&&(e[Xp]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof $e)return e;if(e!=null&&e.asCID===e){let{version:t,code:r,multihash:o,bytes:i}=e;return new $e(t,r,o,i||Up(t,r,o.bytes))}else if(e!=null&&e[Xp]===!0){let{version:t,multihash:r,code:o}=e,i=Cc(r);return $e.create(t,o,i)}else return null}static create(e,t,r){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==Go)throw new Error(`Version 0 CID must use dag-pb (code: ${Go}) block encoding`);return new $e(e,t,r,r.bytes)}case 1:{let o=Up(e,t,r.bytes);return new $e(e,t,r,o)}default:throw new Error("Invalid version")}}static createV0(e){return $e.create(0,Go,e)}static createV1(e,t){return $e.create(1,e,t)}static decode(e){let[t,r]=$e.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=$e.inspectBytes(e),r=t.size-t.multihashSize,o=Yt(e.subarray(r,r+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=o.subarray(t.multihashSize-t.digestSize),s=new fr(t.multihashCode,t.digestSize,i,o);return[t.version===0?$e.createV0(s):$e.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,r=()=>{let[c,u]=Zr(e.subarray(t));return t+=u,c},o=r(),i=Go;if(o===18?(o=0,t=0):o===1&&(i=r()),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let s=t,l=r(),g=r(),d=t+g,a=d-s;return{version:o,codec:i,multihashCode:l,digestSize:g,multihashSize:a,size:d}}static parse(e,t){let[r,o]=vb(e,t),i=$e.decode(o);return i._baseCache.set(r,e),i}},vb=(n,e)=>{switch(n[0]){case"Q":{let t=e||fn;return[fn.prefix,t.decode(`${fn.prefix}${n}`)]}case fn.prefix:{let t=e||fn;return[fn.prefix,t.decode(n)]}case Qr.prefix:{let t=e||Qr;return[Qr.prefix,t.decode(n)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[n[0],e.decode(n)]}}},Cb=(n,e,t)=>{let{prefix:r}=t;if(r!==fn.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let o=e.get(r);if(o==null){let i=t.encode(n).slice(1);return e.set(r,i),i}else return o},Ob=(n,e,t)=>{let{prefix:r}=t,o=e.get(r);if(o==null){let i=t.encode(n);return e.set(r,i),i}else return o},Go=112,Eb=18,Up=(n,e,t)=>{let r=dr(n),o=r+dr(e),i=new Uint8Array(o+t.byteLength);return ur(n,i,0),ur(e,i,r),i.set(t,o),i},Xp=Symbol.for("@ipld/js-cid/CID"),Cs={writable:!1,configurable:!1,enumerable:!0},Os={writable:!1,enumerable:!1,configurable:!1},wb="0.0.0-dev",Tb=(n,e)=>{if(n.test(wb))console.warn(e);else throw new Error(e)},Sb=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`});var qp=ke(()=>{f();p();Hp();ms();jn();vs();_s()});var Jp={};Qe(Jp,{CID:()=>$e,bases:()=>Nb,bytes:()=>hs,codecs:()=>Ib,digest:()=>to,hasher:()=>bs,hashes:()=>Rb,varint:()=>eo});var Nb,Rb,Ib,Fp=ke(()=>{f();p();wp();Tp();Sp();Np();Rp();gc();Ip();yc();Dp();Kp();Mp();jp();Bp();qp();Nb={...lc,...uc,...dc,...fc,...pc,...hc,...mc,..._c,...bc},Rb={...Ec,...wc},Ib={raw:Tc,json:Sc}});var Rc=$(ro=>{"use strict";f();p();Object.defineProperty(ro,"__esModule",{value:!0});ro.okxfromString=Db;ro.okxtoString=Ab;ro.alloc=Pb;ro.allocUnsafe=Yp;var $p=(Fp(),Ml(Jp)),Gp=He();function Db(n,e="utf8"){let t=Qp[e];if((0,Gp.logDebug)("okxfromstring ====> "),!t)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${n}`)}function Ab(n,e="utf8"){let t=Qp[e];if((0,Gp.logDebug)("okxtoString ====> "),!t)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(n).substring(1)}function Pb(n=0){return new Uint8Array(n)}function Yp(n=0){return new Uint8Array(n)}function zp(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}var Vp=zp("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),Nc=zp("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++){let r=n[t];r&&String.fromCharCode(r)&&(e+=String.fromCharCode(r))}return e},n=>{n=n.substring(1);let e=Yp(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),Qp=Object.assign({utf8:Vp,"utf-8":Vp,hex:$p.bases.base16,latin1:Nc,ascii:Nc,binary:Nc},$p.bases)});var xt=$(z=>{"use strict";f();p();var Ic=z&&z.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(z,"__esModule",{value:!0});z.chainName2IdMap=z.isValidObject=z.RANDOM_LENGTH=z.isBrowser=z.resolveLocalStorage=z.hasLocalStorage=z.hasBuiltInWebSocket=z.resolveWebSocketImplementation=void 0;z.hexToByteArray=Mb;z.getChainId=Wb;z.toHexString=jb;z.concatUint8Arrays=Bb;z.splitToUint8Arrays=Ub;z.base64encode=qb;z.base64decode=Jb;z.checkWSUrl=Fb;z.hashKey=Pc;z.generateRandomBytes32=th;z.generateTopic=Qb;z.generateGroupId=Zb;z.isInIOSLine=tv;z.isInIOSLark=nv;z.isInIOSChrome=rv;z.isInIOSWeChat=ov;z.isIos=zo;z.getLastSixMd5Hash=iv;z.toSafeBase64FromBase64=sv;z.useShortLink=av;z.replaceChainNameToChainId=cv;z.replaceChainIdToChainName=lv;z.getNamespaceKeyByChain=uv;var Zp=Ic(kr()),Yo=Ic(vm()),Dc=(wm(),Ml(Em)),kb=Om(),eh=Kn(),Es=He(),Lb=Rc(),xb=Ic($l()),Kb=et(),Ac="base16";function Mb(n){if(n.length%2!==0)throw new Error(`Cannot convert ${n} to bytesArray`);let e=new Uint8Array(n.length/2);for(let t=0;t<n.length;t+=2)e[t/2]=parseInt(n.slice(t,t+2),16);return e}function Wb(n){return n.includes(":")?n.split(":")[1]:n}function jb(n){let e="";return n.forEach(t=>{e+=("0"+(t&255).toString(16)).slice(-2)}),e}function Bb(n,e){let t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Ub(n,e){if(e>=n.length)throw new Error("Index is out of buffer");let t=n.slice(0,e),r=n.slice(e);return[t,r]}function Xb(n,e){let t=Yo.default.encodeBase64(n);return e?encodeURIComponent(t):t}function Hb(n,e){return e&&(n=decodeURIComponent(n)),Yo.default.decodeBase64(n)}function qb(n,e){let t;return n instanceof Uint8Array?t=n:(typeof n!="string"&&(n=(0,eh.safeJsonStringify)(n)),t=Yo.default.decodeUTF8(n)),Xb(t,e)}function Jb(n,e){let t=Hb(n,e);return{toString(){return Yo.default.encodeUTF8(t)},toObject(){try{return(0,eh.safeJsonParse)(Yo.default.encodeUTF8(t))}catch{return null}},toUint8Array(){return t}}}function Fb(n){let e=n.match(new RegExp(/^\w+:/,"gi"));if(!e||!e.length)return!1;let t=e[0];return t===void 0?!1:new RegExp("^wss?:").test(t)}var $b=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:WebSocket;z.resolveWebSocketImplementation=$b;var Vb=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u";z.hasBuiltInWebSocket=Vb;var Gb=()=>typeof globalThis<"u"&&typeof globalThis.localStorage<"u"||typeof window<"u"&&typeof window.localStorage<"u";z.hasLocalStorage=Gb;var Yb=()=>typeof globalThis<"u"&&typeof globalThis.localStorage<"u"?globalThis.localStorage:typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:localStorage;z.resolveLocalStorage=Yb;var zb=()=>typeof window<"u";z.isBrowser=zb;z.RANDOM_LENGTH=32;function Pc(n,e=Ac){(0,Es.logDebug)(`hash key called ${n}`);let t=(0,kb.hash)((0,Lb.okxfromString)(n,e));return(0,Dc.toString)(t,e)}function th(){return Zp.default.randomBytes(z.RANDOM_LENGTH)}function Qb(){let n=th();return(0,Es.logDebug)(`generate topic called ${n}`),Pc((0,Dc.toString)(n,Ac))}function Zb(){let n=Zp.default.randomBytes(16);return(0,Es.logDebug)(`generate groupid called ${n}`),Pc((0,Dc.toString)(n,Ac))}var ev=n=>Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length;z.isValidObject=ev;function tv(){return navigator.userAgent.includes("Safari Line/")&&zo()}function nv(){return navigator.userAgent.includes("Lark/")&&zo()}function rv(){return navigator.userAgent.includes("CriOS/")&&zo()}function ov(){return navigator.userAgent.includes("MicroMessenger/")&&zo()}function zo(){let n=navigator.userAgent,e=navigator.maxTouchPoints||0,t=/iPad|iPhone|iPod/.test(n)&&!window.MSStream,r=n.includes("Mac")&&e>1;return(0,Es.logDebug)(`utils isIos >>>isIOSDevice: ${t}    >> isIPadOS: ${r}`),t||r}function iv(n){return xb.default.MD5(n).toString().slice(-6)}function sv(n){return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function av(){return!0}z.chainName2IdMap=new Map;z.chainName2IdMap.set("aptos:mainnet","aptos:637");z.chainName2IdMap.set("movement:testnet","aptos:70000060");z.chainName2IdMap.set("movement:mainnet","aptos:70000066");z.chainName2IdMap.set("soon:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","svm:70000069");z.chainName2IdMap.set("soon:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","svm:70000067");z.chainName2IdMap.set("eclipse:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","svm:70000068");z.chainName2IdMap.set("sonic:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","svm:70000073");function cv(n){return z.chainName2IdMap.forEach((e,t)=>{n.includes(t)&&(n=n.replace(t,e))}),n}function lv(n){return z.chainName2IdMap.forEach((e,t)=>{n.includes(e)&&(n=n.replace(e,t))}),n}function uv(n){for(let[e,t]of Object.entries(Kb.NAMES_CHAINS))if(Object.values(t).includes(n))return e;return n}});var Qo=$(jt=>{"use strict";f();p();var dv=jt&&jt.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),fv=jt&&jt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),pv=jt&&jt.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&dv(t,e,r[o]);return fv(t,e),t}}(),hv=jt&&jt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(jt,"__esModule",{value:!0});jt.Storage=void 0;var oo=Br(),kc=hv(kr()),pr=xt(),Lc=tt(),nt=pv(He()),io=tt(),ws=$l(),Wt=class{constructor(e,t=void 0){let r=(0,pr.resolveLocalStorage)();this.storeKey="",this.cipherIV="",this.subKey=e,nt.logDebug("--------get current local storage --------"),nt.logDebug(r),this.synchronizedCache()}checkAndUpgradeCache(e,t){if(e&&e.length>0&&t&&t.length>0){nt.logDebug("--------get current local storage --------"),nt.logDebug(localStorage);let r=localStorage.getItem(Wt.cacheKey+e);if(typeof r>"u"||r===null){nt.logDebug("no pre cache content");return}nt.logDebug(r),r?.length>0&&(nt.logDebug("write in cache content: ",e,"->",t),localStorage.setItem(Wt.cacheKey+t,r),nt.logDebug("clean in cache content: ",e),localStorage.removeItem(Wt.cacheKey+e))}else nt.logDebug("no pre cache key:",e)}saveContent(e,t,r="-"){let o={id:r,timestamp:Date.now().toString(),content:e};this.saveItem(o,t)}saveItem(e,t){let r=Wt.cacheKey+this.subKey,o=(0,pr.resolveLocalStorage)();nt.logDebug(this.cache),nt.logDebug(`get cache obj: ${this.cache}, ${t}, ${e}`),this.cache[t]=e;let i=(0,Lc.safeJsonStringify)(this.cache);nt.logDebug(`STORAGE: ${t} @ ${this.cache}`),o.setItem(r,i)}getItem(e){return nt.logDebug(`STORAGE >> getItem: ${e} @ ${this.cache}`),this.cache[e]}synchronizedCache(){let e=localStorage.getItem(Wt.cacheKey+this.subKey);if(typeof e>"u"||e===null){nt.logDebug("with no cache"),this.cache={};return}if(nt.logDebug(e),e?.length>0){var t=(0,Lc.safeJsonParse)(e);this.cache=t}nt.logDebug(`get cache obj: ${this.cache}`),(typeof this.cache>"u"||this.cache==null)&&(this.cache={})}getCachedPBKDF2InfoKey(){var e,t,r,o;if(this.storeKey.length>0&&((e=this.cipherIV)===null||e===void 0?void 0:e.length)>0)return{pw:this.storeKey,iv:this.cipherIV};let l=(t=this.getItem(oo.OKXCONNECTOR_STORAGER_CRYPTO_SALT))===null||t===void 0?void 0:t.content;l||(l=(0,pr.toHexString)(kc.default.randomBytes(24)),this.saveContent(l,oo.OKXCONNECTOR_STORAGER_CRYPTO_SALT));let g=(r=this.getItem(oo.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD))===null||r===void 0?void 0:r.content;g||(g=(0,pr.toHexString)(kc.default.randomBytes(32)),this.saveContent(g,oo.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD));let d=(o=this.getItem(oo.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV))===null||o===void 0?void 0:o.content;if(!d){let a=kc.default.randomBytes(16);d=(0,pr.toHexString)(a),this.saveContent(d,oo.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV)}return this.cipherIV=d,this.storeKey=(0,ws.PBKDF2)(g,l,{iterations:10}).toString(),{pw:this.storeKey,iv:this.cipherIV}}encryptStoreMsg(e,t){(0,io.logDebug)(`encryptStoreMsg  encryptStoreMsg start ${Date.now()}`);let r=this.getCachedPBKDF2InfoKey();(0,io.logDebug)(`encryptStoreMsg  encryptStoreMsg mid ${Date.now()}`);var o=ws.AES.encrypt(e,r.pw).toString();this.saveContent(o,t),(0,io.logDebug)(`encryptStoreMsg  encryptStoreMsg end ${Date.now()}`)}getAndDecrypt(e){(0,io.logDebug)(`encryptStoreMsg  getAndDecrypt start ${Date.now()}`);let t=this.getItem(e);if(t&&t.content){let r=this.getCachedPBKDF2InfoKey();(0,io.logDebug)(`encryptStoreMsg  getAndDecrypt mid ${Date.now()}`);let o=ws.AES.decrypt(t.content,r.pw).toString(ws.enc.Utf8);return(0,io.logDebug)(`encryptStoreMsg  getAndDecrypt end ${Date.now()}`),o}return null}clearCache(e=void 0){if(e===void 0){let t=(0,pr.resolveLocalStorage)();this.cache={};let r=Wt.cacheKey+this.subKey;t.setItem(r,"")}else{let t=Wt.cacheKey+this.subKey,r=(0,pr.resolveLocalStorage)();nt.logDebug(this.cache),this.cache[e]=null;let o=(0,Lc.safeJsonStringify)(this.cache);nt.logDebug(`STORAGE: clean key ${e} @ ${this.cache}`),r.setItem(t,o)}}};jt.Storage=Wt;Wt.cacheKey="OKXStorageKey"});var Ss=$(Bt=>{"use strict";f();p();var gv=Bt&&Bt.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),mv=Bt&&Bt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),_v=Bt&&Bt.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&gv(t,e,r[o]);return mv(t,e),t}}(),zt=Bt&&Bt.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.OKXWalletConnector=void 0;var qe=jr(),xc=Br(),yv=Qo(),so=tt(),Ts=xt(),bv=ki(),re=_v(He()),nh=et(),vv=qo(),Cv=(0,Ts.resolveWebSocketImplementation)(),Kc=class{constructor(e){if(this.events=new bv.EventEmitter,this.state=qe.ConnectorState.InitState,this.selectedUrlIndex=0,this.retryCount=0,this.timeOutLimit=8e3,!(0,Ts.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);this.url=e,this.heartbeatTimer=null,this.connectionTimeoutTimer=null,this.connectURLStorage=new yv.Storage(xc.OKXCONNECTOR_CACHE_KEY+xc.OKXCONNECTOR_CACHE_KEY)}get connecting(){return this.state==qe.ConnectorState.Connecting}onPayload(e){if(!(typeof e.data>"u")){if(re.logDebug("get received data"),re.logDebug(e),typeof e.data=="string"&&e.data==="pong"){re.logDebug(`CONNECT: receive pong ${Date.now().toString()}`);return}this.events.emit("payload",e.data)}}onClose(e){var t;re.logDebug("socket get closed: ",(t=this.socket)===null||t===void 0?void 0:t.url,e.code),this.socket=void 0,this.events.emit("close",e)}onError(e,t){let r={id:e,msg:t.toString()};this.events.emit("payload",r)}onopen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.state=qe.ConnectorState.Connected,this.events.emit("open")}emitError(e){this.events.emit("fail",e)}heartbeat(){return zt(this,void 0,void 0,function*(){if(this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.state!=qe.ConnectorState.Connected&&this.state!=qe.ConnectorState.OnError){re.logDebug("heart beat close");return}if(!this.socket){if(re.logDebug("socket not exist"),this.state==qe.ConnectorState.Connected||this.state==qe.ConnectorState.OnError){re.logDebug("socket reconnect by heartbeat");try{yield this.tryRegistOpen()}catch{re.logError("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}return}if(this.socket.readyState!==WebSocket.OPEN){if(re.logDebug("socket not ready"),this.state==qe.ConnectorState.Connected||this.state==qe.ConnectorState.OnError){re.logDebug("socket reconnect by heartbeat with state",this.state,this.socket.readyState);try{yield this.tryRegistOpen()}catch{re.logError("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}return}re.logDebug(`send ping heart beat: ${Date.now().toString()}, ${this.socket}`),this.socket.send("ping"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)})}registOpen(e=this.url,t=!1){if(!(0,Ts.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);this.url=e,t||re.logDebug("Connection connect:",this.url,new Date().toUTCString()),this.state=qe.ConnectorState.Connecting;let r=new URLSearchParams(e).get("origin");return new Promise((o,i)=>{let s=new Cv(e,[]);re.logDebug("Connection connect Begin:",this.url,new Date().toUTCString()),this.startTimeOutTimer(s),(0,Ts.hasBuiltInWebSocket)()?(re.logDebug("Add socket error handler"),s.onerror=()=>{i(new Error("socket error")),s.close()}):(re.logDebug("Add socket error handler"),s.on("error",()=>{i(new Error("socket error")),s.close()})),s.onopen=()=>{re.logDebug("socket opened"),this.resetTimeOutTimer(qe.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.FINISHED),this.onopen(s),this.heartbeat(),o(s)}})}checkMaxRetry(){return re.logDebug("current retry count:",this.retryCount,"of",qe.OKXCONNECTOR_WS_URL_LIST.length),this.retryCount>qe.OKXCONNECTOR_WS_URL_LIST.length*3}connectionTryNext(){return zt(this,void 0,void 0,function*(){if(this.checkMaxRetry())re.logDebug("Max Connection retry ",this.retryCount,new Date().toUTCString());else{this.retryCount+=1;let e=this.getNextSelectUrl();return re.logDebug("Connection retry:",e,new Date().toUTCString()),this.registOpen(e,!0)}})}startTimeOutTimer(e){this.connectionTimeoutTimer&&this.resetTimeOutTimer(qe.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.CANCELED),this.pendingSocket=e,this.connectionTimeoutTimer=setTimeout(()=>{this.pendingSocket&&this.resetTimeOutTimer(qe.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.TIME_OUT)},this.timeOutLimit)}resetTimeOutTimer(e){var t;if(e==qe.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.TIME_OUT)throw clearTimeout(this.connectionTimeoutTimer),(t=this.pendingSocket)===null||t===void 0||t.close(),this.pendingSocket=void 0,re.reportEvent(vv.OKXReportType.LOG,"timeout",this.retryCount.toString()),new Error("socket timeout");this.pendingSocket=void 0,clearTimeout(this.connectionTimeoutTimer)}cacheSuccessUrlSelect(){this.connectURLStorage.saveContent(this.selectedUrlIndex.toString(),xc.OKXCONNECTOR_CACHE_KEY)}getNextSelectUrl(){return this.selectedUrlIndex+=1,this.selectedUrlIndex=this.selectedUrlIndex%qe.OKXCONNECTOR_WS_URL_LIST.length,qe.OKXCONNECTOR_WS_URL_LIST[this.selectedUrlIndex]}onVisibleChanged(){return zt(this,void 0,void 0,function*(){if(document.visibilityState==="visible"&&(re.logDebug(`get changed ${this.state}, ${this.socket}`),this.state==qe.ConnectorState.Connected&&typeof this.socket>"u")){re.logDebug("CONNECTION need reopen");try{yield this.tryRegistOpen()}catch{re.logError("regist open failed")}return}})}tryRegistOpen(){return zt(this,arguments,void 0,function*(e=this.url){if(this.connecting)return re.logDebug("tryRegistOpen => connecting state"),new Promise((r,o)=>{this.events.once("fail",i=>(re.logDebug("tryRegistOpen => connecting fail listener",i),o(i))),this.events.once("open",()=>typeof this.socket>"u"?o(new Error("Connect lost")):r(this.socket))});re.logDebug("tryRegistOpen => try registOpen until retry limit is hit");let t=!1;for(;!this.checkMaxRetry()&&!this.socket;)try{re.logDebug("tryRegistOpen => call registOpen, try count:",this.retryCount,t),yield this.registOpen(e,t)}catch(r){re.logDebug("tryRegistOpen => registOpen failed",r),this.retryCount+=1,e=this.getNextSelectUrl(),t=!0}if(re.logDebug("tryRegistOpen => exit while loop",this.retryCount,this.socket),!this.socket&&this.checkMaxRetry())throw re.logDebug("tryRegistOpen => failed to open a socket",this.retryCount,this.socket),this.retryCount=0,this.state=qe.ConnectorState.OnError,this.emitError(new Error("tryRegistOpen failed")),new nh.OKXConnectError(nh.OKX_CONNECT_ERROR_CODES.CONNECTION_ERROR,"Failed to connect")})}connect(){return zt(this,void 0,void 0,function*(){try{yield this.tryRegistOpen(),document.removeEventListener("visibilitychange",this.onVisibleChanged.bind(this)),document.addEventListener("visibilitychange",this.onVisibleChanged.bind(this))}catch(e){throw re.logDebug("connect => failed to connect",e),e}})}disconnect(){return zt(this,void 0,void 0,function*(){return this.state=qe.ConnectorState.Disconnected,new Promise((e,t)=>{if(typeof this.socket>"u"){e();return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close(),this.heartbeatTimer&&clearTimeout(this.heartbeatTimer)})})}currentStatus(){return{state:this.state,url:this.url}}addListener(e,t,r,o,i){this.listenPayloadHandler&&this.events.removeListener("payload",this.listenPayloadHandler),this.listenPayloadHandler=s=>zt(this,void 0,void 0,function*(){var l;re.logDebug(`<<< get payload ${s}`);let g=(0,so.safeJsonParse)(s);if(g.params&&g.params.data){let d=(l=g.params.data)===null||l===void 0?void 0:l.message,a=!1;if(d&&i){let c=yield i(g.params.data);a=c.isSplitPackage&&!c.finalMessage,c.isSplitPackage&&(c.finalMessage&&c.finalMessage.length>0?(re.logDebug("CONNECT: update raw msg content"),d=c.finalMessage):(re.logDebug("CONNECT: skip raw msg content"),a=!0))}if(!a)try{let c=t(d);c===void 0?(re.logDebug("CONNECT: decrypt undefined"),o(e,"Decrypt undefined")):r(e,c)}catch(c){re.logDebug(`CONNECT: decrypt failed: ${c}`),o(e,c.message)}}}),this.events.on("payload",this.listenPayloadHandler),this.failHandler&&this.events.removeListener("fail",this.failHandler),this.failHandler=s=>{s?(re.logDebug(`CONNECT failed: ${s}`),o(e,s.message)):o(e,"Unkonow error")},this.events.on("fail",this.failHandler)}addPackageParse(e){this.payloadHandler&&this.events.removeListener("payload",this.payloadHandler),this.payloadHandler=t=>zt(this,void 0,void 0,function*(){re.logDebug(`CONNECTION @[${new Date().toUTCString()}] <<<< received e:${t}`);let r=(0,so.safeJsonParse)(t);yield e(r)}),this.events.on("payload",this.payloadHandler)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}send(e,t){return zt(this,void 0,void 0,function*(){try{typeof this.socket>"u"&&(re.logDebug(`>>> send payload undefined ${t}`),yield e()),re.logDebug(`CONNECTION @[${new Date().toUTCString()}]>>> send payload ${(0,so.safeJsonStringify)(t)}`),this.socket&&this.socket.send((0,so.safeJsonStringify)(t))}catch(r){this.onError(t.id,r)}})}getMsgPayloadFromHistory(e){return zt(this,void 0,void 0,function*(){if(typeof e>"u")return;let t={params:{data:e}},r=(0,so.safeJsonStringify)(e);re.logDebug("get received data from history"),re.logDebug(r),r=(0,so.safeJsonStringify)(t),this.events.emit("payload",r)})}onOpen(e){this.openHandler&&this.events.removeListener("open",this.openHandler),this.openHandler=()=>zt(this,void 0,void 0,function*(){re.logDebug(`CONNECTION @[${new Date().toUTCString()}] >>> ws opened: `),yield e()}),this.events.on("open",this.openHandler),this.cacheSuccessUrlSelect()}};Bt.OKXWalletConnector=Kc});var Mc=$(We=>{"use strict";f();p();Object.defineProperty(We,"__esModule",{value:!0});We.CONNECT_METHOD_RECV_DISCONNECT=We.CONNECT_METHOD_DISCONNECT=We.CONNECT_METHOD_BATCH_FETCHMSG=We.CONNECT_METHOD_FETCHMSG=We.CONNECT_METHOD_RECEIVE=We.CONNECT_METHOD_UNSUB=We.CONNECT_METHOD_SUB=We.CONNECT_METHOD_PUBLISH=We.CONNECT_METHOD_LOGIN=We.CONNECT_METHOD_PUSH=void 0;We.CONNECT_METHOD_PUSH="push";We.CONNECT_METHOD_LOGIN="login";We.CONNECT_METHOD_PUBLISH="publish";We.CONNECT_METHOD_SUB="subscribe";We.CONNECT_METHOD_UNSUB="unsubscribe";We.CONNECT_METHOD_RECEIVE="receive";We.CONNECT_METHOD_FETCHMSG="fetchMessages";We.CONNECT_METHOD_BATCH_FETCHMSG="batchFetchMessages";We.CONNECT_METHOD_DISCONNECT="disconnect";We.CONNECT_METHOD_RECV_DISCONNECT="receiveDisconnect"});var Wc=$(Un=>{"use strict";f();p();Object.defineProperty(Un,"__esModule",{value:!0});Un.OKXCONNECTOR_JWT_TTL=Un.OKXCONNECTOR_JWT_WALLET_SIDE=Un.OKXCONNECTOR_JWT_SIDE=void 0;Un.OKXCONNECTOR_JWT_SIDE="wallet";Un.OKXCONNECTOR_JWT_WALLET_SIDE="dapp";Un.OKXCONNECTOR_JWT_TTL=864e5});var Bc=$(co=>{"use strict";f();p();var Ov=co&&co.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(co,"__esModule",{value:!0});co.SessionCrypto=void 0;var ao=Ov(kr()),je=xt(),jc=class{constructor(e=void 0){this.nonceLength=24,this.sessionKeyPair=e?this.createKeypairFromString(e):this.createKeypair()}createKeypair(){return ao.default.box.keyPair()}createKeypairFromString(e){return{publicKey:(0,je.hexToByteArray)(e.publicKey),secretKey:(0,je.hexToByteArray)(e.secretKey)}}createNonce(){return ao.default.randomBytes(this.nonceLength)}get keyPair(){return this.sessionKeyPair}encrypt(e,t){let r=new TextEncoder().encode(e),o=this.createNonce(),i=ao.default.box(r,o,(0,je.hexToByteArray)(t),this.keyPair.secretKey),s=(0,je.concatUint8Arrays)(o,i);var l=(0,je.toHexString)(s),g=new TextEncoder().encode(l);return(0,je.base64encode)(g,!1)}encryptWallet(e,t){let r=new TextEncoder().encode(e),o=this.createNonce(),i=ao.default.box(r,o,(0,je.hexToByteArray)(t),this.keyPair.secretKey),s=(0,je.concatUint8Arrays)(o,i);return(0,je.base64encode)(s,!1)}decrypt(e,t){let o=(0,je.base64decode)(e,!0).toUint8Array(),[i,s]=(0,je.splitToUint8Arrays)(o,this.nonceLength),l=ao.default.box.open(s,i,(0,je.hexToByteArray)(t),this.keyPair.secretKey);if(!l)throw new Error(`Decryption error: 
 message: ${e.toString()} 
 sender pubkey: ${t.toString()} 
 keypair pubkey: ${(0,je.toHexString)(this.keyPair.publicKey)} 
 keypair secretkey: ${(0,je.toHexString)(this.keyPair.secretKey)}`);return new TextDecoder().decode(l)}decryptWallet(e,t){let r=(0,je.base64decode)(e,!0),o=(0,je.hexToByteArray)(r.toString()),[i,s]=(0,je.splitToUint8Arrays)(o,this.nonceLength),l=ao.default.box.open(s,i,(0,je.hexToByteArray)(t),this.keyPair.secretKey);if(!l)throw new Error(`Decryption error: 
 message: ${e.toString()} 
 sender pubkey: ${t.toString()} 
 keypair pubkey: ${(0,je.toHexString)(this.keyPair.publicKey)} 
 keypair secretkey: ${(0,je.toHexString)(this.keyPair.secretKey)}`);return new TextDecoder().decode(l)}stringifyKeypair(){return{publicKey:(0,je.toHexString)(this.keyPair.publicKey),secretKey:(0,je.toHexString)(this.keyPair.secretKey)}}};co.SessionCrypto=jc});var Uc=$(U=>{"use strict";f();p();var Ev=U&&U.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),wv=U&&U.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),rh=U&&U.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&Ev(t,e,r[o]);return wv(t,e),t}}(),oh=U&&U.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})},Tv=U&&U.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(U,"__esModule",{value:!0});U.MULTICODEC_ED25519_LENGTH=U.MULTICODEC_ED25519_HEADER=U.MULTICODEC_ED25519_BASE=U.MULTICODEC_ED25519_ENCODING=U.DID_METHOD=U.DID_PREFIX=U.DID_DELIMITER=U.KEY_PAIR_SEED_LENGTH=U.DATA_ENCODING=U.JSON_ENCODING=U.JWT_ENCODING=U.JWT_DELIMITER=U.JWT_IRIDIUM_TYP=U.JWT_IRIDIUM_ALG=U.JWTHeaderType=void 0;U.generateKeyPair=Rv;U.decodeJSON=Zo;U.encodeJSON=ei;U.encodeIss=ch;U.decodeIss=lh;U.encodeSig=uh;U.decodeSig=dh;U.encodeData=fh;U.decodeData=Iv;U.encodeJWT=ph;U.decodeJWT=hh;U.signJWT=Dv;U.verifyJWT=Av;var Sv=rh(Cm()),ih=Kn(),Nv=xt(),sh=Tv(kr()),ah=rh(He()),Qt=Rc();U.JWTHeaderType="dapp";U.JWT_IRIDIUM_ALG="EdDSA";U.JWT_IRIDIUM_TYP="JWT";U.JWT_DELIMITER=".";U.JWT_ENCODING="base64url";U.JSON_ENCODING="utf8";U.DATA_ENCODING="utf8";U.KEY_PAIR_SEED_LENGTH=32;U.DID_DELIMITER=":";U.DID_PREFIX="did";U.DID_METHOD="key";U.MULTICODEC_ED25519_ENCODING="base58btc";U.MULTICODEC_ED25519_BASE="z";U.MULTICODEC_ED25519_HEADER="K36";U.MULTICODEC_ED25519_LENGTH=32;function Rv(){return sh.default.sign.keyPair()}function Zo(n){return(0,ih.safeJsonParse)((0,Qt.okxtoString)((0,Qt.okxfromString)(n,U.JWT_ENCODING),U.JSON_ENCODING))}function ei(n){return(0,Qt.okxtoString)((0,Qt.okxfromString)((0,ih.safeJsonStringify)(n),U.JSON_ENCODING),U.JWT_ENCODING)}function ch(n){ah.logDebug(`publicKey: ${(0,Nv.toHexString)(n)}`);var e=(0,Qt.okxtoString)(n,U.MULTICODEC_ED25519_ENCODING);return[U.DID_PREFIX,U.DID_METHOD,e].join(U.DID_DELIMITER)}function lh(n){let[e,t,r]=n.split(U.DID_DELIMITER);if(e!==U.DID_PREFIX||t!==U.DID_METHOD)throw new Error('Issuer must be a DID with method "key"');if(r===void 0)throw new Error("multicodec is undefined");let o=(0,Qt.okxfromString)(r,U.MULTICODEC_ED25519_ENCODING);if(o===void 0||o.length!==U.MULTICODEC_ED25519_LENGTH)throw new Error("Issuer must be a public key with length 32 bytes");return o}function uh(n){return(0,Qt.okxtoString)(n,U.JWT_ENCODING)}function dh(n){return(0,Qt.okxfromString)(n,U.JWT_ENCODING)}function fh(n){return(0,Qt.okxfromString)([ei(n.header),ei(n.payload)].join(U.JWT_DELIMITER),U.DATA_ENCODING)}function Iv(n){var e,t;let r=(0,Qt.okxtoString)(n,U.DATA_ENCODING).split(U.JWT_DELIMITER),o=Zo((e=r[0])!==null&&e!==void 0?e:"{}"),i=Zo((t=r[1])!==null&&t!==void 0?t:"{}");return{header:o,payload:i}}function ph(n){return[ei(n.header),ei(n.payload),uh(n.signature)].join(U.JWT_DELIMITER)}function hh(n){var e,t,r;let o=n.split(U.JWT_DELIMITER),i=Zo((e=o[0])!==null&&e!==void 0?e:"{}"),s=Zo((t=o[1])!==null&&t!==void 0?t:"{}"),l=dh((r=o[2])!==null&&r!==void 0?r:"{}"),g=(0,Qt.okxfromString)(o.slice(0,2).join(U.JWT_DELIMITER),U.DATA_ENCODING);return{header:i,payload:s,signature:l,data:g}}function Dv(n,e,t,r){return oh(this,arguments,void 0,function*(o,i,s,l,g=Math.floor(Date.now())){let d={alg:U.JWT_IRIDIUM_ALG,typ:U.JWT_IRIDIUM_TYP},a=ch(l.publicKey),c=g+s,_={iss:a,sub:o,aud:i,act:"authenticate user",iat:g,exp:c},y=fh({header:d,payload:_});ah.logDebug(`get sec kp: ${l.secretKey} {${l.secretKey.length}}`);let N=sh.default.sign.detached(y,l.secretKey);return ph({header:d,payload:_,signature:N})})}function Av(n){return oh(this,void 0,void 0,function*(){let{header:e,payload:t,data:r,signature:o}=hh(n);if(e.alg!==U.JWT_IRIDIUM_ALG||e.typ!==U.JWT_IRIDIUM_TYP)throw new Error("JWT must use EdDSA algorithm");let i=lh(t.iss);return Sv.verify(i,r,o)})}});var Hc=$(_t=>{"use strict";f();p();var Pv=_t&&_t.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),kv=_t&&_t.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Lv=_t&&_t.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&Pv(t,e,r[o]);return kv(t,e),t}}(),hr=_t&&_t.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})},xv=_t&&_t.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(_t,"__esModule",{value:!0});_t.ConnectionSplitPackages=void 0;var Kv=Br(),Mv=xv(us()),Wv=xt(),lo=Kn(),gr=Lv(He()),pn=He(),gh=2,mh=63e3,_h="ConnectionReceiveKey",yh="ConnectionSendKey",bh="ConnectionSenderVersionKey",Xc=class{constructor(e){this.splitMessageSendArray=new Map,this.splitMessageReceivedArray=new Map,this.splitMessageSenderVersionMap=new Map,this.splitPackageCache=Mv.default.createInstance({name:Kv.OKXCONNECTOR_STORAGE_PROTOCOL_CACHE+e})}init(e){return hr(this,void 0,void 0,function*(){if(yield this.recoverFromCache(),this.splitMessageSendArray.size>0){for(let[t,r]of this.splitMessageSendArray.entries())for(let o=0;o<r.length;){let i=r[o];try{yield e((0,lo.safeJsonStringify)(i),t),gr.logDebug(`Successfully sent payload: ${(0,lo.safeJsonStringify)(i)} to topic: ${t}`),r.splice(o,1)}catch(s){gr.logError(`Failed to send payload: ${(0,lo.safeJsonStringify)(i)} to topic: ${t}`,s),i.retryCount=(i.retryCount||0)+1,i.retryCount>3?(gr.logError(`Payload failed after 3 retries: ${(0,lo.safeJsonStringify)(i)}`),r.splice(o,1)):o++}}yield this.syncCache()}})}tryParseMessageSplitPayload(e){var t;let r;try{if(e.trimStart().startsWith("{")){let o=(0,lo.safeJsonParse)(e);if(o&&o.protocol_version&&o.protocol_version>=2){let i=o;i.package_group_id&&((t=i.package_group_id)===null||t===void 0?void 0:t.length)>0&&(r=o)}}else(0,pn.logDebug)("not split packages")}catch{(0,pn.logDebug)("not split packages")}return r}updateTopicSenderVersion(e,t){return hr(this,void 0,void 0,function*(){this.splitMessageSenderVersionMap.set(e,t),yield this.syncCache(),(0,pn.logDebug)("get update topic sender version: ",e,t)})}sendSplitPackages(e,t,r,o){return hr(this,void 0,void 0,function*(){if(!e){gr.logError("sendSplitPackages invalid topic");return}let i=this.splitMessageSenderVersionMap.get(e),s=t.length;try{if(s<mh)throw new Error(`no need to split (size:${s})`);if(!i||i&&i<gh)throw new Error(`version not support split (version: ${i})`);let l=[],g=mh;for(let c=0;c<t.length;c+=g)c+g<t.length?l.push(t.slice(c,c+g)):l.push(t.slice(c));let d=(0,Wv.generateGroupId)(),a=l.map((c,u)=>({topicId:e,protocol_version:gh,total_count:l.length,package_index:u,package_group_id:d,content:c}));this.mergePackageArray(!0,a);for(let c=0;c<a.length;){let u=a[c],_=(0,lo.safeJsonStringify)(u);try{yield o(_,e),gr.logDebug(`Successfully sent payload: ${_} to topic: ${e}`),a.splice(c,1)}catch(y){gr.logError(`Failed to send payload: ${_} to topic: ${e}`,y),u.retryCount=(u.retryCount||0)+1,u.retryCount>3?(gr.logError(`Payload failed after 3 retries: ${_}`),a.splice(c,1)):c++}}this.splitMessageSendArray.set(e,[]),yield this.syncCache()}catch(l){(0,pn.logDebug)("send split packages no split"),(0,pn.logDebug)(l),yield r(e,t)}})}onReceivedPackageCheck(e){return hr(this,void 0,void 0,function*(){this.mergePackageArray(!1,[e]);let t=new Map,r=e.topicId;this.splitMessageReceivedArray.forEach((i,s)=>{s==e.topicId&&i.forEach(l=>{if(l.messageObject.package_group_id){let g=t.get(l.messageObject.package_group_id);g||(g=new Array),g.push(l),t.set(l.messageObject.package_group_id,g)}})}),(0,pn.logDebug)("on received message, check message cache");let o={isSplitPackage:!1};if(e.messageObject.package_group_id){o.isSplitPackage=!0;let i=t.get(e.messageObject.package_group_id);if(i?.length){let s=new Set;if(i.forEach(l=>{l.messageObject.package_index!==void 0&&s.add(l.messageObject.package_index)}),s.size==e.messageObject.total_count){i.sort((a,c)=>(a.messageObject.package_index||a.messageObject.package_index===0)&&(c.messageObject.package_index||c.messageObject.package_index===0)?a.messageObject.package_index-c.messageObject.package_index:0);let l=i.reduce((a,c)=>(a.push(c.messageObject.content),a),[]),g=i.reduce((a,c)=>(a.push(c.messageId),a),[]);o.isSplitPackage=!0,o.finalMessage=l.join(""),o.completeMessageIdList=g;let d=this.splitMessageReceivedArray.get(r);d&&(d=d.filter(a=>!g.includes(a.messageId)),this.splitMessageReceivedArray.set(r,d)),yield this.syncCache()}}}return o})}mergePackageArray(e,t){return hr(this,void 0,void 0,function*(){if((0,pn.logDebug)("append sending array"),e){let o=t.filter(i=>{let s=i.topicId,l=!0,g=this.splitMessageSendArray.get(s);return g?.forEach(d=>{d.package_group_id==i.package_group_id&&d.total_count==i.total_count&&d.package_index==i.package_index&&(l=!1)}),l});if(o.length>0){let i=o[0].topicId,s=this.splitMessageSendArray.get(i);s||(s=new Array),s=s.concat(o),this.splitMessageSendArray.set(i,s),(0,pn.logDebug)("append sending array (after filted): ",s)}}else{let o=t.filter(i=>{let s=i.topicId,l=!0,g=this.splitMessageReceivedArray.get(s);return g?.forEach(d=>{d.messageId==i.messageId&&(l=!1)}),l});if(o.length>0){let i=o[0].topicId,s=this.splitMessageReceivedArray.get(i);s||(s=new Array),s=s.concat(o),this.splitMessageReceivedArray.set(i,s),(0,pn.logDebug)("append received array (after filted): ",s)}}})}syncCache(){return hr(this,void 0,void 0,function*(){(0,pn.logDebug)("sync split message cache"),yield this.splitPackageCache.setItem(_h,this.splitMessageReceivedArray),yield this.splitPackageCache.setItem(yh,this.splitMessageSendArray),yield this.splitPackageCache.setItem(bh,this.splitMessageSenderVersionMap)})}recoverFromCache(){return hr(this,void 0,void 0,function*(){let e=yield this.splitPackageCache.getItem(_h);e?this.splitMessageReceivedArray=e:this.splitMessageReceivedArray=new Map;let t=yield this.splitPackageCache.getItem(yh);t?this.splitMessageSendArray=t:this.splitMessageSendArray=new Map;let r=yield this.splitPackageCache.getItem(bh);r?this.splitMessageSenderVersionMap=r:this.splitMessageSenderVersionMap=new Map})}};_t.ConnectionSplitPackages=Xc});var $c=$(Ut=>{"use strict";f();p();var jv=Ut&&Ut.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Bv=Ut&&Ut.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Uv=Ut&&Ut.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&jv(t,e,r[o]);return Bv(t,e),t}}(),ge=Ut&&Ut.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.ConnectionManager=void 0;var Xv=Ss(),hn=Mc(),Ae=Br(),vh=Wc(),at=jr(),Hv=ki(),Ch=Qo(),uo=xt(),qc=Bc(),Jc=Uc(),wt=Kn(),M=Uv(He()),Je=He(),Ns=qo(),qv=Vr(),Jv=Hc(),Fc=class{constructor(e=void 0){this.events=new Hv.EventEmitter,this.splitManager=new Jv.ConnectionSplitPackages("dapp"),this.connectorEnable=!1,this.connectStorage=new Ch.Storage(Ae.OKXCONNECTOR_CACHE_KEY_DAPP+e,Ae.OKXCONNECTOR_CACHE_KEY_DAPP),this.tonsdkConnectStorage=new Ch.Storage(Ae.OKXCONNECTOR_TON_KEY+e,Ae.OKXCONNECTOR_TON_KEY),this.crypto=new qc.SessionCrypto;let t=(0,qv.isInTMA)();if((0,Je.logDebug)("do init:",t),M.reportLog("connection manager do init"),t)try{let r=this.getCachedCryptoKeyPair();(0,Je.logDebug)("use same pk:",r),this.crypto=new qc.SessionCrypto(r)}catch{this.connectStorage.clearCache(),M.reportEvent(Ns.OKXReportType.LOG,"cache_fail","cache failed")}this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new Xv.OKXWalletConnector(at.OKXCONNECTOR_WS_URL_1),this.packageId=Date.now(),this.connectedWalletPK="",this.currentTopic="",M.logDebug(`this.connectedWalletPK  constructor   ${this.connectedWalletPK}`)}refreshPackageId(){let e=Date.now();e==this.packageId&&(this.packageId=e+1),this.packageId=e}saveCryptoKeyPair(e){let t=(0,wt.safeJsonStringify)(e);this.connectStorage.encryptStoreMsg(t,Ae.OKXCONNECTOR_CRYPTO_KEY)}getCachedCryptoKeyPair(){let t=this.connectStorage.getAndDecrypt(Ae.OKXCONNECTOR_CRYPTO_KEY);return typeof t=="string"?(M.logDebug("get cached crypto key:"),M.logDebug(t),(0,wt.safeJsonParse)(t)):(this.connectStorage.clearCache(),null)}saveJWTKeyPair(e){var t={publicKey:(0,uo.toHexString)(e.publicKey),secretKey:(0,uo.toHexString)(e.secretKey)};M.logDebug("save jwt kp");let r=(0,wt.safeJsonStringify)(t);M.logDebug(r),this.connectStorage.encryptStoreMsg(r,Ae.OKXCONNECTOR_JWT_KEY)}getCachedJWTKeyPair(){try{let r=this.connectStorage.getAndDecrypt(Ae.OKXCONNECTOR_JWT_KEY);if(typeof r=="string"){M.logDebug("get cached jwt kp:"),M.logDebug(r);let o=(0,wt.safeJsonParse)(r);M.logDebug("save jwt kp"),M.logDebug(o);var e={publicKey:(0,uo.hexToByteArray)(o.publicKey),secretKey:(0,uo.hexToByteArray)(o.secretKey)};return e}else return(0,Jc.generateKeyPair)()}catch{return M.reportEvent(Ns.OKXReportType.LOG,"cache_fail","cache failed"),(0,Jc.generateKeyPair)()}}isWalletPKReady(){return M.logDebug(`isWalletPKReady  ===> ${this.connectedWalletPK}`),this.connectedWalletPK.length>0}makeJWT(e){return ge(this,void 0,void 0,function*(){return yield(0,Jc.signJWT)(e,vh.OKXCONNECTOR_JWT_SIDE,vh.OKXCONNECTOR_JWT_TTL,this.jwtKeyPair)})}parsePackage(e){return ge(this,arguments,void 0,function*(t,r=!1){var o,i,s,l,g,d,a,c,u,_,y,N,X;if(this.events.emit(t.id,t),!r){yield this.sendACK(t.id,!0);let D=(o=this.connectStorage.getItem(Ae.OKXCONNECTOR_TOKEN_CACHE))===null||o===void 0?void 0:o.content;if(D){let T=t;if(!((s=(i=T.params)===null||i===void 0?void 0:i.data)===null||s===void 0)&&s.messageId){T.method&&T.method===hn.CONNECT_METHOD_PUSH&&((0,Je.logDebug)("checkExpire: update expire when get push"),this.updateExpireLimit(D));let L=this.splitManager.tryParseMessageSplitPayload((g=(l=T.params)===null||l===void 0?void 0:l.data)===null||g===void 0?void 0:g.message);if(L){let H={topicId:(a=(d=T.params)===null||d===void 0?void 0:d.data)===null||a===void 0?void 0:a.topic,messageId:(u=(c=T.params)===null||c===void 0?void 0:c.data)===null||u===void 0?void 0:u.messageId,messageObject:L,publishedAt:(y=(_=T.params)===null||_===void 0?void 0:_.data)===null||y===void 0?void 0:y.publishedAt},F=yield this.splitManager.onReceivedPackageCheck(H);F.completeMessageIdList&&F.completeMessageIdList.forEach(S=>ge(this,void 0,void 0,function*(){this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),S,D)}))}else this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),(X=(N=T.params)===null||N===void 0?void 0:N.data)===null||X===void 0?void 0:X.messageId,D)}}}})}restoreConnect(e){return ge(this,void 0,void 0,function*(){if(M.reportLog("connection manager restore connection"),M.logDebug(`connectionManager  restoreConenct   ${e}`),typeof e!="string"||e.length===0)throw new Error("CONNECTION: invalid topic");M.logDebug("connectionManager  restoreConenct   disconnect"),yield this.disconnect(!0),this.connectStorage.saveContent(e,Ae.OKXCONNECTOR_TOKEN_CACHE),M.logDebug("connectionManager  restoreConenct   conect"),yield this.connect(!0)})}getConnectInfo(){var e=(0,uo.generateTopic)();return M.logDebug(`generate topic token: ${e}`),M.reportLog("connection manager generate connection info"),this.currentTopic=e,{channelId:e,clientId:this.crypto.stringifyKeypair().publicKey}}connect(){return ge(this,arguments,void 0,function*(e=!1){this.timeLog=new Date().getTime(),(0,Je.logDebug)("ConnectTime---enter->",this.timeLog),M.reportLog("connection manager begin connect");let t=this.connectStorage.getItem(Ae.OKXCONNECTOR_TOKEN_CACHE);var r=this.currentTopic;if(M.logDebug(`generate topic token: ${r}`),e){typeof t<"u"&&t!==null&&(M.logDebug(`read last connect id: ${t}`),r=t.content);var o=this.connectStorage.getItem(Ae.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE);o&&(this.connectedWalletPK=o.content,(0,Je.logDebug)(`connectionManager connect() this.connectedWalletPK : ${this.connectedWalletPK}`)),M.reportLog("connection manager do restore connection")}if(e)try{let s=this.getCachedCryptoKeyPair();s&&(this.crypto=new qc.SessionCrypto(s))}catch{throw M.logError("get crypto key pair from cache failed"),M.reportEvent(Ns.OKXReportType.LOG,"cache_fail","cache failed"),this.connectStorage.clearCache(),new Error("crypto cache failed")}M.logDebug(`use crypto client id: ${this.crypto.stringifyKeypair().publicKey}`),this.connectStorage.saveContent(r,Ae.OKXCONNECTOR_TOKEN_CACHE);var i=yield this.makeJWT(r);return M.logDebug(`generate jwt token: ${i}`),this.connectStorage.saveContent(i,"jwt"),new Promise((s,l)=>{this.connector.onOpen(()=>ge(this,void 0,void 0,function*(){M.logDebug("1. connector on open"),M.reportLog("1. connect ws open");let g=new Date().getTime();(0,Je.logDebug)("ConnectTime---open->",g-this.timeLog),this.events.once(this.packageId.toString(),d=>ge(this,void 0,void 0,function*(){if(d&&d.error){M.logError("failed when login"),M.reportLog("2. connect login failed"),yield this.connector.disconnect();var a=new Error;a.message=d.error.message,a.name=d.error.code.toString(),l(a)}this.refreshPackageId(),this.events.once(this.packageId.toString(),u=>ge(this,void 0,void 0,function*(){if(u&&u.error){M.logError("failed when subscribe"),M.reportLog("3. connect subscribe failed"),yield this.connector.disconnect();var _=new Error;_.message=u.error.message,_.name=u.error.code.toString(),l(_)}this.refreshPackageId(),M.logDebug(`4. subscribe callback then send fetch: ${this.packageId}`),M.reportLog("4. subscribe callback then send fetch");let y=new Date().getTime();(0,Je.logDebug)("ConnectTime--subscribe callback->",y-this.timeLog),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),r),M.logDebug(`5. splitmanager init: ${this.packageId}`),M.reportLog("5. splitmanager init"),yield this.splitManager.init(this.sendRaw.bind(this)),e&&(this.checkExpire(r)?((0,Je.logDebug)("disconnect From topic expire"),setTimeout(()=>{this.activateDisconnect()},1e3)):((0,Je.logDebug)("extends expire check"),this.updateExpireLimit(r))),s()})),M.logDebug(`3. login callback then send subscribe: ${this.packageId}`),M.reportLog("3. connect subscribe failed");let c=new Date().getTime();(0,Je.logDebug)("ConnectTime---login callback->",c-this.timeLog),yield this.connector.send(()=>ge(this,void 0,void 0,function*(){M.logDebug("CONNECT: reconnect before send"),yield this.connector.connect().catch(u=>{(0,Je.logDebug)("ConnectionManager connect error",u),l(u)})}),{id:this.packageId.toString(),jsonrpc:at.CONNECT_JSONRPC_VER,method:hn.CONNECT_METHOD_SUB,params:{topic:r}})})),M.logDebug("2. login called"),M.reportLog("2. connection manager connect call login"),yield this.connector.send(()=>ge(this,void 0,void 0,function*(){M.logDebug("CONNECT: reconnect before send"),yield this.connector.connect().catch(d=>{(0,Je.logDebug)("ConnectionManager connect error",d),l(d)})}),{id:this.packageId.toString(),jsonrpc:at.CONNECT_JSONRPC_VER,method:hn.CONNECT_METHOD_LOGIN,params:{token:i}}),this.connector.addPackageParse(d=>{var a;if(M.logDebug("connect: parse package"),M.logDebug(d),!("params"in d)||!("data"in d.params)){this.parsePackage(d,!0);return}let c=(a=d.params.data)===null||a===void 0?void 0:a.message;if(typeof c<"u"&&c.length>0){c=c.replace(/'/g,'"');let u=(0,wt.safeJsonParse)(c);typeof u!="string"&&"clientId"in u&&u.clientId&&u.clientId.length>0&&(this.connectedWalletPK=u.clientId,M.logDebug(`this.connectedWalletPK  addPackageParse   ${this.connectedWalletPK}`),this.connectStorage.saveContent(this.connectedWalletPK,Ae.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),this.saveCryptoKeyPair(this.crypto.stringifyKeypair()))}this.parsePackage(d,d.method===hn.CONNECT_METHOD_RECEIVE)})})),this.connector.connect().catch(g=>{(0,Je.logDebug)("ConnectionManager connect error",g),l(g)}),this.connectorEnable=!0})})}sendDisconnect(e){return ge(this,void 0,void 0,function*(){return new Promise((t,r)=>ge(this,void 0,void 0,function*(){if(this.refreshPackageId(),!this.connectorEnable){M.logDebug("skip disconnect before connected relay"),t();return}this.events.once(this.packageId.toString(),i=>ge(this,void 0,void 0,function*(){M.logDebug("CONNECT: disconnect command send"),this.connectorEnable=!1,t()}));let o={id:this.packageId.toString(),jsonrpc:at.CONNECT_JSONRPC_VER,method:hn.CONNECT_METHOD_DISCONNECT,params:{message:{topic:e,ttl:at.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL}}};yield this.connector.send(()=>ge(this,void 0,void 0,function*(){M.logDebug("CONNECT: skip reconnect send")}),o)}))})}sendRecvDisconnect(e){return ge(this,void 0,void 0,function*(){this.refreshPackageId();let t={id:this.packageId.toString(),jsonrpc:at.CONNECT_JSONRPC_VER,method:hn.CONNECT_METHOD_RECV_DISCONNECT,params:{topic:e}};yield this.connector.send(()=>ge(this,void 0,void 0,function*(){return M.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),t)})}disconnect(){return ge(this,arguments,void 0,function*(e=!1){try{yield this.sendDisconnect(this.currentTopic)}catch(t){M.logError("send disconnect command failed",t)}yield this.connector.disconnect(),M.reportLog("connect disconnect"),this.connectStorage.clearCache(Ae.OKXCONNECTOR_TOKEN_CACHE),e||(this.connectStorage.clearCache(Ae.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),this.connectedWalletPK="",(0,Je.logDebug)(`connectionManager disconnect() this.connectedWalletPK : ${this.connectedWalletPK}`))})}updateProtocolVersion(e,t){this.splitManager.updateTopicSenderVersion(e,t)}addListener(e,t,r){this.connector.addListener((0,wt.safeJsonStringify)(e),o=>{if(o=o.replace(/'/g,'"'),M.logDebug(`addListener ===> ${o}`),typeof o<"u"&&o.length>0){var i=(0,wt.safeJsonParse)(o),s=i.message;let l;return s.trimStart().startsWith("{")?l=s:(i.clientId&&i.clientId.length>0&&(this.connectedWalletPK=i.clientId,this.connectStorage.saveContent(this.connectedWalletPK,Ae.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),M.logDebug(`this.connectedWalletPK  addListener   ${this.connectedWalletPK}`),M.logDebug(`this.cryptoKey  addListener   ${(0,uo.toHexString)(this.crypto.keyPair.publicKey)}`),this.saveCryptoKeyPair(this.crypto.stringifyKeypair())),l=this.crypto.decrypt(s,this.connectedWalletPK)),M.logDebug(`addListener ===> ${l}`),l}},t,r,o=>new Promise((i,s)=>ge(this,void 0,void 0,function*(){let l=this.splitManager.tryParseMessageSplitPayload(o.message);if(l){let g={topicId:o.topic,messageId:o?.messageId,messageObject:l,publishedAt:o?.publishedAt},d=yield this.splitManager.onReceivedPackageCheck(g);i(d)}else i({isSplitPackage:!1})})))}sendRaw(e){return ge(this,void 0,void 0,function*(){M.logDebug(`message send =====> ${e}`),M.reportLog("connect send raw msg");let t=e;M.logDebug(`message send =====encrypt message.length>>>> ${t.length}`);let r=this.connectStorage.getItem(Ae.OKXCONNECTOR_TOKEN_CACHE);M.logDebug(`message send =====topic>>>> ${r?.content}`),this.refreshPackageId();let o={id:this.packageId.toString(),method:hn.CONNECT_METHOD_PUBLISH,jsonrpc:at.CONNECT_JSONRPC_VER,params:{message:{topic:r?.content,message:t,ttl:at.OKXCONNECTOR_MESSAGE_TTL}}};return this.events.once(this.packageId.toString(),i=>ge(this,void 0,void 0,function*(){i&&i.error?M.logError(`@${new Date().toUTCString()} >>> failed when send msg`):i&&!i.error&&M.logDebug(`CONNECTION @[${new Date().toUTCString()}] >>> send msg with id ${this.packageId} successed`)})),yield this.connector.send(()=>ge(this,void 0,void 0,function*(){return M.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o),this.packageId})}sendEncryptedMsg(e,t){return ge(this,arguments,void 0,function*(r,o,i=at.OKXCONNECTOR_MESSAGE_TTL){this.refreshPackageId();let s={id:this.packageId.toString(),method:hn.CONNECT_METHOD_PUBLISH,jsonrpc:at.CONNECT_JSONRPC_VER,params:{message:{topic:r,message:o,ttl:i}}};this.events.once(this.packageId.toString(),l=>ge(this,void 0,void 0,function*(){l&&l.error?M.logError(`@${new Date().toUTCString()} >>> failed when send msg`):l&&!l.error&&M.logDebug(`CONNECTION @[${new Date().toUTCString()}] >>> send msg with id ${this.packageId} successed`)})),yield this.connector.send(()=>ge(this,void 0,void 0,function*(){return M.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)})}send(e){return ge(this,arguments,void 0,function*(t,r=at.OKXCONNECTOR_MESSAGE_TTL){if(M.logDebug(`message send =====> ${t}`),M.reportLog("connect send msg"),!this.isWalletPKReady())throw new Error("connection not finish");let o=this.crypto.encrypt(t,this.connectedWalletPK);M.logDebug(`message send =====encrypt message.length>>>> ${o.length}`),M.reportEvent(Ns.OKXReportType.LOG,"msg_size",o.length.toString());let i=this.connectStorage.getItem(Ae.OKXCONNECTOR_TOKEN_CACHE);return M.logDebug(`message send =====topic>>>> ${i?.content}`),yield this.splitManager.sendSplitPackages(i?.content,o,this.sendEncryptedMsg.bind(this),this.sendRaw.bind(this)),this.packageId})}sendACK(e,t){return ge(this,arguments,void 0,function*(r,o,i=void 0){if(o===!0){let s={id:r,jsonrpc:at.CONNECT_JSONRPC_VER,result:!0};yield this.connector.send(()=>ge(this,void 0,void 0,function*(){return M.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)}else if(i){let s={id:r,jsonrpc:at.CONNECT_JSONRPC_VER,error:{code:i.code,message:i.message}};yield this.connector.send(()=>ge(this,void 0,void 0,function*(){return M.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)}})}sendReceive(e,t,r){return ge(this,void 0,void 0,function*(){let o={id:e,jsonrpc:at.CONNECT_JSONRPC_VER,method:hn.CONNECT_METHOD_RECEIVE,params:{data:{messageId:t,topic:r}}};yield this.connector.send(()=>ge(this,void 0,void 0,function*(){return M.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}sendFetchAndConsumeMessages(e,t){return ge(this,void 0,void 0,function*(){this.events.once(e,i=>ge(this,void 0,void 0,function*(){var s,l;if(i.result){var g=i.result.hasMore,d=i.result.data;let a=i.result.disconnectedTopics;if(a)try{for(let c=0;c<a.length;c++){let u=a[c];if(u.topic){(0,Je.logDebug)("send receive disconnect:",u.topic),yield this.sendRecvDisconnect(u.topic);let _=(0,wt.safeJsonStringify)({requestId:u.publishedAt.toString(),method:"disconnect"}),y={messageId:u.publishedAt.toString(),message:(0,wt.safeJsonStringify)({message:_}),topic:u.topic,publishedAt:u.publishedAt};yield this.connector.getMsgPayloadFromHistory(y)}}}catch(c){M.logError("disconnect topic fails",c)}if(d)for(let c=0;c<d.length;c++){let u=d[c];if(u&&u.topic==t){let _=u.messageId;M.reportLog("5. get fetch result"),this.splitManager.tryParseMessageSplitPayload(u.message)?(yield this.connector.getMsgPayloadFromHistory(u),M.logDebug("skip receive")):(yield this.connector.getMsgPayloadFromHistory(u),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),_,t))}}g&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else M.logDebug(`CONNECT: get error rsp ${(s=i.error)===null||s===void 0?void 0:s.code} : ${(l=i.error)===null||l===void 0?void 0:l.message}`)})),M.logDebug("5. send fetch more"),M.reportLog("5. send fetch more");let r=new Date().getTime();(0,Je.logDebug)("ConnectTime---5->",r-this.timeLog);let o={id:e,jsonrpc:at.CONNECT_JSONRPC_VER,method:hn.CONNECT_METHOD_FETCHMSG,params:{data:{topic:t}}};yield this.connector.send(()=>ge(this,void 0,void 0,function*(){return M.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}cleanCache(){M.reportLog("connection cache clean called"),this.connectStorage.clearCache()}saveSessionContent(e,t){t||this.connectStorage.clearCache(Ae.OKXCONNECTOR_SESSION_PREFIX_KEY+e);let r=(0,wt.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(r,Ae.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}getSessionContent(e){try{let t=this.connectStorage.getAndDecrypt(Ae.OKXCONNECTOR_SESSION_PREFIX_KEY+e);if(t)return(0,wt.safeJsonParse)(t)}catch{this.connectStorage.clearCache(Ae.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}}getCurrentConnectionReady(){let e=!1;try{this.getCachedCryptoKeyPair()&&(e=!0)}catch{M.logError("check connection ready failed")}return this.isWalletPKReady()&&e}getCryptoKeyEnable(){let e=!1;try{this.getCachedCryptoKeyPair()&&(e=!0)}catch{M.logError("check connection ready failed")}return e}checkExpire(e){let t=!1;if(e.length==0)return(0,Je.logDebug)("checkExpire: invalid topic"),t;let r=this.getSessionContent(Ae.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE);return r&&r.topic?r.topic==e?Date.now()>r.timestamp&&((0,Je.logDebug)("checkExpire: connection is Expired"),t=!0):((0,Je.logDebug)("checkExpire: not same connection"),t=!1):((0,Je.logDebug)("checkExpire: not topic records"),this.updateExpireLimit(e),t=!1),t}updateExpireLimit(e){(0,Je.logDebug)(`update expire limit for topic: ${e}`);let t={topic:e,timestamp:Date.now()+at.OKXCONNECTOR_SESSION_LIVE_TTL};this.saveSessionContent(Ae.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE,t)}activateDisconnect(){return ge(this,void 0,void 0,function*(){let e=(0,wt.safeJsonStringify)({requestId:"",method:"disconnect"}),t={messageId:"",message:(0,wt.safeJsonStringify)({message:e}),topic:this.currentTopic,publishedAt:0};yield this.connector.getMsgPayloadFromHistory(t)})}};Ut.ConnectionManager=Fc});var Oh=$(fo=>{"use strict";f();p();Object.defineProperty(fo,"__esModule",{value:!0});fo.WalletConnectionManagerEvent=fo.WalletConnectionManagerTopicInfoCacheKey=void 0;fo.WalletConnectionManagerTopicInfoCacheKey="wcmtic";fo.WalletConnectionManagerEvent={RECEIVE_REQUEST:"payload"}});var Ih=$(Xt=>{"use strict";f();p();var Fv=Xt&&Xt.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),$v=Xt&&Xt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Vv=Xt&&Xt.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&Fv(t,e,r[o]);return $v(t,e),t}}(),de=Xt&&Xt.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.WalletConnectionManager=void 0;var Gv=Ss(),Tt=Mc(),St=Br(),Eh=Wc(),ct=jr(),wh=Oh(),Yv=Hc(),Th=ki(),zv=Qo(),mr=xt(),Sh=Bc(),Nh=Uc(),ut=Kn(),V=Vv(He()),Oe=He(),Rh=tt(),Vc=class{constructor(){this.events=new Th.EventEmitter,this.communicateEvents=new Th.EventEmitter,this.splitManager=new Yv.ConnectionSplitPackages("wallet"),V.logDebug("connect manager construct"),this.connectStorage=new zv.Storage(St.OKXCONNECTOR_CACHE_KEY),this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new Gv.OKXWalletConnector(ct.OKXCONNECTOR_WS_URL_1),this.packageId=Date.now(),this.sessionCryptoInfoMap=new Map,this.inLogin=!1,this.isLogined=!1}refreshPackageId(e=0){let t=Date.now()+e;t==this.packageId&&(this.packageId=t+1),this.packageId=t}saveCryptoKeyPair(e,t){let r=(0,ut.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(r,St.OKXCONNECTOR_CRYPTO_KEY+e)}getCachedCryptoKeyPair(e){let r=this.connectStorage.getAndDecrypt(St.OKXCONNECTOR_CRYPTO_KEY+e);return typeof r=="string"?(V.logDebug("get cached crypto key:"),V.logDebug(r),(0,ut.safeJsonParse)(r)):(this.connectStorage.clearCache(),null)}saveJWTKeyPair(e){var t={publicKey:(0,mr.toHexString)(e.publicKey),secretKey:(0,mr.toHexString)(e.secretKey)};V.logDebug("save jwt kp");let r=(0,ut.safeJsonStringify)(t);V.logDebug(r),this.connectStorage.encryptStoreMsg(r,St.OKXCONNECTOR_JWT_KEY),V.logDebug("after save jwt kp")}getCachedJWTKeyPair(){let t=this.connectStorage.getAndDecrypt(St.OKXCONNECTOR_JWT_KEY);if(typeof t=="string"){V.logDebug("get cached jwt kp:"),V.logDebug(t);let o=(0,ut.safeJsonParse)(t);V.logDebug("save jwt kp"),V.logDebug(o);var r={publicKey:(0,mr.hexToByteArray)(o.publicKey),secretKey:(0,mr.hexToByteArray)(o.secretKey)};return r}else return(0,Nh.generateKeyPair)()}isTopicPublicKeyExist(e){return V.logDebug(`isTopicPublicKeyExist  ===> ${e}`),this.sessionCryptoInfoMap.get(e)}makeJWT(e){return de(this,void 0,void 0,function*(){return yield(0,Nh.signJWT)(e,Eh.OKXCONNECTOR_JWT_WALLET_SIDE,Eh.OKXCONNECTOR_JWT_TTL,this.jwtKeyPair)})}parseInternalMsg(e){try{let r=(0,ut.safeJsonParse)(e)["ivur-igbfft-ptjip"];if(r&&r.length>0)return(0,Rh.base64decode)(r,!0).toString()}catch(t){V.logError("parse internal msg",t)}}updateClientId(e,t){let r=this.sessionCryptoInfoMap.get(e);if((0,Oe.logDebug)("updateClientId",r,e,t),r&&t&&t.length>0){if(r.cid){let o=(0,mr.getLastSixMd5Hash)(t);r.cid==o?r.dappPublicKey=t:V.logError("cid check failed",r,e,t)}else r.dappPublicKey=t;this.syncCacheSessionInfo()}return!1}parsePackage(e,t){return de(this,arguments,void 0,function*(r,o,i=!1){var s,l,g,d,a,c,u,_,y,N,X,D,T,L,H,F,S;this.events.emit(o.id,o);let W=this.sessionCryptoInfoMap.get(r);V.logDebug("get sessionInfo for decrypt topic:",r),V.logDebug("get sessionInfo for decrypt:",o.id,r,W,this.sessionCryptoInfoMap);let k=!1;if(W&&o.params.data&&!((s=o.params.data)===null||s===void 0)&&s.message)if(!((l=o.params.data)===null||l===void 0)&&l.isInternalData){let J=(g=o.params.data)===null||g===void 0?void 0:g.message,ne=(d=o.params.data)===null||d===void 0?void 0:d.topic,O=this.parseInternalMsg(J);(0,Oe.logDebug)("parse internal origin: ",O),O&&O.length>0&&this.communicateEvents.emit("origin",O,ne)}else try{let J=(a=o.params.data)===null||a===void 0?void 0:a.message;if(o.method&&o.method===Tt.CONNECT_METHOD_PUSH&&((0,Oe.logDebug)("checkExpire: update expire when get push"),this.updateExpireLimit(r)),J.trimStart().startsWith("{")){let ne=this.splitManager.tryParseMessageSplitPayload(J);if(ne){(0,Oe.logDebug)("parse split msg object: ",ne),k=!0;let O={topicId:(u=(c=o.params)===null||c===void 0?void 0:c.data)===null||u===void 0?void 0:u.topic,messageId:(y=(_=o.params)===null||_===void 0?void 0:_.data)===null||y===void 0?void 0:y.messageId,messageObject:ne,publishedAt:(X=(N=o.params)===null||N===void 0?void 0:N.data)===null||X===void 0?void 0:X.publishedAt},R=yield this.splitManager.onReceivedPackageCheck(O);if(R.completeMessageIdList&&R.completeMessageIdList.forEach(B=>de(this,void 0,void 0,function*(){this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),B,r)})),R.finalMessage){let B=W.crypto.decryptWallet(R.finalMessage,W.dappPublicKey);(0,Oe.logDebug)("<<< receive msg from split:",r,B),this.communicateEvents.emit(r,B)}}else{let O=(0,ut.safeJsonParse)(J);if(O.method){if(O.method=="session_info"){let R=O.params.sessionInfo,B=(0,Rh.base64decode)(R,!1);(0,Oe.logDebug)("wallet connection manager requset base64Content:",B),(0,Oe.logDebug)("base64Content:"+B);let Q=B.toObject();this.updateClientId(r,Q.clientId)}(0,Oe.logDebug)("<<< parse raw msg:",r,O),this.communicateEvents.emit(r,J)}}}else{let ne=W.crypto.decryptWallet((D=o.params.data)===null||D===void 0?void 0:D.message,W.dappPublicKey);(0,Oe.logDebug)("<<< receive msg:",r,ne),this.communicateEvents.emit(r,ne)}}catch{let ne=W.crypto.decryptWallet((T=o.params.data)===null||T===void 0?void 0:T.message,W.dappPublicKey);(0,Oe.logDebug)("<<< receive msg:",r,ne),this.communicateEvents.emit(r,ne)}if(!i&&(yield this.sendACK(o.id,!0),r&&!k)){let J=o;!((H=(L=J.params)===null||L===void 0?void 0:L.data)===null||H===void 0)&&H.messageId&&(this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),(S=(F=J.params)===null||F===void 0?void 0:F.data)===null||S===void 0?void 0:S.messageId,r))}})}recovrySessionInfoFromCache(){let e=this.connectStorage.getAndDecrypt(wh.WalletConnectionManagerTopicInfoCacheKey);if(V.logDebug("get cached sessionInfos:",e),e){let t=(0,ut.safeJsonParse)(e);for(let r in t){let o=t[r];V.logDebug("make topicItem:",o);let i={topic:r,crypto:new Sh.SessionCrypto({publicKey:o.cryptoKeyPair.publicKey,secretKey:o.cryptoKeyPair.secretKey}),dappPublicKey:o.dappPublicKey,cid:o.cid};this.sessionCryptoInfoMap.set(r,i)}}V.logDebug("get cached sessionInfos map:",this.sessionCryptoInfoMap)}syncCacheSessionInfo(){let e={};for(let[r,o]of this.sessionCryptoInfoMap)V.logDebug("for each Keys",r),o&&(e[r]={cryptoKeyPair:o.crypto.stringifyKeypair(),dappPublicKey:o.dappPublicKey,cid:o.cid});let t=(0,ut.safeJsonStringify)(e);V.logDebug("sync cache sessionInfos:",t),this.connectStorage.encryptStoreMsg(t,wh.WalletConnectionManagerTopicInfoCacheKey)}cacheSessionInfo(e,t,r=!0){let o=t.dappPublicKey,i=[];for(let[s,l]of this.sessionCryptoInfoMap)V.logDebug("for each Keys",s),l.dappPublicKey==o&&(V.logDebug("duplicated dapp public key:",s,o),i.push(s));for(let[s,l]of this.sessionCryptoInfoMap)i.includes(s)&&this.sessionCryptoInfoMap.delete(s);return V.logDebug("cleaned connect session cache:",this.sessionCryptoInfoMap),this.sessionCryptoInfoMap.set(e,t),V.logDebug("cache sessionInfo:",e,t,this.sessionCryptoInfoMap),r&&this.syncCacheSessionInfo(),i}updateProtocolVersion(e,t){this.splitManager.updateTopicSenderVersion(e,t)}appendTopic(e,t,r){return de(this,void 0,void 0,function*(){return(0,Oe.logDebug)("4.1. get append Topic:",e),new Promise((o,i)=>de(this,void 0,void 0,function*(){if(!this.isLogined){var s=new Error;s.message="connection is not logined",s.name="append error",i(s);return}let l={topic:e,crypto:new Sh.SessionCrypto,dappPublicKey:t||"",cid:r},g=this.cacheSessionInfo(e,l,!1);yield this.subscribeTopics(Array.from([e])),this.refreshPackageId(),V.logDebug(`5. subscribe callback then fetch append message: ${this.packageId}, ${e}`),V.reportLog("5. subscribe callback then fetch append message");let d=new Date().getTime();(0,Oe.logDebug)("Append --subscribe callback->",d-this.timeLog),o(g)}))})}confirmAppendingTopics(){this.syncCacheSessionInfo()}connect(){return de(this,void 0,void 0,function*(){this.timeLog=new Date().getTime(),(0,Oe.logDebug)("[Wallet] ConnectTime---enter->",this.timeLog),V.reportLog("wallet connect connect called");let e=Date.now().toString();var t=yield this.makeJWT(e);return V.logDebug(`generate jwt token: ${t}`),this.connectStorage.saveContent(t,"jwt"),this.recovrySessionInfoFromCache(),new Promise((r,o)=>{this.inLogin=!0,this.connector.onOpen(()=>de(this,void 0,void 0,function*(){V.logDebug("1. connector on open"),V.reportLog("1. wallet connect connect on open");let i=new Date().getTime();(0,Oe.logDebug)("ConnectTime---open->",i-this.timeLog),this.events.once(this.packageId.toString(),s=>de(this,void 0,void 0,function*(){if(s&&s.error){V.logError("failed when login"),yield this.connector.disconnect();var l=new Error;l.message=s.error.message,l.name=s.error.code.toString(),o(l)}else this.isLogined=!0,r(),V.logDebug("3. subscribe cached topics",this.sessionCryptoInfoMap),V.reportLog("3. wallet connect connect subscribe cached topics"),this.sessionCryptoInfoMap.size>0&&(yield this.subscribeTopics(Array.from(this.sessionCryptoInfoMap.keys())))})),V.logDebug("2. login called"),V.reportLog("2. wallet connect login called"),yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),{id:this.packageId.toString(),jsonrpc:ct.CONNECT_JSONRPC_VER,method:Tt.CONNECT_METHOD_LOGIN,params:{token:t}})})),this.connector.connect().catch(i=>{(0,Oe.logDebug)("WalletConnectionManager connect error",i),o(i)}),this.connector.addPackageParse(i=>{var s,l;if(V.logDebug("connect: parse package"),V.logDebug(i),!("params"in i)||!("data"in i.params)){this.parsePackage("",i,!0);return}!((s=i.params.data)===null||s===void 0)&&s.topic&&this.parsePackage((l=i.params.data)===null||l===void 0?void 0:l.topic,i,i.method===Tt.CONNECT_METHOD_RECEIVE)})})})}getSessionPublicKey(e){if(this.isTopicPublicKeyExist(e)){let t=this.sessionCryptoInfoMap.get(e);if(t)return(0,mr.toHexString)(t.crypto.keyPair.publicKey)}}getCurrentCachedTopicIdList(){return Array.from(this.sessionCryptoInfoMap.keys())}sendDisconnect(e){return de(this,void 0,void 0,function*(){this.refreshPackageId();let t={id:this.packageId.toString(),jsonrpc:ct.CONNECT_JSONRPC_VER,method:Tt.CONNECT_METHOD_DISCONNECT,params:{message:{topic:e,ttl:ct.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL}}};yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),t)})}sendRecvDisconnect(e){return de(this,void 0,void 0,function*(){this.refreshPackageId();let t={id:this.packageId.toString(),jsonrpc:ct.CONNECT_JSONRPC_VER,method:Tt.CONNECT_METHOD_RECV_DISCONNECT,params:{topic:e}};yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),t)})}disconnect(){return de(this,arguments,void 0,function*(e=!1){yield this.connector.disconnect(),this.connectStorage.clearCache(St.OKXCONNECTOR_TOKEN_CACHE),e||this.connectStorage.clearCache(St.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE)})}sendRaw(e,t){return de(this,void 0,void 0,function*(){t&&(yield this.sendMsg(t,e,ct.OKXCONNECTOR_MESSAGE_TTL))})}sendMsg(e,t,r){return de(this,void 0,void 0,function*(){if(t){this.refreshPackageId();let o={id:this.packageId.toString(),method:Tt.CONNECT_METHOD_PUBLISH,jsonrpc:ct.CONNECT_JSONRPC_VER,params:{message:{topic:e,message:t,ttl:r}}};this.events.once(this.packageId.toString(),i=>de(this,void 0,void 0,function*(){i&&i.error?V.logError(`@${new Date().toUTCString()} >>> failed when send msg`):i&&!i.error&&V.logDebug(`CONNECTION @[${new Date().toUTCString()}] >>> send msg with id ${this.packageId} successed`)})),yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)}})}send(e,t){return de(this,arguments,void 0,function*(r,o,i=!1,s=ct.OKXCONNECTOR_MESSAGE_TTL,l=!1){var g,d;if(V.logDebug(`message send =====> ${o}`),!this.isTopicPublicKeyExist(r))throw new Error("connection not finish");let a=(g=this.sessionCryptoInfoMap.get(r))===null||g===void 0?void 0:g.dappPublicKey,c=(d=this.sessionCryptoInfoMap.get(r))===null||d===void 0?void 0:d.crypto,u;l&&(u={message:o});let _=!1;if(c&&a&&!l){let y=c.encryptWallet(o,a);_=!0,u={message:y}}if(u){i&&c&&(u.clientId=(0,mr.toHexString)(c.keyPair.publicKey));let y=(0,ut.safeJsonStringify)(u);!l&&_?yield this.splitManager.sendSplitPackages(r,y,this.sendMsg.bind(this),this.sendRaw.bind(this)):yield this.sendMsg(r,y,s)}})}sendACK(e,t){return de(this,arguments,void 0,function*(r,o,i=void 0){if(o===!0){let s={id:r,jsonrpc:ct.CONNECT_JSONRPC_VER,result:!0};yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)}else if(i){let s={id:r,jsonrpc:ct.CONNECT_JSONRPC_VER,error:{code:i.code,message:i.message}};yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)}})}sendReceive(e,t,r){return de(this,void 0,void 0,function*(){let o={id:e,jsonrpc:ct.CONNECT_JSONRPC_VER,method:Tt.CONNECT_METHOD_RECEIVE,params:{data:{messageId:t,topic:r}}};yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}sendUnsubscribe(e){return de(this,void 0,void 0,function*(){yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),{id:this.packageId.toString(),jsonrpc:ct.CONNECT_JSONRPC_VER,method:Tt.CONNECT_METHOD_UNSUB,params:{topic:e}});try{yield this.sendDisconnect(e)}catch(t){V.logError("send disconnect command failed",t)}this.sessionCryptoInfoMap.delete(e),this.syncCacheSessionInfo()})}sendFetchAndConsumeMessages(e,t){return de(this,void 0,void 0,function*(){this.events.once(e,i=>de(this,void 0,void 0,function*(){var s,l;if(i.result){var g=i.result.hasMore,d=i.result.data;if(d)for(let a=0;a<d.length;a++){let c=d[a];if(c&&c.topic==t){let u=c.messageId;yield this.connector.getMsgPayloadFromHistory(c),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),u,t)}}g&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else V.logDebug(`CONNECT: get error rsp ${(s=i.error)===null||s===void 0?void 0:s.code} : ${(l=i.error)===null||l===void 0?void 0:l.message}`)})),V.logDebug("5. send fetch more");let r=new Date().getTime();(0,Oe.logDebug)("ConnectTime---5->",r-this.timeLog);let o={id:e,jsonrpc:ct.CONNECT_JSONRPC_VER,method:Tt.CONNECT_METHOD_FETCHMSG,params:{data:{topic:t}}};yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}sendBatchFetchAndConsumeMessages(e,t){return de(this,void 0,void 0,function*(){this.events.once(e,i=>de(this,void 0,void 0,function*(){var s,l;if(i.result){var g=i.result.hasMore,d=i.result.data;let a=i.result.disconnectedTopics;if(a)try{for(let c=0;c<a.length;c++){let u=a[c];if(u.topic){(0,Oe.logDebug)("send receive disconnect:",u.topic),yield this.sendRecvDisconnect(u.topic);let _=(0,ut.safeJsonStringify)({requestId:u.publishedAt.toString(),method:Tt.CONNECT_METHOD_DISCONNECT}),y={messageId:u.publishedAt.toString(),message:(0,ut.safeJsonStringify)({message:_}),topic:u.topic,publishedAt:u.publishedAt};yield this.connector.getMsgPayloadFromHistory(y)}}}catch(c){V.logError("disconnect topic fails",c)}if(d)for(let c=0;c<d.length;c++){let u=d[c];if(u&&u.topic)if(this.splitManager.tryParseMessageSplitPayload(u.message))yield this.connector.getMsgPayloadFromHistory(u);else{let y=u.messageId;yield this.connector.getMsgPayloadFromHistory(u),this.refreshPackageId(c),yield this.sendReceive(this.packageId.toString(),y,u.topic)}}g&&(this.refreshPackageId(),yield this.sendBatchFetchAndConsumeMessages(this.packageId.toString(),t))}else V.logDebug(`CONNECT: get error rsp ${(s=i.error)===null||s===void 0?void 0:s.code} : ${(l=i.error)===null||l===void 0?void 0:l.message}`)})),V.logDebug("5. send fetch more"),V.reportLog("5. send fetch more");let r=new Date().getTime();(0,Oe.logDebug)("ConnectTime---5->",r-this.timeLog);let o={id:e,jsonrpc:ct.CONNECT_JSONRPC_VER,method:Tt.CONNECT_METHOD_BATCH_FETCHMSG,params:{topics:t,withInternalData:!0}};yield this.connector.send(()=>de(this,void 0,void 0,function*(){V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}cleanCache(){return de(this,void 0,void 0,function*(){this.connectStorage.clearCache()})}saveSessionContent(e,t){t||this.connectStorage.clearCache(St.OKXCONNECTOR_SESSION_PREFIX_KEY+e);let r=(0,ut.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(r,St.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}getSessionContent(e){let t=this.connectStorage.getAndDecrypt(St.OKXCONNECTOR_SESSION_PREFIX_KEY+e);if(t)return(0,ut.safeJsonParse)(t)}subscribeTopics(e){return de(this,void 0,void 0,function*(){(0,Oe.logDebug)("4. topicid list",e),V.reportLog("4. topicid list"),this.refreshPackageId();let t=new Date().getTime();return(0,Oe.logDebug)("ConnectTime--subscribe callback->",t-this.timeLog),new Promise((r,o)=>de(this,void 0,void 0,function*(){let i=0;for(let s=0;s<e.length;++s){let l=e[s];this.refreshPackageId(s),this.events.once(this.packageId.toString(),d=>de(this,void 0,void 0,function*(){if(d&&d.error){V.logError("failed when subscribe"),yield this.connector.disconnect();var a=new Error;a.message=d.error.message,a.name=d.error.code.toString(),i+=1,i==e.length&&r()}this.refreshPackageId(s);let c=new Date().getTime();(0,Oe.logDebug)("ConnectTime--subscribe callback->",c-this.timeLog),i+=1,i==e.length&&(V.logDebug(`5. send fetch msg: ${this.packageId}, ${l}`),yield this.sendBatchFetchAndConsumeMessages(this.packageId.toString(),e),yield this.splitManager.init(this.sendRaw.bind(this)),this.checkExpire(l)?((0,Oe.logDebug)("disconnect From topic expire"),yield this.activateDisconnect(l)):((0,Oe.logDebug)("extends expire check"),this.updateExpireLimit(l)),r())})),V.logDebug(`3. login callback then send subscribe: ${this.packageId}, ${l}`),V.reportLog("3. login callback then send subscribe");let g=new Date().getTime();(0,Oe.logDebug)("ConnectTime---login callback->",g-this.timeLog),yield this.connector.send(()=>de(this,void 0,void 0,function*(){return V.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),{id:this.packageId.toString(),jsonrpc:ct.CONNECT_JSONRPC_VER,method:Tt.CONNECT_METHOD_SUB,params:{topic:l}})}}))})}checkExpire(e){let t=!1;if(e.length==0)return(0,Oe.logDebug)("checkExpire: invalid topic"),t;let r=this.getSessionContent(St.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE);if(r&&r instanceof Object)try{let i=new Map(Object.entries(r)).get(e);i?Date.now()>i&&((0,Oe.logDebug)("checkExpire: connection is Expired"),t=!0):((0,Oe.logDebug)("checkExpire: not same connection"),t=!1)}catch{(0,Oe.logDebug)("checkExpire: cache error"),t=!1}else(0,Oe.logDebug)("checkExpire: not topic records"),this.updateExpireLimit(e),t=!1;return t}updateExpireLimit(e){(0,Oe.logDebug)(`update expire limit for topic: ${e}`);try{let t=this.getSessionContent(St.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE),r=new Map;t&&(r=new Map(Object.entries(t)));let o=Date.now()+ct.OKXCONNECTOR_SESSION_LIVE_TTL;r.set(e,o),this.saveSessionContent(St.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE,Object.fromEntries(r))}catch{(0,Oe.logDebug)("update cache failed")}}activateDisconnect(e){return de(this,void 0,void 0,function*(){let t=(0,ut.safeJsonStringify)({requestId:"",method:Tt.CONNECT_METHOD_DISCONNECT}),r={messageId:"",message:(0,ut.safeJsonStringify)({message:t}),topic:e,publishedAt:0};yield this.connector.getMsgPayloadFromHistory(r)})}};Xt.WalletConnectionManager=Vc});var po=$(Ht=>{"use strict";f();p();Object.defineProperty(Ht,"__esModule",{value:!0});Ht.OKX_TG_WALLET=Ht.OKX_APP_WALLET=Ht.OKX_INJECT_WALLET=void 0;Ht.getTagByappName=Zv;var Qv=et(),Dh=jo();Ht.OKX_INJECT_WALLET="okx_inject_wallet";Ht.OKX_APP_WALLET="okx_app_wallet";Ht.OKX_TG_WALLET="okx_tg_wallet";function Zv(n){var e="";if(n)switch(n){case Qv.OKXWalletName:e=Ht.OKX_APP_WALLET;break;case Dh.OKXMiniWalletName:e=Ht.OKX_TG_WALLET;break;case Dh.OKXInjectWalletName:e=Ht.OKX_INJECT_WALLET}return e}});var Gc=$(ti=>{"use strict";f();p();Object.defineProperty(ti,"__esModule",{value:!0});ti.buildNameSpacesByConnectResponse=eC;ti.buildRequestAccountNameSpacesByConnectResponse=Ah;ti.buildAccountNameSpaces=Ph;var Xn=He();function eC(n){return Ah(n)}function Ah(n){let e={};(0,Xn.logDebug)("buildRequestAccountNameSpacesByConnectResponse start connectResponse111>>",JSON.stringify(n));let t=n.payload.responses.find(i=>i.name==="requestAccounts");if(t&&t.accounts){let i=[];for(let s of t.accounts)s.namespace==="ton"?s.data&&s.data.ton_addr&&s.data.ton_addr.address&&s.data.ton_addr.address.length>0&&((0,Xn.logDebug)("buildRequestAccountNameSpacesByConnectResponse start TON>>",JSON.stringify(s)),i.push(s)):((0,Xn.logDebug)("buildRequestAccountNameSpacesByConnectResponse start other>>",JSON.stringify(s)),i.push(s));t.accounts=i}let r=n.payload.responses.find(i=>i.name==="ton_addr"),o=n.payload.responses.find(i=>i.name==="ton_proof");if(r&&!t){(0,Xn.logDebug)("buildRequestAccountNameSpacesByConnectResponse adapt ton data >>");let i=r.address;i="ton:"+r.network+":"+i;let s={ton_addr:r};o&&(s.ton_proof=o),t={name:"requestAccounts",accounts:[{namespace:"ton",addresses:[i],methods:["ton_sendTransaction"],extra:{},data:s}]}}return(0,Xn.logDebug)("buildRequestAccountNameSpacesByConnectResponse end universalResponse>>>",JSON.stringify(t)),Ph(t.accounts,e),e}function Ph(n,e){n.forEach(t=>{var r=[],o=[];t.addresses.forEach(i=>{var s=i.split(":");if((0,Xn.logDebug)("buildRequestAccountNameSpacesByConnectResponse addressArr>>",s.length),s.length>=3){let l=s.slice(0,2).join(":");r.push(l),o.push(i),(0,Xn.logDebug)("buildRequestAccountNameSpacesByConnectResponse chain:>>",l,"addressItem:",i)}}),t.data&&t.data.ton_addr&&(t.data.ton_addr.name="ton_addr"),t.data&&t.data.ton_proof&&(t.data.ton_proof.name="ton_proof"),e[t.namespace]={chains:r,accounts:o,methods:t.methods,extra:t.extra,payload:t.data},(0,Xn.logDebug)("buildRequestAccountNameSpacesByConnectResponse result>>",JSON.stringify(e))})}});var kh=$(ho=>{"use strict";f();p();var _r=ho&&ho.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(ho,"__esModule",{value:!0});ho.Engine=void 0;var yr=et(),tC=jr(),oe=tt(),wn=po(),nC=$c(),rC=Gc(),Yc=jo(),zc=class{constructor(e){this.connectors=[],this.useConnector=void 0,this.connectionManager=new nC.ConnectionManager(e),this.addConnectionListener()}getConnector(){if(this.useConnector)return this.useConnector}setAccountChangeListener(e){this.accountChangeListener=e,(0,oe.logDebug)("setAccountChangeListener: engine",e);for(let t of this.connectors)t.setAccountChangeListener(e)}registerConnector(e){this.connectors=e;for(let t of e)t.setConnectionManager(this.connectionManager)}hasWsConnector(){for(let e of this.connectors)if(this.isWsConnector(e))return!0;return!1}isWsConnector(e){return e?e.getTag()===wn.OKX_TG_WALLET||e.getTag()===wn.OKX_APP_WALLET:!1}isInjectedConnector(e){return e?e.getTag()===wn.OKX_INJECT_WALLET:!1}universalConnect(e,t,r){return _r(this,void 0,void 0,function*(){return this.addConnectionListener(),new Promise((o,i)=>_r(this,void 0,void 0,function*(){var s,l,g,d,a;try{(0,oe.logDebug)("engine universalConnect request :",JSON.stringify(e)),(0,oe.logDebug)("engine universalConnect sessionConfig :",JSON.stringify(t));let c=[];e.forEach(S=>{let W=S.name;(W.startsWith("requestAccounts")||W.startsWith("ton"))&&c.push(S)}),(0,oe.logDebug)("engine universalConnect universalRequest :",JSON.stringify(c));let u=this.connectionManager.getConnectInfo(),_=Date.now().toString(),y=(s=t.openUniversalUrl)!==null&&s!==void 0?s:!1,N=(l=t.openAppLinkType)!==null&&l!==void 0?l:yr.OpenAppLinkType.UniversalLink,X={protocolVer:Number(yr.tonConnectSdkVersion),topic:u.channelId,clientId:u.clientId,requestId:_,dAppInfo:this.fixDappName(t.dappInfo),requests:c,redirect:(g=t?.redirect)!==null&&g!==void 0?g:"none"},D=(0,oe.encodeConnectParams)(X);X.redirect=(d=t?.redirect)!==null&&d!==void 0?d:"none",(0,oe.logDebug)("engine universalConnect ==>>universalConnectRequest:",JSON.stringify(X));let T="",L="";if(y){let S=(0,oe.getOKXLink)(X,t.useMini,t.tmaReturnUrl);T=S.universalLink,L=S.deepLink||"",(0,oe.logDebug)("engine universalConnect ==>>openOKXLink:",T)}let H=()=>this.connectors.length==1&&this.connectors[0].getTag()===wn.OKX_INJECT_WALLET?this.connectors[0].openWallet({connectRequest:X},N):t.useMini?(0,oe.openOKXTMAWalletlinkWithFallback)(T):(0,oe.openOKXDeeplinkWithFallback)(L,T,N);(0,oe.logDebug)("engine universalConnect ==>>openOKXLink:",T);let F=(0,oe.isIos)();if(F&&y&&((0,oe.logDebug)(`engine universalConnect ==>>isIOS: ${F}   openUniversalLink: ${y}`),H()),this.addOnConnectResultListener(S=>{var W,k,J,ne;try{this.addOnConnectResultListener(void 0);let B=S;if(B.method=="connect"){(0,oe.logDebug)("engin  universalConnect success connectResponse:>>>",JSON.stringify(B));let Q=(0,rC.buildNameSpacesByConnectResponse)(B);if(Q){let ce;((k=(W=B.payload)===null||W===void 0?void 0:W.responses)===null||k===void 0?void 0:k[0])&&"walletName"in B.payload.responses[0]&&(ce=B.payload.responses[0].walletName);let ie=(J=B.payload)===null||J===void 0?void 0:J.wallet.appName;var O="";switch(ie){case Yc.OKXWalletName:O=wn.OKX_APP_WALLET;break;case Yc.OKXMiniWalletName:O=wn.OKX_TG_WALLET;break;case Yc.OKXInjectWalletName:O=wn.OKX_INJECT_WALLET;break}var R=this.connectors.find(Pe=>Pe.getTag()===O);if(!R)throw new yr.OKXConnectError(yr.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR);let Ge=Object.assign({topic:u.channelId,sessionConfig:t,namespaces:Q},B.payload&&{wallet:Object.assign(Object.assign({},B.payload.wallet),{walletName:ce})}),Ye=B.payload.responses.find(Pe=>Pe.name==="requestAccounts");Ye&&Ye.connectRequestMethods&&(Ge.signResponse=Ye.connectRequestMethods),(0,oe.logDebug)("engin  universalConnect success session:>>>",JSON.stringify(Ge)),this.isWsConnector(R)&&((0,oe.logDebug)("engine update protocol version"),this.connectionManager.updateProtocolVersion(u.channelId,B.payload.wallet.maxProtocolVersion)),this.deviceInfo=Object.assign({},Ge.wallet),o(Ge),this.setUseConnector(R),(0,oe.reportEvent)(oe.OKXReportType.PAGE_IN,oe.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View,O)}else throw new yr.OKXConnectError(yr.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR)}else if(B.method=="connect_error"&&((ne=B.payload)===null||ne===void 0?void 0:ne.code)!=null)throw new yr.OKXConnectError(B.payload.code)}catch(B){i(B)}}),this.hasWsConnector()){yield(a=this.connectionManager)===null||a===void 0?void 0:a.disconnect(!1);try{yield this.connectionManager.connect()}catch(S){throw(0,oe.logDebug)("Engine universalConnect error",S),S}(0,oe.logDebug)("engin  universalConnect ==>> connectInfoAndUrl:",r),this.sendSession(D)}if(!F&&y&&H(),(0,oe.logDebug)("engin  universalConnect ==>> connectInfoAndUrl:",r),r){let S={connectRequest:X,redirect:t.redirect,tmaReturnUrl:t.tmaReturnUrl};(0,oe.logDebug)("universalConnect connectInfoAndUrl info :",JSON.stringify(S)),r(S)}}catch(c){(0,oe.logDebug)("Engine universalConnect catch error",c),i(c)}}))})}fixDappName(e){try{if(e.name.toLowerCase()==="dapp portal"){let t=document.title;if(t||(t=this.getOGSiteName()),t)return Object.assign(Object.assign({},e),{name:e.name+" - "+t})}return e}catch{return e}}getOGSiteName(){let e=document.getElementsByTagName("meta"),t=["og:site_name","og:title","twitter:title"];for(let r of e){let o=r.getAttribute("property");for(let i of t)if(o==i)return r.getAttribute("content")}}addOnConnectResultListener(e){for(let t of this.connectors)this.isInjectedConnector(t)&&t.setOnConnectResultListener(e);this.connectResultListener=e}openWallet(e,t,r){var o;t?t.openWallet(e,r):(o=this.getConnector())===null||o===void 0||o.openWallet(e,r)}send(e,t,r){return _r(this,void 0,void 0,function*(){var o,i,s,l,g,d,a,c,u;let _;"chainId"in e&&e.chainId!=null&&(_=e.chainId.toString());try{(0,oe.reportEvent)(oe.OKXReportType.LOG,oe.Report_OKXConnectSDK_RequestStart_Log,"",(i=(o=this.getConnector())===null||o===void 0?void 0:o.getTag())!==null&&i!==void 0?i:"",e.method,(l=(s=this.deviceInfo)===null||s===void 0?void 0:s.platform)!==null&&l!==void 0?l:"",_),(g=this.getConnector())===null||g===void 0||g.send(e,{resolve:y=>{var N,X,D,T,L,H,F,S,W;(N=t?.resolve)===null||N===void 0||N.call(t,y),"error"in y&&y.error?(0,oe.reportEvent)(oe.OKXReportType.LOG,oe.Report_OKXConnectSDK_RequestError_Log,"",(D=(X=this.getConnector())===null||X===void 0?void 0:X.getTag())!==null&&D!==void 0?D:"",e.method,(L=(T=this.deviceInfo)===null||T===void 0?void 0:T.platform)!==null&&L!==void 0?L:"",_):(0,oe.reportEvent)(oe.OKXReportType.LOG,oe.Report_OKXConnectSDK_RequestSuccess_Log,"",(F=(H=this.getConnector())===null||H===void 0?void 0:H.getTag())!==null&&F!==void 0?F:"",e.method,(W=(S=this.deviceInfo)===null||S===void 0?void 0:S.platform)!==null&&W!==void 0?W:"",_)},onAck:()=>{var y;(y=t?.onAck)===null||y===void 0||y.call(t)}})}catch(y){throw(0,oe.reportEvent)(oe.OKXReportType.LOG,oe.Report_OKXConnectSDK_RequestError_Log,"",(a=(d=this.getConnector())===null||d===void 0?void 0:d.getTag())!==null&&a!==void 0?a:"",e.method,(u=(c=this.deviceInfo)===null||c===void 0?void 0:c.platform)!==null&&u!==void 0?u:"",_),y}})}clearData(){var e;(e=this.getConnector())===null||e===void 0||e.clearData()}addDisconnectListener(e){var t;(t=this.getConnector())===null||t===void 0||t.addDisconnectListener(e)}saveSessionContent(e,t){this.connectionManager.saveSessionContent(e,t)}getSessionContent(e){var t,r=this.connectionManager.getSessionContent(e);if(r){var o="";if(typeof r=="object"&&(o=(0,wn.getTagByappName)((t=r.wallet)===null||t===void 0?void 0:t.appName)),this.connectors.find(i=>i.getTag()===o))return r}}setConnectConnector(e){var t=(0,wn.getTagByappName)(e?.appName);!t||this.setUseConnector(this.connectors.find(r=>r.getTag()===t))}setUseConnector(e){this.useConnector=e,this.isWsConnector(e)&&e.addConnectionListener()}setSessionConnectingListener(e){this.sessionConnectingListener=e}restoreconnect(e,t){return _r(this,void 0,void 0,function*(){var r;yield(r=this.getConnector())===null||r===void 0?void 0:r.restoreconnect(e,o=>{var i,s;t(o),o&&(this.deviceInfo=Object.assign({},o.wallet),(0,oe.reportEvent)(oe.OKXReportType.PAGE_IN,oe.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View,(s=(i=this.getConnector())===null||i===void 0?void 0:i.getTag())!==null&&s!==void 0?s:""))})})}restoreconnectFromTopic(e){return _r(this,void 0,void 0,function*(){this.isWsConnector(this.getConnector())&&(yield this.getConnector().restoreconnectFromTopic(e))})}getCurrentConnectionReady(e){var t;return!!(!((t=this.getConnector())===null||t===void 0)&&t.getCurrentConnectionReady(e))}connectManagerDisconnect(){return _r(this,arguments,void 0,function*(e=!1){var t;yield(t=this.getConnector())===null||t===void 0?void 0:t.connectManagerDisconnect(e)})}sendSession(e){return _r(this,void 0,void 0,function*(){(0,oe.logDebug)("[Connect] sendSession called:",e);let t=Date.now().toString(),r={method:"session_info",params:{protocolVersion:tC.CONNECT_PROTOCOL_VER,sessionInfo:e}};yield this.connectionManager.sendRaw(JSON.stringify(Object.assign(Object.assign({},r),{requestId:t})))})}addConnectionListener(){var e;(e=this.connectionManager)===null||e===void 0||e.addListener("sdk_response",(t,r)=>{var o=(0,oe.safeJsonParse)(r);(0,oe.logDebug)(`Engine ==>> addListener ==> success ==> ${o}`),o.method==="connect"||o.method==="connect_error"?this.connectResultListener&&this.connectResultListener(o):o.method==="session_connecting"&&((0,oe.logDebug)("Engine ==>> handleResponse_4  ===> sessionConnectingListener"),this.sessionConnectingListener&&((0,oe.logDebug)("Engine ==>> handleResponse_4  ===> sessionConnectingListener not null"),this.sessionConnectingListener(),this.sessionConnectingListener=void 0))},function(){})}};ho.Engine=zc});var Lh=$(qt=>{"use strict";f();p();Object.defineProperty(qt,"__esModule",{value:!0});qt.Storage=qt.Engine=qt.WalletConnectionManager=qt.ConnectionManager=qt.OKXWalletConnector=void 0;var oC=Ss();Object.defineProperty(qt,"OKXWalletConnector",{enumerable:!0,get:function(){return oC.OKXWalletConnector}});var iC=$c();Object.defineProperty(qt,"ConnectionManager",{enumerable:!0,get:function(){return iC.ConnectionManager}});var sC=Ih();Object.defineProperty(qt,"WalletConnectionManager",{enumerable:!0,get:function(){return sC.WalletConnectionManager}});var aC=kh();Object.defineProperty(qt,"Engine",{enumerable:!0,get:function(){return aC.Engine}});var cC=Qo();Object.defineProperty(qt,"Storage",{enumerable:!0,get:function(){return cC.Storage}})});var Hn=$(dt=>{"use strict";f();p();Object.defineProperty(dt,"__esModule",{value:!0});dt.BtcMethods=dt.SuiMethods=dt.TONMethods=dt.AptosMethods=dt.SOLANAMethods=dt.Eip55Methods=void 0;dt.hasOKXInjectedProvider=lC;function lC(){return typeof uC("okxwallet")<"u"}function uC(n){let e=(t,r)=>{let[o,...i]=r.split("."),s=t[o];if(s)return i.length===0?s:e(s,i.join("."))};if(typeof window<"u")return e(window,n)}dt.Eip55Methods=["personal_sign","eth_signTypedData_v4","eth_sendTransaction","wallet_addEthereumChain","wallet_watchAsset","wallet_switchEthereumChain","eth_requestAccounts","eth_accounts","eth_chainId"];dt.SOLANAMethods=["solana_signTransaction","solana_signMessage","solana_signAllTransactions","solana_signAndSendTransaction"];dt.AptosMethods=["aptos_signMessage","aptos_signTransaction","aptos_signAndSubmitTransaction"];dt.TONMethods=["ton_sendTransaction"];dt.SuiMethods=["sui_signMessage","sui_signPersonalMessage","sui_signTransactionBlock","sui_signAndExecuteTransactionBlock"];dt.BtcMethods=["btc_signMessage","btc_signPsbts","btc_send","btc_sendInscription","btc_signAndPushPsbt","btc_inscribeTransfer","btc_sendRunes"]});var Tn=$(Ve=>{"use strict";f();p();Object.defineProperty(Ve,"__esModule",{value:!0});Ve.mediaNotTouch=Ve.mediaTouch=Ve.maxWidth=void 0;Ve.isDevice=hC;Ve.media=gC;Ve.mediaMin=mC;Ve.mediaMax=_C;Ve.mediaMinMax=yC;var dC=rs(),fC=Uo(),xh=Vr(),pC=He();Ve.maxWidth={mobile:440,tablet:1020};function hC(n){var e;let t=(0,xh.getWindow)();if(!t)return n==="desktop";if((0,fC.isTmaPlatform)("weba"))return!0;let r=t.innerWidth;switch(n){case"desktop":return r>Ve.maxWidth.tablet;case"tablet":return r>Ve.maxWidth.mobile;default:case"mobile":let o=r<=Ve.maxWidth.mobile||(0,dC.isOS)("ios","android","ipad");if(o){let i=!!(!((e=(0,xh.getWindow)())===null||e===void 0)&&e.TelegramWebviewProxy),s=navigator.maxTouchPoints||0;i&&s===0&&(o=!1),(0,pC.logDebug)("isDevice mobile isTelegram and maxTouchPoints:",o,i,s)}return o}}function gC(n){switch(n){case"mobile":return`@media (max-width: ${Ve.maxWidth.mobile}px)`;case"tablet":return`@media (max-width: ${Ve.maxWidth.tablet}px) (min-width: ${Ve.maxWidth.mobile}px)`;default:case"desktop":return`@media (min-width: ${Ve.maxWidth.tablet}px)`}}function mC(n){return`@media (min-width: ${n}px)`}function _C(n){return`@media (max-width: ${n}px)`}function yC(n,e){return`@media (min-width: ${n}px) and (max-width: ${e}px)`}Ve.mediaTouch="@media (hover: none)";Ve.mediaNotTouch="@media not all and (hover: none)"});var Kh=$(go=>{"use strict";f();p();var Qc=go&&go.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(go,"__esModule",{value:!0});go.Eip155Provider=void 0;var Rs=et(),Nt=tt(),bC=Tn(),vC=Hn(),Zc=class{constructor(){this.accountChangedEVMHandler=null}send(e){return Qc(this,void 0,void 0,function*(){var t;try{(0,Nt.logDebug)("Eip155Provider send request:",(0,Nt.safeJsonStringify)(e)),yield this.restoreConnect();let r=null;switch(e.method){case"personal_sign":e.params&&"message"in e.params&&(r={method:e.method,params:[e.params.message,e.address]});break;case"eth_sendTransaction":case"wallet_addEthereumChain":case"wallet_switchEthereumChain":e.params&&(r={method:e.method,params:[e.params]});break;case"eth_signTypedData_v4":e.params&&"typedDataJson"in e.params&&((t=e.params)===null||t===void 0?void 0:t.typedDataJson)&&typeof e.params.typedDataJson=="string"&&(r={method:e.method,params:[e.address,e.params.typedDataJson]});break;case"wallet_watchAsset":e.params&&(r={method:e.method,params:e.params});break;default:r={method:e.method,params:e.injectParams}}if(r)if((e.method==="wallet_switchEthereumChain"||e.method==="wallet_addEthereumChain")&&e.params&&"chainId"in e.params){(0,Nt.logDebug)("Eip155Provider send request switch requestParams:",(0,Nt.safeJsonStringify)(r));let o=parseInt(e.params.chainId,16).toString();yield window.okxwallet.request(r);let i=`eip155:${o}:${e.address}`;return(0,Nt.logDebug)("Eip155Provider send request switch result:",i),{result:i,method:e.method}}else{let o=(0,Nt.getChainId)(e.chainId),i=`0x${Number(o).toString(16)}`;if((0,Nt.logDebug)("Eip155Provider current chainId:",o,i),i){yield window.okxwallet.request({method:"wallet_switchEthereumChain",params:[{chainId:i}]}),(0,Nt.logDebug)("Eip155Provider send request requestParams:",i,(0,Nt.safeJsonStringify)(r));let s=yield window.okxwallet.request(r);return(0,Nt.logDebug)("Eip155Provider send request result:",(0,Nt.safeJsonStringify)(s)),{result:s,method:e.method}}}else throw new Rs.OKXConnectError(Rs.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED)}catch(r){throw(0,Nt.logDebug)("Eip155Provider encountered an error:",r),r}})}connectReady(){return!0}restoreConnect(){return(0,bC.isDevice)("mobile")?window.okxwallet.request({method:"eth_requestAccounts"}):Promise.resolve()}parseConnectResponse(e,t,r,o,i,s){return Qc(this,void 0,void 0,function*(){try{let l=[];o.forEach(a=>{a.namespace===Rs.NameSpaceKeyEip155&&l.push(...a.chains)});let g=[],d={};return l.forEach(a=>{let c=(0,Nt.getChainId)(a),u=i.address.find(_=>_.chainId===c&&_.coinType===60||_.namespaceChainId===a);u&&(g.push(a+":"+u.address),d[a]={publicKey:u.publicKey})}),g&&g.length>0?{namespace:Rs.NameSpaceKeyEip155,addresses:g,methods:[...vC.Eip55Methods],extra:d}:void 0}catch(l){throw l}})}connect(){return Qc(this,void 0,void 0,function*(){return window.okxwallet.request({method:"eth_requestAccounts"})})}singleConnect(){return this.connect()}addListener(e){console.log("window.okxwallet configEventWithKey: eip155"),this.accountChangedEVMHandler=t=>{console.log("window.okxwallet configEventWithKey_evm:",Date.now(),"eip155",t),t&&t.length>0&&e()},window.okxwallet.on("accountsChanged",this.accountChangedEVMHandler)}removeListener(){this.accountChangedEVMHandler&&window.okxwallet.removeListener("accountsChanged",this.accountChangedEVMHandler)}};go.Eip155Provider=Zc});var Mh=$(br=>{"use strict";f();p();var CC=br&&br.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),OC=br&&br.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&CC(e,n,t)};Object.defineProperty(br,"__esModule",{value:!0});OC(Kh(),br)});var el=$(qn=>{"use strict";f();p();var EC=qn&&qn.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Wh=qn&&qn.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&EC(e,n,t)};Object.defineProperty(qn,"__esModule",{value:!0});Wh(Hn(),qn);Wh(Mh(),qn)});var Ds=$(mo=>{"use strict";f();p();var Is=mo&&mo.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(mo,"__esModule",{value:!0});mo.WsConnector=void 0;var tl=Kn(),Sn=He(),nl=class{constructor(){this.disconnectListener=[],this.walletName="",this.walletNameKey="",this.enable=!0,this.pendingRequests=new Map,(0,Sn.getDefaultReporter)().beginReport()}setAccountChangeListener(e){this.accountChangeListener=e}setConnectionManager(e){this.connectionManager=e}addConnectionListener(){var e;(e=this.connectionManager)===null||e===void 0||e.addListener("sdk_response",(t,r)=>{var o=(0,tl.safeJsonParse)(r);(0,Sn.logDebug)(`Engine ==>> addListener ==> success ==> ${o}`),this.handleResponse(t,o)},function(){})}addDisconnectListener(e){this.disconnectListener.push(e)}connectManagerDisconnect(){return Is(this,arguments,void 0,function*(e=!1){var t;yield(t=this.connectionManager)===null||t===void 0?void 0:t.disconnect(e)})}openWallet(e,t){}bindRequestForPromise(e,t){this.pendingRequests.set(e,t)}send(e,t,r){return Is(this,void 0,void 0,function*(){var o,i;try{delete e.injectParams}catch{}(0,Sn.logDebug)("Engine ==>> send  request==>",JSON.stringify(e));let s=this.getRequestId();try{let l=yield(o=this.connectionManager)===null||o===void 0?void 0:o.send(JSON.stringify(Object.assign(Object.assign({},e),{requestId:s})),r);l&&((i=this.connectionManager)===null||i===void 0||i.events.once(l.toString(),g=>{var d;(0,Sn.logDebug)(`Engine ==> send => onAck => ${(0,tl.safeJsonStringify)(g)}`),g&&g.result&&((d=t.onAck)===null||d===void 0||d.call(t))})),t.resolve&&this.bindRequestForPromise(s,t.resolve)}catch(l){return Promise.reject(l)}})}restoreconnect(e,t){return Is(this,void 0,void 0,function*(){var r;yield(r=this.connectionManager)===null||r===void 0?void 0:r.restoreConnect(e.topic),t(e)})}restoreconnectFromTopic(e){return Is(this,void 0,void 0,function*(){var t;yield(t=this.connectionManager)===null||t===void 0?void 0:t.restoreConnect(e)})}getRequestId(){let e=Date.now().toString();return(0,Sn.logDebug)("Engine ==>> getRequestId ==>",e),e}handleResponse(e,t){if((0,Sn.logDebug)(`Engine ==>> handleResponse_1  ======>response: ${(0,tl.safeJsonStringify)(t)}`,e),"requestId"in t){(0,Sn.logDebug)("Engine ==>> handleResponse_2  ===> in response");let r=t.requestId,o=this.pendingRequests.get(r);o?((0,Sn.logDebug)("Engine ==>> handleResponse_3  ===> find resolve:",o),o(t),this.pendingRequests.delete(r)):((0,Sn.logDebug)("Engine ==>> handleResponse_3  ===> not find resolve:"),t.method==="disconnect"&&(this.disconnectListener.forEach(i=>i()),this.disconnectListener=[],this.clearData()))}}getCurrentConnectionReady(){var e;return!!(!((e=this.connectionManager)===null||e===void 0)&&e.getCurrentConnectionReady())}saveSessionContent(e,t){var r;(r=this.connectionManager)===null||r===void 0||r.saveSessionContent(e,t)}getSessionContent(e){var t;return(t=this.connectionManager)===null||t===void 0?void 0:t.getSessionContent(e)}setOnConnectResultListener(e){this.connectResultListener=e}getTag(){return""}toJSON(){return"ws-connector"}clearData(){this.pendingRequests.clear()}};mo.WsConnector=nl});var jh=$(As=>{"use strict";f();p();Object.defineProperty(As,"__esModule",{value:!0});As.AppwalletConnector=void 0;var wC=Ds(),TC=po(),vr=tt(),rl=Gi(),SC=et(),ol=class extends wC.WsConnector{constructor(){super(),this.walletName="OKX App",this.walletNameKey="walletModal.mobileConnectionModal.connectApp"}getTag(){return TC.OKX_APP_WALLET}openWallet(e,t){var r;let o=t??SC.OpenAppLinkType.UniversalLink;if(e&&e.connectRequest){(0,vr.logDebug)(`appwallet-connector openwallet before useSHortLink engineConnectInfo.connectRequest JSON ${JSON.stringify(e)}`);let i=e.connectRequest;(0,vr.useShortLink)()||(i=Object.assign(Object.assign({},e.connectRequest),{redirect:(r=e.redirect)!==null&&r!==void 0?r:"none"}));let{universalLink:s,deepLink:l}=(0,vr.getOKXLink)(i);(0,vr.openOKXDeeplinkWithFallback)(l,s,o)}else(0,vr.isOS)("android")?(0,vr.openDeeplinkWithFallback)(rl.stackDeepLink,()=>{}):(0,vr.openOKXDeeplinkWithFallback)(rl.standardDeeplink,rl.shortUniversalLink,o)}};As.AppwalletConnector=ol});var Bh=$(Fn=>{"use strict";f();p();var il=Fn&&Fn.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})},NC=Fn&&Fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fn,"__esModule",{value:!0});Fn.SolProvider=void 0;var Jn=et(),Zt=tt(),RC=NC(ym()),IC=Tn(),DC=Hn(),sl=class{constructor(){this.accountChangedSolanaPublicKeyHandler=null}send(e){return il(this,void 0,void 0,function*(){var t;try{yield this.restoreConnect(),(0,Zt.logDebug)("SolProvider send request:",JSON.stringify(e));let i=e.method,s;if(e.injectParams)switch(i){case"solana_signMessage":if(e.injectParams&&typeof e.injectParams=="object"&&"message"in e.injectParams){var r=(t=e.injectParams)===null||t===void 0?void 0:t.message;let l=new TextEncoder().encode(r),g=yield window.okxwallet.solana.signMessage(l,"utf8");return s={method:e.method,result:RC.default.encode(g.signature)},(0,Zt.logDebug)("SolProvider send result:",JSON.stringify(g)),s}else throw new Jn.OKXConnectError(Jn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`param is error method: '${i}'`);break;case"solana_signTransaction":{let l=yield window.okxwallet.solana.signTransaction(e.injectParams);return(0,Zt.logDebug)("SolProvider send bufferResult:",JSON.stringify(l)),s={method:e.method,injectResult:l},(0,Zt.logDebug)("SolProvider send result:",(0,Zt.safeJsonStringify)(s)),s}break;case"solana_signAllTransactions":{let l=yield window.okxwallet.solana.signAllTransactions(e.injectParams);return(0,Zt.logDebug)("SolProvider send result:",(0,Zt.safeJsonStringify)(l)),s={method:e.method,injectResult:l},s}break;case"solana_signAndSendTransaction":{var o=yield window.okxwallet.solana.signAndSendTransaction(e.injectParams);return(0,Zt.logDebug)("SolProvider send result:",(0,Zt.safeJsonStringify)(o)),s={method:e.method,injectResult:o},s}break;default:throw new Jn.OKXConnectError(Jn.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,`method: '${i}'`)}else throw new Jn.OKXConnectError(Jn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`param is error method: '${i}'`)}catch(i){throw(0,Zt.logDebug)("SolProvider send error:",i),i}})}connectReady(){return!0}disconnect(){}restoreConnect(){return(0,IC.isDevice)("mobile")?this.connect():Promise.resolve()}parseConnectResponse(e,t,r,o,i,s){return il(this,void 0,void 0,function*(){let l=[];o.forEach(c=>{c.namespace===Jn.NameSpaceKeySOL&&l.push(...c.chains)});let g=[],d={},a={};if(l.forEach(c=>{let u=i.address.find(_=>_.chainId==="501"&&_.coinType===501||_.namespaceChainId===c);u&&(g.push(c+":"+u.address),a&&"publicKey"in a?d[c]=a:d[c]={publicKey:u.publicKey})}),g&&g.length>0){let c={namespace:Jn.NameSpaceKeySOL,addresses:g,methods:[...DC.SOLANAMethods],extra:d};return(0,Zt.logDebug)("parseConnectResponse nameSpaceResponse :",JSON.stringify(c)),c}})}connect(){return il(this,void 0,void 0,function*(){return window.okxwallet.solana.connect()})}singleConnect(){return this.connect()}addListener(e){console.log("window.okxwallet configEventWithKey:","sol"),this.accountChangedSolanaPublicKeyHandler=t=>{console.log("window.okxwallet configEventWithKey_solana:",Date.now(),"sol",t),t&&e()},window.okxwallet.solana.on("accountChanged",this.accountChangedSolanaPublicKeyHandler)}removeListener(){this.accountChangedSolanaPublicKeyHandler&&window.okxwallet.solana.removeListener("accountChanged",this.accountChangedSolanaPublicKeyHandler)}};Fn.SolProvider=sl});var Xh=$(_o=>{"use strict";f();p();var al=_o&&_o.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(_o,"__esModule",{value:!0});_o.AptosProvider=void 0;var $n=et(),yt=tt(),AC=Hn(),Uh=Tn(),PC=us(),kC=Object.freeze(["637","70000060","70000066"]),Ps=new Map;Ps.set("aptos:637","Mainnet");Ps.set("aptos:70000060","Movement Testnet");Ps.set("aptos:70000066","Movement Mainnet");var cl=class{send(e){return al(this,void 0,void 0,function*(){try{(0,yt.logDebug)("AptosProvider send request:",(0,yt.safeJsonStringify)(e)),yield this.restoreConnect();let t=yield window.okxwallet.aptos.network(),r=this.searchChainIdToInjectChainName(e.chainId);if((0,yt.logDebug)("AptosProvider send network and searchNetwork:",t,"-----",r),!(t&&r&&t.toLowerCase()===r.toLowerCase()))throw new $n.OKXConnectError($n.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Please switch your wallet link to '${r}'`);let o=e.method,i;switch(o){case"aptos_signMessage":if(e.injectParams){let s=yield window.okxwallet.aptos.signMessage(e.injectParams);return i={method:e.method,result:s.signature,injectResult:s},(0,yt.logDebug)("AptosProvider send result:",(0,yt.safeJsonStringify)(i)),i}else throw new $n.OKXConnectError($n.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`param is error method: '${o}'`);break;case"aptos_signTransaction":{(0,yt.logDebug)("AptosProvider Method>>>> :",o);let s=yield window.okxwallet.aptos.signTransaction(e.params);return i={method:e.method,result:s},(0,yt.logDebug)("AptosProvider send result:",(0,yt.safeJsonStringify)(i)),i}break;case"aptos_signAndSubmitTransaction":{(0,yt.logDebug)("AptosProvider Method>>>> :",o);let s=yield window.okxwallet.aptos.signAndSubmitTransaction(e.params);return i={method:e.method,result:s.hash},(0,yt.logDebug)("AptosProvider send result:",(0,yt.safeJsonStringify)(i)),i}break;default:throw new $n.OKXConnectError($n.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,` method: '${o}'`)}}catch(t){throw(0,yt.logDebug)("AptosProvider send error:",t),t}})}searchChainIdToInjectChainName(e){let t=e;return Ps.forEach((r,o)=>{e.includes(o)&&(t=r)}),t}connectReady(){return!0}disconnect(){}restoreConnect(){return(0,Uh.isDevice)("mobile")?this.connect():Promise.resolve()}parseConnectResponse(e,t,r,o,i,s){return al(this,void 0,void 0,function*(){let l=[];o.forEach(c=>{c.namespace===$n.NameSpaceKeyAptos&&l.push(...c.chains)});let g=[],d={};(0,yt.logDebug)("AptosProvider parseConnectResponse connectChain",JSON.stringify(l));let a;if(!(0,Uh.isDevice)("mobile")&&l&&l.length>0&&(a=(yield window.okxwallet.aptos.connect()).publicKey),l.forEach(c=>{let u=i.address.find(_=>kC.includes(_.chainId)&&_.coinType===637||_.namespaceChainId===c);u&&(g.push(c+":"+u.address),d[c]={publicKey:u.publicKey?u.publicKey:a})}),(0,yt.logDebug)("AptosProvider parseConnectResponse addresses",JSON.stringify(g)),g&&g.length>0)return{namespace:$n.NameSpaceKeyAptos,addresses:g,methods:[...AC.AptosMethods],extra:d}})}connect(){return al(this,void 0,void 0,function*(){return window.okxwallet.aptos.connect()})}singleConnect(){return this.connect()}addListener(e){window.okxwallet.aptos.onAccountChange(t=>{console.log("window.okxwallet configEventWithKey_aptos:",Date.now(),PC.key,JSON.stringify(t)),t&&e()})}removeListener(){}};_o.AptosProvider=cl});var Hh=$(yo=>{"use strict";f();p();var ll=yo&&yo.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(yo,"__esModule",{value:!0});yo.TONProvider=void 0;var ft=et(),lt=tt(),LC=Tn(),xC=Hn(),ul=class{constructor(){this.signalChainConnectResult=void 0,this.accountChangedTONHandler=null}send(e){return ll(this,void 0,void 0,function*(){try{(0,lt.logDebug)("TONProvider send request:",(0,lt.safeJsonStringify)(e));let t=null;switch(e.method){case"ton_sendTransaction":e.params&&(t={method:"sendTransaction",params:[JSON.stringify(e.params)],id:Date.now().toString()},(0,lt.logDebug)("TONProvider tonParams first:",JSON.stringify(t)));break;default:throw new ft.OKXConnectError(ft.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED)}if(t){let r=yield window.okxTonWallet.tonconnect.send(t);if((0,lt.logDebug)("TONProvider send request result:",(0,lt.safeJsonStringify)(r)),r.error)throw new ft.OKXConnectError(r.error.code,r.error.message);return{result:r.result,method:e.method}}else throw new ft.OKXConnectError(ft.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED)}catch(t){throw(0,lt.logDebug)("TONProvider encountered an error:",t),t}})}connectReady(){return!0}restoreConnect(){return Promise.resolve()}parseConnectResponse(e,t,r,o,i,s){return ll(this,void 0,void 0,function*(){try{let l=[];o.forEach(a=>{a.namespace===ft.NameSpaceKeyTON&&l.push(...a.chains)});let g=[],d={};if(l.forEach(a=>{let c=(0,lt.getChainId)(a),u=i.address.find(_=>_.chainId==="607"&&_.coinType===607||_.namespaceChainId===a);u&&(g.push(a+":"+u.address),d[a]={publicKey:u.publicKey})}),(0,lt.logDebug)("tonprovider parseConnectResponse needPop and addresses: ",e,JSON.stringify(g)),g&&g.length>0){let a=o.find(u=>u.namespace===ft.NameSpaceKeyTON);(0,lt.logDebug)("tonprovider parseConnectResponse ton: ",JSON.stringify(a));let c;if(a&&a.params&&s&&s.manifestUrl){this.dappInfo=s;let u=[a.params.ton_addr],_={manifestUrl:s.manifestUrl,items:u};(e||t)&&a.params.ton_proof&&u.push(a.params.ton_proof),(0,lt.logDebug)("parseConnectResponse ton connect params: ",JSON.stringify(_)),(0,LC.isDevice)("mobile")?c=yield window.okxTonWallet.tonconnect.connect(2,_):e||t?c=yield window.okxTonWallet.tonconnect.connect(2,_):c=yield window.okxTonWallet.tonconnect.restoreConnection()}else throw new ft.OKXConnectError(ft.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"manifestUrl is nil");if(r&&this.signalChainConnectResult&&(c=this.signalChainConnectResult,this.signalChainConnectResult=void 0),(0,lt.logDebug)("parseConnectResponse ton connect result: ",JSON.stringify(c)),c&&a){if(c.event==="connect_error")throw new ft.OKXConnectError(c.payload.code,c.payload.message);{let u=c.payload.items.find(N=>N.name==="ton_addr"),_=c.payload.items.find(N=>N.name==="ton_proof");return(0,lt.logDebug)("tonprovider connect isSignalChain: ",r),{namespace:ft.NameSpaceKeyTON,addresses:g,methods:[...xC.TONMethods],extra:d,data:{ton_addr:u,ton_proof:_,manifestUrl:s.manifestUrl}}}}}return}catch(l){throw(0,lt.logDebug)("tonprovider parseConnectResponse error: ",JSON.stringify(l)),l}})}connect(e,t){return ll(this,void 0,void 0,function*(){if(e&&t&&t.manifestUrl&&e.params){this.dappInfo=t;let r=[e.params.ton_addr],o={manifestUrl:t.manifestUrl,items:r};e.params.ton_proof&&r.push(e.params.ton_proof),(0,lt.logDebug)("tonprovider connect params: ",JSON.stringify(o));try{let i=yield window.okxTonWallet.tonconnect.connect(2,o);return(0,lt.logDebug)("tonprovider connect tonResult: ",JSON.stringify(i)),this.signalChainConnectResult=i,i}catch(i){throw(0,lt.logDebug)("tonprovider connect error: ",JSON.stringify(i)),new ft.OKXConnectError(ft.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"tonconnect error")}}else throw new ft.OKXConnectError(ft.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"manifestUrl or params is nil")})}singleConnect(e,t){return this.connect(e,t)}addListener(e){console.log("window.okxwallet configEventWithKey:","ton"),this.accountChangedTONHandler=()=>{console.log("window.okxwallet configEventWithKey_TON:",Date.now(),"ton"),e()},window.okxTonWallet.tonconnect.on("accountChanged",this.accountChangedTONHandler)}removeListener(){this.accountChangedTONHandler&&window.okxTonWallet.tonconnect.off("accountChanged",this.accountChangedTONHandler)}};yo.TONProvider=ul});var Jh=$(bo=>{"use strict";f();p();var ks=bo&&bo.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(bo,"__esModule",{value:!0});bo.SuiProvider=void 0;var qh=et(),dl=tt(),KC=Tn(),MC=Hn(),fl=class{constructor(){this.accountChangedHandler=null}connectReady(){return!0}getSuiPublicKey(){return ks(this,void 0,void 0,function*(){return(yield this.connect()).accounts[0].publicKey})}parseConnectResponse(e,t,r,o,i,s){return ks(this,void 0,void 0,function*(){try{let l=[];o.forEach(c=>{c.namespace===qh.NameSpaceKeySui&&l.push(...c.chains)});let g=[],d={};if(l.length==0)return;let a=yield this.getSuiPublicKey();return l.forEach(c=>{var u;let _=(0,dl.getChainId)(c),y=i.address.find(N=>N.coinType===784||N.namespaceChainId===c);y&&(g.push(c+":"+y.address),d[c]={publicKey:(u=y.publicKey)!==null&&u!==void 0?u:a})}),g&&g.length>0?{namespace:qh.NameSpaceKeySui,addresses:g,methods:[...MC.SuiMethods],extra:d}:void 0}catch(l){throw l}})}restoreConnect(){return(0,KC.isDevice)("mobile")?this.connect():Promise.resolve()}getSuiWallet(){return window.okxwallet.sui}send(e){return ks(this,void 0,void 0,function*(){try{yield this.restoreConnect(),(0,dl.logDebug)("suiProvider send request:",JSON.stringify(e));let t=e.method,r;if(e.injectParams&&this.getSuiWallet()){let o=e.injectParams;switch(t){case"sui_signTransactionBlock":r={method:"sui_signTransactionBlock",result:(yield this.getSuiWallet().features["sui:signTransactionBlock"].signTransactionBlock(o)).signature};break;case"sui_signAndExecuteTransactionBlock":r={method:"sui_signAndExecuteTransactionBlock",result:(yield this.getSuiWallet().features["sui:signAndExecuteTransactionBlock"].signAndExecuteTransactionBlock(o)).digest};break;case"sui_signMessage":r={method:"sui_signMessage",result:(yield this.getSuiWallet().features["sui:signMessage"].signMessage(o)).signature};break;case"sui_signPersonalMessage":r={method:"sui_signPersonalMessage",result:(yield this.getSuiWallet().features["sui:signPersonalMessage"].signPersonalMessage(o)).signature};break}}return r}catch(t){throw(0,dl.logDebug)("suiProvider send error:",t),t}})}connect(){return ks(this,void 0,void 0,function*(){var e;return(e=this.getSuiWallet())===null||e===void 0?void 0:e.features["standard:connect"].connect()})}singleConnect(){return this.connect()}addListener(e){console.log("window.okxwallet configEventWithKey:","sui"),this.accountChangedHandler=t=>{console.log("window.okxwallet configEventWithKey_sui:",Date.now(),"sui",t),t&&e()},window.okxwallet.sui.on("accountChanged",this.accountChangedHandler)}removeListener(){this.accountChangedHandler&&window.okxwallet.sui.removeListener("accountChanged",this.accountChangedHandler)}};bo.SuiProvider=fl});var Fh=$(Co=>{"use strict";f();p();var vo=Co&&Co.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(Co,"__esModule",{value:!0});Co.BtcProvider=void 0;var gn=et(),Ls=tt(),WC=Hn(),jC=Tn(),pl=class{constructor(){this.accountChangedBtcHandler=null}connect(){return window.okxwallet.unisat.connect()}switchChain(e){return vo(this,void 0,void 0,function*(){let t=window.okxwallet.unisat;switch(e){case gn.BTC_CHAINS.MAINNET:yield t.switchChain("BITCOIN_MAINNET");break;case gn.BTC_CHAINS.FRACTAL:yield t.switchChain("FRACTAL_BITCOIN_MAINNET");break}})}connectReady(){return!0}parseConnectResponse(e,t,r,o,i){return vo(this,void 0,void 0,function*(){try{let s=[];o.forEach(u=>{u.namespace===gn.NameSpaceKeyBtc&&s.push(...u.chains)});let l=[],g={};if(s.length==0)return;let d=(u,_)=>u.find(y=>{let N=y.name==="bitcoin"&&_===gn.BTC_CHAINS.MAINNET||y.name==="fractalbitcoin"&&_===gn.BTC_CHAINS.FRACTAL;return y.coinType===0&&N||y.namespaceChainId===_}),a=u=>vo(this,void 0,void 0,function*(){let _=d(i.address,u);if(!_)return;l.push(u+":"+_.address);let y=yield this.connect();g[u]={publicKey:y.publicKey,compressedPublicKey:y.compressedPublicKey}}),c=s.map(a);return yield Promise.all(c),l&&l.length>0?{namespace:gn.NameSpaceKeyBtc,addresses:l,methods:[...WC.BtcMethods],extra:g}:void 0}catch(s){throw s}})}restoreConnect(){return vo(this,void 0,void 0,function*(){return(0,jC.isDevice)("mobile")?this.connect():Promise.resolve()})}send(e){return vo(this,void 0,void 0,function*(){try{(0,Ls.logDebug)("btcProvider send request:",JSON.stringify(e));let t=e.method,r=e.chainId;yield this.restoreConnect(),yield this.switchChain(r);let o;if(e.params)switch(t){case"btc_signMessage":{let{signStr:i,type:s}=e.params||{},l=yield window.okxwallet.unisat.signMessage(i,s);return{method:e.method,result:l}}case"btc_send":{let{from:i,to:s,value:l,satBytes:g}=e.params||{},d=yield window.okxwallet.unisat.send({from:i,to:s,value:l,satBytes:g});return{method:e.method,result:d}}case"btc_signPsbts":{let{psbtHexs:i,options:s}=e.params||{},l;if(Array.isArray(i)&&i.length===1){let g;Array.isArray(s)?g=yield window.okxwallet.unisat.signPsbt(i[0],s.length>0&&typeof s[0]=="object"?s[0]:void 0):g=yield window.okxwallet.unisat.signPsbt(i[0]),l=[g]}else l=yield window.okxwallet.unisat.signPsbts(i,s);return{method:e.method,result:(0,Ls.safeJsonStringify)(l)}}case"btc_signAndPushPsbt":{let{psbtHex:i,options:s}=e.params||{},l=yield window.okxwallet.unisat.signPsbt(i,s),g=yield window.okxwallet.unisat.pushPsbt(l);return{method:e.method,result:(0,Ls.safeJsonStringify)({signedPsbt:l,txHash:g})}}case"btc_sendInscription":{let{address:i,inscriptionId:s,options:l}=e.injectParams||{},g=yield window.okxwallet.unisat.sendInscription(i,s,l);return{method:e.method,result:g}}case"btc_inscribeTransfer":if(this.hasFunction("inscribeTransfer")){let{ticker:i,amount:s}=e.params||{},l=yield window.okxwallet.unisat.inscribeTransfer(i,s);return{method:e.method,result:l}}case"btc_sendRunes":if(this.hasFunction("sendRunes")){let{address:i,runeid:s,amount:l,options:g}=e.injectParams||{},d=yield window.okxwallet.unisat.sendRunes(i,s,l,g);return{method:e.method,result:d}}default:throw new gn.OKXConnectError(gn.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,`method: '${t}' not support`)}else throw new gn.OKXConnectError(gn.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,`param is error method: '${t}'`)}catch(t){throw(0,Ls.logDebug)("BtcProvider send error:",t),t}})}hasFunction(e){return!!(window.okxwallet&&window.okxwallet.unisat&&typeof window.okxwallet.unisat[e]=="function")}singleConnect(e){return vo(this,void 0,void 0,function*(){return e.chains.length==1?this.connect():!1})}addListener(e){this.accountChangedBtcHandler=t=>{console.log("window.okxwallet btc:",Date.now(),"btc",t),t&&t.length>0&&e()},window.okxwallet.unisat.on("accountsChanged",this.accountChangedBtcHandler)}removeListener(){window.okxwallet.unisat.removeListener("accountsChanged",this.accountChangedBtcHandler)}};Co.BtcProvider=pl});var xs=$(Oo=>{"use strict";f();p();var Cr=Oo&&Oo.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(Oo,"__esModule",{value:!0});Oo.InjectConnector=void 0;var ae=et(),Te=tt(),BC=po(),UC=Bh(),XC=jo(),HC=Xh(),hl=Tn(),qC=Hh(),JC=el(),FC=Jh(),$h=xt(),$C=Gc(),VC=Fh(),gl=class{constructor(){this.disconnectListener=[],this.providerMap=new Map,this.disconnectHandler=null,this.walletName="",this.walletNameKey="",this.enable=!0,this.providerMap.set(ae.NameSpaceKeyEip155,new JC.Eip155Provider),this.providerMap.set(ae.NameSpaceKeySOL,new UC.SolProvider),this.providerMap.set(ae.NameSpaceKeyAptos,new HC.AptosProvider),this.providerMap.set(ae.NameSpaceKeyTON,new qC.TONProvider),this.providerMap.set(ae.NameSpaceKeySui,new FC.SuiProvider),this.providerMap.set(ae.NameSpaceKeyBtc,new VC.BtcProvider)}setAccountChangeListener(e){(0,Te.logDebug)("setAccountChangeListener: inject",e),this.accountChangeListener=e}setConnectionManager(e){this.connectionManager=e}getInjectProvider(e){if(!!e){for(let[t,r]of this.providerMap.entries())if(e.includes(t))return r}}openWallet(e,t){return Cr(this,void 0,void 0,function*(){var r,o,i;if((0,Te.logDebug)("InjectEngine connect begin:",JSON.stringify(e)),!e)throw new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR);this.dappInfo=e.connectRequest.dAppInfo;var s=e.connectRequest;try{if(window&&window.okxwallet){if(s.requests){let a=s.requests.find(T=>T.name==="requestAccounts"),c=yield window.okxwallet.getVersion(),u={method:"connect",requestId:s.requestId,payload:{wallet:{platform:(r=navigator.platform)!==null&&r!==void 0?r:"/",appName:XC.OKXInjectWalletName,appVersion:c??"1.0.0",maxProtocolVersion:1},responses:[]}},_={name:"requestAccounts",accounts:[]};u.payload.responses.push(_),yield this.disconnect();let y=(o=a.requiredNamespaces)!==null&&o!==void 0?o:[],N=(i=a.optionalNamespaces)!==null&&i!==void 0?i:[],X=!0,D=!1;if(y.length+N.length===1&&!(0,hl.isDevice)("mobile")){let T=y.length===1?y[0]:N[0],L=this.getInjectProvider(T.namespace);(yield L?.singleConnect(T,this.dappInfo))&&(D=!0,X=!1)}var l=yield this.getAccountByRequestWallets(X,!1,D,y,N);if(l){if(_.accounts.push(...l),_.accounts.length===0)throw new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect connectAccounts is null")}else throw new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect requestWallets is null");this.connectResultListener&&(this.disconnectHandler&&window.okxwallet.removeListener("disconnect",this.disconnectHandler),this.disconnectHandler=()=>{console.log("window.okxwallet disconnect:"),this.disconnectListener.forEach(T=>T()),this.disconnectListener=[]},window.okxwallet.on("disconnect",this.disconnectHandler),this.connectResultListener(u))}}else throw new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR)}catch(a){var g=ae.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,d="";a instanceof ae.OKXConnectError&&(g=a.code,d=a.message),this.connectResultListener&&this.connectResultListener({requestId:"-1",method:"connect_error",payload:{code:g}})}})}disconnect(){return Cr(this,void 0,void 0,function*(){(0,Te.logDebug)("InjectEngine ==>> disconnect  okxwallet.disconnect()"),window.okxwallet&&(yield window.okxwallet.disconnect(),(0,Te.logDebug)("InjectEngine ==>> disconnect end okxwallet.disconnect()"))})}getRequestId(){let e=Date.now().toString();return(0,Te.logDebug)("InjectEngine ==>> getRequestId ==>",e),e}send(e,t){return Cr(this,void 0,void 0,function*(){var r;try{(0,Te.logDebug)("InjectEngine send  > request:",(0,Te.safeJsonStringify)(e));let o=e;if(o.method==="disconnect"){yield this.disconnect(),this.disconnectListener.forEach(s=>s()),this.disconnectListener=[],(r=t.onAck)===null||r===void 0||r.call(t);return}yield this.checkWalletMatch();let i=this.getInjectProvider((0,Te.getNamespaceKeyByChain)(o.chainId));if(i){i.send(o).then(s=>{var l;(0,Te.logDebug)("InjectEngine ==>> send > result:",s),(l=t.resolve)===null||l===void 0||l.call(t,s)}).catch(s=>{var l;let g=s.code;g===4001&&(g=ae.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR);let d={requestId:this.getRequestId(),method:e.method,error:{code:g,message:s.message}};(0,Te.logDebug)("InjectEngine ==>> send > errorResponse:",JSON.stringify(d)),(l=t.resolve)===null||l===void 0||l.call(t,d)});return}else throw new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.CHAIN_NOT_SUPPORTED)}catch(o){return(0,Te.logDebug)("InjectEngine ==>> send  ===> error:",o),Promise.reject(o)}})}checkWalletMatch(){return Cr(this,void 0,void 0,function*(){return new Promise((e,t)=>{var r;let o=(r=this.connectionManager)===null||r===void 0?void 0:r.getSessionContent("connectSession");o||t(new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED)),this.restoreconnect(o,i=>{i?e():t(new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED))})})})}checkAccountChanged(){return Cr(this,void 0,void 0,function*(){var e;try{let t=(e=this.connectionManager)===null||e===void 0?void 0:e.getSessionContent("connectSession");if(!t)throw new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);(0,Te.logDebug)("inject-connector checkAccountChanged --sessionInfo:",JSON.stringify(t));let r=this.getRequireNameSpaceFromSession(t);(0,Te.logDebug)("inject-connector checkAccountChanged --requiredNamespaces:",JSON.stringify(r));let o=yield this.getAccountByRequestWallets(!1,!0,!1,r,[]);if((0,Te.logDebug)("inject-connector checkAccountChanged --accounts:",JSON.stringify(o)),o){let i={};(0,$C.buildAccountNameSpaces)(o,i),this.compareAndModifyNamespaces(t.namespaces,i)||((0,Te.logDebug)("inject-connector checkAccountChanged --result sessionLocal:",JSON.stringify(t)),this.accountChangeListener?((0,Te.logDebug)("inject-connector checkAccountChanged -accountChangeListener:",this.accountChangeListener),this.accountChangeListener(t)):((0,Te.logDebug)("inject-connector checkAccountChanged disconnect:"),yield this.disconnect()))}else throw new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect requestWallets is null")}catch(t){throw(0,Te.logDebug)("inject-connector restoreconnect catch error",JSON.stringify(t)),t}})}compareAndModifyNamespaces(e,t){let r=!0;for(let o in e)if(t[o]){let i=e[o],s=t[o];(0,Te.logDebug)("inject-connector checkAccountChanged ns1:",JSON.stringify(i)),(0,Te.logDebug)("inject-connector checkAccountChanged ns2:",JSON.stringify(s)),JSON.stringify([...i.accounts].sort())===JSON.stringify([...s.accounts].sort())||(r=!1,i.accounts=[...s.accounts],i.extra=Object.assign({},s.extra),i.payload=Object.assign({},s.payload)),(0,Te.logDebug)("inject-connector checkAccountChanged new ns1:",JSON.stringify(i))}return(0,Te.logDebug)(`inject-connector checkAccountChanged compareAndModifyNamespaces ===> ${r}`),r}clearData(){this.connectResultListener=void 0}addDisconnectListener(e){this.disconnectListener.push(e)}setOnConnectResultListener(e){this.connectResultListener=e}connectManagerDisconnect(){return Cr(this,arguments,void 0,function*(e=!1){})}getCurrentConnectionReady(e){return e?e.every(r=>{var o;return(o=this.getInjectProvider(r))===null||o===void 0?void 0:o.connectReady()}):!1}getTag(){return BC.OKX_INJECT_WALLET}toJSON(){return"inject-connector"}getRequireNameSpaceFromSession(e){var t,r,o=[];for(let i in e.namespaces){let s=e.namespaces[i],l={namespace:i,chains:s.chains};if(i===ae.NameSpaceKeyAptos){let g=[];s.chains.forEach(d=>{let a=(0,$h.replaceChainNameToChainId)(d);g.push(a)}),l={namespace:i,chains:g}}else if(i===ae.NameSpaceKeyTON){let g,d;!((t=s.payload)===null||t===void 0)&&t.ton_proof&&(g=(r=s.payload)===null||r===void 0?void 0:r.ton_proof,g.proof.payload&&(d={name:"ton_proof",payload:g.proof.payload})),l={namespace:i,chains:s.chains,params:{ton_addr:{name:"ton_addr"},ton_proof:d}}}o.push(l)}return o}restoreconnect(e,t){var r;if(!window.okxwallet){t(null);return}this.dappInfo=(r=e.sessionConfig)===null||r===void 0?void 0:r.dappInfo,(0,Te.logDebug)("inject-connector restoreconnect --sessionInfo:",JSON.stringify(e));var o=this.getRequireNameSpaceFromSession(e);(0,Te.logDebug)("inject-connector restoreconnect --requiredNamespaces:",JSON.stringify(o)),this.getAccountByRequestWallets(!1,!1,!1,o,[]).then(i=>{(0,Te.logDebug)("inject-connector restoreconnect --accounts:",JSON.stringify(i));let s=!0;for(let d in e.namespaces){var l=i.find(u=>u.namespace===d),g=e.namespaces[d].accounts;if(!l)throw new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"resotreconnect error: accountItem error");let a=g;d===ae.NameSpaceKeyAptos&&a&&a.length>0&&(a=g.map(u=>(0,$h.replaceChainNameToChainId)(u))),l.addresses.length===a.length&&l.addresses.slice().sort().every((u,_)=>{if(d===ae.NameSpaceKeyAptos){let y=a.slice().sort()[_];return(0,Te.logDebug)("check aptos address -value and aptosAdd--",u,y),y===u}else return u===a.slice().sort()[_]})||(s=!1)}if(s)t(e);else throw new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"resotreconnect error: address not as same as session")}).catch(i=>{(0,Te.logDebug)("inject-connector restoreconnect catch error",JSON.stringify(i)),t(null)})}getAccountByRequestWallets(e,t,r,o,i){return Cr(this,void 0,void 0,function*(){try{var s=[],l=[];if((0,hl.isDevice)("mobile")){var g=yield window.okxwallet.connectWallet(e,{requiredNamespaces:o,optionalNamespaces:i});s.push(g)}else s=yield window.okxwallet.requestWallets(e);var d=[...o??[],...i??[]];let a=s[0];(0,Te.logDebug)(" InjectEngine connect connectAccounts:",JSON.stringify(a));let c;if(d&&a&&a.address)for(let[_,y]of this.providerMap.entries()){let N=yield y.parseConnectResponse(e,t,r,d,a,this.dappInfo);N&&(c=_,l.push(N))}let u=o.every(_=>{let y=l.find(N=>N.namespace===_.namespace);return y?_.chains.every(X=>!!y.addresses.find(T=>T.startsWith(X+":"))):!1});if((0,Te.logDebug)("InjectEngine connect requiredNamespaces:",JSON.stringify(o)),(0,Te.logDebug)("InjectEngine connect accountResult:",JSON.stringify(l)),!u)throw yield this.disconnect(),new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.CHAIN_NOT_SUPPORTED);return(0,hl.isDevice)("mobile")||(this.configEventWithKey(c),yield window.okxwallet.requestWallets(e)),l}catch(a){throw a&&typeof a=="object"&&"code"in a&&a.code===4001?new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR):new ae.OKXConnectError(ae.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR)}})}configEventWithKey(e){var t,r;for(let o in this.providerMap)(t=this.providerMap.get(o))===null||t===void 0||t.removeListener();(r=this.getInjectProvider(e))===null||r===void 0||r.addListener(()=>{this.checkAccountChanged().catch(o=>{console.log("window.okxwallet configEventWithKey error: ",o)})})}};Oo.InjectConnector=gl});var Vh=$(Ks=>{"use strict";f();p();Object.defineProperty(Ks,"__esModule",{value:!0});Ks.TgwalletConnector=void 0;var GC=Ds(),YC=po(),ml=tt(),_l=class extends GC.WsConnector{constructor(){super(),this.walletName="OKX Mini Wallet",this.walletNameKey="walletModal.mobileConnectionModal.connectMini"}getTag(){return YC.OKX_TG_WALLET}openWallet(e,t){var r,o;e&&e.connectRequest&&(o=(0,ml.encodeTWAConnectURLParams)(Object.assign(Object.assign({},e.connectRequest),{redirect:"none"})));var i=(0,ml.getTelegramWalletTWAUrl)(o,(r=e?.tmaReturnUrl)!==null&&r!==void 0?r:"back");(0,ml.openOKXTMAWalletlinkWithFallback)(i)}};Ks.TgwalletConnector=_l});var Gh=$(Ms=>{"use strict";f();p();Object.defineProperty(Ms,"__esModule",{value:!0});Ms.OkxwalletInjectConnector=void 0;var zC=xs(),yl=class extends zC.InjectConnector{constructor(){super(),this.walletName="OKX Wallet extension",this.walletNameKey="walletModal.mobileConnectionModal.connectInjected"}};Ms.OkxwalletInjectConnector=yl});var Yh=$(Eo=>{"use strict";f();p();var QC=Eo&&Eo.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{d(r.next(a))}catch(c){s(c)}}function g(a){try{d(r.throw(a))}catch(c){s(c)}}function d(a){a.done?i(a.value):o(a.value).then(l,g)}d((r=r.apply(n,e||[])).next())})};Object.defineProperty(Eo,"__esModule",{value:!0});Eo.OkxwalletInjectTonsdkConnector=void 0;var ZC=xs(),Vn=et(),eO=tt(),tO=Tn(),bl=class extends ZC.InjectConnector{constructor(){super(),this.walletName="OKX Wallet extension",this.walletNameKey="walletModal.mobileConnectionModal.connectInjected"}checkWalletMatch(){return QC(this,void 0,void 0,function*(){var e,t,r;(e=this.connectionManager)===null||e===void 0||e.tonsdkConnectStorage.synchronizedCache();let o=(t=this.connectionManager)===null||t===void 0?void 0:t.tonsdkConnectStorage.getItem("ton_connect_info_adapter_universal");if(!o||!o?.content)throw new Vn.OKXConnectError(Vn.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR);let i=o?.content,s=JSON.parse(i),l=s.connectEvent.payload.items.find(d=>"name"in d?d.name==="ton_addr":!1);this.dappInfo=s.dappInfo;let g;if(l&&"address"in l&&(g=l.address),!g)throw new Vn.OKXConnectError(Vn.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);if((0,eO.logDebug)(`inject-connector localTonaddress : ${g}`),(0,tO.isDevice)("mobile")){let d,a;d={namespace:Vn.NameSpaceKeyTON,chains:[Vn.TON_CHAINS.MAINNET],params:{ton_addr:{name:"ton_addr"}}};let c=yield this.getAccountByRequestWallets(!1,!1,!1,[d],[]);if(c&&c.length==1){let _=(r=c[0].data)===null||r===void 0?void 0:r.ton_addr,y=_?.address;if(g===y)return}}else{let d=yield window.okxTonWallet.tonconnect.restoreConnection();if(d.event==="connect"&&d.payload.items.find(c=>c.name==="ton_addr").address==g)return}throw new Vn.OKXConnectError(Vn.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED)})}};Eo.OkxwalletInjectTonsdkConnector=bl});var zh=$(Be=>{"use strict";f();p();Object.defineProperty(Be,"__esModule",{value:!0});Be.OkxwalletInjectTonsdkConnector=Be.OkxwalletInjectConnector=Be.WsConnector=Be.TgwalletConnector=Be.InjectConnector=Be.getTagByappName=Be.OKX_INJECT_WALLET=Be.OKX_APP_WALLET=Be.OKX_TG_WALLET=Be.AppwalletConnector=void 0;var nO=jh();Object.defineProperty(Be,"AppwalletConnector",{enumerable:!0,get:function(){return nO.AppwalletConnector}});var Ws=po();Object.defineProperty(Be,"OKX_TG_WALLET",{enumerable:!0,get:function(){return Ws.OKX_TG_WALLET}});Object.defineProperty(Be,"OKX_APP_WALLET",{enumerable:!0,get:function(){return Ws.OKX_APP_WALLET}});Object.defineProperty(Be,"OKX_INJECT_WALLET",{enumerable:!0,get:function(){return Ws.OKX_INJECT_WALLET}});Object.defineProperty(Be,"getTagByappName",{enumerable:!0,get:function(){return Ws.getTagByappName}});var rO=xs();Object.defineProperty(Be,"InjectConnector",{enumerable:!0,get:function(){return rO.InjectConnector}});var oO=Vh();Object.defineProperty(Be,"TgwalletConnector",{enumerable:!0,get:function(){return oO.TgwalletConnector}});var iO=Ds();Object.defineProperty(Be,"WsConnector",{enumerable:!0,get:function(){return iO.WsConnector}});var sO=Gh();Object.defineProperty(Be,"OkxwalletInjectConnector",{enumerable:!0,get:function(){return sO.OkxwalletInjectConnector}});var aO=Yh();Object.defineProperty(Be,"OkxwalletInjectTonsdkConnector",{enumerable:!0,get:function(){return aO.OkxwalletInjectTonsdkConnector}})});var vl=$(en=>{"use strict";f();p();var cO=en&&en.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),ni=en&&en.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&cO(e,n,t)};Object.defineProperty(en,"__esModule",{value:!0});ni(Lh(),en);ni(et(),en);ni(tt(),en);ni(el(),en);ni(zh(),en)});f();p();var me=q(Ce()),Rg=q(it()),Vs=q(vn()),Gs=q(Pr());ot();bm();f();p();f();p();var Et=q(Ce()),Md=q(vn());ot();f();p();var _a=q(Ce());gm();var xd=({walletIds:n})=>{let e=(0,_a.useCallback)(async()=>{try{return await ca().fetchApprovalRisk({accountIds:n})}catch{return{}}},[n]),t=(0,_a.useCallback)(async()=>{await ca().setApprovalRiskRemindLater()},[]);return{fetchApprovalRisk:e,remindLater:t}};f();p();var Kd={btn:"_btn_l5kiz_1"};var Wd=({walletId:n,onFetchApprovalRisk:e})=>{let[t,r]=Et.default.useState(!1),o=(0,Et.useMemo)(()=>({walletIds:[n]}),[n]),{fetchApprovalRisk:i,remindLater:s}=xd(o);(0,Et.useEffect)(()=>{(async()=>{let{approvalProjectList:a}=await i();a?.length>0&&(r(!0),e(!0)),e(!1)})()},[i,e]);let l=(0,Et.useCallback)(()=>{r(!1),hu({go_to_website:!1}),s()},[s]),g=(0,Md.useHistory)(),d=()=>{g.push(Su)};return Et.default.createElement(Ot.Prompt,{visible:t,title:se("wallet_extension_risk_modaltitle_risk_warning"),text:se("wallet_extension_risk_modalsubtitle_risk_warning"),infoType:Ot.Prompt.INFO_TYPE.warn,hideCloseBtn:!0,alignBottom:!1,footer:Et.default.createElement(Et.default.Fragment,null,Et.default.createElement(Le,{category:Le.CATEGORY.fill,type:Le.TYPE.highlight,size:Le.SIZE.lg,block:!0,onClick:d},se("wallet_extension_approval_btn_revoke")),Et.default.createElement(Le,{category:Le.CATEGORY.outline,type:Le.TYPE.default,size:Le.SIZE.lg,className:Kd.btn,block:!0,onClick:l},se("wallet_extension_risk_btn_remind_later")))})};f();p();var jd=q(it());var Mr=()=>{let n=sn(),e=(0,jd.useSelector)(Ci)||{};return{isWalletCreated:Boolean(e[n])}};f();p();var Ze=q(Ce());f();p();var ya=q(Ce());f();p();var Wi={main:"_main_1li3n_1",line:"_line_1li3n_5",dot:"_dot_1li3n_11"};var Bd=({total:n,activeIndex:e,className:t})=>ya.default.createElement(ee.FlexBox,{align:ee.ALIGN.center,className:`${Wi.main} ${t}`},Array(n).fill("").map((r,o)=>ya.default.createElement("div",{className:e===o?Wi.line:Wi.dot})));f();p();var ji=q(Ce());f();p();var Ko={main:"_main_si9mr_1",icon:"_icon_si9mr_1",left:"_left_si9mr_11"};var Ud=({handlePrev:n,handleNext:e,className:t})=>ji.default.createElement(ee.FlexBox,{align:ee.ALIGN.center,className:`${Ko.main} ${t}`},ji.default.createElement(Ft,{size:Ft.SIZE.xxs,onClick:n,icon:"okx-wallet-plugin-left",className:`${Ko.icon} ${Ko.left} `}),ji.default.createElement(Ft,{size:Ft.SIZE.xxs,onClick:e,icon:"okx-wallet-plugin-right",className:Ko.icon}));f();p();var An=q(Ce()),Bi=q(it());oa();pm();yi();bi();var Xd=()=>{let[n,e]=(0,An.useState)([]),t=(0,Bi.useSelector)(mu),r=(0,Bi.useDispatch)(),o=Gl();(0,An.useEffect)(()=>{(async()=>{let{data:l=[]}=await zl(In.getBannerConfig),{uiData:g}=await di.get("uiData"),d=g?.closedBannerStore||[];r(da({allData:l,closedBanners:d,theme:o})),e(l)})()},[o]);let i=(0,An.useMemo)(()=>t.length,[t]),s=(0,An.useCallback)(async l=>{let{uiData:g}=await di.get("uiData"),{closedBannerStore:d=[]}=g;d.push(l?.id);let a=Wl(d,n,(c,u)=>c===u?.id);await di.set({uiData:{...g??{},closedBannerStore:a}}),r(da({allData:n,closedBanners:a,theme:o}))},[n,o]);return{bannerList:t,total:i,handleClose:s}};f();p();var Hd=q(Ce()),qd=q(vn());var Jd=()=>{let n=(0,qd.useHistory)();return{link:(0,Hd.useCallback)(t=>{switch(Oi({click_close:!1,banner_id:t.id}),t.urlType){case 2:{let r=t.url.replace("wallet://","");n.push(r);break}case 1:globalThis.open(t.url);break;default:break}},[])}};f();p();var $t={"retina-border-basic":"_retina-border-basic_60npk_1",retinaBorderBasic:"_retina-border-basic_60npk_1",main:"_main_60npk_29",carousel:"_carousel_60npk_63",closeWrapper:"_closeWrapper_60npk_67",banner:"_banner_60npk_75",content:"_content_60npk_80",left:"_left_60npk_83",title:"_title_60npk_87",icon:"_icon_60npk_90",buttonIndex:"_buttonIndex_60npk_95",switch:"_switch_60npk_100"};var Fd=()=>{let[n,e]=(0,Ze.useState)(0),[t,r]=(0,Ze.useState)(!1),o=Ze.default.useRef(null),{link:i}=Jd(),{bannerList:s,total:l,handleClose:g}=Xd();return l===0?null:Ze.default.createElement(ee.FlexBox,{className:$t.main,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1)},Ze.default.createElement(sa,{touchSwitch:l>1,className:$t.carousel,autoplay:l>1?5e3:!1,ref:o,loop:l>1,navigation:!1,showIndicators:!1,onChange:d=>{e(d)}},s?.map(d=>Ze.default.createElement(sa.Slide,null,Ze.default.createElement(ee.FlexBox,{className:$t.banner},Ze.default.createElement(ee.FlexBox,{onClick:()=>i(d),className:$t.content,align:l===1?ee.ALIGN.center:ee.ALIGN.start},Ze.default.createElement("div",{className:$t.left},Ze.default.createElement(Jt.Text,{ellipsis:{rows:2},size:Jt.SIZE.sm,strong:500,className:$t.title},d.title)),Ze.default.createElement(Ft,{type:Ft.TYPE.image,className:$t.icon,src:d.img})),Ze.default.createElement(ee.FlexBox,{align:ee.ALIGN.center,className:$t.closeWrapper,onClick:()=>{Oi({click_close:!0,banner_id:d.id}),g(d)}},Ze.default.createElement(Ir,{className:"okx-wallet-plugin-close"})))))),l>1&&Ze.default.createElement("div",null,t?Ze.default.createElement(Ud,{className:$t.switch,handlePrev:()=>o.current?.prev(),handleNext:()=>o.current?.next()}):Ze.default.createElement(Bd,{total:l,activeIndex:n,className:$t.buttonIndex})))};f();p();var De=q(Ce()),Tf=q(it());f();p();var va=q(Ce());ot();f();p();var ba={content:"_content_1mi10_1",wrapper:"_wrapper_1mi10_5"};var $d=({tryAgain:n})=>va.default.createElement(ee.FlexBox,{align:ee.ALIGN.center,justify:ee.ALIGN.center,direction:ee.DIRECTION.vertical,className:ba.content},va.default.createElement(Dr.State,{title:se("wallet_extension_home_title_network_unavailable"),type:Dr.State.TYPE.noNetwork,description:se("wallet_extension_home_text_check_network_error"),buttonText:se("wallet_extension_home_btn_try_again"),onButtonClick:()=>{n&&n()},className:ba.wrapper}));f();p();var Pt=q(Ce());f();p();var At={skeletonWrapper:"_skeletonWrapper_k76ne_1",tab:"_tab_k76ne_5",tokenList:"_tokenList_k76ne_10",token:"_token_k76ne_10",logo:"_logo_k76ne_18",symbol:"_symbol_k76ne_23",chain:"_chain_k76ne_28",middle:"_middle_k76ne_32",number:"_number_k76ne_35",currency:"_currency_k76ne_40"};var Tm=()=>Pt.default.createElement(ee.FlexBox,{direction:ee.DIRECTION.vertical,align:ee.ALIGN.unset,className:At.skeletonWrapper},Pt.default.createElement(tr.Input,{active:!0,className:At.tab}),Pt.default.createElement(ee.FlexBox,{direction:ee.DIRECTION.vertical,justify:"space-around",className:At.tokenList},Array(5).fill("").map((n,e)=>Pt.default.createElement(ee.FlexBox,{className:At.token,align:ee.ALIGN.center,key:e},Pt.default.createElement(tr.Avatar,{active:!0,className:At.logo}),Pt.default.createElement(ee.FlexBox,{direction:ee.DIRECTION.vertical,className:At.middle},Pt.default.createElement(tr.Input,{active:!0,className:At.symbol}),Pt.default.createElement(tr.Input,{active:!0,className:At.chain})),Pt.default.createElement(ee.FlexBox,{direction:ee.DIRECTION.vertical,align:ee.ALIGN.end,className:At.right},Pt.default.createElement(tr.Input,{active:!0,className:At.number}),Pt.default.createElement(tr.Input,{active:!0,className:At.currency})))))),Vd=Tm;f();p();var Ui=q(Ce());var Gd=q(it());var Yd=()=>{let[n,e]=(0,Ui.useState)([]),t=Di("nft-operate"),o=(0,Gd.useSelector)(lu)?.account?.aptos||"",i=_d();return yd(),(0,Ui.useEffect)(()=>{(!t||t.data.status===2)&&o&&cu(o).then(s=>{e(s.list)}),t?.data?.status===2&&setTimeout(()=>{i()},3e3)},[t,i]),{aptosNftOffers:n,aptosAddress:o,fetchNftListData:i}};f();p();f();p();var we=q(Ce()),Cf=q(it()),Of=q(vn());f();p();var ef=q(mm());f();p();var Nm=n=>{let e=n;return typeof e!="string"?"":(e?.[0]==="$"&&(e=n?.slice(1)),e?.toLowerCase()||"")},zd=n=>n.isHighQuality!==bu.NORMAL&&n.riskType===yu.NORMAL;function Qd(n){let e=new Map;return n.forEach(t=>{let r=t,i=`${Nm(r.symbol)}-${r.chainId}`;if(e.has(i)){let s=e.get(i);zd(s)&&!s.sameNameCoin&&(s.sameNameCoin=!0),zd(r)&&(r.sameNameCoin=!0)}else e.set(i,r)}),n}f();p();ia();var Zd=({addedCoinIdsSet:n,defaultBaseCoinsCoinIdsSet:e,balanceCoin:t,isDefault:r})=>{let o=n.has(t.coinId),i=e.has(t.coinId)||r||t.isDefault,s=o||i,l=gi(t.currencyAmountUSD,"1");return s||l};var Rm={showCoins:[],hiddenCoins:[]},tf=(0,ef.createSelector)(Fu,Ju,Vu,$u,(n,e,t,r)=>{if(!n.length)return Rm;let o=ha(n,g=>!t.has(g.coinId),{sort:!1}).results,i=Qd(o),{results:s,uselessResults:l}=ha(i,(g,d)=>Zd({defaultBaseCoinsCoinIdsSet:r,addedCoinIdsSet:e,balanceCoin:g,isDefault:d}));return{showCoins:s,hiddenCoins:l}});f();p();var nf=q(it());function Im(){let n=(0,nf.useDispatch)(),[e]=Mu(Ku.hiddenSmallAssets),t=s=>{n(xu(s))};return[e,{toggle:()=>{t(!e)},hide:()=>{t(!0)},show:()=>{t(!1)},setValue:t}]}var rf=Im;ot();f();p();var sf=q(Ce()),Ca=q(it());ot();ia();var Dm=n=>n.map(e=>({...e,coinAmount:null})),of=n=>n.map(e=>{try{let t=new Hl(e.image),{query:r}=t;if(!r.get("x-oss-process"))return r.set("x-oss-process","image/resize,m_lfit,w_100,h_100/ignore-error,1"),{...e,image:t.get()}}catch{}return e}),Oa=n=>{let e=Bu(),{currentNetworkUniqueId:t}=Dn(),r=(0,Ca.useSelector)(Ci),o=(0,Ca.useSelector)(pu),i=Boolean(r[e]),s=Boolean(o[e]);return(!i||s)&&(n=Dm(n)),(0,sf.useMemo)(()=>{if(t==="")return of(n);let g=n.filter(a=>(a?.childrenCoin||[]).find(c=>c.chainId===Number(t))||a.chainId===Number(t)),d=[];return g.forEach(a=>{if(a?.aggregation){let c=(a?.childrenCoin||[]).filter(N=>N.chainId===Number(t)),u=c.reduce((N,X)=>hi(N,X.coinAmount),"0"),_=c.reduce((N,X)=>hi(N,X.currencyAmount),"0"),y=c.reduce((N,X)=>hi(N,X.currencyAmountUSD),"0");d.push({...a,childrenCoin:c,coinAmount:u,currencyAmount:_,currencyAmountUSD:y})}else d.push(a)}),d=d.map(a=>({...a,coinAmount:a?.coinAmount===null?"--":Dt.truncate(a?.coinAmount,6,!1)})).sort((a,c)=>gi(c.currencyAmount,a.currencyAmount)?1:-1),of(d)},[n,t])};f();p();f();p();var Hi=q(Ce()),af=q(vn());var cf=q(Io());ot();f();p();var Xi={button:"_button_6jkwx_1","button--has-dapp-state":"_button--has-dapp-state_6jkwx_13",buttonHasDappState:"_button--has-dapp-state_6jkwx_13",icon:"_icon_6jkwx_16",empty:"_empty_6jkwx_20"};function Am({hasDappState:n}){let e=(0,af.useHistory)();return Hi.default.createElement("div",{className:(0,cf.default)(Xi.button,{[Xi["button--has-dapp-state"]]:n}),"data-testid":on.HOME_PAGE.COIN_MANAGE_BUTTON_BOTTOM},Hi.default.createElement(Le,{circle:!0,category:Le.CATEGORY.outline,type:Le.TYPE.secondary,size:Le.SIZE.md,onClick:()=>{e.push(Ti)}},Hi.default.createElement(Ir,{className:`okx-wallet-plugin-edit-wallet ${Xi.icon}`}),se("wallet_home_btn_manage_crypto")))}var lf=Am;var uf=lf;f();p();var Wr=q(Ce()),mf=q(it()),_f=q(Pr());f();p();var df=q(Pr());var ff=()=>{let n=Pi();return(0,df.useCreation)(()=>Object.keys(n).reduce((e,t)=>{let r=n?.[t]?.priceCoinId;return e[t]=r,e},{}),[n])};ia();f();p();var Ea=q(it()),hf=q(vn());ko();var pf={[nr]:"btcAggregation",[tu]:"nearAggregation",[nu]:"tonAggregation"},gf=()=>{let{currentNetworkUniqueId:n}=(0,Ea.useSelector)(Ni),e=Gu(),t=(0,hf.useHistory)(),r=(0,Ea.useSelector)(vu),o=sn(),i=r?.[o],s=d=>{if(i?.[`${d.symbol}-${d.coinId}`])return i[`${d.symbol}-${d.coinId}`];let a=pf[d.localType]||pf[nr],c=Ai({[a]:!0,coinSymbol:d.symbol,coinId:d.coinId,addressType:"",sameNameCoin:Boolean(d.sameNameCoin)});return`${wi}${c}`},l=async d=>{if(n===""&&i?.[d.symbol])return i[d.symbol];let c=(n!==""?d.childrenCoin.find(_=>_.chainId===Number(n)):null)?.coinId||"",u=Ai({aggregation:!0,coinSymbol:d.symbol,coinId:c,sameNameCoin:Boolean(d.sameNameCoin)});return`${wi}${u}`};return{jumpCoinDetailPage:async d=>{let a="";if(d.aggregation)a=await l(d);else if(iu(d)||su(d)||au(d))a=s(d);else{let c=Ai({coinId:d.coinId,sameNameCoin:Boolean(d.sameNameCoin)});a=`${wi}${c}`}a&&t.push(a)},coinToCurrencyRate:e}};function Pm({dataSource:n,hiddenAssets:e,onMount:t}){let{jumpCoinDetailPage:r,coinToCurrencyRate:o}=gf(),i=ff(),s=Td(),l=Pi(),{currentNetworkUniqueId:g}=(0,mf.useSelector)(Ni),d=(0,_f.useMemoizedFn)(()=>{t?.()});(0,Wr.useLayoutEffect)(()=>{d()},[d]);let a=c=>{let{aggregation:u,coinId:_,coinAmount:y,currencyAmount:N}=c,X=_;u&&!g&&(X=i?.[_]||_);let D=o?.[X]||"0",T=u&&!g?Jl(y,D):N,L=l?.[X],H=L?.coinPriceChangePercent24h??void 0,F=L?.anchorStatus===1;return{price:D,currencyAmount:T,pricePercent:H,isAnchorOff:F}};return Wr.default.createElement(pa,{"data-testid":on.HOME_PAGE.COMMON_COIN_LIST,renderEmpty:!1,dataSource:n,renderItem:c=>{let{image:u,symbol:_,coinAmount:y,riskType:N,chainName:X,sameNameCoin:D,voucherToken:T}=c,L=s(c),{price:H,currencyAmount:F,pricePercent:S,isAnchorOff:W}=a(c);return Wr.default.createElement(pa.Coin,{icon:{lazyload:!0,src:u,type:Du.image,defaultIcon:_u},price:H,pricePercent:S,symbol:_,hidden:e,balance:L?y:void 0,market:L?F:void 0,onClick:async()=>{L&&await r(c)},riskType:N,chainName:X,isAnchorOff:W,isVoucherToken:T,sameNameCoin:D},!L&&Wr.default.createElement(wd,{coinId:c?.coinId}))}})}var wa=Pm;f();p();var an=q(Ce());ot();ko();yi();bi();f();p();var yf={root:"_root_qmbez_1",alert:"_alert_qmbez_4"};function km(){let[n,e]=(0,an.useState)(!1),[t,r]=(0,an.useState)({}),o=ju(Po),i=Di("dex-across-order-info"),{currentNetworkUniqueId:s}=Dn(),l=Qu({localType:Po})||[],g=Number(s)===l?.[0]?.realChainId||s==="";(0,an.useEffect)(()=>{(()=>{Ar(In.postPendingFacetOrder,{userWalletAddresses:o,chainId:l?.[0]?.realChainId||1}).then(c=>{if(c.data?.length>0){if(g)e(!0);else{e(!1);return}let u=c.data.filter(_=>Number(_.status)===11&&Number(_.specialOrderType)===3);u?.length>0?(r({orderId:u[0].orderId,toAmount:u[0].toAmount,toTokenSymbol:u[0].toTokenSymbol}),e(!0)):(r(""),e(!1))}else r({}),e(!1)}).catch(()=>{r({}),e(!1)})})()},[i,s,g]);let{openDexTxDetailDialog:d}=td();return n?an.default.createElement(ee.Box,{className:yf.root},an.default.createElement(_i,{desc:an.default.createElement("div",null,se("swaptrade_extension_reminder_desc_pending_withdrawal",{token:t?.toTokenSymbol,amount:t?.toAmount}),an.default.createElement(_i.Link,{onClick:a=>{a.preventDefault(),d(t?.orderId)}},se("wallet_extension_details_textbtn_check_details"))),type:_i.TYPE.info,onClose:()=>{e(!1)}})):null}var bf=km;f();p();var Ji=q(Ce()),Ta=q(Io());ot();Fl();ql();f();p();var qi={root:"_root_15d68_1","root--sticky":"_root--sticky_15d68_12",rootSticky:"_root--sticky_15d68_12",icon:"_icon_15d68_19"};function Lm({length:n,toggle:e,value:t}){let r=t?"okds-arrow-chevron-down-md":"okds-arrow-chevron-up-md",o=se("wallet_extension_main_toggle_hide",{num:Ul.formatNumber(n)});return Ji.default.createElement("div",{onClick:e,className:(0,Ta.default)(qi.root,{[qi.rootSticky]:mi()!==pi}),"data-testid":on.HOME_PAGE.HIDDEN_COIN_LIST},Ji.default.createElement("div",null,o),Ji.default.createElement(Ir,{className:(0,Ta.default)(r,qi.icon)}))}var vf=Lm;f();p();var Mo={button:"_button_1e59f_1",coinListInnerContainer:"_coinListInnerContainer_1e59f_5",showButton:"_showButton_1e59f_10",coinList:"_coinList_1e59f_5",icon:"_icon_1e59f_22",hiddenCoinList:"_hiddenCoinList_1e59f_26",empty:"_empty_1e59f_30",emptyImg:"_emptyImg_1e59f_33"};var xm=(0,we.lazy)(()=>import("./LimitOrder-7NPX7SRN.js")),Km=190,Mm=({scrollTop:n,hiddenAssets:e,backupHeight:t,changeScrollTop:r,showDappConnectAffix:o})=>{let[i,s]=(0,we.useState)(!1),l=(0,we.useRef)(null),{showCoins:g,hiddenCoins:d}=(0,Cf.useSelector)(tf),a=Oa(g),c=Oa(d),[u,{toggle:_}]=rf(),y=(0,we.useRef)(n),N=()=>{y.current=n,_()},X=()=>{requestAnimationFrame(()=>{r(y.current)})},{fetch:D}=Od();bd(D,{cacheKey:Cd,staleTime:1e3*60*10}),(0,we.useLayoutEffect)(()=>{let k=document.getElementById("home-page-root-element-id");if(!k)return;let J=()=>{s((()=>{let Q=k.scrollHeight>window.innerHeight,ce=k.scrollTop>0;return!Q||ce})())};J();let ne=setTimeout(J,100),O=new ResizeObserver(()=>{J()});O.observe(k);let R=()=>{J()};return k.addEventListener("scroll",R),()=>{clearTimeout(ne),O.disconnect(),k.removeEventListener("scroll",R)}},[a,c,u]);let T=(0,Of.useHistory)(),L=a.length,H=c.length,F=(0,we.useMemo)(()=>n<=Km?!1:L+(u?0:H)>8,[u,H,L,n]),{paddingBottom:S}=vd({isButtonAbsolute:F,backupHeight:t});return L===0&&H===0?we.default.createElement("div",{style:{paddingBottom:S+t}},we.default.createElement(Dr.State,{imgClassName:Mo.emptyImg,className:Mo.empty,type:Dr.State.TYPE.noRecord,title:se("extension_wallet_home_text_no_added_currencies"),buttonText:se("extension_wallet_home_btn_add_now"),onButtonClick:()=>{T.push(Ti)}})):we.default.createElement(we.default.Fragment,null,we.default.createElement("div",{className:Mo.coinList},we.default.createElement(Ed,{assetType:"coin",buttonRef:l}),we.default.createElement(we.Suspense,{fallback:null},we.default.createElement(xm,null)),we.default.createElement(bf,null),we.default.createElement(wa,{dataSource:a,hiddenAssets:e})),we.default.createElement("div",{className:Mo.hiddenCoinList},H>0&&we.default.createElement(we.default.Fragment,null,we.default.createElement(vf,{length:H,toggle:N,value:u}),!u&&we.default.createElement(wa,{onMount:X,dataSource:c,hiddenAssets:e}))),i&&we.default.createElement(uf,{hasDappState:o}))},Sa=Mm;f();p();var Pn=q(Ce()),Fi=q(it()),Ef=q(Io());ot();Fl();ql();f();p();var Wo={homeTabs:"_homeTabs_16jop_1","homeTabs--sticky":"_homeTabs--sticky_16jop_4",homeTabsSticky:"_homeTabs--sticky_16jop_4",homeTab:"_homeTab_16jop_1",active:"_active_16jop_19"};var wf=({aptosNftOffers:n})=>{let e=(0,Fi.useSelector)(Ri),t=(0,Fi.useDispatch)(),r=Ki(Ei),o=(0,Pn.useMemo)(()=>[se("wallet_extension_nft_tab_coins"),Pn.default.createElement("div",null,se("wallet_extension_nft_tab_nfts"),n.length>0&&Pn.default.createElement("span",{className:"new-home-nft-aptos-notify"})),se("wallet_extension_tab_defi"),se("wallet_extension_home_tab_approvals")],[n]);return Pn.default.createElement("div",{className:(0,Ef.default)(Wo.homeTabs,{[Wo.homeTabsSticky]:mi()!==pi}),"data-testid":on.HOME_PAGE.MAIN_TABS},Pn.default.createElement(Ao,{noLine:!0,activeId:e,size:Ao.SIZE.lg,color:Ao.COLOR.grey,paneSpacing:0,noPadding:!0,onChange:i=>{let s;switch(i){case 1:s="crypto";break;case 2:s="nfts";break;case 3:s="defi";break;case 4:s="approve";break;default:break}r({homepage:s}),t(Nu.setActiveId({id:i}))}},o.map((i,s)=>Pn.default.createElement(Ao.TabPane,{className:`${Wo.homeTab} ${+e===s+1?Wo.active:""}`,tab:i,key:s,id:s+1}))))};var Wm=(0,De.lazy)(()=>import("./Nft-QO736YV6.js")),jm=(0,De.lazy)(()=>import("./DefiList-QBY2R5K5.js")),Bm=(0,De.lazy)(()=>import("./Approve-2C457U62.js")),Sf=({scrollTop:n,hiddenAssets:e,backupHeight:t,isWalletCreated:r,changeScrollTop:o,errorType:i,tryAgain:s,showDappConnectAffix:l})=>{let g=(0,Tf.useSelector)(Ri),{aptosNftOffers:d,aptosAddress:a}=Yd(),c=(0,De.useMemo)(()=>{switch(g){case 2:return De.default.createElement(De.Suspense,{fallback:null},De.default.createElement(Wm,{scrollTop:n,aptosNftOffers:d,aptosAddress:a,backupHeight:t}));case 3:return De.default.createElement(De.Suspense,{fallback:null},De.default.createElement(jm,{scrollTop:n,hiddenAssets:e,backupHeight:t,isWalletCreated:r}));case 4:return De.default.createElement(De.Suspense,{fallback:null},De.default.createElement(Bm,null));default:return De.default.createElement(Sa,{scrollTop:n,hiddenAssets:e,backupHeight:t,changeScrollTop:o,showDappConnectAffix:l})}},[g,n,e,t,o,d,a,r]),u=(0,De.useMemo)(()=>i===Kr.PENDING,[i]),_=(0,De.useMemo)(()=>[Kr.CREATE_FAIL_FROM_NETWORK_ERROR,Kr.CREATE_FAIL_FROM_SERVER_ERROR].includes(i),[i]);return De.default.createElement(De.default.Fragment,null,De.default.createElement(wf,{aptosNftOffers:d}),(()=>_?De.default.createElement($d,{tryAgain:s}):u&&(g===1||!g)?De.default.createElement(Vd,null):c)())};f();p();var kn=q(Ce());ot();f();p();var rr={iconAniWrapper:"_iconAniWrapper_piy3e_20",iconItem:"_iconItem_piy3e_29",text:"_text_piy3e_35",moveOutAnimation:"_moveOutAnimation_piy3e_38",moveOut:"_moveOut_piy3e_38",moveInAnimation:"_moveInAnimation_piy3e_42",moveIn:"_moveIn_piy3e_42",iconTitle:"_iconTitle_piy3e_54"};var Nf=({width:n})=>kn.default.createElement(ee.FlexBox,{align:ee.ALIGN.center,direction:ee.DIRECTION.vertical,style:{width:n}},kn.default.createElement(ee.Box,{className:rr.iconAniWrapper},kn.default.createElement(ee.FlexBox,{align:ee.ALIGN.center,justify:ee.ALIGN.center,className:`${rr.iconItem} ${rr.moveInAnimation}`},kn.default.createElement(Ft,{className:"okx-wallet-plugin-toolkit"})),kn.default.createElement(ee.FlexBox,{align:ee.ALIGN.center,justify:ee.ALIGN.center,direction:ee.DIRECTION.vertical,className:`${rr.iconItem} ${rr.moveOutAnimation}`},kn.default.createElement(Ft,{className:"okx-wallet-plugin-swap-for-gas"}))),kn.default.createElement(Jt.Text,{className:rr.iconTitle,ellipsis:!0,size:Jt.SIZE.xs},se("wallet_extension_home_text_toolkit")));f();p();var _n=q(Ce()),Xs=q(it()),Tl=q(vn());f();p();var rg=q(vn());f();p();f();p();var tn=q(vl());f();p();f();p();function Cl(n){let e={};try{let t=new URL(n),r=new URLSearchParams(t.search);for(let[o,i]of r.entries())e[o]=i;if(t.pathname.endsWith("/ul/connect")&&e.topic!==void 0&&e.topic.length>=6){let o=e.topic,i=o.slice(-6),l={topic:o.slice(0,-6),cid:i};return(0,tn.base64encode)(l,!1)}else{if(t.href.startsWith(tn.standardDeeplink)&&e.param!==void 0)return e.param;if(t.pathname.endsWith("/download")&&e.deeplink!==void 0){let o=new URL(e.deeplink),i=new URLSearchParams(o.search),s={};for(let[l,g]of i.entries())s[l]=g;if(o.href.startsWith(tn.standardDeeplink)&&s.param!==void 0)return s.param}}}catch(t){console.log("Invalid URL:",t)}}f();p();var Ol=q(vl());f();p();f();p();var El=async()=>{};f();p();var Bs=q(Ce());ot();f();p();f();p();var js="";var Qh=()=>{let[n,e]=(0,Bs.useState)(!1);return[(0,Bs.useCallback)(async r=>{if(!!js)try{e(!0),await js.pair({uri:r})}catch(o){o&&o?.message&&o?.message?.includes("URI has expired")&&Yl.error(se("wallet_extension_tg_error_qr_code_expired"))}finally{e(!1)}},[]),n]};ko();f();p();var Zh=n=>{let t=`http://t.me/OKX_WALLET_BOT/dapp?startapp=${encodeURIComponent(n).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%/g,"__")}`;id(t)};f();p();function fO(){let n=(e,t)=>{if(Array.isArray(t))return t.find(r=>r?.coinId===e.coinId||n(e,r?.childrenCoin))};return{checkCoinAdded:n}}var eg=fO;f();p();_m();var pO=async(n,e)=>{let t=await Promise.all(n.map(e));return n.filter((r,o)=>t[o])};function hO(){return{findChainsByAddress:async t=>{let r=la();return await pO(r,async i=>await nd(t,i.coinId))||[]},findChainByChainName:t=>la().find(o=>ua(t)===ua(o.chainName))||{}}}var tg=hO;f();p();var mn=q(Ce());ot();function gO(){let n=(0,mn.useCallback)(()=>{let i=Ot.tip({infoType:Ot.Tip.INFO_TYPE.default,children:mn.default.createElement(mn.default.Fragment,null,se("wallet_extension_tg_alert_address_not_recognize")),confirmText:se("commonall_text_btn_ok_active"),onConfirm:()=>{i.destroy()}})},[]),e=(0,mn.useCallback)(()=>{ga({message:se("wallet_extension_tg_alert_address_not_recognize")})},[]),t=(0,mn.useCallback)(i=>{let s=Ot.tip({infoType:Ot.Tip.INFO_TYPE.default,children:mn.default.createElement(mn.default.Fragment,null,se("wallet_extension_tg_alert_token_not_add",{token:i})),confirmText:se("commonall_text_btn_ok_active"),onConfirm:()=>{s.destroy()}})},[]),r=(0,mn.useCallback)(i=>{ga({message:se("wallet_extension_tg_alert_token_not_add",{token:i})})},[]);return{getMessageFns:i=>i==="link"?{showCoinNotFindMessage:n,showCoinNotAddedMessage:t}:{showCoinNotFindMessage:e,showCoinNotAddedMessage:r}}}var ng=gO;var Us=[eu,Zl],wl=(n,e)=>n.indexOf(e)>0,mO=n=>{let e=wl(n,"?")?n.split("?")[0]:n;if(wl(e,":")){let[t,r]=e.split(":");return{address:r,chainName:t}}return{address:e}},_O=n=>{if(!wl(n,"?"))return{};let[,e]=n.split("?");return qu(e)};function yO(){let n=(0,rg.useHistory)(),e=Yu(),[t]=Qh(),r=rd(),{findChainsByAddress:o,findChainByChainName:i}=tg(),{checkCoinAdded:s}=eg(),{getMessageFns:l}=ng(),g=u=>{if(!u)return{};let _=_O(u);return{...mO(u),..._}},d=async({chainName:u="",address:_="",token:y="",amount:N="",source:X="scan",finishedAction:D=()=>{}})=>{let{showCoinNotFindMessage:T,showCoinNotAddedMessage:L}=l(X),H=_;_&&Us.includes(u)&&(H=`${u}:${_}`);let F=y;if(y&&Us.includes(u)&&!y.startsWith(u)&&(F=`${u}:${y}`),H&&!N&&!Us.includes(u)){let W=(await o(H)).map(k=>k.coinId);W.length?(n.push(`${xo}?type=${Lo.SEND}&address=${H}&coinIds=${W.join(",")}`),D()):T()}else if(H&&u&&(N||Us.includes(u))){let{chainId:S}=i(u);if(typeof S<"u"){let W={chainId:S};F&&(W.address=F);let k=await e(void 0,W);k&&k.coinId&&(s(k,r)?(n.push(`${Cu}/${k.coinId}${wu}?address=${H}&amount=${N}`),D()):L(k.symbol))}else T()}else T()};return{openScanner:async()=>{try{await ma({onCaptured:async u=>{let _=Cl(u);if(!!_){(await El())?.pairingFromUrl(_),xr();return}if(u.startsWith("http://")||u.startsWith("https://")){Zh(u),xr();return}if(u.startsWith("wc:")){t(u),xr();return}let{chainName:N,address:X,token:D,amount:T}=g(u);d({chainName:N,address:X,token:D,amount:T,finishedAction:()=>{xr()}})}})}catch{xr()}},linkToSend:d,scanToGetText:async()=>{let u;try{u=await ma({capture:()=>!0})}catch{u=""}return u}}}var og=yO;ko();f();p();var vO=[{text:"wallet_home_btn_send",icon:"okx-wallet-plugin-up",type:"SEND"},{text:"wallet_home_btn_receive",icon:"okx-wallet-plugin-down",type:"RECEIVE"},{text:"wallet_extension_homepage_feature_name_swap",icon:"okx-wallet-plugin-swap-2",type:"DEX",disabledText:""},{text:"wallet_extension_header_text_history",icon:"okx-wallet-plugin-history-1",type:"HISTORY"},{text:"wallet_extension_home_text_toolkit",icon:"okx-wallet-plugin-toolkit",type:"MORE"}],ig=vO;var CO=n=>Zu({networkId:n?.id?String(n?.id):void 0})?.coinId,OO=n=>(0,_n.useMemo)(()=>{let{initialType:t,accountMap:r}=n;if(ku(t)){let o=Object.keys(r);return![nr,Po].some(i=>o.includes(i))}return!1},[n]),EO=n=>{let e=xi(),t=(0,Tl.useHistory)(),r=(0,_n.useCallback)(()=>{t.push(`${xo}?type=${Lo.RECEIVE}`)},[t]);return(0,_n.useCallback)(()=>{(n?e:r)()},[r,n,e])},sg=()=>{let{isNotBackupWallet:n}=Li(),e=(0,Tl.useHistory)(),t=(0,Xs.useDispatch)(),r=Nd(),o=CO(r),{baseCoin:i={}}=zu(o,!0),s=Ad(i,"",Dd.home),l=(0,Xs.useSelector)(uu),g=OO(l),d=EO(n),a=(0,_n.useCallback)(()=>{!(typeof i?.chainId>"u")&&t(Iu({chainId:i?.chainId})),e.push(Eu)},[i?.chainId,t,e]),c=(0,_n.useCallback)(()=>{e.push(Ou)},[e]),u=(0,_n.useCallback)(()=>{e.push(`${xo}?type=${Lo.SEND}`)},[e]),_=Ki(Ei),{impactHaptic:y}=Wu(),{openScanner:N}=og(),X=(0,_n.useCallback)(T=>{switch(y(),T.type){case"SEND":{_({homepage:"send"}),u();break}case"RECEIVE":{_({homepage:"receive"}),d();break}case"SCANNER":{N();break}case"DEX":{_({homepage:"trade"}),s();break}case"HISTORY":{_({homepage:"history"}),a();break}case"DAPP_CONNECT":{c();break}default:break}},[d,s,a,c,u,e,y,_]),D=(0,_n.useMemo)(()=>ig.map(T=>T.type==="DEX"?{...T,disabled:g}:T).filter(T=>T.type==="SCANNER"?od():!0),[g]);return{clickHandle:X,iconOptions:D}};f();p();var Hs=q(Ce()),cg=q(it());f();p();var ag=q(Ce());oa();ru();ko();function Sl(){let n=Lr();return(0,ag.useMemo)(()=>{let e=Pd.find(t=>{let r=n?.account?.[t],o=Bl(Object.values(n?.account??{}));return t===nr?!1:r&&n.keyringIdentityType===vi.PRIVATE_KEY&&o.length===1&&o[0]===r});return e?{isFactionPKAccount:!0,chain:e}:{isFactionPKAccount:!1}},[n])}var lg=()=>{let n=Lr(),{isFactionPKAccount:e,chain:t}=Sl(),{currentNetworkUniqueId:r}=Dn(),{addresses:o=[],hotAddresses:i=[]}=(0,cg.useSelector)(Lu),s=(0,Hs.useCallback)(a=>e?a.localType===t:r===""?!0:a.chainId===Number(r),[r,e,t]),{filterAddress:l,filterHotAddress:g}=(0,Hs.useMemo)(()=>({filterAddress:o.filter(s),filterHotAddress:i.filter(s)}),[o,s,i]),d=l.length===1;return{filterAddress:l,filterHotAddress:g,address:d?l[0]?.address:"",chainName:d?l[0]?.chainName:"",titleLeft:n?.keyringName,titleRight:d?n?.walletName:"",subTitle:d?ou(l[0]?.address):n?.walletName,isFactionPKAccount:e}};f();p();var ug=q(Ce()),dg=q(vn());ot();ru();var fg=({address:n})=>{let e=(0,dg.useHistory)(),t=Lr(),r=()=>{e.push(`${Si}?fromHome=1`)};return t?.keyringIdentityType===vi.PRIVATE_KEY&&n==="UQCiCTSKMQTIF8VSGc3F7DxWxJrV09SAbJzc1YvWZ5pgiQAP"?ug.default.createElement(Ot.Prompt,{visible:!0,infoType:Ot.Prompt.INFO_TYPE.warn,title:se("wallet_extension_errormsg_unavailable_address"),confirmText:se("wallet_extension_connect_btn_switch_wallet"),onConfirm:r,hideCloseBtn:!0,alignBottom:!1,maskClosable:!1,confirmBtnProps:{type:Le.TYPE.highlight,size:Le.SIZE.lg}}):null};f();p();f();p();var pg=()=>null;var hg=pg;f();p();var Gn=q(Ce());f();p();f();p();var Nl={version:"3.33.51",web:!0,extension:!1,title:"wallet_extension_main_popup_shortcut",description:"wallet_extension_main_toast_shortcut",imgLight:"/cdn/assets/imgs/2412/EEC46FC3302CEC12.svg",imgDark:"/cdn/assets/imgs/2412/026A26E3C0C3D875.svg",mainButtonText:"commonall_text_btn_ok_passive"};f();p();var ri=q(Ce());ot();hm();var gg=(n,e,t)=>{let{version:r,imgLight:o,imgDark:i,title:s,description:l,mainButtonText:g}=n,d=Au({dark:i,light:o}),[a,c]=(0,ri.useState)(!1),u=Xl.init({project:"whatsNew"});return(0,ri.useEffect)(()=>{if(!e){c(!1);return}if(r!==Vl.version){c(!1);return}if(u.get("whatsNewVersion")===r){c(!1);return}if(typeof t=="boolean"&&!t){c(!1);return}c(!0)},[u,t,r,e]),(0,ri.useEffect)(()=>{a&&u.set("whatsNewVersion",r)},[a,u,r]),{visible:a,title:fi(s),description:fi(l),img:d,mainButtonText:fi(g),onMainButtonClick:()=>{c(!1)}}};function Rl(){let{extension:n}=Nl;return gg(Nl,n)}f();p();var Or={"whats-new-img":"_whats-new-img_fow6p_1",whatsNewImg:"_whats-new-img_fow6p_1","whats-new-box":"_whats-new-box_fow6p_5",whatsNewBox:"_whats-new-box_fow6p_5","whats-new-title":"_whats-new-title_fow6p_10",whatsNewTitle:"_whats-new-title_fow6p_10","whats-new-desc":"_whats-new-desc_fow6p_15",whatsNewDesc:"_whats-new-desc_fow6p_15","whats-new-footer":"_whats-new-footer_fow6p_20",whatsNewFooter:"_whats-new-footer_fow6p_20","whats-new-dialog":"_whats-new-dialog_fow6p_23",whatsNewDialog:"_whats-new-dialog_fow6p_23"};var wO=({shouldWhatsNewShow:n})=>{let{visible:e,title:t,description:r,img:o,mainButtonText:i,onMainButtonClick:s}=Rl();return Gn.default.createElement(Ot,{whiteboard:!0,visible:n&&e,hideCloseBtn:!0,noMargin:!1,alignBottom:!1,windowClass:Or.whatsNewDialog},Gn.default.createElement("img",{className:Or.whatsNewImg,src:o,alt:""}),Gn.default.createElement("div",{className:Or.whatsNewBox},Gn.default.createElement("h2",{className:Or.whatsNewTitle},t),Gn.default.createElement("p",{className:Or.whatsNewDesc},r),Gn.default.createElement("div",{className:Or.whatsNewFooter},Gn.default.createElement(Le,{category:Le.CATEGORY.fill,type:Le.TYPE.highlight,size:Le.SIZE.md,onClick:s,block:!0},i))))},mg=wO;f();p();var ii=q(Ce()),Tg=q(it()),Sg=q(Io());f();p();var Yn=q(Ce()),qs=q(Io());ot();f();p();var nn={root:"_root_1yqai_1",asset:"_asset_1yqai_13",change:"_change_1yqai_20",up:"_up_1yqai_23",down:"_down_1yqai_26",hidden:"_hidden_1yqai_29",empty:"_empty_1yqai_32",select:"_select_1yqai_35",amount:"_amount_1yqai_38"};function TO(n){let{hiddenAssets:e,data:t}=n,{hasTypes:r,types:o,typeId:i,onChangeType:s,balanceAdd:l,balanceAddPercent:g}=t,d=l!==void 0,a=g!==void 0,c="--",u="****",_=(0,qs.default)(nn.change,{[nn.up]:d&&Dt.gt(l,0),[nn.down]:d&&Dt.lt(l,0)});return Yn.default.createElement("div",{className:nn.root},Yn.default.createElement("div",{className:nn.asset},!e&&!d&&Yn.default.createElement("div",{className:nn.empty},c),e&&Yn.default.createElement("div",{className:nn.hidden},u),!e&&d&&Yn.default.createElement(Jt.DisplayAmount,{autoColor:!0,useApproximate:!1,mode:Jt.LEGAL,amount:l,ellipsis:{tooltip:!0},signDisplayForLessMin:!0,size:fa.sm,className:(0,qs.default)(nn.amount,_),plusSignDisplay:Dt.gt(l,0)}),!e&&d&&a&&Yn.default.createElement(Jt.DisplayAmount,{autoColor:!0,useApproximate:!1,ellipsis:{tooltip:!0},mode:Jt.PERCENT,signDisplay:!0,size:fa.sm,zeroSign:!1,needZero:!0,className:(0,qs.default)(nn.amount,_),amount:g,format:y=>y&&`(${y})`})),r&&Yn.default.createElement(Do,{dropMode:!0,type:Do.TYPE.text,value:i,align:Do.DIRECTION.left,options:o.map(y=>({value:y.chartTypeId,label:y.chartTypeMsg})),size:Do.SIZE.md,onChange:y=>{let N=y;s({chartTypeId:N.value,chartTypeMsg:N.label})},searchable:!1,className:nn.select}))}var _g=TO;f();p();var oi=q(Ce()),Og=q(it()),Eg=q(Pr());oa();ot();f();p();var Il=q(it()),Fs=q(Pr());f();p();var SO=()=>{let{showErrorAlert:n}=Mi();return t=>{try{Ql(t,!0)}catch(r){let{type:o,msg:i}=ld(r);n(o,i)}}},Js=SO;f();p();yi();bi();var NO=n=>Ar(In.getAssetChangeData,n),yg=NO;var RO=n=>n!=null,IO=n=>{let e=(0,Il.useSelector)(Ru),t=Js(),{isWalletCreated:r}=Mr(),o=sn(),{currentNetworkUniqueId:i}=Dn(),s=(0,Il.useSelector)(fu),l=i===""?void 0:+i,g=e?1:0,d=RO(n),a=r&&!!o&&d,c=(0,Fs.useRequest)(()=>yg({accountIds:[o],chainId:l,userUniqueId:s,chartTypeId:n,hasNft:g}),{ready:a,refreshDeps:[o,l,s,n,g],onError:t}),u=(0,Fs.useMemoizedFn)(()=>{a&&c.run()});return{data:c,refresh:u}},bg=IO;f();p();var $s=q(Pr());f();p();yi();bi();var DO=()=>Ar(In.getAssetChangeType),vg=DO;var AO=()=>{let{isWalletCreated:n}=Mr(),e=sn(),t=Js(),r=(0,$s.useRequest)(vg,{ready:n&&!!e,onError:t,cacheKey:"assetChangeType"}),o=(0,$s.useMemoizedFn)(()=>{r.run()});return{data:r,refresh:o}},Cg=AO;var PO="current_asset_change_type",kO=n=>{let e=!jl(n)&&n!=="--",t=Cg(),{data:r,loading:o,error:i}=t.data,[s,l]=(0,Eg.useLocalStorageState)(PO),{usdToThisRate:g}=(0,Og.useSelector)(du),d=(0,oi.useMemo)(()=>r?.data??[],[r?.data]),a=d.length>0,c=(0,oi.useMemo)(()=>d.find(J=>J.chartTypeId===s)??d?.[0],[s,d]),u=c?.chartTypeId,_=bg(c?.chartTypeId),{loading:y,data:N,error:X}=_.data,D=J=>{l(J.chartTypeId)},T=N?.data?.[0]?.assetAmount,L=!X&&T!==void 0,H=L&&e?Dt.sub(n,T):void 0,F=L&&e&&H!==void 0&&T!==void 0,S=(0,oi.useMemo)(()=>{if(!!F)return Dt.eq(T,0)?0:Dt.mul(Dt.div(H,T),100)},[H,T,F]),W=(0,oi.useMemo)(()=>{if(H!==void 0)return Dt.mul(H,g)},[H,g]);return{hasTypes:a,types:d,typeLoading:o,typeError:i,typeId:u,onChangeType:D,loading:y,data:N,error:X,hasData:L,balanceAdd:W,balanceAddPercent:S,refresh:()=>{t.refresh(),_.refresh()}}},wg=kO;f();p();var Dl={addWeight:"_addWeight_17jnv_1",balance:"_balance_17jnv_1"};function LO(n){let{walletAsset:e,walletAssetUSD:t}=(0,Tg.useSelector)(sd),r=wg(t),[o,i]=Ii();return ii.default.createElement(ii.default.Fragment,null,ii.default.createElement(Ld,{balance:e,hiddenAssets:o,onRefresh:()=>{r.refresh(),n.onRefresh?.()},onToggleHiddenAssets:i,className:(0,Sg.default)(Dl.addWeight,Dl.balance)}),ii.default.createElement(_g,{hiddenAssets:o,data:r}))}var Ng=LO;var xO="54px",KO=({hasBar:n=!1})=>{let e=(0,Rg.useSelector)(Pu),{isWalletCreated:t}=Mr(),{showErrorAlert:r}=Mi(),o=sn(),i=xi(),[{errorType:s,errorMsg:l},{createWalletToServer:g}]=ud(),d=fd(),[a]=Ii(),c=(0,me.useRef)(null),[u,_]=(0,me.useState)(0),[y,N]=(0,me.useState)(!1),{isNeedShowDisconnectUpgrade:X,setDisconnectUpgrade:D}=dd(),T=(0,me.useCallback)(()=>{X&&(aa.success({title:se("wallet_extension_card_subtitle_disconnect_update")}),D())},[X,D]),{isNotBackupWallet:L}=Li(),H=gd(),F=(0,me.useMemo)(()=>H.originNoPrefix&&!L,[H,L]),S=(0,me.useRef)(null),W=(0,Vs.useHistory)(),{search:k}=(0,Vs.useLocation)(),[J,ne]=(0,me.useState)(0),{clickHandle:O,iconOptions:R}=sg();(0,me.useEffect)(()=>{r(s,l)},[l,s,r]),(0,Gs.useMount)(()=>{gu()});let B=Hu();(0,me.useEffect)(()=>{if(!k)return;let{redirectPathname:bt,redirectSearchParams:Er}=Xu(k);bt&&B(bt,{removeExistingSearchKeys:["redirect_pathname","redirect_search_params"],preserveState:!0,newSearchParams:Uu(Er)})},[k]);let{run:Q}=(0,Gs.useDebounceFn)(()=>{ne(S.current?.scrollTop||0)},{wait:50,maxWait:50});kd();let{titleLeft:ce,titleRight:ie,subTitle:Ge,address:Ye,chainName:Pe,filterAddress:pt,filterHotAddress:yn,isFactionPKAccount:ht}=lg(),bn=async()=>{s!==Kr.PENDING&&(aa.destroyAll(),await g())};(0,me.useLayoutEffect)(()=>{c.current&&L&&t&&_(c.current?.clientHeight||0)},[L,t]);let zn=bt=>{S.current&&(S.current.scrollTop=bt)},Qn=(0,me.useCallback)(bt=>{N(!bt)},[]);return me.default.createElement("div",{id:Sd,"data-testid":on.HOME_PAGE.HOME_ROOT_ELEMENT_ID,className:"ok-home-page main-container",ref:S,onScroll:()=>{Q()},style:{height:n?`calc(100% - ${xO})`:"100%"}},me.default.createElement(Rd,{titleLeft:ce,titleRight:ie,subTitle:Ge,address:Ye,chainName:Pe,filterAddress:pt,filterHotAddress:yn,isNotBackupWallet:L,isFactionPKAccount:ht}),me.default.createElement(Ng,null),me.default.createElement(md,{clickHandle:O,iconOptions:R,customMore:bt=>me.default.createElement(Nf,{width:bt})}),me.default.createElement(Fd,null),me.default.createElement(Sf,{scrollTop:J,hiddenAssets:a,backupHeight:L?u+24:0,isWalletCreated:t,changeScrollTop:zn,errorType:s,tryAgain:bn,showDappConnectAffix:F}),t&&me.default.createElement("div",{ref:c},me.default.createElement(ad,{offsetBottom:24+cd})),me.default.createElement(pd,{info:H,isNotBackupWallet:L,disconnectCallback:T}),t&&me.default.createElement(Id,{showBackup:()=>{i({text:se("wallet_dapp_conncetion_alert_backup_wallet")},e)}}),d&&me.default.createElement(hd,{actionMap:{["RECOVER"]:()=>{W.push(`${Tu}?action=${ed.RECOVER}&walletId=${o}`)},["SWITCH_WALLET"]:()=>{W.push(`${Si}?fromHome=1`)}}}),me.default.createElement(Wd,{walletId:o,onFetchApprovalRisk:Qn}),me.default.createElement(fg,{address:Ye}),me.default.createElement(hg,null),me.default.createElement(mg,{shouldWhatsNewShow:y}))},wM=KO;export{wM as a};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-C4QQDU3P.js.map
