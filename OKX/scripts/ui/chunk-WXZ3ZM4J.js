import{a as q}from"./chunk-CNXMURDK.js";import{a as z}from"./chunk-ZLEGHRVC.js";import{a as Q}from"./chunk-J5SZHERT.js";import{a as Z}from"./chunk-XQGZFXUE.js";import{a as G}from"./chunk-YBR4PVVH.js";import{a as S,g as M}from"./chunk-F7VSWGDW.js";import{e as U,g as j}from"./chunk-IRMYAC6R.js";import{b as O}from"./chunk-ETJEH7T4.js";import{a as $}from"./chunk-E2JYOUYE.js";import{a as H}from"./chunk-B3JSNQIV.js";import{o as Re}from"./chunk-5QMHGZLF.js";import{cc as K,ec as N}from"./chunk-HPWCPLRR.js";import{d as _,f as b}from"./chunk-DEOJU4Z3.js";import{c as C}from"./chunk-43VURGIT.js";import{Ia as D,Na as me,a as w,ad as P,b as ce,rd as Ee,ya as B,za as le}from"./chunk-TM67VPZU.js";import{G as d}from"./chunk-PUSMMCUD.js";import{R as V,q as x,z as L}from"./chunk-UWJLNJLY.js";import{r as v,ra as ie}from"./chunk-XDY6V34Y.js";import{b as I}from"./chunk-JWYCKY2V.js";import{f as p,o as c,q as i}from"./chunk-6KXF36WM.js";c();i();var J=(t=>(t.CREATE_FAIL_FROM_NETWORK_ERROR="CREATE_FAIL_FROM_NETWORK_ERROR",t.CREATE_FAIL_FROM_SERVER_ERROR="CREATE_FAIL_FROM_SERVER_ERROR",t.CREATE_FAIL_FROM_SERVER_LIMIT="CREATE_FAIL_FROM_SERVER_LIMIT",t.PENDING="PENDING",t))(J||{}),n={...J,...S};c();i();var m=p(I()),W=p(N()),te=p(Re());c();i();function g(e){let r=e?.type||e?.message;return r==="ERR_SERVER_TINE_LIMIT"?{type:"ERR_SERVER_TINE_LIMIT"}:r==="ERR_SERVER_LIMIT"?{type:"ERR_SERVER_LIMIT"}:r==="ERR_NETWORK"?{type:"ERR_NETWORK"}:r==="ERR_SERVER_COMMON"?{type:"ERR_SERVER_COMMON",msg:e?.message}:{type:"ERR_DEFAULT"}}b();c();i();var X=p(I());ce();var Y=()=>(0,X.useCallback)(e=>{try{let r=e===n.CREATE_FAIL_FROM_SERVER_ERROR?"Server":"Local";w.captureException(`CreateWalletToServerInHomePage-${r}`)}catch(r){console.log(r)}},[]);c();i();b();Ee();le();me();var h=p(I()),ee=p(N());var re=()=>{let e=U({keyringType:P.MPC}),r=(0,ee.useSelector)(K),s=(0,h.useCallback)(async()=>{Promise.all(e.map(o=>{let t=o?.mpcId||"",a=o?.walletIdentities?.length-1;return D(B.syncMpcwallet,{mpcId:t,deriveIndex:a})})).then(o=>{_().setIsNeedSyncMpcIndex(!1)}).catch(o=>{console.log("syncMpcWallet error:")})},[e?.length]);(0,h.useEffect)(()=>{e?.length&&r&&s()},[e?.length,s,r])};var pe=e=>{let{needSyncMap:r={},createdMap:s={}}=(0,W.useSelector)(({metamask:T})=>T),o=Boolean(s[e]),t=Boolean(r[e]),a=q(),E=!o||t||a,[l,R]=(0,m.useState)(E?n.PENDING:""),[f,y]=(0,m.useState)("");return(0,te.useUpdateEffect)(()=>{R(n.PENDING)},[e]),(0,m.useEffect)(()=>{!a&&o&&!t&&R("")},[a,o,t]),{errorMsg:f,errorType:l,isWalletCreated:o,isWalletNeedSync:t,setErrorMsg:y,setErrorType:R}},fe=e=>{let{walletId:r,setErrorMsg:s,setErrorType:o}=e,t=Y();return(0,m.useCallback)(async()=>{let E=await _().getWalletTypeCreated(r);o(n.PENDING);try{await _().createWalletToServer({walletId:r,walletType:E,noticeBackend:!0}),H()}catch(l){switch(l?.message){case"ERR_NETWORK":o(n.CREATE_FAIL_FROM_NETWORK_ERROR),t();break;case"ERR_SERVER_LIMIT":o(n.CREATE_FAIL_FROM_SERVER_LIMIT),t(n.CREATE_FAIL_FROM_SERVER_LIMIT);break;default:o(n.CREATE_FAIL_FROM_SERVER_ERROR),s(l?.message);break}}},[t,r])},_e=e=>(0,m.useCallback)(async()=>{try{await _().syncWalletToServer(e)}catch{}},[e]),ue=({walletId:e,setErrorType:r,isWalletCreated:s,isWalletNeedSync:o,setErrorMsg:t})=>{let a=(0,W.useDispatch)(),E=(0,m.useCallback)(async()=>{try{await a(M())}catch(R){let{type:f,msg:y}=g(R);r(f),y!==void 0&&t(y)}},[t,r,a]),l=z();(0,m.useEffect)(()=>{(async()=>s&&!o&&(await E(),await _().getAccountKeys(),await l([e],!1)))()},[E,s,o,l,e])},Je=()=>{re();let e=j(),{errorMsg:r,errorType:s,isWalletCreated:o,isWalletNeedSync:t,setErrorMsg:a,setErrorType:E}=pe(e),l=fe({walletId:e,setErrorMsg:a,setErrorType:E}),R=_e(e);ue({walletId:e,setErrorType:E,setErrorMsg:a,isWalletCreated:o,isWalletNeedSync:t});let f=(0,m.useCallback)(async()=>{o?t&&await R():await l()},[l,o,t,R]);return(0,m.useEffect)(()=>{f()},[f]),[{errorType:s,errorMsg:r},{createWalletToServer:l}]};c();i();var F=p(I());V();function ye(){let e=G(),r=(0,F.useCallback)((t=5)=>{d.error({key:"serverLimitError",title:L("wallet_extension_home_notif_network_high_traffic"),duration:t,placement:d.DIRECTION.top})},[]),s=(0,F.useCallback)((t,a=5)=>{d.error({key:"customAlert",title:t,duration:a,placement:d.DIRECTION.top})},[]),o=(0,F.useCallback)((t,a)=>{switch(t){case n.CREATE_FAIL_FROM_NETWORK_ERROR:case n.ERR_NETWORK:e();break;case n.CREATE_FAIL_FROM_SERVER_LIMIT:case n.ERR_SERVER_LIMIT:r();break;case n.CREATE_FAIL_FROM_SERVER_ERROR:s(a);break;case n.ERR_SERVER_TINE_LIMIT:s(L("wallet_extension_error_check_device_time"));break;case n.ERR_SERVER_COMMON:s(a);break;default:break}},[s,e,r]);return{customAlert:s,serverLimitAlert:r,networkAlert:e,showErrorAlert:o}}var oe=ye;c();i();var k=p(I()),se=p(N());ie();V();c();i();var A={refreshWrapper:"_refreshWrapper_ec3nw_1",refresh:"_refresh_ec3nw_1",loading:"_loading_ec3nw_27",rotate:"_rotate_ec3nw_1"};var Wr=({className:e="",handleRefresh:r,onRefresh:s,status:o})=>{let t=(0,se.useDispatch)(),a=Q(),E=async()=>{x.trigger(Z)},{showErrorAlert:l}=oe(),{successHaptic:R,impactHaptic:f}=$(),y=v(async()=>{s?.(),r("loading"),f();try{await Promise.all([t(M()),a(),E()]),r("success"),R()}catch(T){let{type:ae,msg:ne}=g(T);l(ae,ne),r("error")}},800,{leading:!0});return o==="hidden"?null:k.default.createElement(C.FlexBox,{align:C.ALIGN.center,justify:C.ALIGN.center,className:`${A.refreshWrapper} ${e}`,onClick:T=>{T.stopPropagation(),o!=="loading"&&y()}},k.default.createElement(O,{size:O.SIZE.xs,icon:"okx-wallet-plugin-refresh",className:`${A.refresh} ${o==="loading"&&A.loading}`}))};export{g as a,n as b,Je as c,oe as d,Wr as e};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-WXZ3ZM4J.js.map
