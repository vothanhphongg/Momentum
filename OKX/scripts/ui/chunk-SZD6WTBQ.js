import{f as l,i as ot}from"./chunk-ASR4HLU7.js";import{K as W,S as j,U as st,a as A,g as S}from"./chunk-ANIUN6US.js";import{a as k,k as M,l as tt,t as w,u as rt,x as O,y as nt}from"./chunk-3DZ7WRLL.js";import{c as g,d as E,f as X}from"./chunk-DEOJU4Z3.js";import{Fa as B,Gc as v,Ja as T,Na as U,Sc as et,c as G,g as c,j as Q,wa as P,ya as x,za as Z}from"./chunk-TM67VPZU.js";import{b as h,d as z,f as d,n as process,o as u,q as f}from"./chunk-6KXF36WM.js";var it,at,ct,D,St,R=h(()=>{"use strict";u();f();tt();it=M({name:"keyring",initialState:{keyringIdentities:[],selectedWallet:""},reducers:{setKeyringIdentities:(t,e)=>{t.selectedWallet=e.payload.selectedWallet,t.keyringIdentities=e.payload.keyringIdentities}}}),{actions:at,reducer:ct}=it,{setKeyringIdentities:D}=at,St=ct});function Y(t,e){return e===a.LOCALE_TYPE.default?t:`${e}_${t}`}async function o(t,e,r){o.cache||(o.cache={});let n=Y(t,e);if(r&&o.cache[n])return o.cache[n];try{let{data:s}=await w(()=>B(x.i18nConfigUrl(t,e)),2,0),i=e===a.LOCALE_TYPE.default?ut(s):s,{local:m}=b.default.storage;return m.set({[n]:i}),o.cache[n]=i,i}catch(s){L.default.error(s)}return{}}async function K(t,e){let{local:r}=b.default.storage,n=Y(t,e);return new Promise((s,i)=>{r.get(n).then(m=>{s(m[n])}).catch(m=>{i(m)})})}async function ft(t,e=a.LOCALE_TYPE.default,r=void 0){try{let n={};if(process.env.ASSETS_BUILD_TYPE===c.PREPUB||process.env.ASSETS_BUILD_TYPE===c.PUBLISH){if(r?.remote)try{return n=await o(t,e,!1),r.storageWallet.set(r.project,r.version),n}catch(s){L.default.error(`failed to fetch ${t} locale because of`,s)}try{n=await K(t,e)}catch{return o(t,e,!0)}if(n&&Object.keys(n).length>0)return(!r||r.remote)&&o(t,e,!0),n}return o(t,e,!0)}catch(n){return L.default.error(`failed to fetch ${t} locale because of`,n),{}}}async function mt(t,e=a.LOCALE_TYPE.default,r=void 0){if(process.env.PLATFORM_WEB)return ft(t,e,r);try{let n={};return(process.env.ASSETS_BUILD_TYPE===c.PREPUB||process.env.ASSETS_BUILD_TYPE===c.PUBLISH)&&(n=await K(t,e)),{...await(await fetch(`/${e}/${t}/messages.json`)).json(),...n}}catch(n){return L.default.error(`failed to fetch ${t} locale because of`,n),{}}}async function p(t,e=a.LOCALE_TYPE.default,r=!0){if(process.env.ASSETS_BUILD_TYPE===c.PREPUB||process.env.ASSETS_BUILD_TYPE===c.PUBLISH){let n=await o(t,e,r);if(n)return n}return mt(t,e)}async function Tt(t){o(t,a.LOCALE_TYPE.default,!1),o(t,a.LOCALE_TYPE.dex,!1),o(t,a.LOCALE_TYPE.okd,!1)}var L,b,a,ut,N=h(()=>{"use strict";u();f();L=d(k()),b=d(G()),a=d(P());Z();Q();U();rt();ut=(t={})=>{let e={};return Object.entries(t).forEach(([r,n])=>{e[r]={message:n}}),e}});var ht={};z(ht,{forceUpdateMetamaskState:()=>J,getChainInfo:()=>dt,getCurrentWindowTab:()=>yt,lockMetamask:()=>Lt,setCurrentLocale:()=>V,setCurrentWindowTab:()=>q,setLastActiveTime:()=>pt,updateAccountIdentities:()=>I,updateCurrentLocale:()=>H,updateMetamaskState:()=>_,updateMetamaskStateFromBackground:()=>C,updatePartialMetamaskState:()=>gt});function V(t,e,r,n,s){return{type:W,value:{locale:t,messages:e,okdMessages:r,dexMessages:n,discoverMessages:s}}}async function dt(){g().getChainsFromServerAndSyncToControllers()}function H(t){return async e=>{try{let r=await p(t),n=await p(t,y.LOCALE_TYPE.okd),s=await p(t,y.LOCALE_TYPE.dex),i=await p(t,y.LOCALE_TYPE.discover);await E().setCurrentLocale(t),e(V(t,r,n,s,i)),T(t)}catch(r){e(l(r.message))}}}function I(t,e,r=!0){Array.isArray(t.accountIdentities)&&Array.isArray(t.keyringIdentities)&&(e(D(O({accountIdentities:t.accountIdentities,keyringIdentities:t.keyringIdentities,multiAddressBaseChainsMap:t.multiAddressBaseChainsMap,selectedWallet:t.selectedWallet}))),r&&(delete t.accountIdentities,delete t.keyringIdentities,delete t.multiAddressBaseChainsMap,delete t.selectedWallet))}function _(t){return(e,r)=>{let{metamask:n}=r(),{currentLocale:s}=n,{currentLocale:i}=t;s&&i&&s!==i&&e(H(i)),I(t,e),e({type:A,value:t})}}async function J(t){let e;try{e=await E().getStateByDomain()}catch(r){throw t(l(r.message)),r}return t(_(e)),e}function gt(t){return e=>{t.chainList&&(v(t.chainList),J(e)),I(t,e),e({type:A,value:t})}}function Lt(){return F.default.debug("background.setLocked"),t=>lt().then(()=>C()).catch(e=>{throw t(l(e.message)),e}).then(e=>{t(_(e)),t({type:S})}).catch(()=>{t({type:S})})}function pt(){return t=>{g().setLastActiveTime(e=>{e&&t(l(e.message))})}}function q(t){return{type:j,value:t}}function yt(){return async t=>{let e=await globalThis.platform.currentTab();t(q(e))}}var F,y,C,lt,Et=h(()=>{"use strict";u();f();F=d(k());ot();R();y=d(P());et();U();N();nt();X();st();C=()=>new Promise((t,e)=>{g().getState((r,n)=>{if(r){e(r);return}t(n)})});lt=()=>new Promise((t,e)=>{g().setLocked(r=>{if(r){e(r);return}t()})})});export{St as a,R as b,mt as c,Tt as d,N as e,dt as f,H as g,I as h,_ as i,J as j,gt as k,Lt as l,pt as m,yt as n,ht as o,Et as p};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-SZD6WTBQ.js.map
