import{a as pe,b as ge}from"./chunk-EWRQIXXK.js";import{a as le,b as de}from"./chunk-COMRRNGX.js";import"./chunk-4M3K2SWT.js";import"./chunk-BKCZZV5Q.js";import"./chunk-HVMJHKTE.js";import"./chunk-GR4GFB4P.js";import"./chunk-2W6CXXNZ.js";import"./chunk-JUBHPSCA.js";import{a as ue}from"./chunk-RRTG4E4G.js";import"./chunk-BARA7AIG.js";import{a as fe}from"./chunk-3YGJNBCZ.js";import"./chunk-U7LFLL6J.js";import"./chunk-3CVTSTBR.js";import"./chunk-TOV4UWR3.js";import"./chunk-BDM6XPIF.js";import"./chunk-N7RVZ3T6.js";import"./chunk-PSDESO5W.js";import"./chunk-HOU3VS5H.js";import"./chunk-SQDIO2NL.js";import"./chunk-TISF4HQJ.js";import"./chunk-IP7VSGCS.js";import"./chunk-XYDICNP3.js";import"./chunk-ALLM2Z34.js";import"./chunk-QXPTHK7Q.js";import{n as ie,t as ce,x as J}from"./chunk-2LCPVMSO.js";import"./chunk-Q57GWOMY.js";import{d as me}from"./chunk-7C3BTQYU.js";import{A as ae,z as se}from"./chunk-3XTUMVWB.js";import"./chunk-MGYCOFIC.js";import"./chunk-6THUPAMO.js";import"./chunk-FK5ARFJK.js";import"./chunk-6Y7SZIB7.js";import"./chunk-VVYJA72I.js";import"./chunk-OWWFH26C.js";import{d as V}from"./chunk-MNZIO3NP.js";import"./chunk-HEFTA5OH.js";import"./chunk-S7NLB5XS.js";import"./chunk-UUWJWUOY.js";import{a as D}from"./chunk-2DF43JKM.js";import"./chunk-7CC6X6YX.js";import"./chunk-JAGKSBYF.js";import"./chunk-CR2CPF4X.js";import"./chunk-HKZGONPS.js";import"./chunk-IIAVVYHZ.js";import"./chunk-TSTKPLAO.js";import"./chunk-52XLG23J.js";import"./chunk-EEFD5KZC.js";import"./chunk-73ZHJYCP.js";import"./chunk-3NSLXJYR.js";import"./chunk-ENPNPH37.js";import"./chunk-5QJIR6ZJ.js";import"./chunk-H6SNSZIS.js";import"./chunk-YWECPG37.js";import"./chunk-AXJECT36.js";import"./chunk-5BIOTNBS.js";import"./chunk-R5SMHBLJ.js";import"./chunk-IY4RYRL6.js";import"./chunk-4OAEJJK5.js";import"./chunk-34VLVCKN.js";import"./chunk-J4ZKBKEJ.js";import"./chunk-TFJRUJHH.js";import"./chunk-7NMUCCUG.js";import"./chunk-YF3DWJDS.js";import"./chunk-RH4ISAHA.js";import"./chunk-ECQND2NK.js";import"./chunk-W3L3YTJO.js";import"./chunk-M5NI6HPE.js";import"./chunk-YQHUKBMA.js";import"./chunk-VM2NMLPX.js";import"./chunk-YP7CHBKG.js";import"./chunk-FNXLAYUB.js";import"./chunk-PQK3LXXN.js";import"./chunk-FTRHGHDS.js";import"./chunk-XT3EOPTE.js";import"./chunk-A6Z53EN6.js";import"./chunk-LL63GZNI.js";import"./chunk-M7CL2K7X.js";import"./chunk-W2CTJYFJ.js";import"./chunk-XUKVTAH5.js";import"./chunk-5OJTPISL.js";import"./chunk-7UPVX2FL.js";import"./chunk-BSFXZ46S.js";import"./chunk-ZMCTBWUY.js";import"./chunk-UMGTYP2Z.js";import"./chunk-5F6JALEN.js";import"./chunk-FWD2CUUI.js";import"./chunk-W23ABSXX.js";import"./chunk-FOF22X4F.js";import"./chunk-P4EMG7RN.js";import"./chunk-BVDJNUOM.js";import"./chunk-7B5UI77E.js";import"./chunk-R6X7EOIE.js";import"./chunk-MKEYCSLA.js";import"./chunk-4EFZXPDV.js";import"./chunk-4KODREVA.js";import"./chunk-6UWGBJGT.js";import"./chunk-G4AVWXHJ.js";import"./chunk-76CRIMII.js";import"./chunk-F7VSWGDW.js";import"./chunk-KLLSVAFY.js";import"./chunk-MBHGLWZJ.js";import"./chunk-QZO7W5WD.js";import"./chunk-AKE54ZCC.js";import"./chunk-EHZWM44P.js";import"./chunk-K6STDTUY.js";import"./chunk-A57OTXBP.js";import"./chunk-YJQGXXOQ.js";import"./chunk-HTLOGWI7.js";import"./chunk-6SEP5B7P.js";import"./chunk-FHKOH5E6.js";import"./chunk-NTQ2YVDA.js";import"./chunk-KKG4PJ6O.js";import"./chunk-7SRLIN7D.js";import"./chunk-AW5NL3JM.js";import"./chunk-RI2WZ5PA.js";import"./chunk-YIAOHVF5.js";import"./chunk-KBS3PMLQ.js";import"./chunk-7GKX3YKG.js";import"./chunk-7HFBMBFB.js";import"./chunk-TJCPJQIM.js";import"./chunk-ZTAZ2272.js";import"./chunk-IRMYAC6R.js";import"./chunk-Q76QXAWY.js";import"./chunk-THSNJ5WU.js";import"./chunk-MRB2XFLQ.js";import"./chunk-65AJJVJY.js";import"./chunk-PDC447BO.js";import"./chunk-JI6FOZGR.js";import"./chunk-JCM7SRK2.js";import"./chunk-PTD7UCOR.js";import"./chunk-Q4YTGP2G.js";import"./chunk-ETJEH7T4.js";import"./chunk-LLZAOPDB.js";import"./chunk-V3IFYKWM.js";import"./chunk-EWTTD4DL.js";import"./chunk-Y2TPPS4H.js";import"./chunk-ITY22AD4.js";import"./chunk-E2JYOUYE.js";import"./chunk-B3JSNQIV.js";import"./chunk-YALUYHLV.js";import"./chunk-I3CPAVOC.js";import"./chunk-ARWSGU73.js";import"./chunk-CZ2ZBAZV.js";import{o as Ne}from"./chunk-5QMHGZLF.js";import{Va as te,Wa as re,ec as Ge}from"./chunk-HPWCPLRR.js";import"./chunk-O6ZBO5JF.js";import"./chunk-TSTPZ3JM.js";import"./chunk-D2LKUI4F.js";import"./chunk-ON6S2DB7.js";import{j as oe,p as ve}from"./chunk-SZD6WTBQ.js";import"./chunk-ASR4HLU7.js";import"./chunk-ANIUN6US.js";import"./chunk-3DZ7WRLL.js";import{d as $,f as De}from"./chunk-DEOJU4Z3.js";import"./chunk-PLIIQKFY.js";import"./chunk-6BXYJZHH.js";import"./chunk-CCEMKRO6.js";import"./chunk-2HSCH6R3.js";import"./chunk-CWNIM6RS.js";import"./chunk-NNAD25BL.js";import"./chunk-XV444F26.js";import{fa as L}from"./chunk-N2BCRNDB.js";import"./chunk-RTFE54S3.js";import"./chunk-GCQ4H2BA.js";import{f as ne}from"./chunk-JGEHAFTO.js";import"./chunk-UVFOW4HH.js";import"./chunk-LNOPECCQ.js";import"./chunk-CB7FOZNP.js";import"./chunk-43VURGIT.js";import{Ib as ee,Q as z,fc as M,ha as Re,rc as j}from"./chunk-TM67VPZU.js";import"./chunk-VW6OQNWT.js";import{H as Q}from"./chunk-PUSMMCUD.js";import{R as Y,z as u}from"./chunk-UWJLNJLY.js";import"./chunk-VRY2ADKE.js";import"./chunk-VWEB6W6G.js";import"./chunk-5U7FO2PW.js";import"./chunk-PDUOSATP.js";import{L as K,ra as he}from"./chunk-XDY6V34Y.js";import"./chunk-YJFNO57I.js";import"./chunk-DZ6CTC22.js";import"./chunk-JT3LNHPY.js";import"./chunk-47UWF72W.js";import{b as G}from"./chunk-JWYCKY2V.js";import"./chunk-G2266BV2.js";import"./chunk-L4PAIYPH.js";import"./chunk-UT7LJPKF.js";import"./chunk-AFZ6A2B3.js";import"./chunk-VVPY7ZA7.js";import"./chunk-KUW5VATV.js";import"./chunk-BNAVWOJ2.js";import"./chunk-IG2Q5ALZ.js";import"./chunk-WOMUNWBT.js";import"./chunk-QNGB57GN.js";import"./chunk-NM2PDVBD.js";import"./chunk-F6PXOVYL.js";import"./chunk-324EPGNQ.js";import"./chunk-5GFHI4AK.js";import"./chunk-QYVQBXDG.js";import"./chunk-7D4PUIEN.js";import"./chunk-IWVM7XL6.js";import"./chunk-7QO4TZYQ.js";import"./chunk-FF4LY6PE.js";import"./chunk-76KCDJDG.js";import"./chunk-YDUDQP2P.js";import"./chunk-PGPFV4JQ.js";import"./chunk-MIBHDVGP.js";import"./chunk-7VFUX7IX.js";import"./chunk-XLF4LAH2.js";import"./chunk-ONKZ57T6.js";import"./chunk-ZC7Q7LCH.js";import{f as k,o as f,q as l}from"./chunk-6KXF36WM.js";f();l();var ye=k(G());f();l();var F=k(G()),Ae=k(Ge());Y();De();ve();j();f();l();var E=k(G());he();Y();Re();var Le=({code:e,data:o,error_message:n,error:a})=>{if(e!==0||!o||o.queryGasLimitErrorUseDefault||a)return{fee:0,feeError:!0,feeErrorMsg:n};let{gasLimit:s="0"}=o;return{...o,fee:s,feeError:!1,feeErrorMsg:""}},Oe=e=>e?.feeError&&e?.feeErrorMsg?u("wallet_extension_alert_estimate_unavailable_error",{errorMsg:e.feeErrorMsg}):"",be=(e,o)=>{let n=K(e)||z(e,o),a=K(e)||z(e,0);return{isSufficientGas:n,isSufficientBalance:a}},Be=({coinId:e,unapproved:o,paramsInfo:n})=>{let{coin:a,toAdr:s,fromAddr:t,walletId:i,messages:r,network:c,validUntil:T}=n,{chainId:x,localType:m}=a||{},d=fe(e,o.walletId)||{},{coinAmountInt:I}=d,h=J(),A=(0,E.useRef)(null),[C,_]=(0,E.useState)(!0),[p,P]=(0,E.useState)({}),[w,b]=(0,E.useState)({});(0,E.useEffect)(()=>{m&&e&&t&&i&&r&&(async()=>{try{_(!0);let g=await h({coinId:e,address:t,toAddr:s,fromAddr:t}),S=await se({nonce:g?.nonce,localType:m,fromAddr:t,walletId:i,messages:r,network:c,validUntil:T});b({signInfo:g,sequence:g?.nonce,inputData:JSON.stringify(S?.stringInputParams),transactionParams:S?.transactionParams})}catch(g){_(!1),P({feeError:!0,feeErrorMsg:g?.message||u("wallet_extension_alert_estimate_unavailable_error")})}})()},[m,e,t,i,r]),(0,E.useEffect)(()=>((()=>{let{inputData:g}=w;if(_(!0),g){let S=async()=>{let W=await ae({fromAddr:t,chainId:x,coinId:e,inputData:g}),q=Le(W);_(!1),P(q)};(()=>{clearInterval(A.current),S(),A.current=setInterval(S,7e3)})()}})(),()=>{clearInterval(A.current)}),[w.inputData,x,t,e]);let{isSufficientGas:B,isSufficientBalance:U}=be(I,p?.fee),v=Oe(p);return{networkFeeProps:{coinId:e,loading:C,estimateFailed:p?.feeError,estimateFailedMsg:v,networkFee:p?.fee},isSufficientGas:B,isSufficientBalance:U,estimateFailed:p?.feeError,estimateFailedMsg:v,extParams:{coinId:e,coinAmount:0,inputData:w?.inputData,fromAdr:t,toAdr:s,serviceCharge:p?.fee,extJson:JSON.stringify({nonce:w?.sequence}),txSource:2,accountId:o?.walletId,walletType:2,transactionParams:w?.transactionParams},coinWithBalance:d}},_e=Be;f();l();j();function We(e){let o=V(M)||{},{address:n,walletId:a}=D(e),s=e?.params?.transaction||{},t=s?.messages||[],i=s?.network,r=s?.valid_until,{address:c}=t[0]||{};return{toAdr:c,coin:o,fromAddr:n,walletId:a,messages:t,validUntil:r,network:i}}var we=We;f();l();var y=k(G());var Ve=({origin:e,walletId:o,localType:n})=>{let a=ce(),[s,t]=(0,y.useState)(!0),{host:i}=ue({origin:e}),r=D({walletId:o,localType:n}),[c,T]=(0,y.useState)({}),x=(0,y.useCallback)(async(I,h,A)=>{let C="";try{C=JSON.stringify(A)}catch{}let{coinId:_,chainId:p}=I,P=await a({coinId:_,checkTypes:[L.KYS,L.VERIFY_GAS_LIMIT],amount:0,from:r.address,to:"",txType:3,domain:i,tokenAddress:"",inputData:h,chainId:p,additionalData:{tonSignData:C}});T(P),t(!1)},[i,a,r.address]),m=(0,y.useMemo)(()=>({loading:s,...c[L.KYS]||{}}),[s,c]),d=(0,y.useMemo)(()=>c[L.VERIFY_GAS_LIMIT]||{},[c]);return{kysRet:m,loading:s,preExecute:x,preExecuteRet:c,verifyGasLimitRet:d}},Ee=Ve;f();l();var Te=k(G()),xe=k(Ne());Y();j();function Je({transaction:e,fromAddress:o}){let{valid_until:n,network:a,from:s,messages:t}=e,[i,r]=(0,Te.useState)("");return(0,xe.useAsyncEffect)(async()=>{if(a!==te.MAINNET)r(u("wallet_extension_error_incorrect_destination_network"));else if(n<Math.floor(Date.now()/1e3))r(u("wallet_extension_error_expired_transaction"));else if(!t||t.length===0)r(u("wallet_extension_error_invalid_transaction_parameter"));else{let{TonWallet:c}=await ne(),T=new c;for(let d=0;d<t.length;d++){let I=t[d]?.address;if(!await me(I,M)){r(u("wallet_extension_error_incorrect_destination_network"));return}}let x=await T.convertAddress({address:o}),m=await T.convertAddress({address:s});x?.raw!==m?.raw&&r(u("wallet_extension_error_incorrect_receiving_address"))}},[n,a,s,o]),{checkParamsTipMessage:i?{message:i}:null,code:i?re.BAD_REQUEST_ERROR:null}}var Ie=Je;var Ue=(0,F.memo)(({unapproved:e})=>{let o=(0,Ae.useDispatch)(),n=V(M)||{},a=n?.coinId||M,{walletId:s,address:t,addressType:i}=D(e),r=we(e),T=(i?.[ee]||[]).find(R=>R.address===t),x=J(),{networkFeeProps:m,isSufficientGas:d,estimateFailed:I,estimateFailedMsg:h,isSufficientBalance:A,extParams:C,coinWithBalance:_}=_e({coinId:a,unapproved:e,paramsInfo:r}),{id:p,origin:P,localType:w}=e,b=Ee({origin:P,walletId:s,localType:w}),{inputData:B,transactionParams:U}=C,v=(0,F.useRef)(),{preExecute:H,kysRet:N,verifyGasLimitRet:g}=b,S=e?.params?.transaction||{};(0,F.useEffect)(()=>{n?.coinId&&!m?.loading&&!v.current&&(v.current=!0,H(n,B,S))},[n?.coinId,m?.loading,B]);let X=le({kysRet:N,baseCoin:n,estimateFailed:I,estimateFailedMsg:h,isSufficientGas:d,isSufficientBalance:A,verifyGasLimitRet:g,coinWithBalance:_}),{checkParamsTipMessage:W,code:q}=Ie({transaction:S,fromAddress:t}),Fe=pe({id:p,walletId:s,origin:P,localType:w,extraParams:{code:q}}),Ce=W||X,Pe=async()=>{try{let R=await x({coinId:a,address:r?.fromAddr,toAddr:r?.toAdr,fromAddr:r?.fromAddr}),Z=await $().approveDappRequest(p,{...C,transactionParams:{...U,seqno:R?.nonce,walletVersion:T?.addressType},extJson:JSON.stringify({nonce:R?.nonce})});if(Z.code===10009){Q.error(Z?.msg||u("wallet_extension_failure_subtitle_fail_resend"));return}await oe(o)}catch(R){Q.error(R?.msg||u("wallet_extension_failure_subtitle_fail_resend"))}},{buttonGroup:ke,handleCancel:Me}=ge({coinId:a,unapproved:e,preExecuteRet:b,feeLoading:m?.loading,estimateFailed:I,isSufficientGas:d,isSufficientBalance:A,disabledConfirmBtn:!!W,onConfirm:Pe,onCancel:Fe,coinWithBalance:_});return ie({kysRet:N,handleCancel:Me}),F.default.createElement(de,{kysRet:N,unapproved:e,tipMessage:Ce,buttonGroup:ke,networkFee:m})}),Se=Ue;var Jt=({unapproved:e})=>ye.default.createElement(Se,{unapproved:e});export{Jt as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Ton-IFOG6B4R.js.map
