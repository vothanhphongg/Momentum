import{a as _s,b as Qt,c as ys,d as Ps}from"./chunk-6IUGQ6HH.js";import{a as ks,d as Es,e as Rs,g as bs,l as vs,o as ko}from"./chunk-KLTZ3J5Y.js";import{a as Ls}from"./chunk-DHKYJFAA.js";import{a as or,c as rr}from"./chunk-ZE7UTNU6.js";import{a as qi,b as no,c as Yi,d as Mt,e as zo,f as Ft,g as xt,h as es,i as co,j as rt,k as po,l as mo,m as lo,o as us,p as ps,r as ls,s as fo,t as Co,u as Io,v as Ss,x as As}from"./chunk-EEFD5KZC.js";import{e as ns,f as st,h as Ao,i as gs,j as Ts,k as _e}from"./chunk-73ZHJYCP.js";import"./chunk-3NSLXJYR.js";import"./chunk-ENPNPH37.js";import{a as Et,b as ms,c as ho,f as yt,g as ke}from"./chunk-5QJIR6ZJ.js";import{a as Bt,b as qt,c as Ut,d as ss,e as Ae}from"./chunk-H6SNSZIS.js";import{d as as,e as cs,h as So,i as go,k as To,m as er,n as Rt}from"./chunk-YWECPG37.js";import{a as ds,b as hs,c as fs,r as Gt,s as Cs,t as Is}from"./chunk-AXJECT36.js";import"./chunk-5BIOTNBS.js";import"./chunk-R5SMHBLJ.js";import{a as O}from"./chunk-IY4RYRL6.js";import"./chunk-4OAEJJK5.js";import{b as Zi}from"./chunk-34VLVCKN.js";import{a as ts,e as Jo}from"./chunk-J4ZKBKEJ.js";import"./chunk-TFJRUJHH.js";import"./chunk-7NMUCCUG.js";import{e as Ji,g as lt,h as se,i as A}from"./chunk-YF3DWJDS.js";import{a as Ki,g as H,h as L}from"./chunk-RH4ISAHA.js";import{O as rs,Q as tr,d as Zo,j as uo,n as os,w as ne}from"./chunk-ECQND2NK.js";import"./chunk-W3L3YTJO.js";import{d as io,h as Wi,i as Hi}from"./chunk-M5NI6HPE.js";import{a as ji}from"./chunk-YQHUKBMA.js";import{a as b,b as Te,c as ao,d as W,e as J,f as Xi,r as zi}from"./chunk-VM2NMLPX.js";import{b as is}from"./chunk-YP7CHBKG.js";import{e as $i}from"./chunk-FNXLAYUB.js";import{a as T,c as Mi,e as Dt,f as Fi,g as mt,h as xi,i as Bi,j as Ce,k as so,m as Gi,r as Qi,s as Vi,u as _t,v as Ie,x as $o}from"./chunk-PQK3LXXN.js";import{$ as Q,$b as Ti,$c as Yn,A as Ze,Bc as vi,Ca as jo,Cc as Pi,D as y,Da as ii,Dc as wi,E as oe,Ea as Ct,Ec as Oi,F as re,G as Jr,Hc as Ni,I as Ot,J as Vo,M as to,Mb as ni,Na as oo,Nb as ai,Oa as Nt,Ob as ci,P as G,Pb as ui,Q as ut,Qb as pi,Qc as Di,R as Tt,Rb as mi,Sb as li,T as Wo,Tb as di,U as Zr,Ub as hi,V as pt,Vb as fi,W as eo,Yb as Si,Zc as d,_ as Ho,_b as gi,a as Ke,aa as ot,ab as si,b as je,ba as ti,bb as Xo,c as he,cb as g,cc as Ci,d as fe,dc as Ii,e as Xe,ec as Ai,f as Se,fa as Yo,g as Qo,ga as ei,h as $e,i as ee,j as Kr,k as ge,ka as kt,l as jr,lb as X,mb as V,o as Y,oc as ki,p as ze,pc as _i,q as K,qc as Ei,ra as Ko,t as Xr,ta as oi,tc as yi,u as M,ua as ri,ub as ro,v as Je,vb as P,vc as Ri,w as $r,x as zr,xb as ie,xc as bi,yc as Li}from"./chunk-FTRHGHDS.js";import{a as E,b as Ui,c as q}from"./chunk-XT3EOPTE.js";import{A as Yr,B,b as Ve,f as gt,g as It,h as At,j as et,k as We,l as N,m as ct,o as Qr,p as te,q as He,r as Vr,s as Wr,t as Hr,z as Ye}from"./chunk-A6Z53EN6.js";import"./chunk-LL63GZNI.js";import"./chunk-M7CL2K7X.js";import"./chunk-W2CTJYFJ.js";import"./chunk-XUKVTAH5.js";import"./chunk-5OJTPISL.js";import"./chunk-7UPVX2FL.js";import"./chunk-BSFXZ46S.js";import"./chunk-ZMCTBWUY.js";import"./chunk-JI6FOZGR.js";import"./chunk-O6ZBO5JF.js";import"./chunk-TSTPZ3JM.js";import{a as wt}from"./chunk-ON6S2DB7.js";import"./chunk-VW6OQNWT.js";import{G as Gr,H as z,k as Ur}from"./chunk-PUSMMCUD.js";import{G as k,R as tt,a as Qe}from"./chunk-UWJLNJLY.js";import{A as qe,E as Pr,F as wr,H as U,J as Or,O as Ue,T as Nr,U as Dr,W as Mr,Z as Ge,aa as Fr,c as $,f as Z,ga as qo,h as St,i as Bo,ia as Uo,j as S,ja as xr,la as de,na as Go,p as Rr,pa as Br,r as br,ra as v,v as Lr,w as vr,y as Be}from"./chunk-XDY6V34Y.js";import{e as qr,ea as Pt}from"./chunk-JT3LNHPY.js";import"./chunk-47UWF72W.js";import{b as x}from"./chunk-JWYCKY2V.js";import"./chunk-G2266BV2.js";import"./chunk-NM2PDVBD.js";import"./chunk-7VFUX7IX.js";import{f as R,h as i,o as u,q as p}from"./chunk-6KXF36WM.js";u();p();var xo=R(x()),Hn=R(wt());u();p();var Os=R(x());u();p();var _o=R(x());var ws=({children:a,rootStore:t})=>{let e=Ui(t),o=(0,_o.useMemo)(()=>(t.commonStore.rootStore=t,t.accountStore.rootStore=t,t),[t]);return _o.default.createElement(e.Provider,{value:o},a)};var Ns=ct(({swapRootStore:a,bridgeRootStore:t,children:e,initTab:o})=>{let{commonStore:{currentTab:r}}=a.getInstance(),s=o||r,n=a.getInstance();return s===P.BRIDGE&&(n=t.getInstance()),Os.default.createElement(ws,{rootStore:n},e)});u();p();var Ro=R(x());u();p();u();p();var Ee=R(x());var Kn=()=>{let a=b.get(jo);if(a){if(b.remove(jo),a.startsWith(Vr))return Ct.MEME_BUY;if(a.startsWith(J))return Ct.BRIDGE;if(a.startsWith(W))return Ct.SWAP}return b.get(ii)||Ct.SWAP},jn=a=>({[Ct.SWAP]:W,[Ct.BRIDGE]:J,[Ct.MEME_BUY]:Wr,[Ct.MEME_SELL]:Hr})[a]||W,Xn=()=>{let{params:a,replace:t}=Gt(),{autoSwitch:e,from:o}=a,r=Kn();if(e===er.BRIDGE&&!o.tokenContractAddress){let s=jn(r);t({pathname:s,params:{...a,autoSwitch:void 0}})}},Ds=a=>{let{params:t,replace:e}=Gt(),{autoSwitch:o}=t,[r,s]=(0,Ee.useState)(""),[n,c]=(0,Ee.useState)(!0);return Xn(),(0,Ee.useEffect)(()=>{a&&(async()=>{if(a===P.SWAP&&o===er.BRIDGE){let l=await Rt.judgeTabTypeByParams(t?.from,t?.to);l===P.BRIDGE&&e({pathname:J,params:{...t,autoSwitch:void 0}}),s(l),c(!1)}else s(a),c(!1)})().catch(()=>{})},[a]),{tabType:r,autoSwitching:n}};u();p();var Eo=R(x()),Ms=R(wt());var Fs=()=>{let{pathname:a}=(0,Ms.useLocation)(),[t,e]=(0,Eo.useState)("");return(0,Eo.useEffect)(()=>{switch(a){case ao:case W:e(P.SWAP);break;case J:e(P.BRIDGE);break;default:break}},[a]),t};u();p();var ir=R(x());var xs=(a,t)=>{let{accountStore:e}=q(),{params:o}=Gt(),{addressType:r}=o;(0,ir.useEffect)(()=>{e.setAddressType(r)},[]);let s=Cs();(0,ir.useEffect)(()=>{async function n(){let c=new Rt(a,o),{from:m,to:l,tab:h,inputAmount:C,error:I}=await c.initTokenPair(t);I||s(m,l,C,h)}a&&n().catch(()=>{})},[a])};u();p();var Bs=R(x()),qs=R(wt());var Us=a=>{let{fromToStore:t}=q(),{from:e,to:o}=t,{params:r,replace:s}=Gt(),{pathname:n}=(0,qs.useLocation)(),c=Is();(0,Bs.useEffect)(()=>{let m=c(e,o);m&&a&&[W,J].includes(n)&&(new Rt(a).writeTabInfoToLocalStorage(m),s({params:{...m,feeConfig:r.feeConfig}}))},[e?.chainId,e?.tokenContractAddress,o?.chainId,o?.tokenContractAddress,a,n])};var $n=a=>{let t=Fs(),{tabType:e}=Ds(t);xs(e,a),Us(e)},Gs=$n;u();p();var Vs=R(x());u();p();function zn(a){return new Promise(t=>setTimeout(t,a))}async function ae(a,t=3,e=0){let o;for(let r=0;r<t;r++)try{return await a()}catch(s){o=s,e&&r<t-1&&await zn(e)}throw o}function Jn(a,t,e){let o=lt();return{promise:a(t,{...e,signal:o.signal}),cancel:()=>o.abort()}}function Zn(a,t,e){if(Nt())return Jn(a,t,e);let o=new AbortController,r=o.signal;return{promise:a(t,{...e,signal:r}),cancel:()=>o.abort(),abortController:o}}function Qs(a,t){return Zn(A.get,a,t)}function Ws(){let{accountStore:a,receiveAddressStore:t}=q(),{address:e,setUserForbiddenBridge:o}=a,{receiveAddrObj:r,computedSwapHighLight:s}=t,{specifiedAddress:n}=r||{};(0,Vs.useEffect)(()=>{let c=()=>{};if(e&&s){let{promise:m,cancel:l}=Qs(Ri,{params:{userWalletAddress:e,receiveWalletAddress:n}});c=l,m.then(h=>{o(h?.data.blackListTypes||to)}).catch(()=>{o(to)})}else o(to);return c},[e,o,n,s])}u();p();var Hs=R(x());function sr(){let{accountStore:{address:a}}=q();(0,Hs.useEffect)(()=>{L.setTags({address:a})},[a])}u();p();var nr=R(x());var ta=()=>{let{accountStore:a,fromToStore:t,approveStore:e,recentTransactionStore:o,tokenModalStore:r}=q(),{computedAccountWalletAddresses:s}=a;(0,nr.useEffect)(()=>{let n=()=>{};return s&&(n=gs(s)),()=>{n?.()}},[s]),(0,nr.useEffect)(()=>{let n=Ao({isPri:!0,needLogin:!0,subscribeParams:[{channel:_e.DEX_PUSH_ENGINE},{channel:_e.WALLET_ASSET}],onListenError:()=>{e.onSocketError(),o.onSocketError(),t.setNeedBalanceLoading(!1),t.getSwapTokenBalance(),r.reloadTokenList()},onListenData:(c,m)=>{if(!!c){if(m?.channel===_e.DEX_PUSH_ENGINE){o.onSocket(c),e.onSocket(c);return}m.channel===_e.WALLET_ASSET&&(r.updateAllTokenList(c),t.updateFromBalancePush(c))}}});return()=>{n?.()}},[o.onSocket,r.updateAllTokenList,t.updateFromBalancePush,a,o,r])},Ys=ta;u();p();var ar=R(x());v();var Ks=({token:a,onListenData:t=Z,globalPrice:e})=>{(0,ar.useEffect)(()=>{!Ie(a)||Jo(a,e)&&t(e)},[e,a?.chainId,a?.tokenContractAddress]),(0,ar.useEffect)(()=>{if(!Ie(a))return Z;if(Jo(a,e))return Z;let o=Ao({subscribeParams:{channel:Ts.DEX_MARKET_TX_CHANNEL,chainId:a.chainId,tokenAddress:a.tokenContractAddress},onListenData:r=>{t(r?.[0]||{})},onListenError:Z});return()=>{o()}},[a?.chainId,a?.tokenContractAddress])},ea=()=>{let{fromToStore:a={},commonMarketStore:t={}}=q(),{from:e,updateFromUsdPriceFromWs:o,to:r,updateToUsdPriceFromWs:s}=a,{globalPrice:n}=t;Ks({token:e,onListenData:o,globalPrice:n}),Ks({token:r,onListenData:s,globalPrice:n})},js=ea;u();p();var bt=R(x()),Xs=R(wt());Ki.setDataProxy(A);var oa=({currency:a,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,addressBookList:r,walletList:s,t:n,dispatch:c,currentTab:m,onBack:l})=>{let{commonStore:h,accountStore:C,recentTransactionStore:I,reset:_}=q(),w=(0,Xs.useHistory)();(0,bt.useEffect)(()=>{B.setRuntimeContext({history:w,toLocale:n,dispatch:c,walletInfo:e,onBack:l})},[n,w,c,e,l]),(0,bt.useEffect)(()=>(t&&C.setWalletConfig(t),()=>{C.cleanWalletConfig()}),[t]),(0,bt.useEffect)(()=>(h.getUserUnit(a),h.fetchChainList({businessLine:1,currentTab:m}).catch(()=>{h.setChainListLoadError(!0)}),()=>{_()}),[]),(0,bt.useEffect)(()=>{C.setAddressBookList(r)},[r]),(0,bt.useEffect)(()=>{C.setWalletList(s)},[s]),(0,bt.useEffect)(()=>{C.setKeyringIdentityTypeEnum(o)},[o]),(0,bt.useEffect)(()=>{t.walletId?I.updatePendingOrders(t.walletId):I.setPendingOrders([])},[t.walletId,m]),ks()},$s=oa;u();p();var j=R(x()),Lt=R(wt());u();p();var Vt=R(x()),yo=R(wt()),an=R(Yn());u();p();var zs=R(x());var ra=()=>{let{fromToStore:a}=q(),{visibleAddFunds:t,addFundsParams:e,closeAddFunds:o}=a;return zs.default.createElement(_s,{visible:t,params:e,onBack:()=>{o()}})},Js=ct(ra);u();p();var Zs=R(x());var tn=()=>{let{fromToStore:a}=q(),{closeAddFunds:t}=a;(0,Zs.useEffect)(()=>{t()},[])};u();p();var en=R(x());function on(){return en.default.createElement(Es,{iconStyle:{fontSize:24},tooltipProps:{show:!1},iconClassName:Qt.rightIcon})}u();p();var rn=R(x()),sn=R(wt());function nn(){let a=(0,sn.useLocation)(),t=Rs(),{isTelegramMiniApp:e}=B.global,o=a.pathname;return(0,rn.useMemo)(()=>!e&&o===W&&t,[e,o,t])}var ia=[W,J],sa=({children:a,onBack:t})=>{let{showNavigator:e,title:o}=ys(),r=(0,yo.useLocation)(),s=(0,yo.useHistory)(),{isTelegramMiniApp:n}=B.global,{Navigator:c}=B.components,m=r.pathname.includes(te),l=nn();tn();let h=()=>{m&&ne({...st(),button_name:"back"}),t?t(s.goBack,ia.includes(r.pathname)):s.goBack()},C=()=>n?Qt.telegramContainer:e?Qt.extensionContainer:Qt.extensionContainerNoHeader,{recentTransactionStore:I}=q(),{dialogVisible:_,dialogOrderId:w,closeDialog:D}=I;return Vt.default.createElement("div",{className:(0,an.default)("universe-swap background-base-primary",Qt.wrapper)},e?Vt.default.createElement(c,{asPage:!0,title:o,onBack:h,closeable:l?{children:Vt.default.createElement(on,null)}:!1}):null,Vt.default.createElement("div",{className:C()},a),Vt.default.createElement(Js,null),Vt.default.createElement(As,{orderId:w,visible:_,onClose:D}))},cn=ct(sa);var na=(0,j.lazy)(()=>import("./Swap-2CPECRE6.js")),aa=(0,j.lazy)(()=>import("./Bridge-6W4F6R3I.js")),ca=(0,j.lazy)(()=>import("./OrderDetail-ZG5QZYVL.js")),ua=(0,j.lazy)(()=>import("./Contract-LVLB7UGT.js")),pa=(0,j.lazy)(()=>import("./Approve-TXPCLTNQ.js")),ma=(0,j.lazy)(()=>import("./Solana-SQ4WGIY3.js")),la=(0,j.lazy)(()=>import("./Claim-RVMR6NJU.js")),da=({onBack:a})=>{let t=(0,Lt.useLocation)();return j.default.createElement(cn,{onBack:a},j.default.createElement(j.Suspense,null,j.default.createElement(Lt.Switch,null,[{path:W,component:na,exact:!0},{path:J,component:aa,exact:!0},{path:Qr,component:ca,exact:!0},{path:te,component:ua,exact:!0},{path:He,component:pa,exact:!0},{path:Ye,component:ma,exact:!0},{path:Yr,component:la,exact:!0}].map((o,r)=>j.default.createElement(Lt.Route,{key:r,path:o.path,component:o.component,exact:o.exact})),j.default.createElement(Lt.Redirect,{from:ao,to:{pathname:W,search:t.search},strict:!0,exact:!0}))))},un=da;var ha=({currency:a,currentWallet:t,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,walletInfo:s,onBack:n,t:c,dispatch:m,currentTab:l=P.SWAP})=>{Gs(s.chainId),$s({currency:a,currentWallet:t,walletInfo:s,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,t:c,dispatch:m,currentTab:l,onBack:n}),Ws(),Ys(),sr(),js();let{initialized:h}=Ss();return h?Ro.default.createElement(un,{onBack:n}):null},pn=(0,Ro.memo)(ct(ha));u();p();u();p();u();p();var ye=class{constructor(){this.isSwapLoading=!1;this.setSwapLoading=t=>{this.isSwapLoading=t};this.checkCancelLimitOrder=async()=>{};N(this)}};u();p();v();tt();var Re=class{constructor(t){i(this,"checkTokenValid",async t=>{if(!Ie(t))return!1;let[e,o]=await k(A.get(Ni,{params:Ge(t,["chainId","tokenContractAddress"])}));return e?!1:o.data.supportMarket});this.rootStore=t,this.accountStore=t.accountStore,N(this,{},{autoBind:!0})}};var Wt=class{constructor(){Wt.instance?(this.commonStore=Wt.instance.commonStore,this.accountStore=Wt.instance.accountStore,this.checkTokenStore=Wt.instance.checkTokenStore,this.limitOrderConfirmStore=new ye(this)):(this.commonStore=new es(this),this.accountStore=new Yi(this),this.checkTokenStore=new Re(this),this.limitOrderConfirmStore=new ye(this),Wt.instance=this)}},Ht=Wt;i(Ht,"instance",null);u();p();u();p();v();tt();var cr=class{constructor(t){this.approveTokenDefaultConfig={status:y.Unknown,approvedAmount:"0"};this.approveTokensConfig={};this.getApproveTokenMapKey=(t,e)=>{let o=this.commonStore.getTokenAddress(t);return`${t.chainId}_${o}_${e}`};this.registerApproveToken=(t,e)=>{let o=this.getApproveTokenMapKey(t,e),r=S(this.approveTokensConfig,o);U(r)&&(this.approveTokensConfig[o]={...this.approveTokenDefaultConfig})};this.registerCurrentApproveToken=()=>{let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;this.registerApproveToken(t,e)};this.updateApproveTokenConfig=(t,e,o)=>{let r=this.getApproveTokenMapKey(t,e),s=S(this.approveTokensConfig,r),n=U(s),c=s||this.approveTokenDefaultConfig;this.approveTokensConfig[r]={...c,...o},n&&L.stuff("if you want to update approve token config, you should register it first.")};this.removeApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);delete this.approveTokensConfig[o]};this.updateCurrentApproveTokenConfig=t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode;this.updateApproveTokenConfig(e,o,t)};this.getApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);return S(this.approveTokensConfig,o,this.approveTokenDefaultConfig)};this.clearNonApprovingTokensConfig=()=>{let t=Dr(this.approveTokensConfig,e=>[y.Approving,y.CancelApproving].includes(e.status));this.approveTokensConfig={...t}};this.isApprovalCheckRequired=()=>{let{computedIsSolanaChain:t,computedIsAptosChain:e}=this.fromToStore,{quote:{bestRoute:o}}=this.rootStore.quoteStore,r=this.commonStore.computedCurrentTabIsLimit,{token:s}=this.computedTokenAndTradeModeCode,{isNativeToken:n}=s;return(r?!0:o?.needApprove==="1")&&!n&&!t&&!e};this.validApproveAmountLessSwapAmount=t=>{let{token:e}=this.computedTokenAndTradeModeCode;return T.BigNumber(t).isLessThan(e.amount||"0")};this.isValidApprovalStatus=(t,e)=>{let o=Mi(t),r=this.validApproveAmountLessSwapAmount(t);return o?y.UnApproved:r&&e?y.CancelApprove:r?y.UnApproved:y.Approved};this.generateApproveRequestParams=t=>{let{address:e}=this.accountStore,{token:o}=this.computedTokenAndTradeModeCode,{tokenContractAddress:r,chainId:s}=o;return{userWalletAddress:e,tokenContractAddress:r,chainId:s,cancelApproveTag:t}};this.fetchApproveAllowance=()=>{let t=this.getDefiPlatformIds();return A.get(Ci,{params:{...this.generateApproveRequestParams(),defiPlatformIds:t}}).then(e=>e?.data)};this.fetchApproveData=t=>{let e=this.fromToStore.computedIsCrossChain?this.getBridgeDefiPlatformId():S(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformId",Q),o={...this.generateApproveRequestParams(t),defiPlatformId:e};return A.get(Ii,{params:o}).then(r=>{let{id:s,data:n,from:c,to:m,unsignedTx:l}=r?.data||{},h={data:n,from:c,to:m};return L.info(H.APPROVE_DATA,{id:s,data:n,from:c,to:m,unsignedTx:l,cancelApproveTag:t}),is(o.chainId)&&(h=JSON.parse(l)),{transactionPayload:h,id:s}})};this.getBridgeDefiPlatformId=()=>{let e=this.rootStore.quoteStore.quote?.bestRoute,o=Number(e?.bridge?.bridgeType),r=e?.bridge?.defiPlatformId;return o===ti?r:Q};this.approveStatusIsPending=()=>[y.Approving,y.CancelApproving].includes(this.computedApprovalStatus);this.isPendingNeedCheck=async()=>{this.approveStatusIsPending()&&this.checkApprove().catch(()=>{})};this.isPendingNotCheck=async t=>{this.approveStatusIsPending()||this.checkApprove(t).catch(()=>{})};this.getDefiPlatformIds=()=>{let{computedIsCrossChain:t}=this.fromToStore;if(t){let e=S(this,"rootStore.quoteStore.pathSelectionRouterList");return Array.isArray(e)?de(e.map(o=>o.bridge?.defiPlatformId).filter(o=>o!==void 0)):[Q]}return S(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformInfoList",[{defiPlatformId:Q}]).map(e=>e.defiPlatformId)};this.checkApprove=async t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode;if(!this.isApprovalCheckRequired()){this.getDefiPlatformIds().forEach(c=>{this.registerApproveToken(e,c),this.updateApproveTokenConfig(e,c,{status:y.Approved,tagStatus:y.UnApproved})});return}let{tokenContractAddress:r}=e,{address:s}=this.accountStore;if(r&&s){let[,n]=await k(this.fetchApproveAllowance());if(!n){this.updateApproveTokenConfig(e,o,{status:y.Unknown});return}if(t==="NO_CHECK"&&this.approveStatusIsPending())return;Object.keys(n).forEach(c=>{let m=n[c];this.calcApproveState({approveInfo:m,token:e,tradeModeCode:Number(c)})})}};this.calcApproveState=({approveInfo:t,token:e,tradeModeCode:o})=>{let{decimals:r}=e,s=Number(t.status)===y.Approved?t.amount:"0",n=so(s,r)||"0",c=t?.needCancelApproveToken,m=this.isValidApprovalStatus(n,c);this.registerApproveToken(e,o),this.updateApproveTokenConfig(e,o,{status:m,tagStatus:m,approvedAmount:n})};this.fetchApproveDataErrorTips=(t,e)=>{this.updateCurrentApproveTokenConfig({status:y.UnApproved});let o=O(t?.tokenSymbol);go({title:e?d("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:o}):d("swaptrade_toast_approve_fail",{tokenSymbol:o})})};this.approveErrorTips=({error:t,chainId:e,transactionPayload:o,token:r,tradeModeCode:s,cancelApproveTag:n})=>{L.error(H.APPROVE_TOKEN_ERROR,{chainId:e,transactionPayload:o,error:t,token:r,tradeModeCode:s}),ls(t)||Gr.error({title:d("swaptrade_home_toast_broadcast_failed")}),this.updateApproveTokenConfig(r,s,{status:this.isCancelApprove(n)?y.CancelApprove:y.UnApproved})};this.isCancelApprove=t=>t===oe.CANCEL_APPROVE;this.setApprove=async t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode,{chainId:r}=e;this.updateApproveTokenConfig(e,o,{status:this.isCancelApprove(t)?y.CancelApproving:y.Approving});try{let{id:s,transactionPayload:n}=await this.fetchApproveData(t);await this.approveToken({chainId:r,transactionPayload:n}).then(({result:c})=>this.saveApprove({id:s,chainId:r,transactionHash:c,cancelApproveTag:t})).catch(c=>{this.approveErrorTips({error:c,chainId:r,transactionPayload:n,token:e,tradeModeCode:o,cancelApproveTag:t})})}catch{this.fetchApproveDataErrorTips(e,t)}};this.saveApprove=async({id:t,chainId:e,transactionHash:o,cancelApproveTag:r})=>{if(!o)return;let{address:s}=this.accountStore,n=S(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformId",Q);L.info(H.SAVE_APPROVE,{id:t,transactionHash:o,chainId:e,userWalletAddress:s,cancelApproveTag:r,defiPlatformId:n});try{await A.post(Ai,{id:t,transactionHash:o,chainId:e,userWalletAddress:s,cancelApproveTag:r,defiPlatformId:n})}catch(c){L.info(H.SAVE_APPROVE_ERROR,{error:c?.message,id:t,transactionHash:o,chainId:e,userWalletAddress:s,cancelApproveTag:r,defiPlatformId:n})}};this.onSocket=async t=>{if(t?.type==="1"&&t?.dexData&&t.dexData.type==="approve"){let e=t.dexData,{status:o,transactionHash:r,fromTokenSymbol:s,fromTokenAddress:n,exploreUrl:c,solanaToast:m,platformId:l}=e,h=Nt();if(m==="1"){if(h)return;let F=o===re.CANCEL_APPROVE_SUBMITTED?"swaptrade_transfer_toast_ccy_unrevoke_submit":"swaptrade_transfer_notification_approval_submit";So({title:d(F,{ccy:O(s)})});return}let{token:C,tradeModeCode:I}=this.computedTokenAndTradeModeCode,_={chainId:e.chainId,tokenContractAddress:n},w=this.commonStore.equalsToken(C,_),D=String(I)===String(l);if(w&&D&&await this.isPendingNeedCheck(),(!w||w&&!D)&&this.removeApproveTokenConfig(_,l),o===re.APPROVE_SUCCESS){let F=d("swaptrade_toast_approve_success",{tokenSymbol:O(s)});!h&&So({title:F,exploreUrl:c}),cs.emit(as.APPROVE,{data:r,status:0,message:F})}else if(o===re.APPROVE_FAILED&&!h){let F=d("swaptrade_toast_approve_fail",{tokenSymbol:O(s)});go({title:F,exploreUrl:c})}else if(o===re.CANCEL_APPROVE_SUCCESS&&!h){let F=d("swaptrade_transfer_notification_title_ccy_revoked",{ccy:O(s)});So({title:F,exploreUrl:c})}else if(o===re.CANCEL_APPROVE_FAILED&&!h){let F=d("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:O(s)});go({title:F,exploreUrl:c})}}};this.onSocketError=()=>{this.isPendingNeedCheck().catch(()=>{})};this.rootStore=t,this.accountStore=t.accountStore,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore}get computedApprovalStatus(){let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;return this.getApproveTokenConfig(t,e).status}get computedTokenAndTradeModeCode(){let{from:t,computedIsCrossChain:e}=this.fromToStore,o=this.rootStore.quoteStore,r=Q;if(e)r=this.getBridgeDefiPlatformId();else{let{aggregateSelectId:s}=o;r=s===ot?Q:s}return{token:t,tradeModeCode:r}}get computedIsCancelApproveStatus(){return[y.CancelApprove,y.CancelApproving].includes(this.computedApprovalStatus)}approveToken(t){return Promise.resolve(t)}},mn=cr;var Yt=class extends mn{constructor(e){super(e);i(this,"approveInfo",{});i(this,"setApproveInfo",e=>{this.approveInfo=e});i(this,"setApprove",async(e=oe.APPROVE)=>{let{token:o,tradeModeCode:r}=this.computedTokenAndTradeModeCode,{chainId:s}=o;this.updateApproveTokenConfig(o,r,{status:this.isCancelApprove(e)?y.CancelApproving:y.Approving});try{let{id:n,transactionPayload:c}=await this.fetchApproveData(e);this.setApproveInfo({chainId:s,id:n,transactionPayload:c,token:o,tradeModeCode:r,cancelApproveTag:e}),B.history?.push({pathname:He})}catch{this.fetchApproveDataErrorTips(o,e)}});i(this,"approveCancel",()=>{let e=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),B.history?.goBack?.(),this.updateCurrentApproveTokenConfig({status:this.isCancelApprove(e)?y.CancelApprove:y.UnApproved})});i(this,"approveConfirm",async({txHash:e,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{id:r,chainId:s,cancelApproveTag:n}=this.approveInfo;await this.saveApprove({id:r,chainId:s,transactionHash:e,cancelApproveTag:n}),B.history?.goBack?.(),this.setApproveInfo({})});rt(this)}};u();p();v();tt();u();p();var nt=()=>{let{fromToStore:a,gasDropStore:t,receiveAddressStore:e,outerStore:o,quoteStore:r,accountStore:s,liquidityChooseStore:n}=E(),{from:c,to:m}=a,{receiveAddrObj:l}=e,{computedForbiddenBridge:h,address:C}=s,I=T.BigNumber(a.computedTypedValue).toString(10),w={...{chainId:c.chainId,toChainId:m.chainId,toTokenAddress:m.tokenContractAddress,fromTokenAddress:c.tokenContractAddress,amount:I,userWalletAddress:C},...r.computedSlippage,pmm:"1",gasDropType:t?.computedGasDropSelected?1:0,forbiddenBridgeTypes:$o(h),dexIds:$o(n?.computedIds),receiveWalletAddress:l?.specifiedAddress};return o.extendFeeConfig(w)},ln=()=>{let{quoteStore:a}=E();return{...nt(),sort:a.bridgeSortType}},dn=()=>{let{quoteStore:a}=E(),{quote:t}=a,e=t?.bestRoute?.bridge?.bridgeId,{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:n,chainId:c,fromTokenAddress:m,toTokenAddress:l,amount:h}=nt();return{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:n,chainId:c,fromTokenAddress:m,toTokenAddress:l,amount:h,bridgeId:e}};u();p();function fa({selector:a}){let t=document.querySelector(a);t&&t.scrollTo({top:0,behavior:"smooth"})}var bo=fa;var hn=20,at={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update",CANCEL:"cancel",DEFAULT:"default"},ur=class{constructor(t){i(this,"quoteData",null);i(this,"preDataForSendBtc",null);i(this,"setPreDataForSendBtc",t=>{this.preDataForSendBtc=t});i(this,"setQuoteData",t=>{this.quoteData=t});i(this,"quoteParams",()=>{let{accountStore:t,fromToStore:e,receiveAddressStore:o}=this.rootStore,s={...nt(),userWalletAddress:t.address};return e.computedDiffCrossChain&&(s.receiveWalletAddress=o.receiveAddrObj?.specifiedAddress),s});i(this,"updating",!1);i(this,"updateQuoteData",async()=>{let{quoteStore:{quote:t},swapStore:e}=this.rootStore,o=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let s={...nt(),bridgeId:t?.bestRoute?.bridge?.bridgeId,...o&&{defiPlatformId:o}},n=await e.extendSignParams(s),[c,m]=await k(A.post(`${Ei}`,n));if(this.updating=!1,bo({selector:"#wallet_scroll"}),c){z.error({title:c?.data?.msg||d("swaptrade_top_notif_data_failed")});return}let{callDataResult:l,quoteResult:h}=m?.data||{};if(this.rootStore.quoteStore.handleUpdateQuote({data:h}),l){let C=await this.getPreExecutionPayload(l);gt(()=>{this.transactionPayload=C})}this.initCountDown(),this.startCountdown()});i(this,"updateBridgeGetIntentQuoteCallData",async()=>{let t=dn();this.updating=!0;let[e,o]=await k(A.get(vi,{params:{...t}}));if(this.updating=!1,bo({selector:"#wallet_scroll"}),e){z.error({title:e?.data?.msg||d("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});i(this,"updateSnapQuoteData",async()=>{let t=nt(),e=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let[o,r]=await k(A.get(bi,{params:{defiPlatformId:e,...t}}));if(this.updating=!1,bo({selector:"#wallet_scroll"}),o){z.error({title:o?.data?.msg||d("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:s}=r?.data||{};s&&this.rootStore.quoteStore.handleUpdateQuote({data:s}),this.initCountDown(),this.startCountdown()});i(this,"timer",null);i(this,"countdown",hn);i(this,"initCountDown",()=>{this.countdown=hn});i(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let t=this.countdown;if(t===0){this.clearTimer();return}this.countdown=t-1,this.startCountdown()},1e3)});i(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});i(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));i(this,"gasInfo",this.initGasInfo());i(this,"setGasInfo",t=>{this.gasInfo=t});i(this,"gasFee",0);i(this,"setGasFee",t=>{this.gasFee=t});i(this,"orderInfo",{});i(this,"transactionPayload",null);i(this,"solonaRent","");i(this,"getPreExecutionPayload",async(t,e)=>{let{swapStore:o,quoteStore:r}=this.rootStore,s=r?.quote?.bestRoute||{},{fromToken:n}=s,c=us(n,{orderData:t},o);if(e){let h=await c.jitoTransaction();return this.solonaRent=ps(h),h}let{payload:m,rent:l}=await c.preExecution();return n.chainId===Xo.SOLANA_MAINNET&&l&&(this.solonaRent=l),m});i(this,"setTransactionPayload",t=>{this.transactionPayload=t});i(this,"fetchCallData",async()=>{let{swapStore:t}=this.rootStore||{};t.setCalldataSign(null);let e=t.saveOrderParams(),o=await t.extendSignParams(e);if(!o)return!1;let r=t.isSwapSolana(o.chainId),s,n;if(r){let m=t.extendSolanaCalldata(o);[s,n]=await t.getSolanaCalldata(m)}else[s,n]=await k(A.post(_i,o));if(s){let m=s?.error_message;return z.error({title:m||d("swaptrade_top_notif_data_failed")}),!0}let c=await this.getPreExecutionPayload(n?.data||{},r);return this.transactionPayload=c,!1});i(this,"preExecutionResult",{});i(this,"setPreExecutionResult",t=>{this.preExecutionResult=t});i(this,"nativeCoin",null);i(this,"setNativeCoin",t=>{this.nativeCoin={...t}});i(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:t,decimals:e}=this.nativeCoin,{from:o,computedIsFromBtcCoin:r}=this.rootStore.fromToStore;return T.BigNumber(r?o.availableBalance:so(t,e))});i(this,"calcNativeCoinAmountChange",()=>{let t;if(this.type===pt.SWAP){let{fromToStore:o}=this.rootStore;t=o.from}else{let{fromToken:o,fromTokenAmount:r}=this.rootStore.facetStore.facetOrderDetail;t={...o,amount:r}}let e=T.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return t.isNativeToken?T.BigNumber(t.amount).plus(e):T.BigNumber(e)});i(this,"gasFeeLoading",!0);i(this,"setGasFeeLoading",t=>{this.gasFeeLoading=t});i(this,"gasLimitError",null);i(this,"setGasLimitError",t=>{this.gasLimitError=t});i(this,"activityId",null);i(this,"setActivityId",t=>{this.activityId=t});i(this,"type",pt.SWAP);i(this,"setSwapType",t=>{this.type=t});i(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(pt.SWAP),this.clearTimer(),this.solonaRent=""});i(this,"starknetRegisterStatus","");i(this,"setStarknetRegisterStatus",t=>{this.starknetRegisterStatus=t});i(this,"visibleStarknetRegister",!1);i(this,"setVisibleStarknetRegister",t=>{this.visibleStarknetRegister=t});i(this,"onSwap",()=>{ne({...st(),button_name:"confirm"}),this.rootStore.swapStore.onSwap()});i(this,"onRedeem",()=>{this.rootStore.facetStore.walletSendRedeem()});i(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});i(this,"confirmSwapMap",{[pt.SWAP]:this.onSwap,[pt.REDEEM]:this.onRedeem,[pt.INTENT_SWAP]:this.onIntentSwap});i(this,"onConfirm",t=>{this.confirmSwapMap[t]?.()});i(this,"getBtnProps",t=>{let{fromToStore:e}=this.rootStore,{symbol:o,coinId:r,chainId:s}=this.nativeCoin||{};return{[at.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:c=>{this.onConfirm(c)},btnText:d("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[at.UPDATE]:{onClick:()=>{ne({...st(),button_name:"update"}),this.updateQuoteData().catch(Z)},btnText:d("swaptrade_confirmswap_btn_update_price")},[at.SNAP_UPDATE]:{onClick:()=>{ne({...st(),button_name:"update"}),e.computedIsCrossChain?this.updateBridgeGetIntentQuoteCallData().catch(Z):this.updateSnapQuoteData().catch(Z)},btnText:d("swaptrade_confirmswap_btn_update_price")},[at.FILL_UP]:{onClick:()=>{tr({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),e.baseAddFunds({coinId:r,chainId:s,receiveOnly:!1})},btnText:d("swaptrade_dialog_btn_supplement",{token:o})},[at.CANCEL]:{onClick:()=>{tr({wallet_address:this.rootStore.accountStore.address,button_name:"cancel"});let{history:c}=B;c?.goBack()},btnText:d("swaptrade_top_btn_cancel")},default:{}}[t]});N(this),this.rootStore=t}get computedFormatTime(){return Vi(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let t=this.calcNativeCoinAmount(),e=this.calcNativeCoinAmountChange();return t.gte(e)}get computedSolonaNativeTokenSufficientRent(){let{quoteStore:t}=this.rootStore,e=t?.quote?.bestRoute||{},{fromToken:o}=e||{};if(o?.chainId!==Xo.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let r=this.calcNativeCoinAmount(),s=this.calcNativeCoinAmountChange();return r.gte(s.plus(this.solonaRent))}get walletSendParams(){let{toLocale:t,dispatch:e}=B;return!t||!e?null:{t,dispatch:e}}get computedIsIntentSwap(){return this.rootStore?.quoteStore?.computedIsOfflineType}get compuletedGetNativeCoinLoading(){return this.nativeCoin?this.nativeCoin?.isBalanceLoading:!0}get compuletedGetNativeCoinError(){return this.nativeCoin?this.nativeCoin.isBalanceLoadError:!0}get computedConfirmBtnDisabled(){let{RegisterLocalStatusEnum:t}=B.global,{computedIsStarknetChain:e,computedIsFromBtcCoin:o,computedIsEvmChain:r}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return this.computedPriceUpdate;if(e&&this.starknetRegisterStatus!==t?.COMPLETED)return!0;let s=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError||this.compuletedGetNativeCoinError||this.compuletedGetNativeCoinLoading||this.updating;return o||!r?s:s||this.gasInfo?.isGasLimitLoading||this.gasInfo?.gasLimitInfo?.queryGasLimitErrorUseDefault}get computedIsConfirming(){let{swapStore:t,intentSwapStore:e}=this.rootStore;return this.computedIsIntentSwap?!!e.isConfirmLoading:t.isConfirmLoading}get computedConfirmBtnProps(){return this.getBtnProps(at.CONFIRM)}get computedCancelBtnProps(){return this.getBtnProps(at.CANCEL)}get computedTipsBtnProps(){let t=at.DEFAULT;return(!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent)&&!this.compuletedGetNativeCoinError&&!this.compuletedGetNativeCoinLoading?t=at.FILL_UP:this.computedPriceUpdate&&(t=this.computedIsIntentSwap?at.SNAP_UPDATE:at.UPDATE),this.getBtnProps(t)}get computedMonitorGasType(){return this.gasInfo?.gasType?{network_fee_details:{gas_level:this.gasInfo?.gasType}}:{}}},Lo=ur;u();p();v();u();p();tt();var pr=class{constructor(t){i(this,"signIntentSwap",async()=>[]);i(this,"createIntentOrder",async t=>{let e={intentCode:t.offlineType,signature:t.signature,quote:t?.quote,userWalletAddress:this.rootStore?.accountStore?.address,defiPlatformId:t.defiPlatformId},[o,r]=await k(A.post(Li,{...e}));return o&&(L.error(H.INTENT_ORDER_CREATE_ERROR,{error:o}),z.error({title:o?.error_message||d("swaptrade_trading_mode_alert_order_fail")})),Zo({...st(),order_id:r?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[o,r]});i(this,"bridgeSumbitIntentOrder",async t=>{let{slippageStore:e,quoteStore:o,receiveAddressStore:r,fromToStore:s,accountStore:n}=this.rootStore,{quote:c,computedQuoteAmount:m}=o,{from:l,to:h}=s,{computedMinimumReceived:C,computedRealSlippageValue:I}=e,_=r?.receiveAddrObj?.specifiedAddress,w=I,D=c?.bestRoute?.bridge?.bridgeId,F=n?.address,dt={signature:t.signature,quote:t?.quote,defiPlatformId:t.defiPlatformId,receiveWalletAddress:_,fromChainId:l?.chainId,fromTokenAddress:l?.tokenContractAddress,fromAmount:m,toChainId:h.chainId,toTokenAddress:h.tokenContractAddress,toAmount:h.reverseReceiveAmount,walletAddress:F,bridgeId:D,minimumReceived:C,slippage:w},[it,ht]=await k(A.post(Pi,{...dt}));return it&&(L.error(H.INTENT_ORDER_CREATE_ERROR,{error:it}),z.error({title:it?.error_message||d("swaptrade_trading_mode_alert_order_fail")})),Zo({...st(),order_id:ht?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[it,ht]});this.rootStore=t}},fn=pr;u();p();var Sn=no(["isConfirmLoading"],[]);var mr=class extends fn{constructor(e){super(e);i(this,"isConfirmLoading",!1);i(this,"setIsConfirmLoading",e=>{this.isConfirmLoading=e});i(this,"signIntentSwap",async(e,o)=>{let{signTransaction:r}=this.rootStore.sendTransactionStore,[s,n]=await r(o,e);return s&&(L.error(H.INTENT_SWAP_SIGN_ERROR,{error:s,msg:{chainId:e,unsignedTx:o}}),z.error({title:d("swaptrade_trading_mode_alert_order_fail")})),[s,n]});i(this,"onIntentSwap",async()=>{let{fromToStore:e}=this.rootStore;if(e?.computedIsCrossChain){await this.onIntentBridgeOrder();return}await this.onIntentSwapOrder()});i(this,"onIntentSwapOrder",async()=>{this.setIsConfirmLoading(!0),L.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=S(o,"quote.bestRoute.fromToken.chainId");try{let{offlineType:s,calldata:n,defiPlatformId:c}=o?.quote.bestRoute,{quote:m,unsignedTx:l}=n||{};if(!m||!l)return;let[h,C]=await this.signIntentSwap(r,l);if(h)return;let[I,_]=await this.createIntentOrder({quote:m,offlineType:s,signature:C,defiPlatformId:c});if(I)return;e.afterTransaction(_.data?.orderId)}catch(s){L.error(H.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),L.removeKeep()}});i(this,"onIntentBridgeOrder",async()=>{this.setIsConfirmLoading(!0),L.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=S(o,"quote.bestRoute.fromToken.chainId");try{let{bridge:s}=o?.quote.bestRoute,{calldata:n,defiPlatformId:c}=s,{quote:m,unsignedTx:l}=n||{};if(!m||!l)return;let[h,C]=await this.signIntentSwap(r,l);if(h)return;let[I,_]=await this.bridgeSumbitIntentOrder({quote:m,signature:C,defiPlatformId:c});if(I)return;e.afterTransaction(_.data?.orderId)}catch(s){L.error(H.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),L.removeKeep()}});We(this,Sn)}},vo=mr;u();p();v();u();p();v();tt();u();p();v();v();var lr=class{constructor(t){i(this,"rootStore");this.rootStore=t}checkZeroValue(){let t=null,o=this.rootStore.quoteStore.quote.bestRoute,{fromTokenPrice:r,toTokenPrice:s,fromToken:n,toToken:c}=o;return!Number(r)&&!Number(s)?t=n.tokenSymbol===c.tokenSymbol?M.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:M.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(s)||(t=M.TO_TOKEN_PRICE_UNKNOWN):t=M.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkValueDifference(){let t=null,{fromToStore:e}=this.rootStore,{computedValueDifference:o,computedIsCrossChain:r}=e;return o.showValueDiffDialog&&(t=r?M.VALUE_DIFFERENCE_TOO_MUCH_CROSS:M.VALUE_DIFFERENCE_TOO_MUCH),{errorType:t,continueToNextInterceptor:!1}}checkMinReceive(){let t=null,e=this.rootStore.quoteStore,o=this.rootStore.slippageStore;return e?null:(o?.computedMinimumReceivedIsOrange&&(t=M.MIN_RECEIVED_TOO_SMALL),{errorType:t,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let t=null,{swapCheckStore:e}=this.rootStore,{repeatOrder:o}=e;return o?.enoughFlag===Vo.ENOUGH&&(t=M.REPEAT_ORDER),{errorType:t,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let t=null,{swapCheckStore:e}=this.rootStore;await e.checkRepeatOrder();let{repeatOrder:o}=e;return o&&(o.repeatFlag===Ot.BTC_REPEAT?t=M.REPEAT_ORDER_BTC:o.repeatFlag===Ot.FACET_REPEAT?t=M.REPEAT_ORDER_FACET:o.enoughFlag!==Vo.ENOUGH&&(t=M.REPEAT_ORDER_NOT_ENOUGH)),{errorType:t,continueToNextInterceptor:!1}}checkFacetTokenCrossChainDetail(){let{fromToStore:t}=this.rootStore,{from:e,to:o,computedNonsupportFacetToken:r}=t;if(r||b.get(ri))return null;let s=null;return e.tokenType!==o.tokenType&&(Number(e.tokenType)===Wo.FACET||Number(o.tokenType)===Wo.FACET)&&(s=M.FACET_SWAP_TIPS),{errorType:s,continueToNextInterceptor:!1}}checkCrossChain(){let t=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!b.get(zr)&&(t=M.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:t,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedIsCrossChain:r}=e,s=o.quote.bestRoute,{toTokenPrice:n,quoteNetWorkFeeOfMoney:c,fromSwapFeeUsd:m}=s,{BigNumber:l}=T;return(r?new l(m):new l(c)).gte(new l(n))&&(t=M.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:t,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedHasToSwap:r}=e,s=Number(e.to.chainId)===1;if(r&&s){let n=S(o,"quote.bestRoute.toSwapFeeUsd"),c=S(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),m=S(o,"quote.bestRoute.bridge.toRiskLimit");T.BigNumber(n).dividedBy(c).gte(m)&&(t=M.TO_SWAP_THAN_GAS_FEE)}return{errorType:t,continueToNextInterceptor:!1}}checkVolatilitySlippage(){let t=null,o=this.rootStore.slippageStore.computedVolatilityTips?.swapInterceptorType;return o&&(t=o),{errorType:t,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:t,safeMoonStore:e}=this.rootStore,{computedIsFromBtcCoin:o,from:r,updateBtcFromBalance:s}=t;if(o){if(!await s())throw Error("btc balance update failed");let c=e.computedInputVal,m=r.availableBalance;if(T.BigNumber(c).gt(m))return{errorType:M.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}async checkCrossChainSwap(){let{swapCheckStore:t}=this.rootStore;await t.checkCrossChainSwap();let e=t.checkSwapMoreInfo?.errorCode;return Or(e)&&e!==0?e===4&&b.get(`${Je}_${t.checkSwapMoreInfo?.contentTip?.extra?.bridgeName}_${e}`)||b.get(`${Je}_${e}`)?null:{errorType:M.CHECK_CROSS_MORE,continueToNextInterceptor:!1}:null}async checkThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedIsOkxProvider:e}=t,o=b.get(`${Je}_${$r}`);return!e&&!o?{errorType:M.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkBridgeThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedBridgeIsOkxProvider:e,computedIsOfflineType:o}=t;return!e&&o?{errorType:M.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkDisclaimerVisible(){return Ls()?{errorType:M.DISCLAIMER_VISIBLE,continueToNextInterceptor:!0}:null}makeCheckers(){let{fromToStore:{computedIsCrossChain:t}}=this.rootStore;return t?[this.checkDisclaimerVisible,this.checkBridgeThirdPartyProvider,this.checkVolatilitySlippage,this.checkCrossChainSwap,this.checkBtcBalance,this.checkZeroValue,this.checkToSwapThanGasFee,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]:[this.checkDisclaimerVisible,this.checkThirdPartyProvider,this.checkVolatilitySlippage,this.checkBlockedRepeatOrder,this.checkFacetTokenCrossChainDetail,this.checkZeroValue,this.checkRepeatOrderWithEnoughBalance,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]}async check(){let t=[],e=this.makeCheckers();for(let o=0;o<e.length;o++){let r=e[o],{errorType:s,continueToNextInterceptor:n}=await r.call(this)||{};if(s&&(t.push(s),!n))return t}return t}},gn=lr;u();p();v();u();p();var Sa=()=>{let{quoteStore:a}=E(),t=a.enableQuoteAggregates?S(a,"quote.bestRoute"):null;return S(t,"defiPlatformId")===Q?d("swaptrade_trade_placeholder_okxdex"):S(t,"name")},dr=({disabled:a,toUsdPrice:t})=>{let{commonStore:e,fromToStore:o,buySellStore:r,quoteStore:s}=E();if(e.portal===oo.MARKET){let l=S(s,"quote.bestRoute.receiveAmount");return l?d(r.tradeMode==="buy"?"swaptrade_market_placeorder_btn_buy_amt":"swaptrade_market_placeorder_btn_sell_amt",{amt:mt(l,{needBillionMillionUnit:!0,useScientificNotation:!0}),token:Bi(o.to.tokenSymbol),price:Fi(e.currencyConversion(t).toString(),e.computedNowCurrencySymbol,{needPlaceholder:!0})}):r.tradeMode==="buy"?d("swaptrade_market_placeorder_btn_buy_symbol",{symbol:o.to.tokenSymbol}):d("swaptrade_market_placeorder_btn_sell_symbol",{symbol:o.from.tokenSymbol})}let m=(s.enableQuoteAggregates?S(s,"quote.bestRoute"):null)?Kr:a?Y:ee;if(o.computedIsSingleChain){let l=Sa();return d(m,{provider:l})}return d(jr)},Tn=()=>{let{commonStore:a,buySellStore:t}=E();return a.portal===oo.MARKET?t.tradeMode==="buy"?Pt.TYPE.green:Pt.TYPE.red:null},Cn=()=>{let{commonStore:a,swapBtnStore:t,swapStore:e}=E();return a.portal===oo.MARKET?e.isConfirmLoading:t.swapBtnLoading};u();p();v();var In=()=>{let{accountStore:a}=E(),t=S(a,"walletConfig.isWCApp"),e=S(a,"walletConfig.isOkxConnect"),o=d("swaptrade_card_swap_modal_btn_confirming_in_your_wallet"),r=d("swaptrade_modal_confirm_swap_btn_confirming_in_app");return t||e?r:o};var be=class{constructor(t){i(this,"swapBtnErrorTipsDialog",null);i(this,"swapInterceptor");i(this,"isInterceptionProcessing",!1);i(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));i(this,"notShowAgainCrossChainConfirm",!1);i(this,"setNotShowAgainCrossChainConfirm",t=>{this.notShowAgainCrossChainConfirm=t});i(this,"tipsDialogInfo",this.defaultTipsDialogInfo());i(this,"swapBtnLoading",!1);i(this,"showErrorTips",(t,e)=>{this.tipsDialogInfo={type:t,visible:!0,confirmCallBack:e},this.setNotShowAgainCrossChainConfirm(!1)});i(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});i(this,"openConfirmSwapDialog",(t,e)=>{let{swapStore:o}=this,{receiveAddressStore:r}=this.rootStore;r.saveWalletAddressToStorage(e),o.setConfirmSwapVisible(!0)});i(this,"connectWallet",()=>{});i(this,"approve",()=>{});i(this,"cancelApprove",()=>{});i(this,"swap",()=>{});i(this,"clickSwapOnDapp",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore,{computedNotThirdBiz:r}=this.commonStore;uo({business_type:o?"swap":"bridge",trade_dialog:r?"no":"yes",from_token_address:t.tokenContractAddress,to_token_address:e.tokenContractAddress,swap_type:o?"discover_swap":"discover_cross_chain_swap",from_chain:t.chainName,to_chain:e.chainName}),this.rootStore.swapDappStore?.fetchDappList()});i(this,"checkDappTrade",()=>{let t=this.rootStore.swapDappStore?.checkShouldJumpToDapp;return typeof t=="function"&&t()?ge:null});i(this,"checkShowLimitRegion",()=>this.checkDappTrade()?null:this.commonStore?.computedIsLimitRegion?Y:null);i(this,"isQuoting",()=>{let{fromToStore:t,quoteStore:e,slippageStore:o}=this.rootStore,{isFetchQuoting:r,bestRoute:s,quoteError:n,quoteNull:c}=e.quote,{from:m,to:l,computedTypedValue:h}=t,{tokenContractAddress:C}=m,{computedRealSlippageValue:I}=o;return c||!s&&n&&!r||!h||!l.tokenContractAddress||!C||I>50||I<0?Y:null});i(this,"isHoneypot",()=>this.rootStore?.safeMoonStore?.computedHoneypot?Y:null);i(this,"noAmountOrOverLimit",()=>{let{fromToStore:t}=this,{overLimit:e}=this.rootStore?.safeMoonStore?.computedSlippageTips||{},{computedTypedValue:o}=t;return Number(o)===0||e?Y:null});i(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?Y:null);i(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:t}}=this;return t?null:Y});i(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:t}}=this;return t?null:he});i(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:t}}=this;return t?Y:null});i(this,"nonsupportFacetToken",()=>{let{fromToStore:{computedNonsupportFacetToken:t}}=this;return t?Y:null});i(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:t}}=this,{receiveAddressStore:{checkReceiveAddressLoading:e,computedSwapHighLight:o}}=this.rootStore;return t&&!o||e?Y:null});i(this,"interceptionProcessing",()=>{let{fromToStore:t}=this;return!this.isInterceptionProcessing&&t.isBalanceLoading||t.fromBalanceState===ze.BALANCE_REQUEST_FAILED?Y:null});i(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?fe:null);i(this,"approveStatus",()=>{let{approveStore:{computedApprovalStatus:t}}=this;return Jr[t]||null});i(this,"isValidAmount",()=>{let{fromToStore:t}=this,{from:e,to:o}=t;return o.amount&&e.amount?ee:null});i(this,"getBtnStatus",()=>{let t=[this.checkShowLimitRegion,this.hasFeeConfigErrorTips,this.unConnectedWallet,this.nonsupportChain,this.nonsupportFacetToken,this.isHoneypot,this.checkDappTrade,this.checkReceiveAddressStatus,this.noAmountOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],e;for(let o of t){let r=o();if(r){e=r;break}}return e||(e=Y),e});i(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||z.warn({title:d("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:e,fromToStore:o,swapStore:r,commonStore:s,quoteStore:n,approveStore:c}=t;this.rootStore=t,this.accountStore=e,this.fromToStore=o,this.swapStore=r,this.commonStore=s,this.quoteStore=n,this.approveStore=c,this.swapInterceptor=new gn(t),Object.assign(this,t)}async runSwapInterceptor(t){this.isInterceptionProcessing=!0;let[e,o]=await k(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,e){L.error(H.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:e});return}if(o.length===0){t();return}let r=-1,s=()=>{r++;let n=r===o.length-1;this.showErrorTips(o[r],n?t:s)};s()}getBtnAllStatus({from:t,toUsdPrice:e}){return{[he]:{statusType:he,disabled:!1,toLocaleText:()=>d(he),onClick:this.connectWallet},[fe]:{statusType:fe,disabled:!0,toLocaleText:()=>d(fe,{tokenSymbol:O(t.tokenSymbol)}),symbol:t.tokenSymbol},[Xe]:{statusType:Xe,disabled:!1,toLocaleText:()=>d(Xe,{tokenSymbol:O(t.tokenSymbol)}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.approve()},icon:"okx-defi-dex-authorization",iconType:Pt.ICON_POSITION.leading},[Se]:{statusType:Se,loading:!0,disabled:!0,toLocaleText:()=>d(Se)},[Qo]:{statusType:Se,disabled:!1,toLocaleText:()=>d(Qo,{ccy:t.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:Pt.ICON_POSITION.leading},[$e]:{statusType:$e,loading:!0,disabled:!0,toLocaleText:()=>d($e)},[Y]:{statusType:Y,disabled:!0,toLocaleText:()=>dr({disabled:!0,toUsdPrice:e})},[ee]:{statusType:ee,disabled:!1,loading:Cn(),toLocaleText:()=>dr({disabled:!1,toUsdPrice:e}),toLoadingLocaleText:()=>In(),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.swap()},type:Tn()},[ge]:{statusType:ge,disabled:!1,loading:this.rootStore.swapDappStore?.swapOnDappBtnLoading,toLocaleText:()=>d(ge),icon:"okds-open-link",iconType:Pt.ICON_POSITION.leading,onClick:this.clickSwapOnDapp}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:t,fromToStore:e,accountStore:o}=this,{isConnectedWallet:r}=o,s=e.from.balance,n=t.safeMoonStore.computedInputVal;return r?T.BigNumber(s||0).isLessThan(n):!1}get computedBtnStatus(){let{fromToStore:t}=this,{from:e,to:o}=t,r=this.getBtnStatus();return this.getBtnAllStatus({from:e,swapLoading:this.swapBtnLoading,toUsdPrice:S(o,"usdPrice")})[r]}get computedIsCurrentQuote(){let{fromToStore:t,quoteStore:e}=this,{computedIsExactIn:o,computedTypedValue:r}=t,{quote:s,getGasTokenFeeLoading:n}=e,{fromTokenAmount:c="",inputToTokenAmount:m=""}=s?.bestRoute||{},l=!!r,h=l&&o&&T.BigNumber(r).isEqualTo(c),C=l&&!o&&T.BigNumber(r).isEqualTo(m);return!n&&(h||C)}};u();p();var An=no(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);u();p();var fr=()=>{let{accountStore:a}=E();rs({wallet_address:a.address,...ns()})};var Kt=class extends be{constructor(e){super(e);i(this,"handleSwap",async()=>{let{quote:e,computedIsOfflineType:o}=this.quoteStore,{receiveAddressStore:r,swapStore:s}=this.rootStore,{from:n,cacheTokenInfo:c}=this.fromToStore;if(this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(e.bestRoute),L.info(H.CLICK_WALLET_SWAP_BUTTON,{chainId:n.chainId,tokenContractAddress:io(n.tokenContractAddress),amountNum:n.balance}),T.eq(n.balance,c.amountNum)||L.info(H.BALANCE_IS_ERROR,{chainId:n.chainId,tokenContractAddress:io(n.tokenContractAddress),amountNum:n.balance,cacheTokenInfo:{...c,tokenContractAddress:io(c.tokenContractAddress)}}),!o){let h=await this.walletContractStore.fetchCallData();if(this.swapBtnLoading=!1,h)return}this.swapBtnLoading=!1;let m=o?pt.INTENT_SWAP:pt.SWAP;r.saveWalletAddressToStorage(this.fromToStore?.to);let{fromToken:l}=Br.get(e,"bestRoute",{});if(s.isSwapSolana(l.chainId)){B.history?.push({pathname:Ye});return}B.history?.push({pathname:te,search:`needUpdate=${Zr.on}&type=${m}`})});i(this,"swap",async()=>{let e=this.checkIsCurrentQuote();uo({wallet_address:this.accountStore.address,button_name:"confirm",...st()}),e&&(this.swapBtnLoading=!0,this.runSwapInterceptor(this.handleSwap))});i(this,"approve",async()=>{this.approveStore.updateCurrentApproveTokenConfig({status:y.Approving});let e=await B.checkMpcAccountIfNecessary();if(fr(),!e){this.approveStore.updateCurrentApproveTokenConfig({status:y.UnApproved});return}this.approveStore.setApprove()});i(this,"cancelApprove",async()=>{this.approveStore.updateCurrentApproveTokenConfig({status:y.CancelApproving});let e=await B.checkMpcAccountIfNecessary();if(fr(),!e){this.approveStore.updateCurrentApproveTokenConfig({status:y.CancelApprove});return}this.approveStore.setApprove(oe.CANCEL_APPROVE)});this.walletContractStore=e.walletContractStore,We(this,An)}};u();p();v();v();u();p();v();v();tt();u();p();u();p();var kn=function(){return new Promise(function(t){setTimeout(t,1)})};u();p();var ue=R(x());u();p();var ga={[P.SWAP]:"swap_used_chain_cache",[P.LIMIT_ORDER]:"limit_used_chain_cache",[P.BRIDGE]:"bridge_used_chain_cache"},_n=(a,t,e)=>{let o=ga[e],r=b.get(o)||[];if(t.sort((s,n)=>n.popularWeight-s.popularWeight),r.length===0&&(r=t.slice(0,4).map(n=>n.chainId)),a.forEach(s=>{r.includes(s)||r.unshift(s)}),r=r.filter(s=>t.find(n=>n.chainId===s)),r.length<4)for(let s=0;s<t.length&&r.length<4;s++)r.includes(t[s].chainId)||r.push(t[s].chainId);return r.length>4&&(r=r.slice(0,4)),b.set(o,r),r};u();p();var Le=class{constructor(t){i(this,"id",1);i(this,"tokenSymbol","--");i(this,"tokenName","--");i(this,"decimals",6);i(this,"tokenContractAddress","");i(this,"tokenLogoUrl","");i(this,"type","");i(this,"amountNum",0);i(this,"currencyAmount",0);N(this),Object.assign(this,t),this.tokenModalStore=E().tokenModalStore}get computedPrice(){let{nowCurrencyUnit:t}=this.tokenModalStore.commonStore,{symbol:e,usdToThisRate:o}=t,r=T.BigNumber(this.currencyAmount);return r.isNaN()||r.isZero()?`${e||""}0.00`:e&&o&&!r.isNaN()&&!r.isZero()?Dt(r.multipliedBy(o).toJSON(),e):"0"}get computedIsSelect(){let{equalsToken:t}=this.tokenModalStore.commonStore,{from:e,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===g.FROM?t(this,o):t(this,e)}get computedIsSelectOrigin(){let{from:t,to:e}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===g.FROM?o(this,t):o(this,e)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return et(this)}get computedTokenVolume(){let{currencyConversionWithSymbol:t}=this.tokenModalStore.commonStore;return t(this.volume,{needPlaceholder:!0})}get computedTokenLiquidity(){let{currencyConversionWithSymbol:t}=this.tokenModalStore.commonStore;return t(this.liquidity,{needPlaceholder:!0})}};u();p();var ve=(a={})=>({...V,logoUrl:V.logoUrl(),chainName:d(V.localKey),...a}),Po=(a={})=>{let t=Ur();return{...X,get logoUrl(){return t===qr.dark?X.darkLogoUrl():X.logoUrl()},chainName:d(X.localKey),...a}};var En="hide_collect_cancel_dialog",yn="hideTokenGuide",jt=class{constructor(t){i(this,"searchValue","");i(this,"setSearchValue",t=>{this.searchValue=t});i(this,"fromTokenList",new Map);i(this,"toTokenList",new Map);i(this,"searchTokenList",{});i(this,"currentCollectionGroupId");i(this,"setCurrentCollectionGroupId",t=>{this.currentCollectionGroupId=t});i(this,"setCurrentCollectionGroupIdAndGetList",t=>{t&&t===this.currentCollectionGroupId||(this.setCurrentCollectionGroupId(t),this[`${this.tokenModalFromState}TokenList`].set(V.chainId),this.getTokenListByChainId().then(Z).catch(Z))});i(this,"error",!1);i(this,"tokenModalVisible",!1);i(this,"tokenModalFromState",g.FROM);i(this,"setTokenModalFromState",t=>{this.tokenModalFromState=t});i(this,"loading",{[g.FROM]:{},[g.TO]:{}});i(this,"initLoading",()=>{this.loading={[g.FROM]:{},[g.TO]:{}}});i(this,"importTokenInfo",{});i(this,"setImportTokenInfo",t=>{this.importTokenInfo={...t}});i(this,"toSelectedChainId","");i(this,"fromSelectedChainId","");i(this,"setToSelectedChainId",t=>{this.toSelectedChainId=t});i(this,"setFromSelectedChainId",t=>{this.fromSelectedChainId=t});i(this,"fromSelectedChainAtSearch","");i(this,"toSelectedChainAtSearch","");i(this,"setFromSelectedChainAtSearch",t=>{this.fromSelectedChainAtSearch=t});i(this,"setToSelectedChainAtSearch",t=>{this.toSelectedChainAtSearch=t});i(this,"updateSelectedChainAtSearch",t=>{this.tokenModalFromState===g.FROM?this.setFromSelectedChainAtSearch(t):this.setToSelectedChainAtSearch(t)});i(this,"updateFromToSelectedChainIdAfterSearch",()=>{if(this.tokenModalFromState===g.FROM&&this.fromSelectedChainAtSearch!==this.fromSelectedChainId){this.setFromSelectedChainId(this.fromSelectedChainAtSearch);return}this.tokenModalFromState===g.TO&&this.toSelectedChainAtSearch!==this.toSelectedChainId&&this.setToSelectedChainId(this.toSelectedChainAtSearch)});i(this,"extendTokens",(t,e)=>t.filter(o=>this.commonStore.getChainByID($(o.chainId))).map(o=>{let r=new Le(o,this);return{...o,balance:r.computedAmountNum,selected:r.computedIsSelect,selectedOrigin:e?r.computedIsSelectOrigin:!1,price:r.computedPrice,formattedVolume:r.computedTokenVolume,formattedLiquidity:r.computedTokenLiquidity}}));i(this,"extendTokenList",(t=[],e=!0)=>U(t)?t:this.extendTokens(t,e));i(this,"importUserToken",At(function*(e,o=!0){let r=e.map(c=>{let{chainId:m,tokenContractAddress:l,tokenSymbol:h,decimals:C}=c;return{chainId:m,contractAddress:l,tokenSymbol:h,precision:C}}),s={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:r},n=[];try{n=(yield A.post(ni,s)).data}catch(c){throw z.error(d("swaptrade_pricechart_no_connection_desc")),c}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),n}));i(this,"sortTokens",t=>Mr(t,[e=>Number(e.topPlacement),e=>Number(e.currencyAmount),e=>Number(e.amountNum),e=>Number(e.isCollectToken),e=>Number(e.collectTime)],["desc","desc","desc","desc","desc"]));i(this,"orderTokenList",t=>this.computedIsCollectChain?t:this.commonStore.currentTab===P.BRIDGE?t.map(e=>({...e,tokenList:this.sortTokens(e.tokenList)})):this.sortTokens(t));i(this,"formatTokenList",(t,e)=>{let o=t;t.length>100&&e!==V.chainId&&(o=t.slice(0,100));let r=this.extendTokenList(o,!0);return this.orderTokenList(r)});i(this,"changeTokenModalVisible",t=>{this.tokenModalVisible=t});i(this,"clearCacheTokenList",()=>{});i(this,"getTokenListByChainId",async()=>{let t=this.tokenModalFromState===g.FROM,e={};if(this.clearCacheTokenList(),this.tokenModalFromState===g.FROM?e={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===g.TO&&(e={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===g.FROM&&Number(this.fromSelectedChainId)===X.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===g.TO&&Number(this.toSelectedChainId)===X.chainId){this.getToAllNetworksTokens(e.fromChainId);return}if(this.tokenModalFromState===g.FROM&&Number(this.fromSelectedChainId)===V.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===g.TO&&Number(this.toSelectedChainId)===V.chainId){this.getToCollectedTokens(e.fromChainId);return}t?this.getTokenList(g.FROM,e.fromChainId):this.getTokenList(g.TO,e.toChainId,e.fromChainId)});i(this,"setTokenList",(t,e,o)=>{let r=this.formatTokenList(e,t);this[`${o}TokenList`].set(t,r)});i(this,"cancelGetTokenListRef",null);i(this,"handleTokenList",At(function*(e,o,r,s){this.setError(!1),this.cancelGetTokenListRef&&this.cancelGetTokenListRef.abort(),this[`${e}TokenList`].get(o)||this.setLoading(e,o,!0),this.cancelGetTokenListRef=lt();try{let{data:n}=yield A.get(r,{params:s,signal:this.cancelGetTokenListRef?.signal,isolate:!0}),c=this.toLowerCaseContractAddress(n);return this.setTokenList(o,c,e),this.setLoading(e,o,!1),{data:c}}catch(n){return this.isCancel(n)?null:(this.setTokenList(o,[],e),this.setLoading(e,o,!1),this.setError(!0),n)}}).bind(this));i(this,"getCrossChainParams",(t,e,o)=>{switch(t){case P.BRIDGE:return{fromChainId:e.fromChainId??e?.chainId,userUniqueId:e.userUniqueId,accountId:e.accountId,targetChainId:e.targetChainId,targetWalletAddress:e.targetWalletAddress,walletAddress:e.walletAddress,...o,toChainId:o.toChainId===-1?"":o?.toChainId};case P.SWAP:default:return e}});i(this,"getTokenList",At(function*(e,o,r){let s={fromChainId:r,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(s={...s,businessLine:ie.LIMIT_ORDER});let n=this.getCrossChainParams(this.commonStore.currentTab,s,{selectChainType:this.getCrossChainSelectChainType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),c=$(o);if(this.computedIsNotSupportToChain)return this.setTokenList(c,[],e),{data:[]};let m=xt(Ft.ALL_TOKENS,this.commonStore.currentTab);return yield this.handleTokenList(e,c,m,n)}));i(this,"getFromCollectedTokens",At(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:ie.LIMIT_ORDER});let o=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Mt.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:"",...this.computedCollectionGroupParams}),r=xt(Ft.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(g.FROM,V.chainId,r,o)}));i(this,"getToCollectedTokens",At(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,chainId:e,...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:ie.LIMIT_ORDER});let r=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Mt.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress,...this.computedCollectionGroupParams}),s=xt(Ft.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(g.TO,V.chainId,s,r)}));i(this,"getFromAllNetworksTokens",At(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:ie.LIMIT_ORDER});let o=xt(Ft.ALL_NETWORK,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Mt.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""});return yield this.handleTokenList(g.FROM,X.chainId,o,r)}));i(this,"getToAllNetworksTokens",At(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:ie.LIMIT_ORDER});let r=xt(Ft.ALL_NETWORK,this.commonStore.currentTab),s=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Mt.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress});return yield this.handleTokenList(g.TO,X.chainId,r,s)}));i(this,"cancelSearchRef",null);i(this,"needRemoveChainId",t=>[X.chainId,V.chainId].includes($(t)));i(this,"getSearchChainType",()=>{let t=Ze.SINGLE;return this.computedCurrentSearchChainId===X.chainId&&(t=Ze.ALL_NETWORK),this.computedCurrentSearchChainId===V.chainId&&(t=Ze.COLLECT),t});i(this,"getCrossChainSelectChainType",()=>this.tokenModalFromState===g.FROM?Mt.FROM:Mt.TO);i(this,"singleSearchParams",t=>{let e=this.getSearchChainType(),o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,searchType:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses},r={},s={};return this.tokenModalFromState===g.FROM?(r={inputContent:t,fromChainId:this.fromSelectedChainAtSearch,chainId:this.fromSelectedChainAtSearch,toChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&(delete r.fromChainId,delete r.toChainId,delete r.chainId)):this.tokenModalFromState===g.TO&&(s={inputContent:t,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},this.needRemoveChainId(this.toSelectedChainAtSearch)&&(delete s.toChainId,delete r.chainId)),{...o,...r,...s}});i(this,"getSearchTokenList",async()=>{if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=lt(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let t=Uo(this.searchValue),e=this.getSearchParams(t);os({keyword:t});let o=xt(Ft.SEARCH,this.commonStore.currentTab),[r,s]=await k(A.get(o,{params:e,signal:this.cancelSearchRef?.signal}));if(r&&!this.isCancel(r)){this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}if(s){let{data:n}=s;if(this.commonStore.currentTab===P.BRIDGE)this.setSearchTokenList({list:n});else{let{systemList:c,thirdPartyList:m}=s.data;this.setSearchTokenList({systemList:c,thirdPartyList:m})}this.updateFromToSelectedChainIdAfterSearch(),this.setError(!1),this.setLoading(this.tokenModalFromState,"search",!1)}});i(this,"resetTokenModal",()=>{this.resetTokenData()});i(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});i(this,"balancePushSort",(t,e)=>{let o=[...t],{currencyAmount:r,coinAmountOriginalDec:s}=e;for(let n=0;n<o.length;n++)if(this.commonStore.equalsToken(o[n],e)){o[n].amountNum=s,o[n].currencyAmount=r;break}return o});i(this,"updateAllTokenList",t=>{let{chainId:e}=t,o=$(e),r=this.fromTokenList.get(o);r&&this.setTokenList(o,this.balancePushSort(et(r),t),g.FROM);let s=this.toTokenList.get(o);s&&this.setTokenList(o,this.balancePushSort(et(s),t),g.TO)});i(this,"checkFromToLegal",(t,e)=>{let{currentTab:o}=this.commonStore,r={toToken:{...e,amount:""},isChanged:!1};if(Number(t.chainId)!==Number(e.chainId)){if(this.computedToChain?.some(C=>C.chainId===e.chainId&&!C.disabled))return r;let{dexDefaultFromToTokenShowVO:s}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:n,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:m}=s,l=o===P.BRIDGE,h;return l&&m?h=m:this.commonStore.equalsToken(t,c)?h=n:h=c,{toToken:h,isChanged:!0}}return r});i(this,"calcCurToChainIdIsInSupList",t=>{let e=!1;return et(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(t)&&!o.disabled&&(e=!0)}),e});i(this,"hideCollectCancelConfirm",b.get(En));i(this,"showCollectOverLimitDialog",!1);i(this,"setShowCollectOverLimitDialog",t=>{this.showCollectOverLimitDialog=t});i(this,"setCommonlyUsedChain",t=>{let{from:e,to:o}=this.fromToStore,{chainList:r,currentTab:s}=this.commonStore,n=t&&t.length>0?t:[e.chainId,o.chainId];return _n(n,r,s)});i(this,"tokenPageChainList",[]);i(this,"setTokenPageChainList",t=>{this.tokenPageChainList=t});i(this,"getCurrentToChainInfo",()=>this.computedToChain.find(e=>$(e.chainId)===$(this.toSelectedChainId)));i(this,"changeTokenPageChainList",async t=>{if(this.tokenPageChainList.findIndex(o=>$(o.chainId)===$(t))===-1){let o=this.commonStore.chainList.find(s=>$(s.chainId)===$(t)),r=[...this.tokenPageChainList];r.unshift(o),r.length>4&&r.pop(),this.setTokenPageChainList(r)}this.tokenModalFromState===g.FROM?this.setFromSelectedChainId(t):this.setToSelectedChainId(t),await this.getTokenListByChainId()});i(this,"searchChainKeywords","");i(this,"setSearchChainKeywords",t=>{this.searchChainKeywords=t});i(this,"filterChains",t=>vr(t,e=>{let o=qo(Uo(this.searchChainKeywords));return qo(e.chainName).includes(o)}));i(this,"dialogIndex",Ko.TOKEN_LIST);i(this,"setDialogIndex",t=>{this.dialogIndex=t});i(this,"hideTokenGuide",!!b.get(yn));i(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,b.set(yn,"1")});i(this,"importToken",async(t,e)=>{let r=(await this.importUserToken(Array.isArray(t)?t:[t]))[0]||{};e&&e(r),ts(r)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,r),this.setImportTokenInfo({}),this.setDialogIndex(Ko.TOKEN_LIST)});i(this,"reloadTokenList",async()=>{!this.tokenModalVisible||(this.searchValue!==""?await this.getSearchTokenList():await this.getTokenListByChainId())});i(this,"selectTokenHandle",async t=>{let e=this.commonStore.getChainByID(Number(t?.chainId));if(await kn(),!e)return;let{quoteStore:o}=this.rootStore,{from:r,updateFrom:s,updateTo:n,setBalance:c,setFromBalanceRequestError:m,setToBalanceRequestError:l,to:h,computedIsExactIn:C,needCrossChainDoubleConfirm:I,setNeedCrossChainDoubleConfirm:_}=this.fromToStore,{clearReceiveAddressValue:w}=this.rootStore.receiveAddressStore;this.setCommonlyUsedChain([t?.chainId]);let D=this.tokenModalFromState===g.FROM,F=()=>{this.rootStore.fromToStore.setCacheTokenInfo({chainId:t.chainId,tokenContractAddress:t.tokenContractAddress,amountNum:t.balance},"tokenList"),m(!1),c(g.FROM,t.balance)},dt=()=>{l(!1),c(g.TO,t.balance)};if(t.selected){D?dt():F(),this.fromToStore.onSwitchFromTo();return}D?F():dt();let it=()=>{I||_(!0)};if(D){if($i(t.chainId,h.chainId)&&this.commonStore.currentTab===P.BRIDGE){let ht=new Rt(this.commonStore.currentTab,{}),[vt,ft]=await ht.fetchCrossChainTokens({fromChainId:t.chainId,fromTokenAddress:t.tokenContractAddress}),{amount:yr}=r,xe={...t},le;vt?(s({...xe,amount:yr}),le=e?.dexDefaultFromToTokenShowVO?.toCrossDexMultiTokenInfoVO,n({...le})):(xe=ft.data.fromTokenInfo,le=ft.data.toTokenInfo,s({...xe,amount:yr}),n(le),it(),this.fromToStore.getTokenBalanceByAccount("from",xe)),this.fromToStore.getTokenBalanceByAccount("to",le)}else if(!this.commonStore.equalsToken(t,r)){let{amount:ht}=r;o.setQuoteNumber(2),s({...t,riskLevel:t.riskLevel,amount:ht});let{toToken:vt,isChanged:ft}=this.checkFromToLegal(t,h);n(vt),ft&&(it(),this.fromToStore.getTokenBalanceByAccount("to",et(vt))),C&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(t,h)||(it(),o.setQuoteNumber(0),n({...t,amount:""}),C||this.fromToStore.advanceSetTypedValue(""));w()});i(this,"updateTokenCollectionStatus",(t,e,o)=>{let r=!o?.length,s=this.currentCollectionGroupId&&!o.includes(this.currentCollectionGroupId);this.updateTokenCollectedLocal({...e,isCollectToken:r||s})});i(this,"memeTagConfig",{});i(this,"setMemeTagConfig",t=>{this.memeTagConfig=t});i(this,"fetchMemeTagConfig",async()=>{let[,t]=await k(A.get(Di)),e=t.data?.tagAndEmojiMap||{};return this.setMemeTagConfig(e),e});this.rootStore=t,this.commonStore=t.commonStore,this.swapStore=t.swapStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore}get computedIsSearching(){return!!this.searchValue}get computedCollectionGroupParams(){let t={accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress};return this.currentCollectionGroupId?{...t,groupId:this.currentCollectionGroupId}:t}get computedAdresses(){return S(this,"accountStore.computedMultiAddresses",{})}setSearchTokenList(t){this.searchTokenList=t}setError(t){this.error=t}setLoading(t,e,o){this.loading[t][e]=o}get computedTokenList(){return this.tokenModalFromState===g.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){let t={};return U(this.searchTokenList)||(t={systemList:this.extendTokenList(this.searchTokenList?.systemList,!1),thirdPartyList:this.extendTokenList(this.searchTokenList?.thirdPartyList,!1)}),t}toLowerCaseContractAddress(t){let e=[];return Array.isArray(t)&&t.forEach(o=>{e.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),e}isCancel(t){return se(t)}getSearchParams(){throw new Error("getSearchParams method must be implemented by subclass")}get computedFromChain(){let t=ve(),e=Po({});return[t,e,...et(this.tokenPageChainList)]}get computedToChain(){let t=ve();if(_t(this.fromToStore.from.chainId)){let e=this.tokenPageChainList.filter(o=>o?.chainId===this.fromToStore.from.chainId);return[t,...e]}return[t]}get computedCurrentToChainId(){return this.toSelectedChainId||_t(this.toSelectedChainId)?this.toSelectedChainId:_t(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?X.chainId:si}reassignTokenInfo(t,e,o){if(this.commonStore.equalsToken(t,e)){let r=e?.isCollectToken;return St({},e,{isCollectToken:r?0:1,collectTime:r?"":Date.now().toString(),isCustomToken:o?1:e?.isCustomToken})}return t}filterCollectToken(t){let e=!t.isCustomToken||t.balance;return!!(!this.computedIsCollectChain&&e||this.searchValue||t.isCollectToken)}updateTokenCollectedLocal(t){let e=(o=[],r=!1)=>o.map(s=>this.reassignTokenInfo(s,t,r)).filter(s=>this.filterCollectToken(s));if(this.searchValue){let{systemList:o,thirdPartyList:r}=this.searchTokenList;this.setSearchTokenList({systemList:e(o),thirdPartyList:e(r,!0)})}else this.updateTokenList(e)}updateTokenList(t){if(this.tokenModalFromState===g.FROM){let e=t(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,e)}else if(this.tokenModalFromState===g.TO){let e=t(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,e)}}get computedCurrentChainId(){return $(this.tokenModalFromState===g.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedCurrentSearchChainId(){return $(this.tokenModalFromState===g.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch)}get computedIsCollectChain(){return this.computedCurrentChainId===V.chainId}setShowCollectCancelConfirm(t){b.set(En,t),this.hideCollectCancelConfirm=t}get computedIsNotSupportToChain(){let t=this.getCurrentToChainInfo();return this.tokenModalFromState===g.TO&&t&&t.disabled}get computedSelectedChainId(){return this.tokenModalFromState===g.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===g.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let t=this.commonStore.chainList;return this.tokenModalFromState===g.FROM?{supported:t,unsupported:[]}:this.tokenModalFromState===g.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let t=this.commonStore.chainList,e=Be(et(t),{chainId:Number(this.fromToStore.to.chainId)});return{supported:e?[e]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:t,unsupported:e}=this.computedAllChainList;return{supported:this.filterChains(t),unsupported:this.filterChains(e)}}get computedTokenGuideVisible(){return!1}get computedIsWatchListGroupShow(){return this.searchValue?!1:this.tokenModalFromState===g.FROM&&Number(this.fromSelectedChainId)===V.chainId||this.tokenModalFromState===g.TO&&Number(this.toSelectedChainId)===V.chainId}};var wo=class extends jt{constructor(e){super(e);i(this,"showChainTab",!0);i(this,"clearCacheTokenList",()=>{this.fromTokenList.clear(),this.toTokenList.clear()});i(this,"extendTokenList",(e=[],o=!0)=>U(e)?e:e?.map(r=>({...r,tokenList:this.extendTokens(r.tokenList,o)})));i(this,"generateToChainMap",()=>{let e=this.commonStore.chainList,r=Be(et(e),{chainId:Number(this.fromToStore.from.chainId)})?.bridgeSupportChainInfoList||[];return Ue([...r],"chainId")});i(this,"getCrossChainSearchType",()=>{let e=this.tokenModalFromState===g.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch;return Number(e)===V.chainId?zo.COLLECTION:zo.COMMON});i(this,"getToChainIdAtSearch",()=>{let e=this.toSelectedChainId;return this.tokenModalFromState===g.TO&&(e=this.toSelectedChainAtSearch),Number(e)===X.chainId?"":e});rt(this)}get computedTokenGuideVisible(){let{tokenModalFromState:e,hideTokenGuide:o}=this;return e===g.TO&&!o}get computedSearchTokenList(){return this.extendTokenList(this.searchTokenList?.list,!1)}get computedToChainList(){let e=this.commonStore.chainList,o=[],r=[],s=this.generateToChainMap();return e.forEach(n=>{let c={...n};c.disabled=!s[n.chainId],c.disabled||o.push(c)}),{supported:o,unsupported:r}}updateTokenCollectedLocal(e){let o=(r=[],s=!1)=>{let n=[];return r?.forEach(c=>{let m=c?.tokenList.map(l=>this.reassignTokenInfo(l,e,s)).filter(l=>this.filterCollectToken(l));n.push({...c,tokenList:m})}),n};if(this.searchValue){let{list:r}=this.searchTokenList;this.setSearchTokenList({list:o(r)})}else this.updateTokenList(o)}get computedToChain(){let e=ve(),o=Po({});if(_t(this.fromToStore.from.chainId)){let r=this.generateToChainMap(),s=[];return et(this.tokenPageChainList).forEach(n=>{n.chainId!==Number(this.fromToStore.from.chainId)&&s.push({...n,disabled:!r[n.chainId]})}),[e,o,...s]}return[e]}getSearchParams(e){let o={...this.computedAdresses};return this.tokenModalFromState===g.FROM&&(o={...o,fromChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&delete o.fromChainId),this.tokenModalFromState===g.TO&&(o={...o,fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch},this.needRemoveChainId(this.toSelectedChainAtSearch)&&delete o.toChainId),{fromChainId:o.fromChainId??o?.chainId,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,targetChainId:o.targetChainId,targetWalletAddress:o.targetWalletAddress,walletAddress:this.accountStore.computedSignWalletAddress,inputContent:e,selectChainType:this.getCrossChainSelectChainType(),searchType:this.getCrossChainSearchType(),toChainId:this.getToChainIdAtSearch(),fromTokenAddress:this.fromToStore.from?.tokenContractAddress||""}}};u();p();v();v();tt();var Xt=class{constructor(t){i(this,"liquidityModelVisible",!1);i(this,"dataStatus",kt.DEFAULT);i(this,"setDataStatus",t=>{this.dataStatus=t});i(this,"rawData",[]);i(this,"LiquidityCancelRef",null);i(this,"fetchLiquidityData",async()=>{this.resetAllLiquidityData(),this.setDataStatus(kt.LOADING);let{from:t}=this.fromToStore;this.LiquidityCancelRef&&this.LiquidityCancelRef.abort(),this.LiquidityCancelRef=lt();let[e,o]=await k(A.get(yi,{params:{chainId:t.chainId},signal:this.LiquidityCancelRef?.signal,isolate:!0}));if(e)this.setDataStatus(kt.ERROR);else{let r=S(o,"data");U(r)?this.setDataStatus(kt.NULL):(this.initAllLiquidityData(r),this.setDataStatus(kt.READY))}});i(this,"selectedListIds",[]);i(this,"setSelectedListIds",t=>{this.selectedListIds=t});i(this,"confirmIds",null);i(this,"setConfirmIds",t=>{this.confirmIds=t});i(this,"filterSelectedListIds",(t,e)=>{let o;e?o=Go(this.selectedListIds,t):o=Rr(this.selectedListIds,t),this.setSelectedListIds(de(o))});i(this,"searchLiquidityValue","");i(this,"setLiquiditySearchValue",t=>{this.searchLiquidityValue=t});this.rootStore=t,this.fromToStore=this.rootStore.fromToStore,N(this,{},{autoBind:!0})}setLiquidityModelVisible(t){this.liquidityModelVisible=t}setData(t){this.rawData=t}resetAllLiquidityData(){this.setData([]),this.setSelectedListIds([]),this.setConfirmIds(null)}initAllLiquidityData(t){this.setData(t);let e=qe(t,"id");this.setSelectedListIds(e);let o=this.fromToStore.from.chainId;_t(o)&&this.setConfirmIds(Fr({},o,e))}get computedListCheckedAll(){return this.computedSearchStatus?this.computedSearchIfAllChecked:this.selectedListIds.length===this.rawData.length}get computedCheckedAllDisabled(){return this.computedSearchStatus&&U(this.computedSearchData)}get computedLiquidityNum(){let{from:t}=this.rootStore.fromToStore,e="--",{dataStatus:o,rawData:r,confirmIds:s}=this;if(o===kt.NULL)e="0 / 0";else if(o===kt.READY){let n=S(s,t.chainId);e=`${!n||n&&n.length===0?r.length:n.length} / ${r.length}`}return e}get computedClearAll(){return U(this.selectedListIds)}checkAllBtn(){let t="",e=this.computedSearchStatus?this.computedSearchData:this.rawData,o=qe(e,"id");this.computedListCheckedAll?t=Go(this.selectedListIds,...o):t=xr(this.selectedListIds,o),this.setSelectedListIds(de(t))}get computedCheckedData(){return qe(this.rawData,e=>({...e,isChecked:!!wr(this.selectedListIds,e.id)}))}get computedSortListData(){return Wi(this.computedCheckedData)}get computedSearchStatus(){return!!this.searchLiquidityValue}get computedSearchDataIsNull(){return this.computedSearchStatus&&U(this.computedSearchData)}get computedSearchData(){return Hi(this.computedCheckedData,this.searchLiquidityValue)}get computedSearchIfAllChecked(){let t=Lr(this.computedSearchData,e=>e?.isChecked);return!U(this.computedSearchData)&&t}get computedShowData(){return this.searchLiquidityValue?this.computedSearchData:this.computedSortListData}get computedIds(){return S(this.rootStore.liquidityChooseStore?.confirmIds,this.rootStore.fromToStore?.from.chainId)}get computedIsCustomLiquidity(){return(this.computedIds||[]).length<this.rawData.length}get computedMonitorLiquidSelectType(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length?"all":t.length>1?"custom_>1":t.length===1?"custom_=1":""}get computedIsSelectedAllDex(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length}};u();p();v();var{BigNumber:Rn}=T,Sr="safemoon_slippage",gr="safemoon_is_changed",bn=50,Tr={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},$t=class{constructor(t){i(this,"isChanged",!1);i(this,"getSafemoonIsChangedLocal",()=>!!b.get(`${gr}_${this.computedSlippageTokenPair}`));i(this,"cacheSlippage",0);N(this),this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,It(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(b.get(`${gr}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(b.get(`${Sr}_${this.computedSlippageTokenPair}`))}),It(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(b.get(`${Sr}_${this.computedSlippageTokenPair}`))}),It(()=>this.computedSlippage,e=>{this.commonStore.safemoonSlippage=e})}setSafeMoonIsChanged(t){this.isChanged=t,b.set(`${gr}_${this.computedSlippageTokenPair}`,t)}checkIsChanged(t){let e=new Rn(t),o=e.gte(this.computedPairSlippage)&&e.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(t){!this.isAccessSlippage(t)||(this.setCacheSlippage(t),b.set(`${Sr}_${this.computedSlippageTokenPair}`,t))}isAccessSlippage(t){let e=new Rn(t);return this.computedPairSlippage>0&&e.gte(this.computedPairSlippage)&&e.lte(50)}get computedAutoSlippage(){return ho(this.rootStore)}get computedSafeMoonToken(){let{from:t,to:e}=this.fromToStore;return this.checkIsSafeMoon(t)?t:this.checkIsSafeMoon(e)?e:null}get computedHoneypot(){let{from:t,to:e}=this.fromToStore;return this.checkIsHoneypot(t)?t:this.checkIsHoneypot(e)?e:null}setCacheSlippage(t){this.cacheSlippage=t}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:t,to:e}=this.fromToStore;return`${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}_${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}`}get computedSlippageTips(){let t=S(this,"rootStore.quoteStore.quote.bestRoute"),e=Number(this.computedAutoSlippage),{tokenSymbol:o}=this.computedSafeMoonToken||{};return t?.isSafeMoonToken!=="1"||t?.isHoneypot==="1"?null:e===bn?{type:Tr.AdviseGivenSlip,safeMoonSlippage:e,equalLimit:!0,tip:d("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:o,slippageTolerance:e}),tipEquation:d("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:O(o),slippageTolerance:e}),inputWarning:d("swaptrade_adjustslip_modal_advise_givenslip")}:e>bn?{type:Tr.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:e,tip:d("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:o}),tipEquation:d("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:O(o)})}:{type:Tr.AdviseSlip,safeMoonSlippage:e,tip:d("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:o}),tipEquation:d("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:O(o)}),inputWarning:d("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:e})}}checkIsSafeMoon(t){return S(t,"isSafeMoonToken")===1}checkIsHoneypot(t){return S(t,"isHoneypot")===1}get computedInputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e[g.FROM]}get computedInputFiatVal(){let{computedIsExactIn:t,computedFromLocalCostByUsd:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e}get computedOutputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return t&&this.computedHoneypot?"":e[g.TO]}get computedOutputFiatVal(){let{computedIsExactIn:t,computedToLocalCostByUsd:e}=this.fromToStore;return t&&this.computedHoneypot?"":e}get computedOutputPopVal(){let{computedSwapAmount:t}=this.fromToStore;return this.computedHoneypot?"":xi(t[g.TO])}};u();p();var Oo=class{constructor(){i(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:b.get(Ho)===Xr.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});i(this,"setGasDropInfo",t=>{this.gasDropConfig={...this.gasDropConfig,...t}});i(this,"setGasDropSwitch",t=>{this.setGasDropInfo({gasDropSwitch:t}),b.set(Ho,`${Number(t)}`)});i(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});N(this)}get computedGasDropSelected(){let{gasDropShow:t,gasDropSwitch:e}=this.gasDropConfig;return t&&e}};u();p();var Cr=class{constructor(t){i(this,"isShowMev",!1);i(this,"setShowMev",t=>{this.isShowMev=t});i(this,"mevSwitchOpenStatue",eo.AUTO_OFF);i(this,"setMevUserSwitchOpen",t=>{this.mevSwitchOpenStatue=t});i(this,"mevInfo",{});i(this,"setMevInfo",t=>{this.mevInfo=t});i(this,"walletMevControl",!1);i(this,"setWalletMevControl",t=>{this.walletMevControl=t});this.rootStore=t,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,N(this,{},{autoBind:!0})}get computedIsMevOpen(){return this.isShowMev&&(this.mevSwitchOpenStatue===eo.AUTO_ON||this.mevSwitchOpenStatue===eo.USER_ON)}},No=Cr;u();p();v();var Ir=class{constructor(t){i(this,"feeConfig",{});i(this,"setFeeConfig",t=>{if(!this.isIframe)return;if(!U(t)){this.feeConfig=t,Te.set("feeConfig",t);return}let e=Te.get("feeConfig"),o=Ge(e,["referrerAddress","feePercent"]);U(o)?(this.feeConfig={},Te.remove("feeConfig")):this.feeConfig=o});i(this,"widgetFeeConfig",{});i(this,"setWidgetFeeConfig",t=>{this.isWidget&&(this.widgetFeeConfig=t)});i(this,"receiveQuoteUrl",()=>this.isIframe?ci:pi);i(this,"aggregatorQuoteUrl",()=>li);i(this,"saveOrderUrl",()=>this.isIframe?fi:hi);i(this,"illegalFeePercent",t=>{let{BigNumber:e}=T,o=e(t);return!!(o.isNaN()||o.gt(oi)||o.lte(0))});i(this,"extendFeeConfig",t=>{if(this.isWidget){let o=S(this.widgetFeeConfig,[t.chainId],{});if(typeof o.referrerAddress=="string")return{...t,...o};let r=S(o,["referrerAddress",t.fromTokenAddress]),s=S(r,"account"),c=S(r,"feePercent")||o.feePercent;return s?{...t,referrerAddress:s,feePercent:c}:t}if(!this.computedHasFeeConfig)return t;let e=U(this.feeConfig)?Te.get("feeConfig"):this.feeConfig;return{...t,...e}});N(this),this.rootStore=t,this.isIframe=!Nt()&&zi()&&!Zi,this.isWidget=!Nt()&&Ji()}get computedHasFeeConfig(){return!!this.feeConfig?.referrerAddress&&!!this.feeConfig?.feePercent&&this.isIframe}get computedFeeConfigErrorTips(){return this.computedHasFeeConfig?this.illegalFeePercent(this.feeConfig?.feePercent):!1}},Do=Ir;u();p();v();tt();u();p();v();tt();u();p();var Ln=()=>{let{swapStore:a,intentSwapStore:t,swapDappStore:e,approveStore:o,fromToStore:r}=E(),{from:s,to:n}=r;return!(!n?.tokenContractAddress||!s?.tokenContractAddress||o.visibleApprove||a.isConfirmLoading||t.isConfirmLoading||e.computedSupportDappTradeByChain)};u();p();u();p();var vn=a=>{let{fromToStore:t,quoteStore:e}=E(),{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s}=a,{computedIsSingleChain:n}=t,c=Number(o?.code)===ut.CROSS_CHAIN_INTERVAL,m=c?{crossMaxAmount:o?.crossMaxAmount,crossMiniAmount:o?.crossMiniAmount}:null;return e.setQuoteScope(m),{isAutoError:c||(n?!s:!r?.length)}};var Ta=({quoteStore:a,fromToStore:t})=>{a.setQuoteNumber(a.quoteNumber+1),a.quoteNumber===1&&a.checkQuoteScopeLtMin(a.quoteScope,t.from.amount)&&t.advanceSetTypedValue("")},Ca=(a,{fromToStore:t,quoteStore:e})=>{let{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s,swapType:n,intentCode:c,isSupportDappTrade:m,offlineType:l,traceData:h,serviceFeeInfo:C}=a,I={intentCode:c,offlineType:l,swapType:n,traceData:h},_=r?.map(D=>({...o,...D,...I,isSupportDappTrade:m}));return{bestRoute:t.computedIsSingleChain?{...o,...s,...I,serviceFeeInfo:C,intentInfo:a?.intentInfo||{},isSupportDappTrade:m}:e.pickBestRouterAccordingBridgeId(_)||{...o,...I,isSupportDappTrade:m},combineSelectionRouterList:_}},Ia=({bestRoute:a,combineSelectionRouterList:t,isAutoError:e},{fromToStore:o,quoteStore:r})=>{r.updateSlippageInfoFetched(a),r.setQuote({...r.quote,bestRoute:a,quoteNull:e,quoteError:null,isFetchQuoting:!1}),o.quoteUpdateFromTo(a),o.computedIsSingleChain||r.setPathSelectionRouterList(t||[])},Pe=({isAutoError:a},{approveStore:t})=>{a||t.isPendingNotCheck("NO_CHECK").catch(()=>{})},we=({isAutoError:a},{quoteStore:t})=>{a&&(t.handleReverseQuoteErrorAndNull(),gt(()=>{t.updateQuoteStatus(t.quoteScope?2:3)}))},Aa=a=>{let{solanaPriorityFeeStore:t}=E();t&&t.setJitoData(a?.priorityFeeInfo)},Pn=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=E(),{isAutoError:r}=vn(a);Ta({quoteStore:e,fromToStore:t});let{bestRoute:s,combineSelectionRouterList:n}=Ca(a,{fromToStore:t,quoteStore:e});Ia({bestRoute:s,combineSelectionRouterList:n,isAutoError:r},{fromToStore:t,quoteStore:e,approveStore:o}),Aa(a),Pe({isAutoError:r},{approveStore:o}),we({isAutoError:r},{quoteStore:e})};u();p();var Oe=class{constructor(t){i(this,"allTimerAndQuoteState",{[K.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[K.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>d(Ke)},[K.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>d(Ke)},[K.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>d(je)},[K.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>d(je)},[K.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>d(Ke)},[K.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>d(je)}});Object.assign(this,t)}isValidRange(t){if(typeof t!="string")return!1;let{from:e}=this.fromToStore,o=t.split("-");if(o.length!==2)return!1;let{BigNumber:r}=T;return r(e.amount).lt(o[0])||r(e.amount).gt(o[1])}getCurrentTimerQuoteState(){let{quoteNull:t,isFetchQuoting:e,quoteError:o,bestRoute:r}=this.quote,s=this.fromToStore?.computedIfQuote,n=o!==null;return s?n?this.allTimerAndQuoteState[K.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[K.QUOTE_IS_HONEYPOT]:t?r?.msg&&(e||this.isValidRange(r.msg))?this.allTimerAndQuoteState[K.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[K.QUOTE_NULL]:e?e?this.allTimerAndQuoteState[K.QUOTING]:this.allTimerAndQuoteState[K.DEFAULT]:this.allTimerAndQuoteState[K.TIMER]:this.allTimerAndQuoteState[K.DEFAULT]}};var{FACET_TOKEN_ERROR_ONE:_a,FACET_TOKEN_ERROR_TWO:Ea,FACET_TOKEN_ERROR_THREE:ya}=ut,zt=class{constructor(){i(this,"dialogCloseFlag",!1);i(this,"slippageInfoFetched",!1);i(this,"setDialogCloseFlag",t=>{this.dialogCloseFlag=t});i(this,"enableQuoteAggregates",!1);i(this,"dialogShowQuotationComparison",!1);i(this,"setDialogShowQuotationComparison",t=>{this.dialogShowQuotationComparison=t});i(this,"quoteNumber",0);i(this,"setQuoteNumber",t=>{this.quoteNumber=t});i(this,"aggregateSelectId",ot);i(this,"isDialog",!1);i(this,"setIsDialog",t=>{this.isDialog=t});i(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});i(this,"isPickRouterFromWallet",!1);i(this,"setIsPickRouterFromWallet",t=>{this.isPickRouterFromWallet=t});i(this,"quoteScope",null);i(this,"setQuoteScope",t=>{this.quoteScope=t});i(this,"fetchQuoteStatus",0);i(this,"quote",{...this.initQuote});i(this,"setQuote",t=>{this.quote=t});i(this,"pathSelectionRouterList",[]);i(this,"setPathSelectionRouterList",t=>{this.pathSelectionRouterList=t});i(this,"pickRouter",{});i(this,"setPickRouter",(t,e)=>{this.pickRouter=t,e&&(this.setNoCurrentPathTipInfo({bridgeName:t?.bridge?.bridgeName}),this.updateBestRoute(t))});i(this,"showChainListModel",!1);i(this,"setShowChainListModel",t=>{this.showChainListModel=t});i(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});i(this,"setNoCurrentPathTipInfo",t=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...t}});i(this,"currentBridgeId","");i(this,"setCurrentBridgeId",t=>{this.currentBridgeId=t});i(this,"updateBestRoute",t=>{this.setQuote({...this.quote,bestRoute:t}),this.rootStore.fromToStore?.quoteUpdateFromTo(t)});i(this,"pickBestRouterAccordingBridgeId",t=>{let{smartRouterStore:{showXRouteModal:e}}=this.rootStore;if(!t||t.length===0)return null;let o=t.find(r=>r?.bridge?.bridgeId===this.currentBridgeId);return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&e!==ro.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||t?.[0]});i(this,"quoteTimer",null);i(this,"clearQuote",()=>{this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1;let{computedIsCrossChain:t,computedIfQuote:e}=this.fromToStore;t?(this.setBridgeQuoteSelectStatus(0),this.setBridgeFetchStatus(e?1:0)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(e?1:0))});i(this,"cancelRef",null);i(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});i(this,"isClearQuote",()=>{let{currentTab:t}=this.commonStore,{computedTypedValue:e,from:o,to:r,computedIsSingleChain:s,computedIsExactIn:n}=this.fromToStore;return t===P.LIMIT_ORDER||!Ce(e)||!r?.tokenContractAddress||!o?.tokenContractAddress||!n&&!s});i(this,"getQuoteData",t=>{let e=nt();return k(ae(()=>A.get(this.getQuoteStoreUrl(),{params:e,signal:t,isolate:!0}),Tt.NUM,Tt.TIMER))});i(this,"handleUpdateQuote",t=>{if(t){let{data:e}=t;Pn(e)}});i(this,"fetchQuote",async({source:t}={})=>{if(!Ln())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Yo),Promise.resolve(!1);if(t===0){let{computedIsCrossChain:r}=this.fromToStore;r?(this.setBridgeQuoteSelectStatus(0),this.setBridgeFetchStatus(1),this.setBridgeSelectId(ot)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1),this.setAggregateSelectId(ot))}if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(null),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=lt();let[e,o]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!se(e)&&e&&this.handleQuoteError(e),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),!se(e)&&!this.dialogCloseFlag&&gt(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Yo)}),Promise.resolve(!0)});i(this,"quotePending",!1);i(this,"debounceQuote",br(this.fetchQuote,ei));i(this,"fetchQuoteDebounce",async({source:t}={})=>{let{computedIsCrossChain:e,computedIfQuote:o}=this.fromToStore;this.quotePending=!0,o&&e?await this.debounceQuote({source:t}):o&&!e?this.debounceQuote({source:t}):this.clearQuote()});i(this,"handleQuoteError",t=>{this.setQuote({...this.initQuote,quoteError:t}),this.handleReverseQuoteErrorAndNull()});i(this,"getGasTokenFeeLoading",!1);i(this,"getGasTokenFeeCancelRef",null);i(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});i(this,"cacheNativeGasFee","");i(this,"setCacheNativeGasFee",t=>{this.cacheNativeGasFee=t});i(this,"fetchGasTokenFee",async()=>{let{from:t}=this.rootStore.fromToStore,{computedReserveGas:e}=this.rootStore.commonStore,{decimals:o,balance:r}=t||{},s=Nr(nt(),["dexIds"]);this.getGasTokenFeeCancelRef=lt();let n=this.rootStore.fromToStore?.computedIsExactIn?ai:ui;this.getGasTokenFeeLoading=!0;let c=this.getGasTokenFeeCancelRef.signal,m=e,[l,h]=await k(A.get(n,{params:{...s,amount:Gi(r,o)},signal:c}));if(this.getGasTokenFeeLoading=!1,!se(l)&&l)return-1;if(!l){let{data:C}=h||{},{commonDexInfo:I}=C||{};Number(I?.code)===0&&I?.estimateReserveGasTokenFee!==""&&(m=I.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(m),m})}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(t){this.fetchQuoteStatus=t}get computedSlippage(){let{computedIsSingleChain:t,computedDefaultAutoSlippageInfo:e}=this.fromToStore,o=this.rootStore.slippageStore,r=ms({isSingleChain:t,autoSlippageInfo:e}),s=Bt.AUTO,n,c;return o&&(r=o.computedRealSlippageValue,s=o.getSlippageType(),n=t?o.computedRealCustomMaxSlippage:void 0,c=t?o.computedRealCustomSlippage:void 0),!this.slippageInfoFetched&&s===Bt.AUTO&&(s=Bt.DEFAULT),{slippage:r,slippageType:s,customSlippage:c,maxSlippage:n}}getQuoteStoreUrl(){return this.outerStore.receiveQuoteUrl()}handleReverseQuoteErrorAndNull(){let{updateFromAmount:t,computedIsExactIn:e,updateTo:o}=this.fromToStore;e?o({amount:""}):t({amount:""})}getQuoteError(t){let{commonDexInfo:e,pathSelectionRouterList:o,singleChainSwapInfo:r}=t,{computedIsSingleChain:s}=this.fromToStore,n=Number(e?.code)===ut.CROSS_CHAIN_INTERVAL,c=n?{crossMaxAmount:e?.crossMaxAmount,crossMiniAmount:e?.crossMiniAmount}:null;return this.setQuoteScope(c),{isAutoError:n||(s?!r:!o?.length)}}updateSlippageInfoFetched(t){let{referenceSlippage:e,autoSlippage:o,autoTotalSlippage:r}=t?.autoSlippageInfo||{};(e||o||r)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(t,e){if(!t||!e)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!T.BigNumber(e).lt(T.BigNumber(o))}get computedCurrentTimerQuoteState(){return new Oe(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){return this.fromToStore?.computedIsSingleChain?this.quote?.bestRoute:this.pickRouter}get computedMediaForChangeSmartRouterData(){return ji()?.media==="sm"||this.isDialog}get computedQuoteAmount(){let{computedIsExactIn:t}=this.fromToStore;return t?this.quote?.bestRoute?.fromTokenAmount:this.quote?.bestRoute?.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===G.EMPTY}get computedShouldShowLimitRegionTip(){let t=!!this.commonStore?.computedIsLimitRegion;return this.fromToStore?.computedIsSingleChain?t&&!this.quote?.bestRoute:t}get computedQuoteInterval(){let{safeMoonStore:t,fromToStore:e,approveStore:o,swapBtnStore:r,swapDappStore:s}=this.rootStore;if(t.computedHoneypot||e.computedFormToTokenIsLeverageToken)return{type:G.EMPTY};let n=bs.handleQuoteErrorState({quote:this.quote,honeypotToken:S(this,"rootStore.safeMoonStore.computedHoneypot",!1),shouldShowLimitRegionTip:this.computedShouldShowLimitRegionTip})||this.accountStore.computedNonsupportChain,{from:c,computedNonsupportFacetToken:m}=this.fromToStore;if(n||m)return{type:G.EMPTY};if(s.checkShouldJumpToDapp())return{type:G.SHOULD_JUMP_DAPPS};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:G.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:this.quote.bestRoute?.errorMsg};if(this.computedIsNoOkxLiquidity)return{type:G.NOT_OKX_LIQUIDITY};if((!this.quoteScope||!e.computedIfQuote)&&this.fetchQuoteStatus!==3&&!o.computedIsCancelApproveStatus&&!this.computedPriceWarn.show&&!this.quote?.bestRoute?.errorMsg)return{type:G.EMPTY};if(this.computedCrossAccuracyLimit)return{type:G.CROSS_CHAIN_ACCURACY,text:d("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:c.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:d("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:O(c.tokenSymbol),value:this.computedCrossAccuracyLimit})};if(this.computedFacetTokenTips)return{type:G.FACET_TOKEN_SWAP_ERROR,text:this.computedFacetTokenTips};let{crossMiniAmount:h,crossMaxAmount:C}=this.quoteScope||{};if(T.BigNumber(c.amount).lt(T.BigNumber(h))){let I=mt(h,{cutPriceText:!0,isFloor:!1});return{type:G.CROSS_CHAIN_MIN,text:d("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:I,symbol:c.tokenSymbol}),equation:d("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:I,symbol:O(c.tokenSymbol)})}}if(T.BigNumber(c.amount).gt(T.BigNumber(C))){let I=mt(C,{cutPriceText:!0});return{type:G.CROSS_CHAIN_MAX,text:d("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:I,symbol:c.tokenSymbol}),equation:d("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:I,symbol:O(c.tokenSymbol)})}}return this.quote?.bestRoute?.errorMsg?{type:G.CROSS_CHAIN_MORE_TIPS,text:this.quote?.bestRoute?.errorMsg}:this.computedIsNoLiquidity?{type:G.NOT_LIQUIDITY}:this.computedCrossChainIntervalOutOfRange?{type:G.NOT_LIQUIDITY}:o.computedIsCancelApproveStatus&&!r.computedTooBalance?{type:G.CANCEL_APPROVE_TIPS}:this.computedPriceWarn.show?{type:G.PROVIDER_PRICE_WARN}:{type:G.EMPTY}}get computedNotSupportFromBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===ut.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===ut.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedCrossChainIntervalOutOfRange(){let{from:t}=this.fromToStore,{crossMiniAmount:e,crossMaxAmount:o}=this.quoteScope||{};return T.BigNumber(t.amount).lte(o)&&T.BigNumber(t.amount).gte(e)}get computedIsNoLiquidity(){return this.fetchQuoteStatus===3&&this.quote.quoteNull}get computedIsNoOkxLiquidity(){let t=this.quote?.bestRoute?.defiPlatformInfoList;return this.enableQuoteAggregates&&t&&this.aggregateFetchStatus===3?!t.some(o=>o?.defiPlatformId===Q):!1}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:t,code:e}=this.quote.bestRoute||{};return Number(e)===ut.CROSS_CHAIN_ACCURACY?t:""}get computedFacetTokenTips(){let{errorMsg:t,code:e}=this.quote.bestRoute||{};return[_a,Ea,ya].includes(Number(e))&&t?t:""}get computedYouSaveVisible(){let{computedNowCurrencySymbol:t,currencyConversion:e,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:r,computedIsCrossChain:s}=this.rootStore.fromToStore,{quoteError:n,quoteNull:c,bestRoute:m}=this.quote;if(!r||n||c||!m?.youSaveDTO||s)return{visible:!1};let{youSaveDTO:l,fromToken:h,toToken:C}=m,{topTenDexInfoList:I,youSaveMoney:_}=l,w=Number(_)>=.1&&I?.length>0&&!h.isHoneypot&&!C.isHoneypot,D=e(_).toString(),F=w?Dt(D,t,{isFloor:!1}):"",dt=w?I?.[1]?.dexName:"";return o&&(!s&&this.computedTopTenDexInfoList.length>0?w=!0:w=!1),{visible:w,youSaveStr:F,dexName:dt}}get computedHasYouSave(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return!!this.quote?.bestRoute?.youSaveDTO||t}get computedTopTenDexInfoList(){if(!this.rootStore.fromToStore?.computedIsExactIn||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:t,currencyConversion:e}=this.commonStore;return this.quote?.bestRoute?.youSaveDTO?.topTenDexInfoList?.map(({logoUrl:o,dexName:r,comparePercent:s,price:n,dexAmountOut:c,amountOutOfMoney:m,gasOfMoney:l,isOkxDex:h})=>{let C=e(m)?.toString(),I=e(l)?.toString();return{logoUrl:o,dexName:r,comparePercent:s,price:n,isOkxDex:h,formatPrice:mt(n),dexAmountOut:T.BigNumber(c).toString(),formatDexAmountOut:mt(c),amountOutOfMoney:C,formatAmountOutOfMoney:Dt(C,t,{needBillionMillionUnit:!1}),gasOfMoney:Dt(I,t),symbol:t||""}})??[]}get computedReferredFee(){let{bestRoute:t}=this.quote,{referredNetWorkFee:e,referredAmount:o}=t||{};if(!o||!e)return"";let{computedNowCurrencySymbol:r,currencyConversion:s}=this.commonStore,{from:n}=this.fromToStore;return d("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${mt(o)} ${n.tokenSymbol}`,fee:`${Dt(s(e).toString(),r)}`})}get computedIsUsingCentralizedBridge(){let t=["8"],e=String(this.quote.bestRoute?.bridge?.bridgeId);return t.includes(e)}get computedIsNoQuote(){return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||this.rootStore.safeMoonStore?.computedHoneypot||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedSupportDappTradeByQuote(){return Number(this.quote?.bestRoute?.isSupportDappTrade)===1}setAggregateFetchStatus(t){return t}setAggregateSelectStatus(t){return t}setAggregateSelectId(t){return t}get computedIsOfflineType(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?Number(this?.quote?.bestRoute?.bridge?.bridgeType)===fs.INTENT_BRIDGE:this?.quote?.bestRoute?.offlineType===ds.YES}get computedIsFreeNetworkFee(){return this?.quote?.bestRoute?.bridge?.isFreeNetworkFee===hs.FREE_NETWORK_FEE}get computedIsOkxProvider(){return!this?.quote?.bestRoute?.defiPlatformId||this?.quote?.bestRoute?.defiPlatformId===Q}get computedBridgeIsOkxProvider(){let{defiPlatformId:t}=this?.quote?.bestRoute?.bridge||{};return!t||t===Q}get computedPriceWarn(){let t=T.BigNumber(this?.quote?.bestRoute?.reducePercent),e=T.BigNumber(this?.quote?.bestRoute?.warnPercent);return{show:t&&t.isGreaterThan(e)}}get computedreducePercent(){return Qi(this?.quote?.bestRoute?.reducePercent)}};u();p();v();var Ra=a=>{let{quoteStore:t,swapStore:e}=E();!a&&t.bridgeQuoteSelectStatus!==0&&(t.setBridgeNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setBridgeQuoteSelectStatus(0))},Nn=a=>Number(a.commonDexInfo?.code)===ut.CROSS_CHAIN_INTERVAL,ba=a=>!a.pathSelectionRouterList?.length,La=a=>Nn(a)||ba(a),va=a=>{let{quoteStore:t}=E(),e=Nn(a)?{crossMaxAmount:a.commonDexInfo?.crossMaxAmount,crossMiniAmount:a.commonDexInfo?.crossMiniAmount}:null;t.setQuoteScope(e)},Pa=a=>{let{quoteStore:t}=E(),e=t.bridgeSelectId===ot?a[0]:a?.find(o=>o.bridge.bridgeId===t.bridgeSelectId);return Ra(e),e||a[0]},wa=({data:a})=>{let{commonDexInfo:t,singleChainSwapInfo:e,swapType:o,pathSelectionRouterList:r,intentCode:s,isSupportDappTrade:n,offlineType:c,traceData:m}=a||{},l=r?.map((_,w)=>({commonDexInfo:t,..._,..._?.valueDiffInfo,isBest:w===0})),h={intentCode:s,offlineType:c,swapType:o,traceData:m},C={...e,...t,swapType:o,pathSelectionRouterList:l},I=l?.map(_=>({...t,..._,...h,isSupportDappTrade:n}));return{bestRoute:C,combineSelectionRouterList:I}},Oa=a=>{let{quoteStore:t,smartRouterStore:e}=E();if(e.showXRouteModal!==ro.XROUTER)return;let o=a.find(r=>r?.bridge?.bridgeId===t.pickRouter?.bridge?.bridgeId);o&&t.setPickRouter(o)},Na=({bestRoute:a,bridgeInfo:t,isAutoError:e,originData:o,combineSelectionRouterList:r},{fromToStore:s,quoteStore:n})=>{let c=St({},a,t);n.updateSlippageInfoFetched(c),n.setBridgeSelectId(c?.bridge?.bridgeId),n.setQuote({...n.quote,bestRoute:c,quoteNull:e,quoteError:null,isFetchQuoting:!1}),va(o),e&&n.setBridgeFetchStatus(3),s.quoteUpdateFromTo(c),s.computedIsCrossChain&&(n.setPathSelectionRouterList(r||[]),Oa(r||[]))},Dn=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=E(),{bestRoute:r,combineSelectionRouterList:s}=wa({data:a}),n=Pa(r.pathSelectionRouterList),c=La(a);e.setQuoteNumber(e.quoteNumber+1),Na({bestRoute:r,bridgeInfo:n,isAutoError:c,originData:a,combineSelectionRouterList:s},{fromToStore:t,quoteStore:e}),Pe({isAutoError:c},{approveStore:o}),we({isAutoError:c},{quoteStore:e})};var Ne=class extends zt{constructor(e){super();this.isEnableBridgeQuoteSearch=!0;this.bridgeListPending=!1;this.bridgeQuoteSelectStatus=0;this.bridgeFetchStatus=0;this.bridgeNoRouteTipStatus=0;this.compareVisible=!1;this.dialogGroupVisibleStatus=1;this.bridgeSortType=0;this.setBridgeSelectId=e=>{this.bridgeSelectId=e};this.setBridgeQuoteSelectStatus=e=>{this.bridgeQuoteSelectStatus=e};this.setBridgeFetchStatus=e=>{this.bridgeFetchStatus=e};this.setBridgeNoRouteTipStatus=e=>{this.bridgeNoRouteTipStatus=e};this.setBridgeList=e=>{this.bridgeList=e};this.setBridgeListPending=e=>{this.bridgeListPending=e};this.setBridgeSortType=e=>{this.bridgeSortType=e};this.setCompareVisible=e=>{this.compareVisible=e};this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};this.getQuoteData=e=>{let o=ln();return this.bridgeFetchStatus===0&&this.setBridgeFetchStatus(1),k(ae(()=>A.get(this.getQuoteStoreUrl(),{params:o,signal:e,isolate:!0}).then(r=>(this.setBridgeFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1,r)).catch(r=>{throw L.stuff(r),r}),Tt.NUM,Tt.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;Dn(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setBridgeFetchStatus(4)};rt(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await k(A.get(Si));if(e)throw e;return S(o,"data",[])}get bridgeList(){return(this.initialPropsStore.initialProps.bridgeList||[]).map(o=>({...o,platformId:o.chainId,logo:o.logoUrl}))}get computedIsBridgeListLoading(){return Qe()?!this.bridgeList?.length:this.bridgeListPending}async getBridgeList(){this.setBridgeListPending(!0),await k(this.initialPropsStore.getInitialProps({key:"bridgeList",callee:Ne})),this.setBridgeListPending(!1)}getQuoteStoreUrl(){return mi}},Mn=co(Ne);u();p();v();var xa="1",Ba="2",Fn={minValue:.01,maxValue:.5},xn={minValue:.03,maxValue:.5},Jt=class{constructor(t){i(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:"",mode:qt.DYNAMIC,level:Ut.LOW,customMax:""});i(this,"configSingle",Fn);i(this,"configCross",xn);i(this,"inputCache","");i(this,"isFrozen",!1);i(this,"setFrozenInfo",({computedSafeMoonNotSupport:t,isCrossBridgeOnly:e})=>{this.isFrozen=t||e});this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.smartRouterStore=t.smartRouterStore,N(this,{},{autoBind:!0})}setInputCache(t){this.inputCache=t}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:t}=this.slippageSetting,e=Et(this.rootStore);return t||this.isFrozen?{maxSlippage:this.computedRealCustomMaxSlippage,autoSlippageInfo:e}:{customSlippage:this.computedRealCustomSlippage,autoSlippageInfo:e}}get isSingleChain(){return this.rootStore.fromToStore.computedIsSingleChain}get minSlippage(){return this.isSingleChain?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.isSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return T.mul(this.minSlippage,100)}get maxSlippageShow(){return T.mul(this.maxSlippage,100)}get computedSupportCustomMax(){return S(Et(this.rootStore),"supportMaxSlippage",!1)}get computedFixedSlippageLevelMap(){if(!this.isSingleChain)return null;let t=S(Et(this.rootStore),"shortcutFixSlippage",Object.values(ss));return{low:yt(t[0]),medium:yt(t[1]),high:yt(t[2])}}get computedDynamicSlippageLimit(){let t=S(Et(this.rootStore),"dynamicSlippageRangeMin",Ae.DYNAMIC_MIN),e=S(Et(this.rootStore),"dynamicSlippageRangeMax",Ae.DYNAMIC_MAX),o=S(Et(this.rootStore),"recommendSlippageRangeMin",Ae.RECOMMEND_MIN),r=S(Et(this.rootStore),"recommendSlippageRangeMax",Ae.RECOMMEND_MAX);return{dynamicMin:yt(t),dynamicMax:yt(e),recommendMin:yt(o),recommendMax:yt(r)}}get computedAutoSlippage(){let{computedHoneypot:t}=this.getSafeMoonStore();if(t){let e=S(this,"rootStore.quoteStore.quote.bestRoute.realSlippage",0);return T.mul(e,100)}return ho(this.rootStore)}get computedRealCustomSlippage(){let t=S(this,"slippageSetting.inputSlippage","");return t?ke(t):""}get computedRealCustomMaxSlippage(){let t=S(this,"slippageSetting.customMax","");return t?ke(t):""}get computedSafeMoonNotSupport(){let{computedHoneypot:t,computedSlippageTips:e}=this.getSafeMoonStore();return!!(t||e?.overLimit||e?.equalLimit)}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){return this.getSafeMoonStore().computedSlippageTips?.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let t=this.getSlippageValue();return Number(ke(t))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let t=this.getSafeMoonStore(),e=this.smartRouterStore;return t.computedSafeMoonToken===null&&!e?.isCrossBridgeOnly}get computedVolatilityTips(){if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:t}=this,e=this.rootStore?.quoteStore?.quote?.bestRoute||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:r,fromPriceFluctuation:s,toPriceFluctuation:n,rateFluctuationThreshold:c,slippageFluctuationhold:m,rateFluctuation:l}=e,{from:h,to:C}=this.fromToStore,I=C?.tokenSymbol||"",_=h?.tokenSymbol||"",w=T.mul(m,100),D=T.mul(r,100),F=T.mul(c,100),dt=Number(l),it=Number(c);if(t>w){if(dt<it)return null}else if(t===w){let ht=Math.abs(s),vt=Math.abs(n),ft=Number(r);if(ht>ft&&vt>ft)return{tip:d("swaptrade_placeorder_alert_both_volatility",{payToken:_,receiveToken:I,value:D,min:o}),tipEquation:d("swaptrade_placeorder_alert_both_volatility",{payToken:O(_),receiveToken:O(I),value:D,min:o})};if(ht>ft)return{tip:d("swaptrade_placeorder_alert_pay_receive_volatility",{token:_,value:D,min:o}),tipEquation:d("swaptrade_placeorder_alert_pay_receive_volatility",{token:O(_),value:D,min:o})};if(vt>ft)return{tip:d("swaptrade_placeorder_alert_pay_receive_volatility",{token:I,value:D,min:o}),tipEquation:d("swaptrade_placeorder_alert_pay_receive_volatility",{token:O(I),value:D,min:o})};if(dt>=it)return{tip:d("swaptrade_settings_alert_both_exchange",{payToken:_,receiveToken:I,value:F,min:o}),tipEquation:d("swaptrade_settings_alert_both_exchange",{payToken:O(_),receiveToken:O(I),value:F,min:o})}}return null}getDefaultSetting(){let t={inputSlippage:"",autoIsSelected:!0,mode:qt.DYNAMIC,level:Ut.LOW,customMax:""},e=this.getSafeMoonStore();if(e.computedSafeMoonToken){let o=e.computedSlippage,r=Bo(o);e.isChanged&&r&&(t.inputSlippage=r,t.autoIsSelected=!1,t.mode=qt.FIXED,t.level=Ut.CUSTOM,t.customMax="")}return t}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?Bt.AUTO:Bt.CUSTOM}getSlippageValue(t=this.slippageSetting){let{autoIsSelected:e,inputSlippage:o}=t;return e||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(t){let e={...t},o=this.getSafeMoonStore(),{computedSafeMoonToken:r}=o;if(!r){this.slippageSetting=e;return}let s=this.getSlippageValue(e);if(s===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(s)||!o.getSafemoonIsChangedLocal()){e.inputSlippage="",e.autoIsSelected=!0,e.mode=qt.DYNAMIC,e.level=Ut.LOW;let n=Bo(s);o.isChanged&&n&&(e.inputSlippage=n,e.autoIsSelected=!1,e.mode=qt.FIXED,e.level=Ut.CUSTOM,e.customMax=""),o.setSafeMoonPairSlippage(s),this.slippageSetting=e}}async initSlippageConfigs(){try{let{data:t}=await A.get(ki),e=t?.find(({configId:r})=>xa===r),o=t?.find(({configId:r})=>Ba===r);e&&(this.configSingle=e),o&&(this.configCross=o)}catch{this.configSingle=Fn,this.configCross=xn}}initSlippageSetting(){let t=this.getDefaultSetting(),e;t?e={...t}:e={autoIsSelected:!0,inputSlippage:"",mode:qt.DYNAMIC,level:Ut.LOW,customMax:""},this.setSlippageSetting(e)}initReactions(){It(()=>{let{from:t,to:e}=this.fromToStore;return{chainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress}},({fromTokenAddress:t,toTokenAddress:e})=>t&&e?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.initSlippageSetting()):!1,{equals:Ve.shallow}),It(()=>{let{computedSafeMoonPairSlippage:t}=this;return{computedSafeMoonPairSlippage:t}},()=>{this.initSlippageSetting()},{equals:Ve.shallow}),It(()=>{let{quote:t}=this.rootStore.quoteStore,e=S(t,"bestRoute.smartRoutingMenuVoList"),o=S(e,[0,"smartRoutingMenuType"]),r=e&&e.length===1&&o===vs.BRIDGE,{computedSafeMoonNotSupport:s}=this;return{computedSafeMoonNotSupport:s,isCrossBridgeOnly:r}},this.setFrozenInfo,{equals:Ve.shallow})}get computedMinimumReceived(){let{quote:t,computedIsOfflineType:e}=this.rootStore.quoteStore,{receiveAmount:o,minimumReceived:r}=t?.bestRoute||{},s=this.fromToStore.to?.tokenSymbol;if(!Ce(o))return"--";let n=this.inputCache?ke(this.inputCache):this.computedRealSlippageValue,c=e?r:T.mul(o,1-(Ce(n)?n:0));return T.BigNumber(c).lte(0)?"--":`${mt(c,{needBillionMillionUnit:!1})} ${s}`}get computedMinimumReceivedIsOrange(){let{quote:t}=this.rootStore.quoteStore,e=this.computedMinimumReceived,o=t?.bestRoute?.receiveAmount,r=T.BigNumber(o);return!r.isZero()&&!r.isNaN()&&T.div(T.sub(r,e),r)>=.1}};u();p();v();tt();var kr=class{constructor(t){i(this,"checkCrossChainParams",()=>{let{quoteStore:t,receiveAddressStore:e}=this.rootStore,{quote:o}=t,r=this.checkCommonParams(),{receiveAddrObj:s}=e,n=S(o.bestRoute,"quoteNetWorkFeeOfMoney"),c=o?.bestRoute?.bridge?.bridgeId,m=s?.specifiedAddress;return{...r,fromSwapFeeUsd:n,bridgeId:c,receiveWalletAddress:m}});i(this,"checkCommonParams",()=>{let{accountStore:t,fromToStore:e,quoteStore:o}=this.rootStore,{from:r,to:s}=e;return{fromChainId:r.chainId,fromTokenAddress:r.tokenContractAddress,amount:o?.computedQuoteAmount,toChainId:s.chainId,toTokenAddress:s.tokenContractAddress,userWalletAddress:t.address,accountId:t.computedAccountId}});i(this,"repeatOrder",null);i(this,"checkRepeatOrder",async()=>{this.repeatOrder=null;let{fromChainId:t,...e}=this.checkCommonParams(),{quoteStore:{quote:o}}=this.rootStore,r=S(o.bestRoute,"fromSwapFeeUsd"),s={...e,chainId:t,fromSwapFeeUsd:r},[n,c]=await k(A.get(gi,{params:s}));!n&&[Ot.COMMON_REPEAT,Ot.BTC_REPEAT,Ot.FACET_REPEAT].includes(c?.data.repeatFlag)&&gt(()=>{let{orderId:m,enoughFlag:l}=c?.data??{};this.repeatOrder={enoughFlag:l,repeatFlag:c?.data.repeatFlag,id:m}})});i(this,"checkSwapMoreInfo",null);i(this,"checkCrossChainSwap",async()=>{this.checkSwapMoreInfo=null;let t=this.checkCrossChainParams(),[e,o]=await k(A.post(Ti,{...t}));e||gt(()=>{this.checkSwapMoreInfo=o?.data})});N(this),this.rootStore=t}},Mo=kr;u();p();tt();var Zt=class{constructor(t){i(this,"swapOnDappBtnLoading",!1);i(this,"setSwapOnDappBtnLoading",t=>{this.swapOnDappBtnLoading=t});i(this,"refreshing",!1);i(this,"setRefreshing",t=>{this.refreshing=t});i(this,"dappListContainerVisible",!1);i(this,"setDappListContainerVisible",t=>{this.dappListContainerVisible=t});i(this,"fetchDappListError",!1);i(this,"setFetchDappListError",t=>{this.fetchDappListError=t});i(this,"availableNoticeVisible",!1);i(this,"setAvailableNoticeVisible",t=>{this.availableNoticeVisible=t});i(this,"dappList",[]);i(this,"setDappList",t=>{this.dappList=t});i(this,"getFetchParam",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore||{},r={fromChainId:t?.chainId,toChainId:e?.chainId,fromTokenAddress:t?.tokenContractAddress,toTokenAddress:e?.tokenContractAddress};return{url:o?Oi:wi,params:r}});i(this,"fetchDappList",async t=>{t?(this.setFetchDappListError(!1),this.setRefreshing(!0)):this.setSwapOnDappBtnLoading(!0);let{url:e,params:o}=this.getFetchParam(),[r,s]=await k(A.get(e,{params:o}));if(this.setRefreshing(!1),this.setSwapOnDappBtnLoading(!1),r){if(Number(r.code)===40008){this.setAvailableNoticeVisible(!0);return}this.setFetchDappListError(!0),this.setDappListContainerVisible(!0);return}this.setDappList(s.data),this.setDappListContainerVisible(!0)});i(this,"getSupportDetail",(t={},e=!1)=>{let o=this.chainIsSupportMarket(t),r=this.chainIsSupportDappTrade(t),s=!!this.quoteStore?.computedSupportDappTradeByQuote,n=!o&&r,c=o&&r,m=o&&!r;return{chainSupportMarket:o,chainSupportDappTrade:r,quoteSupportDappTrade:s,balance:c||m,kline:c||m,klineJumpMarket:c||m,costValue:e&&c||m,valueDifference:m,liquidity:m,disableInput:n||c,showMax:m,showAddFund:m}});i(this,"mergeCurrencyInputProps",(t,e)=>({balanceStatus:e.balance?t.balanceStatus:ze.BALANCE_NOT_SHOW,costValue:e.costValue?t.costValue:"",valueDifference:e.valueDifference?t.valueDifference:{},disableInput:e.disableInput,showMax:e.showMax?t.showMax:!1,showMaxIcon:e.showMax?t.showMaxIcon:!1,showAddFund:e.showAddFund?t.showAddFund:!1}));i(this,"getCurrentFromToChainConfig",()=>{let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t),r=this.commonStore.getChainByID(e);return[o,r]});i(this,"chainIsSupportMarket",t=>Number(t?.isSupportMarket)===1);i(this,"chainIsSupportDappTrade",t=>Number(t?.isSupportDappTrade)===1);i(this,"bridgeSupportDappTrade",t=>Number(t?.supportLinkDapp)===1);i(this,"getSupportDappTradeByToken",()=>{let t=this.quoteStore?.computedSupportDappTradeByQuote,e=this.liquidityChooseStore?.computedIsSelectedAllDex;return this.fromToStore.computedIsSingleChain&&t&&e});i(this,"checkShouldJumpToDapp",()=>this.fromToStore.computedFormToTokenIsLeverageToken?!1:this.computedSupportDappTradeByChain?!0:this.getSupportDappTradeByToken());this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.quoteStore=t.quoteStore,this.liquidityChooseStore=t.liquidityChooseStore,N(this,{},{autoBind:!0})}get computedFromToSupportMarketAndDappTrade(){let[t,e]=this.getCurrentFromToChainConfig();return{from:{...this.getSupportDetail(t,!0)},to:{...this.getSupportDetail(e)}}}get computedFromToSupportMarket(){let[t,e]=this.getCurrentFromToChainConfig();return this.chainIsSupportMarket(t)&&this.chainIsSupportMarket(e)}get computedSupportDappTradeByChain(){let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t);if(this.fromToStore.computedIsSingleChain)return this.chainIsSupportDappTrade(o);let r=o?.bridgeSupportChainInfoList,s=Array.isArray(r)&&r.find(n=>Number(n.chainId)===Number(e));return this.bridgeSupportDappTrade(s)}};var pe=class extends Ht{constructor(){super();i(this,"reset",()=>{this.receiveAddressStore=new mo(this),this.outerStore=new Do(this),this.fromToStore=new po(this),this.approveStore=new Yt(this),this.quoteStore=new Mn(this),this.tokenModalStore=new wo(this),this.safeMoonStore=new $t(this),this.walletContractStore=new Lo(this),this.sendTransactionStore=new lo(this),this.intentSwapStore=new vo(this),this.swapCheckStore=new Mo(this),this.swapStore=new fo(this),this.swapBtnStore=new Kt(this),this.mevStore=new No(this),this.recentTransactionStore=new To(this),this.facetStore=new Co(this),this.liquidityChooseStore=new Xt(this),this.swapDappStore=new Zt(this),this.smartRouterStore=new ko(this),this.slippageStore=new Jt(this),this.oneMoreOrderStore=new Io(this),this.gasDropStore=new Oo});this.reset()}},De=pe;i(De,"instance",null),i(De,"getInstance",()=>(pe.instance||(pe.instance=new pe),pe.instance));var qn=De;u();p();u();p();var Fo=class extends jt{constructor(t){super(t),rt(this)}getSearchParams(t){return this.singleSearchParams(t)}};u();p();v();tt();u();p();v();var qa=a=>{let{quoteStore:t,swapStore:e}=E();!a&&t.aggregateSelectStatus!==0&&(t.setAggregateNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setAggregateSelectStatus(0))},Ua=a=>{let{quoteStore:t}=E(),e=t.aggregateSelectId===ot?a[0]:a.find(r=>r.defiPlatformId===t.aggregateSelectId),o=S(a.find(r=>r.defiPlatformId===Q),"dexRouterList",[]);return qa(e),St({},e||a[0],{dexRouterList:o})},Ga=({data:a,isCompareResult:t})=>{let{commonDexInfo:e,singleChainSwapInfo:o,swapType:r,isSupportDappTrade:s,defiPlatformInfoList:n,traceData:c}=a,m=n.map((h,C)=>({...h,isBest:C===0}));return{bestRoute:{...o,...e,isSupportDappTrade:t?s:"0",swapType:r,defiPlatformInfoList:m,traceData:c}}},Qa=({bestRoute:a,aggregateInfo:t,isAutoError:e},{fromToStore:o,quoteStore:r})=>{let s=St({},a,t);r.updateSlippageInfoFetched(s),r.setAggregateSelectId(s.defiPlatformId),r.setQuote({...r.quote,bestRoute:s,quoteNull:e,quoteError:null,isFetchQuoting:!1}),e&&r.setAggregateFetchStatus(4),o.quoteUpdateFromTo(s)},Va=a=>{let{solanaPriorityFeeStore:t}=E();t&&a?.jitoData&&t.setJitoData(a?.jitoData)},Un=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=E(),r=e.aggregateFetchStatus===3,{bestRoute:s}=Ga({data:a,isCompareResult:r}),n=Ua(s.defiPlatformInfoList),c=r&&s.defiPlatformInfoList.length===0;e.setQuoteNumber(e.quoteNumber+1),Qa({bestRoute:s,aggregateInfo:n,isAutoError:c},{fromToStore:t,quoteStore:e}),Va(a),Pe({isAutoError:c},{approveStore:o}),we({isAutoError:c},{quoteStore:e})};var Me=class extends zt{constructor(e){super();this.enableQuoteAggregates=!0;this.setAggregateSelectId=e=>{this.aggregateSelectId=e};this.aggregateSelectStatus=0;this.setAggregateSelectStatus=e=>{this.aggregateSelectStatus=e};this.aggregateFetchStatus=0;this.setAggregateFetchStatus=e=>{this.aggregateFetchStatus=e};this.fetchOKXQuote=({params:e,signal:o})=>{this.aggregateFetchStatus!==3&&A.get(this.outerStore.aggregatorQuoteUrl(),{params:St({},e,{defiPlatformIds:Q}),signal:o}).then(r=>{this.aggregateFetchStatus===1&&(this.setAggregateFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1)}).catch(r=>{L.stuff(r)})};this.getQuoteData=e=>{let o=nt();return this.fetchOKXQuote({params:o,signal:e}),k(ae(()=>this.fetchAggregatesQuote({params:o,signal:e}),Tt.NUM,Tt.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;Un(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.aggregateNoRouteTipStatus=0;this.setAggregateNoRouteTipStatus=e=>{this.aggregateNoRouteTipStatus=e};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setAggregateFetchStatus(5)};this.aggregatorListPending=!1;this.setAggregatorListPending=e=>{this.aggregatorListPending=e};this.fetchAggregatorList=async()=>{this.setAggregatorListPending(!0),await k(this.initialPropsStore.getInitialProps({key:"aggregatorList",callee:Me})),this.setAggregatorListPending(!1)};this.compareVisible=!1;this.setCompareVisible=e=>{this.compareVisible=e};this.dialogGroupVisibleStatus=1;this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};rt(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await k(A.get(di));if(e)throw e;return S(o,"data",[])}fetchAggregatesQuote({params:e,signal:o}){return A.get(this.outerStore.aggregatorQuoteUrl(),{params:e,signal:o,isolate:!0}).then(r=>(this.aggregateFetchStatus===2&&this.setAggregateSelectId(ot),this.setAggregateFetchStatus(3),r))}get aggregatorList(){return this.initialPropsStore.initialProps.aggregatorList||[]}get computedIsAggregatorListLoading(){return Qe()?!this.aggregatorList?.length:this.aggregatorListPending}},Gn=co(Me);u();p();u();p();v();var _r=a=>{if(!a)return[];let{solPrice:t,solTokenSymbol:e,solDecimals:o}=a;return rr.map(r=>({type:r,fee:a[`${r}Fee`],usd:a[`${r}FeeUsd`],solPrice:t,solTokenSymbol:e,solDecimals:o}))},Qn=a=>{let t={},e=Ue(_r(a),"type");return Pr(rr).forEach(o=>{t[o]={amount:e[o]?.fee||"",price:e[o]?.usd||""}}),t};var Er=class{constructor(t){i(this,"visible",!1);i(this,"setVisible",t=>{this.visible=t});i(this,"feeType",or.MARKET);i(this,"setFeeType",t=>{this.feeType=t});i(this,"customFee",null);i(this,"setCustomFee",t=>{this.customFee=t});i(this,"jitoData",null);i(this,"setJitoData",t=>{this.jitoData=t});this.rootStore=t,rt(this)}get computedPriorityFeeList(){return _r(this.jitoData)}get computedPriorityFeeMap(){return Qn(this.jitoData)}get computedPriorityFeeAmount(){return this.jitoData?this.feeType===or.CUSTOM?this.customFee:this.computedPriorityFeeList.find(e=>e.type===this.feeType)?.fee:null}get computedPriorityFeeOfUsd(){if(!this.jitoData)return null;let{solPrice:t}=this.jitoData;return T.mul(this.computedPriorityFeeAmount,t,{returnString:!0})}},Vn=Er;var me=class extends Ht{constructor(){super();i(this,"reset",()=>{this.receiveAddressStore=new mo(this),this.outerStore=new Do(this),this.fromToStore=new po(this),this.approveStore=new Yt(this),this.quoteStore=new Gn(this),this.tokenModalStore=new Fo(this),this.safeMoonStore=new $t(this),this.walletContractStore=new Lo(this),this.sendTransactionStore=new lo(this),this.intentSwapStore=new vo(this),this.swapCheckStore=new Mo(this),this.swapStore=new fo(this),this.swapBtnStore=new Kt(this),this.solanaPriorityFeeStore=new Vn(this),this.mevStore=new No(this),this.recentTransactionStore=new To(this),this.facetStore=new Co(this),this.liquidityChooseStore=new Xt(this),this.swapDappStore=new Zt(this),this.smartRouterStore=new ko(this),this.slippageStore=new Jt(this),this.oneMoreOrderStore=new Io(this)});this.reset()}},Fe=me;i(Fe,"instance",null),i(Fe,"getInstance",()=>(me.instance||(me.instance=new me),me.instance));var Wn=Fe;var Wa=({localeData:a,...t})=>{Ps();let e=(0,Hn.useLocation)(),o;return e.pathname.includes(J)?o=P.BRIDGE:e.pathname.includes(Xi)?o=P.LIMIT_ORDER:e.pathname===W&&(o=P.SWAP),xo.default.createElement(qi,{localeData:a,isDev:!0,noRemoteData:!0,customRender:r=>r},xo.default.createElement(Ns,{swapRootStore:Wn,bridgeRootStore:qn,initTab:o},xo.default.createElement(pn,{currentTab:o,...t})))},tI=ct(Wa);export{tI as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Advanced-KSCGIYGP.js.map
